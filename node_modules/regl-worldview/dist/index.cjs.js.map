{"version":3,"file":"index.cjs.js","sources":["../src/utils/getOrthographicBounds.js","../src/camera/cameraProject.js","../src/utils/commandUtils.js","../src/camera/cameraStateSelectors.js","../src/camera/CameraStore.js","../src/camera/camera.js","../src/camera/CameraListener.js","../src/camera/index.js","../src/utils/common.js","../src/utils/Raycast.js","../src/WorldviewReactContext.js","../src/commands/Command.js","../src/utils/aggregate.js","../src/utils/Dimensions.js","../src/utils/HitmapObjectIdManager.js","../src/utils/signal.js","../src/utils/queuePromise.js","../src/WorldviewContext.js","../src/Worldview.js","../src/utils/Bounds.js","../src/utils/eulerFromQuaternion.js","../src/utils/fromGeometry.js","../src/utils/parseGLB.js","../src/utils/getChildrenForHitmapDefaults.js","../src/utils/withRenderStateOverrides.js","../src/commands/Cylinders.js","../src/commands/Cones.js","../src/commands/Arrows.js","../src/commands/Lines.js","../src/commands/Axes.js","../src/commands/Cubes.js","../src/commands/Spheres.js","../src/commands/DrawPolygon/index.js","../src/commands/DrawPolygon/PolygonBuilder.js","../src/commands/Triangles.js","../src/commands/FilledPolygons.js","../src/commands/Text.js","../src/commands/GLText.js","../src/commands/GLTFScene.js","../src/commands/Grid.js","../src/commands/Overlay.js","../src/commands/Points.js","../src/commands/index.js","../src/types/index.js","../src/index.js"],"sourcesContent":["// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nclass BoundingBox {\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n  width: number;\n  height: number;\n\n  constructor(left: number, top: number) {\n    this.left = left;\n    this.top = top;\n    this.right = -left;\n    this.bottom = -top;\n    this.width = Math.abs(left) * 2;\n    this.height = Math.abs(top) * 2;\n  }\n}\n\nexport default function getOrthographicBounds(zDistance: number, width: number, height: number): BoundingBox {\n  const aspect = width / height;\n  // never go below ground level\n  const distanceToGround = Math.abs(zDistance);\n  const left = (-distanceToGround / 2) * aspect;\n  const top = distanceToGround / 2;\n  return new BoundingBox(left, top);\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\n// Copied from Jam3/camera-project\n// in order to replace gl-vec4 dependency with gl-matrix\n\nimport { vec4 } from \"gl-matrix\";\n\nimport type { Vec3, Vec4, Mat4 } from \"../types\";\n\nconst NEAR_RANGE = 0;\nconst FAR_RANGE = 1;\nconst tmp4 = [0, 0, 0, 0];\n\nexport default function cameraProject(out: any, vec: Vec3, viewport: Vec4, combinedProjView: Mat4): Vec4 {\n  const vX = viewport[0],\n    vY = viewport[1],\n    vWidth = viewport[2],\n    vHeight = viewport[3],\n    n = NEAR_RANGE,\n    f = FAR_RANGE;\n\n  // convert: clip space -> NDC -> window coords\n  // implicit 1.0 for w component\n  vec4.set(tmp4, vec[0], vec[1], vec[2], 1.0);\n\n  // transform into clip space\n  vec4.transformMat4(tmp4, tmp4, combinedProjView);\n\n  // now transform into NDC\n  const w = tmp4[3];\n  if (w !== 0) {\n    // how to handle infinity here?\n    tmp4[0] = tmp4[0] / w;\n    tmp4[1] = tmp4[1] / w;\n    tmp4[2] = tmp4[2] / w;\n  }\n\n  // and finally into window coordinates\n  // the foruth component is (1/clip.w)\n  // which is the same as gl_FragCoord.w\n  out[0] = vX + (vWidth / 2) * tmp4[0] + (0 + vWidth / 2);\n  out[1] = vY + (vHeight / 2) * tmp4[1] + (0 + vHeight / 2);\n  out[2] = ((f - n) / 2) * tmp4[2] + (f + n) / 2;\n  out[3] = w === 0 ? 0 : 1 / w;\n  return out;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport type { Color, Point, Orientation, ReglCommand, Vec4, Vec3 } from \"../types\";\n\nconst rotateGLSL = `\n  uniform vec3 _position;\n  uniform vec4 _rotation;\n\n  // rotate a 3d point v by a rotation quaternion q\n  vec3 rotate(vec3 v, vec4 q) {\n    vec3 temp = cross(q.xyz, v) + q.w * v;\n    return v + (2.0 * cross(q.xyz, temp));\n  }\n\n  vec3 applyPose(vec3 point) {\n    // rotate the point and then add the position of the pose\n    return rotate(point, _rotation) + _position;\n  }\n`;\n\nconst DEFAULT_TEXT_COLOR = { r: 1, g: 1, b: 1, a: 1 };\n\nexport const pointToVec3 = ({ x, y, z }: Point): Vec3 => {\n  return [x, y, z];\n};\nexport const orientationToVec4 = ({ x, y, z, w }: Orientation): Vec4 => {\n  return [x, y, z, w];\n};\n\nexport const vec3ToPoint = ([x, y, z]: Vec3): Point => ({ x, y, z });\n\nexport const vec4ToOrientation = ([x, y, z, w]: Vec4): Orientation => ({ x, y, z, w });\n\nexport const pointToVec3Array = (points: Point[]) => {\n  const result = new Float32Array(points.length * 3);\n  let i = 0;\n  for (const { x, y, z } of points) {\n    result[i++] = x;\n    result[i++] = y;\n    result[i++] = z;\n  }\n  return result;\n};\n\nexport const toRGBA = (val: Color) => {\n  return [val.r, val.g, val.b, val.a];\n};\n\nexport const vec4ToRGBA = (color: Vec4): Color => ({ r: color[0], g: color[1], b: color[2], a: color[3] });\n\nexport const toColor = (val: Color | Vec4): Color => (Array.isArray(val) ? vec4ToRGBA(val) : val);\n\nexport function getCSSColor(color: Color = DEFAULT_TEXT_COLOR) {\n  const { r, g, b, a } = color;\n  return `rgba(${(r * 255).toFixed()}, ${(g * 255).toFixed()}, ${(b * 255).toFixed()}, ${a.toFixed(3)})`;\n}\n\nconst toRGBAArray = (colors: $ReadOnlyArray<Color>): Float32Array => {\n  const result = new Float32Array(colors.length * 4);\n  let i = 0;\n  for (const { r, g, b, a } of colors) {\n    result[i++] = r;\n    result[i++] = g;\n    result[i++] = b;\n    result[i++] = a;\n  }\n  return result;\n};\n\nconst constantRGBAArray = (count: number, { r, g, b, a }: Color): Float32Array => {\n  const result = new Float32Array(count * 4);\n  for (let i = 0; i < count; i++) {\n    result[4 * i + 0] = r;\n    result[4 * i + 1] = g;\n    result[4 * i + 2] = b;\n    result[4 * i + 3] = a;\n  }\n  return result;\n};\n\n// default blend func params to be mixed into regl commands\nexport const defaultReglBlend = {\n  enable: true,\n  // this is the same gl.BlendFunc used by three.js by default\n  func: {\n    src: \"src alpha\",\n    dst: \"one minus src alpha\",\n    srcAlpha: 1,\n    dstAlpha: \"one minus src alpha\",\n  },\n  equation: {\n    rgb: \"add\",\n    alpha: \"add\",\n  },\n};\n\nexport const defaultReglDepth = {\n  enable: true,\n  mask: true,\n};\n\nexport const defaultDepth = {\n  enable: (context: any, props: any) => (props.depth && props.depth.enable) || defaultReglDepth.enable,\n  mask: (context: any, props: any) => (props.depth && props.depth.mask) || defaultReglDepth.mask,\n};\n\nexport const defaultBlend = {\n  ...defaultReglBlend,\n  enable: (context: any, props: any) => (props.blend && props.blend.enable) || defaultReglBlend.enable,\n  func: (context: any, props: any) => (props.blend && props.blend.func) || defaultReglBlend.func,\n};\n\n// TODO: deprecating, remove before 1.x release\nexport const blend = defaultBlend;\n\n// takes a regl command definition object and injects\n// position and rotation from the object pose and also\n// inserts some glsl helpers to apply the pose to points in a fragment shader\nexport function withPose(command: ReglCommand): ReglCommand {\n  const { vert, uniforms } = command;\n  const newVert = vert.replace(\"#WITH_POSE\", rotateGLSL);\n  const newUniforms = {\n    ...uniforms,\n    _position: (context, props) => {\n      const { position } = props.pose;\n      return Array.isArray(position) ? position : pointToVec3(position);\n    },\n    _rotation: (context, props) => {\n      const { orientation: r } = props.pose;\n      return Array.isArray(r) ? r : [r.x, r.y, r.z, r.w];\n    },\n  };\n  return {\n    ...command,\n    vert: newVert,\n    uniforms: newUniforms,\n  };\n}\n\nexport function getVertexColors({\n  colors,\n  color,\n  points,\n}: {\n  colors?: $ReadOnlyArray<Color> | $ReadOnlyArray<Vec4>,\n  color: Color,\n  points: $ReadOnlyArray<Point>,\n}): Float32Array | $ReadOnlyArray<Vec4> {\n  if ((!colors || !colors.length) && color) {\n    return constantRGBAArray(points.length, color);\n  }\n  if (colors) {\n    // $FlowFixMe this will go away once we consolidate getVertexColors and colorBuffer\n    return shouldConvert(colors) ? toRGBAArray(colors) : colors;\n  }\n  return [];\n}\n\nfunction hasNestedArrays(arr: any[]) {\n  return arr.length && Array.isArray(arr[0]);\n}\n\n// Returns a function which accepts a single color, an array of colors, and the number of instances,\n// and returns a color attribute buffer for use in regl.\n// If there are multiple colors in the colors array, one color will be assigned to each instance.\n// In the case of a single color, the same color will be used for all instances.\nexport function colorBuffer(regl: any) {\n  const buffer = regl.buffer({\n    usage: \"dynamic\",\n    data: [],\n  });\n\n  return function(color: any, colors: any, length: number) {\n    let data, divisor;\n    if (!colors || !colors.length) {\n      data = shouldConvert(color) ? toRGBA(color) : color;\n      divisor = length;\n    } else {\n      data = shouldConvert(colors) ? toRGBAArray(colors) : colors;\n      divisor = 1;\n    }\n    return {\n      buffer: buffer({\n        usage: \"dynamic\",\n        data,\n      }),\n      divisor,\n    };\n  };\n}\n\n// used to determine if the input/array of inputs is an object like {r: 0, g: 0, b: 0} or [0,0,0]\nexport function shouldConvert(props: any) {\n  if (!props || hasNestedArrays(props) || !isNaN(props[0])) {\n    return false;\n  }\n  return true;\n}\n\nexport function intToRGB(i: number = 0): Vec4 {\n  const r = ((i >> 16) & 255) / 255;\n  const g = ((i >> 8) & 255) / 255;\n  const b = (i & 255) / 255;\n  return [r, g, b, 1];\n}\n\nexport function getIdFromColor(rgb: Vec4): number {\n  const r = rgb[0] * 255;\n  const g = rgb[1] * 255;\n  const b = rgb[2] * 255;\n  return b | (g << 8) | (r << 16);\n}\n\nexport function getIdFromPixel(rgb: Uint8Array): number {\n  const r = rgb[0];\n  const g = rgb[1];\n  const b = rgb[2];\n  return b | (g << 8) | (r << 16);\n}\n\n// gl-matrix clone of three.js Vector3.setFromSpherical\n// phi: polar angle (between poles, 0 - pi)\n// theta: azimuthal angle (around equator, 0 - 2pi)\nexport function fromSpherical(out: number[], r: number, theta: number, phi: number): Vec3 {\n  const rSinPhi = r * Math.sin(phi);\n  out[0] = rSinPhi * Math.sin(theta);\n  out[1] = r * Math.cos(phi);\n  out[2] = rSinPhi * Math.cos(theta);\n  return (out: any);\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { vec3, quat, mat4 } from \"gl-matrix\";\nimport { createSelector } from \"reselect\";\n\nimport type { CameraState, Vec4, Vec3, Mat4 } from \"../types\";\nimport { fromSpherical } from \"../utils/commandUtils\";\n\nconst UNIT_X_VECTOR = Object.freeze([1, 0, 0]);\n\n// reusable arrays for intermediate calculations\nconst TEMP_VEC3 = [0, 0, 0];\nconst TEMP_MAT = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\nconst TEMP_QUAT = [0, 0, 0, 0];\n\nconst stateSelector = (state: CameraState) => state;\n\nconst perspectiveSelector = createSelector(\n  stateSelector,\n  ({ perspective }) => perspective\n);\nconst distanceSelector = createSelector(\n  stateSelector,\n  ({ distance }) => distance\n);\nconst phiSelector = createSelector(\n  stateSelector,\n  ({ phi }) => phi\n);\nconst thetaOffsetSelector = createSelector(\n  stateSelector,\n  ({ thetaOffset }) => thetaOffset\n);\nconst targetOrientationSelector = createSelector(\n  stateSelector,\n  ({ targetOrientation }) => targetOrientation\n);\n\n// the heading direction of the target\nconst targetHeadingSelector: (CameraState) => number = createSelector(\n  targetOrientationSelector,\n  (targetOrientation) => {\n    const out = vec3.transformQuat(TEMP_VEC3, UNIT_X_VECTOR, targetOrientation);\n    const heading = -Math.atan2(out[1], out[0]);\n    return heading;\n  }\n);\n\n// orientation of the camera\nconst orientationSelector: (CameraState) => Vec4 = createSelector(\n  perspectiveSelector,\n  phiSelector,\n  thetaOffsetSelector,\n  (perspective, phi, thetaOffset) => {\n    const result = quat.identity([0, 0, 0, 0]);\n    quat.rotateZ(result, result, -thetaOffset);\n\n    // phi is ignored in 2D mode\n    if (perspective) {\n      quat.rotateX(result, result, phi);\n    }\n    return result;\n  }\n);\n\n// position of the camera\nconst positionSelector: (CameraState) => Vec3 = createSelector(\n  thetaOffsetSelector,\n  phiSelector,\n  distanceSelector,\n  (thetaOffset, phi, distance) => {\n    const position = fromSpherical([], distance, thetaOffset, phi);\n\n    // poles are on the y-axis in spherical coordinates; rearrange so they are on the z axis\n    const [x, y, z] = position;\n    position[0] = -x;\n    position[1] = -z;\n    position[2] = y;\n\n    return position;\n  }\n);\n\n/*\nGet the view matrix, which transforms points from world coordinates to camera coordinates.\n\nAn equivalent and easier way to think about this transformation is that it takes the camera from\nits actual position/orientation in the world, and moves it to have position=0,0,0 and orientation=0,0,0,1.\n\nWe build up this transformation in 5 steps as demonstrated below:\n   T = target\n   < = direction of target\n   * = target with offset (position that the camera is looking at)\n   C = camera (always points toward *)\n\nStarting point: actual positions in world coordinates\n\n  |      *\n  |  <T   C\n  |\n  +--------\n\nStep 1: translate target to the origin\n\n  |\n  |  *\n <T---C----\n\nStep 2: rotate around the origin so the target points forward\n(Here we use the target's heading only, ignoring other components of its rotation)\n\n  |\n  ^\n  T--------\n  |\n  | *\n  C\n\nStep 3: translate the target-with-offset point to be at the origin\n\n ^\n T|\n  |\n  *--------\n C|\n  |\n\n\nStep 4: translate the camera to be at the origin\n(Steps 3 and 4 are both translations, but they're kept separate because it's easier\nto conceptualize: 3 uses the targetOffset and 4 uses the distance+thetaOffset+phi.)\n\n ^\n T\n |\n |*\n C--------\n |\n\nStep 5: rotate the camera to point forward\n\n \\\n  T  |\n     *\n     C--------\n     |\n\n*/\nconst viewSelector: (CameraState) => Mat4 = createSelector(\n  stateSelector,\n  orientationSelector,\n  positionSelector,\n  targetHeadingSelector,\n  ({ target, targetOffset, perspective }, orientation, position, targetHeading) => {\n    const m = mat4.identity([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n\n    // apply the steps described above in reverse because we use right-multiplication\n\n    // 5. rotate camera to point forward\n    mat4.multiply(m, m, mat4.fromQuat(TEMP_MAT, quat.invert(TEMP_QUAT, orientation)));\n\n    // 4. move camera to the origin\n    if (perspective) {\n      mat4.translate(m, m, vec3.negate(TEMP_VEC3, position));\n    }\n\n    // 3. move center to the origin\n    mat4.translate(m, m, vec3.negate(TEMP_VEC3, targetOffset));\n\n    // 2. rotate target to point forward\n    mat4.rotateZ(m, m, targetHeading);\n\n    // 1. move target to the origin\n    vec3.negate(TEMP_VEC3, target);\n    if (!perspective) {\n      // if using orthographic camera ensure the distance from \"ground\"\n      // stays large so no reasonably tall item goes past the camera\n      TEMP_VEC3[2] = -2500;\n    }\n    mat4.translate(m, m, TEMP_VEC3);\n\n    return m;\n  }\n);\n\nconst billboardRotation: (CameraState) => Mat4 = createSelector(\n  orientationSelector,\n  targetHeadingSelector,\n  (orientation, targetHeading) => {\n    const m = mat4.identity(mat4.create());\n    mat4.rotateZ(m, m, -targetHeading);\n    mat4.multiply(m, m, mat4.fromQuat(TEMP_MAT, orientation));\n    return m;\n  }\n);\n\nexport default {\n  orientation: orientationSelector,\n  position: positionSelector,\n  targetHeading: targetHeadingSelector,\n  view: viewSelector,\n  billboardRotation,\n};\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { vec3, quat } from \"gl-matrix\";\n\nimport type { Vec2, Vec3, Vec4 } from \"../types\";\nimport selectors from \"./cameraStateSelectors\";\n\nexport type CameraState = {|\n  distance: number,\n  perspective: boolean,\n  phi: number,\n  target: Vec3,\n  targetOffset: Vec3,\n  targetOrientation: Vec4,\n  thetaOffset: number,\n  fovy: number,\n  near: number,\n  far: number,\n|};\n\n//  we use up on the +z axis\nconst UNIT_Z_VECTOR = Object.freeze([0, 0, 1]);\n// reusable array for intermediate calculations\nconst TEMP_QUAT = [0, 0, 0, 0];\n\nexport const DEFAULT_CAMERA_STATE: CameraState = {\n  distance: 75,\n  perspective: true,\n  phi: Math.PI / 4,\n  target: [0, 0, 0],\n  targetOffset: [0, 0, 0],\n  targetOrientation: [0, 0, 0, 1],\n  thetaOffset: 0,\n  fovy: Math.PI / 4,\n  near: 0.01,\n  far: 5000,\n};\n\nfunction distanceAfterZoom(startingDistance: number, zoomPercent: number): number {\n  // keep distance above 0 so that percentage-based zoom always works\n  return Math.max(0.001, startingDistance * (1 - zoomPercent / 100));\n}\n\nexport default class CameraStore {\n  state: CameraState;\n\n  _onChange: (CameraState) => void;\n\n  constructor(\n    handler: (CameraState) => void = () => {},\n    initialCameraState: $Shape<CameraState> = DEFAULT_CAMERA_STATE\n  ) {\n    this._onChange = handler;\n    this.setCameraState(initialCameraState);\n  }\n\n  setCameraState = (state: $Shape<CameraState>) => {\n    // Fill in missing properties from DEFAULT_CAMERA_STATE.\n    // Mutate the `state` parameter instead of copying -- this\n    // matches the previous behavior of this method, which didn't\n    // fill in missing properties but also didn't copy `state`.\n    for (const [key, value] of Object.entries(DEFAULT_CAMERA_STATE)) {\n      if (state[key] == null) {\n        state[key] = value;\n      }\n    }\n    // `state` must be a valid CameraState now, because we filled in\n    // missing properties from DEFAULT_CAMERA_STATE.\n    this.state = (state: any);\n  };\n\n  cameraRotate = ([x, y]: Vec2) => {\n    // This can happen in 2D mode, when both e.movementX and e.movementY are evaluated as negative and mouseX move is 0\n    if (x === 0 && y === 0) {\n      return;\n    }\n    const { thetaOffset, phi } = this.state;\n    this.setCameraState({\n      ...this.state,\n      thetaOffset: thetaOffset - x,\n      phi: Math.max(0, Math.min(phi + y, Math.PI)),\n    });\n    this._onChange(this.state);\n  };\n\n  // move the camera along x, y axis; do not move up/down\n  cameraMove = ([x, y]: Vec2) => {\n    // moveX and moveY both be 0 sometimes\n    if (x === 0 && y === 0) {\n      return;\n    }\n\n    const { targetOffset, thetaOffset } = this.state;\n\n    // rotate around z axis so the offset is in the target's reference frame\n    const result = [x, y, 0];\n    const offset = vec3.transformQuat(result, result, quat.setAxisAngle(TEMP_QUAT, UNIT_Z_VECTOR, -thetaOffset));\n\n    this.setCameraState({\n      ...this.state,\n      targetOffset: vec3.add(offset, targetOffset, offset),\n    });\n    this._onChange(this.state);\n  };\n\n  cameraZoom = (zoomPercent: number) => {\n    const { distance } = this.state;\n    const newDistance: number = distanceAfterZoom(distance, zoomPercent);\n    if (distance === newDistance) {\n      return;\n    }\n\n    this.setCameraState({\n      ...this.state,\n      distance: newDistance,\n    });\n    this._onChange(this.state);\n  };\n}\n\nexport { selectors };\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { mat4 } from \"gl-matrix\";\n\nimport type { Vec3, Mat4, CameraCommand, Viewport } from \"../types\";\nimport getOrthographicBounds from \"../utils/getOrthographicBounds\";\nimport project from \"./cameraProject\";\nimport { selectors, DEFAULT_CAMERA_STATE, type CameraState } from \"./CameraStore\";\n\nconst TEMP_MAT = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n\n// This is the regl command which encapsulates the camera projection and view matrices.\n// It adds the matrices to the regl context so they can be used by other commands.\nexport default (regl: any) => {\n  return class Camera implements CameraCommand {\n    viewportWidth: number = 0;\n    viewportHeight: number = 0;\n    cameraState: CameraState = DEFAULT_CAMERA_STATE;\n\n    getProjection(): Mat4 {\n      const { near, far, distance, fovy } = this.cameraState;\n      if (!this.cameraState.perspective) {\n        const bounds = getOrthographicBounds(distance, this.viewportWidth, this.viewportHeight);\n        const { left, right, bottom, top } = bounds;\n        return mat4.ortho([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], left, right, bottom, top, near, far);\n      }\n      const aspect = this.viewportWidth / this.viewportHeight;\n      return mat4.perspective([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], fovy, aspect, near, far);\n    }\n\n    getView(): Mat4 {\n      return selectors.view(this.cameraState);\n    }\n\n    // convert a point in 3D space to a point on the screen\n    toScreenCoord(viewport: Viewport, point: Vec3) {\n      const projection = this.getProjection();\n      const view = selectors.view(this.cameraState);\n      const combinedProjView = mat4.multiply(TEMP_MAT, projection, view);\n      const [x, y, z, w] = project([], point, viewport, combinedProjView);\n      if (z < 0 || z > 1 || w < 0) {\n        // resulting point is outside the window depth range\n        return undefined;\n      }\n      const diffY = viewport[3] + viewport[1];\n      const diffX = viewport[0];\n      // move the x value over based on the left of the viewport\n      // and move the y value over based on the bottom of the viewport\n      return [x - diffX, diffY - y, z];\n    }\n\n    draw = regl({\n      // adds context variables to the regl context so they are accessible from commands\n      context: {\n        // use functions, not lambdas here to make sure we can access\n        // the regl supplied this scope: http://regl.party/api#this\n        projection(context, props) {\n          const { viewportWidth, viewportHeight } = context;\n          // save these variables on the camera instance\n          // because we need them for raycasting\n          this.viewportWidth = viewportWidth;\n          this.viewportHeight = viewportHeight;\n          this.cameraState = props;\n          return this.getProjection();\n        },\n\n        view(context, props) {\n          return this.getView();\n        },\n\n        // inverse of the view rotation, used for making objects always face the camera\n        billboardRotation(context, props) {\n          return selectors.billboardRotation(this.cameraState);\n        },\n\n        isPerspective(context, props) {\n          return this.cameraState.perspective;\n        },\n\n        fovy(context, props) {\n          return this.cameraState.fovy;\n        },\n      },\n\n      // adds view and projection as uniforms to every command\n      // and makes them available in the shaders\n      uniforms: {\n        view: regl.context(\"view\"),\n        billboardRotation: regl.context(\"billboardRotation\"),\n        projection: regl.context(\"projection\"),\n      },\n    });\n  };\n};\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport normalizeWheel from \"normalize-wheel\";\nimport * as React from \"react\";\n\nimport type { CameraKeyMap, CameraAction, Vec2 } from \"../types\";\nimport getOrthographicBounds from \"../utils/getOrthographicBounds\";\nimport CameraStore from \"./CameraStore\";\n\nconst PAN_SPEED = 4;\nconst MOUSE_ZOOM_SPEED = 0.3;\nconst KEYBOARD_MOVE_SPEED = 0.3;\nconst KEYBOARD_ZOOM_SPEED = 150;\nconst KEYBOARD_SPIN_SPEED = 1.5;\n\nconst DEFAULT_KEYMAP: CameraKeyMap = {\n  KeyA: \"moveLeft\",\n  KeyD: \"moveRight\",\n  KeyE: \"rotateRight\",\n  KeyF: \"tiltUp\",\n  KeyQ: \"rotateLeft\",\n  KeyR: \"tiltDown\",\n  KeyS: \"moveDown\",\n  KeyW: \"moveUp\",\n  KeyX: \"zoomOut\",\n  KeyZ: \"zoomIn\",\n};\n\ntype KeyMotion = { x?: number, y?: number, zoom?: number, yaw?: number, tilt?: number };\n\ntype Props = {|\n  cameraStore: CameraStore,\n  keyMap?: CameraKeyMap,\n  shiftKeys: boolean,\n  children?: React.ChildrenArray<React.Element<any> | null>,\n|};\n\n// attaches mouse and keyboard listeners to allow for moving the camera on user input\nexport default class CameraListener extends React.Component<Props> {\n  _keyTimer: ?AnimationFrameID;\n  _keys: Set<string> = new Set();\n  _buttons: Set<number> = new Set();\n  _listeners = [];\n  _shiftKey = false;\n  _metaKey = false;\n  _ctrlKey = false;\n\n  _el: ?HTMLDivElement;\n  _rect: ClientRect | DOMRect;\n  _initialMouse: Vec2;\n\n  componentDidMount() {\n    const { _el } = this;\n    if (!_el) {\n      return;\n    }\n\n    this._rect = _el.getBoundingClientRect();\n    const listen = (target: any, name: string, fn) => {\n      target.addEventListener(name, fn);\n      this._listeners.push({ target, name, fn });\n    };\n    listen(document, \"blur\", this._onBlur);\n    listen(window, \"mouseup\", this._onWindowMouseUp);\n    _el.addEventListener(\"wheel\", this._onWheel, { passive: false });\n  }\n\n  componentWillUnmount() {\n    this._listeners.forEach((listener) => {\n      listener.target.removeEventListener(listener.name, listener.fn);\n    });\n    this._endDragging();\n    const { _el } = this;\n    if (!_el) {\n      return;\n    }\n    _el.removeEventListener(\"wheel\", this._onWheel, { passive: false });\n  }\n\n  focus() {\n    if (this._el) {\n      this._el.focus();\n    }\n  }\n\n  _getMouseOnScreen = (mouse: MouseEvent) => {\n    const { clientX, clientY } = mouse;\n    const { top, left, width, height } = this._rect;\n    const x = (clientX - left) / width;\n    const y = (clientY - top) / height;\n    return [x, y];\n  };\n\n  _onMouseDown = (e: MouseEvent) => {\n    const { _el } = this;\n    if (!_el) {\n      return;\n    }\n\n    e.preventDefault();\n    this._buttons.add(e.button);\n    _el.focus();\n    this._rect = _el.getBoundingClientRect();\n    this._initialMouse = this._getMouseOnScreen(e);\n    this.startDragging(e);\n  };\n\n  _isLeftMouseDown() {\n    return this._buttons.has(0);\n  }\n\n  _isRightMouseDown() {\n    return this._buttons.has(2);\n  }\n\n  _getMagnitude(base: number = 1) {\n    return this._shiftKey ? base / 10 : base;\n  }\n\n  _getMoveMagnitude() {\n    // avoid interference with drawing tools\n    if (this._ctrlKey) {\n      return { x: 0, y: 0 };\n    }\n\n    const {\n      cameraStore: {\n        state: { distance, perspective },\n      },\n    } = this.props;\n    if (perspective) {\n      // in perspective mode its more like flying, so move by the magnitude\n      // we use the camera distance as a heuristic\n      return { x: distance, y: distance };\n    }\n    // in orthographic mode we know the exact viewable area\n    // which is a square so we can move exactly percentage within it\n    const { width, height } = this._rect;\n    const bounds = getOrthographicBounds(distance, width, height);\n    return { x: bounds.width, y: bounds.height };\n  }\n\n  _onWindowMouseMove = (e: MouseEvent) => {\n    if (!this._buttons.size) {\n      return;\n    }\n    this._shiftKey = e.shiftKey;\n    const {\n      cameraStore: {\n        cameraMove,\n        cameraRotate,\n        state: { perspective },\n      },\n    } = this.props;\n\n    // compute the amount the mouse has moved\n    let moveX, moveY;\n    const mouse = this._getMouseOnScreen(e);\n    // when pointer lock is enabled, we get movementX and movementY (with direction reversed)\n    // instead of the screenX/screenY changing... except, when using synergy, they come through\n    // like regular mousemove events.\n    if ((document: any).pointerLockElement && (e.movementX || e.movementY)) {\n      moveX = -e.movementX / this._rect.width;\n      moveY = -e.movementY / this._rect.height;\n    } else {\n      moveX = this._initialMouse[0] - mouse[0];\n      moveY = this._initialMouse[1] - mouse[1];\n    }\n    this._initialMouse = mouse;\n\n    if (this._isRightMouseDown()) {\n      const magnitude = this._getMagnitude(PAN_SPEED);\n      // in orthographic mode, flip the direction of rotation so \"left\" means \"counterclockwise\"\n      const x = (perspective ? moveX : -moveX) * magnitude;\n      // do not rotate vertically in orthograhpic mode\n      const y = perspective ? moveY * magnitude : 0;\n      cameraRotate([x, y]);\n    }\n\n    if (this._isLeftMouseDown()) {\n      const { x, y } = this._getMoveMagnitude();\n      cameraMove([this._getMagnitude(moveX * x), this._getMagnitude(-moveY * y)]);\n    }\n  };\n\n  _onMouseUp = (e: MouseEvent) => {\n    this._buttons.delete(e.button);\n    this._endDragging();\n  };\n\n  _onWindowMouseUp = (e: MouseEvent) => {\n    const { _el } = this;\n    if (!_el) {\n      return;\n    }\n\n    // do nothing if this container had a mouseup, because we catch it in the onMouseUp handler\n    if (_el.contains((e.target: any)) || e.target === _el) {\n      return;\n    }\n    // If mouseup triggers on the window outside this container, clear any active interactions.\n    // This will allow a mouseup outside the browser window to be handled; otherwise the mouse\n    // \"sticks\" in a down position until another click on this element is received.\n    this._buttons.clear();\n    this._endDragging();\n  };\n\n  startDragging(e: MouseEvent) {\n    if (e.button !== 0 && this._el && typeof this._el.requestPointerLock === \"function\") {\n      this._el.requestPointerLock();\n    }\n    window.addEventListener(\"mousemove\", this._onWindowMouseMove);\n  }\n\n  _endDragging() {\n    window.removeEventListener(\"mousemove\", this._onWindowMouseMove);\n    if (typeof (document: any).exitPointerLock === \"function\") {\n      (document: any).exitPointerLock();\n    }\n  }\n\n  _getKeyMotion = (code: string): ?KeyMotion => {\n    const moveSpeed = this._getMagnitude(KEYBOARD_MOVE_SPEED);\n    const zoomSpeed = this._getMagnitude(KEYBOARD_ZOOM_SPEED);\n    const spinSpeed = this._getMagnitude(KEYBOARD_SPIN_SPEED);\n    const { keyMap, shiftKeys } = this.props;\n    const action: CameraAction | false = (keyMap && keyMap[code]) || DEFAULT_KEYMAP[code] || false;\n\n    if (this._shiftKey && !shiftKeys) {\n      return null;\n    }\n\n    switch (action) {\n      case \"moveRight\":\n        return { x: moveSpeed };\n      case \"moveLeft\":\n        return { x: -moveSpeed };\n      case \"moveUp\":\n        return { y: moveSpeed };\n      case \"moveDown\":\n        return { y: -moveSpeed };\n      case \"zoomIn\":\n        return { zoom: zoomSpeed };\n      case \"zoomOut\":\n        return { zoom: -zoomSpeed };\n      case \"rotateLeft\":\n        return { yaw: -spinSpeed };\n      case \"rotateRight\":\n        return { yaw: spinSpeed };\n      case \"tiltUp\":\n        return { tilt: -spinSpeed };\n      case \"tiltDown\":\n        return { tilt: spinSpeed };\n      case false:\n        return null;\n      default:\n        (action: empty);\n        console.warn(\"Unrecognized key action:\", action);\n        return null;\n    }\n  };\n\n  _moveKeyboard(dt: number) {\n    const motion = { x: 0, y: 0, zoom: 0, yaw: 0, tilt: 0 };\n    this._keys.forEach((code) => {\n      const { x = 0, y = 0, zoom = 0, yaw = 0, tilt = 0 } = this._getKeyMotion(code) || {};\n      motion.x += x;\n      motion.y += y;\n      motion.zoom += zoom;\n      motion.yaw += yaw;\n      motion.tilt += tilt;\n    });\n\n    const {\n      cameraStore: {\n        cameraMove,\n        cameraRotate,\n        cameraZoom,\n        state: { perspective },\n      },\n    } = this.props;\n\n    if (motion.x || motion.y) {\n      const { x, y } = this._getMoveMagnitude();\n      cameraMove([motion.x * x * dt, motion.y * y * dt]);\n    }\n    if (motion.yaw || (perspective && motion.tilt)) {\n      cameraRotate([motion.yaw * dt, perspective ? motion.tilt * dt : 0]);\n    }\n    if (motion.zoom) {\n      cameraZoom(motion.zoom * dt);\n    }\n  }\n\n  _startKeyTimer(lastStamp: ?number) {\n    if (this._keyTimer) {\n      return;\n    }\n    this._keyTimer = requestAnimationFrame((stamp) => {\n      this._moveKeyboard((lastStamp ? stamp - lastStamp : 0) / 1000);\n      this._keyTimer = undefined;\n\n      // Only start the timer if keys are still pressed.\n      // We do this rather than stopping the timer in onKeyUp, because keys held\n      // sometimes actually trigger repeated keyup/keydown, rather than just repeated keydown.\n      // By checking currently-down keys in the requestAnimationFrame callback, we give the browser enough time to\n      // handle both the keyup and keydown before checking whether we should restart the timer.\n      if (this._keys.size) {\n        this._startKeyTimer(stamp);\n      }\n    });\n  }\n\n  _stopKeyTimer() {\n    if (this._keyTimer) {\n      cancelAnimationFrame(this._keyTimer);\n    }\n    this._keyTimer = undefined;\n  }\n\n  _onKeyDown = (e: SyntheticKeyboardEvent<HTMLDivElement>) => {\n    const { keyMap } = this.props;\n    this._shiftKey = e.shiftKey;\n    this._metaKey = e.metaKey;\n    this._ctrlKey = e.ctrlKey;\n    const code = ((e.nativeEvent: any): KeyboardEvent).code;\n\n    // ignore repeated keydown events\n    if (e.repeat || this._keys.has(code)) {\n      e.stopPropagation();\n      e.preventDefault();\n      return;\n    }\n\n    if (e.altKey || e.ctrlKey || e.metaKey) {\n      // we don't currently handle these modifiers\n      return;\n    }\n\n    // allow null, false, or empty keymappings which explicitly cancel Worldview from processing that key\n    if (keyMap && code in keyMap && !keyMap[code]) {\n      return false;\n    }\n\n    // if we respond to this key, start the update timer\n    if (this._getKeyMotion(code)) {\n      this._keys.add(code);\n      this._startKeyTimer();\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  };\n\n  _onKeyUp = (e: SyntheticKeyboardEvent<HTMLDivElement>) => {\n    this._shiftKey = e.shiftKey;\n    this._metaKey = e.metaKey;\n    this._ctrlKey = e.ctrlKey;\n\n    this._keys.delete(((e.nativeEvent: any): KeyboardEvent).code);\n  };\n\n  _onWheel = (e: WheelEvent) => {\n    // stop the wheel event here, as wheel propagation through the entire dom\n    // can cause the browser to slow down & thrash\n    e.preventDefault();\n    e.stopPropagation();\n    this._shiftKey = e.shiftKey;\n\n    // with osx trackpad scrolling, slow to medium pixelY is around +/- 1 to 10\n    // external mouse wheels generally come in higher values around +/- 30 to 50\n    const { pixelX, pixelY } = normalizeWheel(e);\n\n    // shift+scroll on an external mouse may scroll in the X direction instead of Y\n    const wheelAmount = pixelY || pixelX;\n\n    // we use positive value to indicate zooming in\n    // and negative value to zoom out, so reverse the direction of the wheel\n    const dir = Math.sign(wheelAmount) * -1;\n    const amount = Math.abs(wheelAmount);\n    // restrict zoom percentage per tick to between 1 & 50 percent\n    const percentage = Math.max(1, Math.min(amount, 50));\n\n    // support shift+wheel magnitude adjustment\n    const zoomPercentage = this._getMagnitude(percentage * dir * MOUSE_ZOOM_SPEED);\n    this.props.cameraStore.cameraZoom(zoomPercentage);\n  };\n\n  // make sure all movements stop if the document loses focus by resetting modifier keys\n  // to their 'off' position\n  // (e.g. ctrl+tab leaving the page should not leave the ctrl key in the 'on' position)\n  _onBlur = (e: MouseEvent) => {\n    this._keys = new Set();\n    this._ctrlKey = false;\n    this._shiftKey = false;\n    this._metaKey = false;\n    this._stopKeyTimer();\n  };\n\n  _onContextMenu = (e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  render() {\n    const { children } = this.props;\n    return (\n      <div\n        tabIndex={0}\n        style={{ outline: \"none\" }}\n        draggable\n        ref={(el) => (this._el = el)}\n        onMouseDown={this._onMouseDown}\n        onMouseUp={this._onMouseUp}\n        onBlur={this._onBlur}\n        onContextMenu={this._onContextMenu}\n        onKeyDown={this._onKeyDown}\n        onKeyUp={this._onKeyUp}>\n        {children}\n      </div>\n    );\n  }\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nexport { default as camera } from \"./camera\";\nexport { default as CameraListener } from \"./CameraListener\";\nexport { default as cameraProject } from \"./cameraProject\";\nexport { default as CameraStore, DEFAULT_CAMERA_STATE } from \"./CameraStore\";\nexport { default as selectors } from \"./cameraStateSelectors\";\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nexport function getNodeEnv() {\n  return process && process.env && process.env.NODE_ENV;\n}\n\n/* eslint-disable no-undef */\nexport const inWebWorker = () =>\n  global.postMessage && typeof WorkerGlobalScope !== \"undefined\" && self instanceof WorkerGlobalScope;\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { vec3, mat4 } from \"gl-matrix\";\n\nimport type { CameraCommand, Vec3 } from \"../types\";\n\ntype ClickInfo = { clientX: number, clientY: number, width: number, height: number };\n\nconst tempVec = [0, 0, 0];\nconst tempMat = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n\nexport class Ray {\n  origin: Vec3;\n  dir: Vec3;\n  point: Vec3;\n\n  constructor(origin: Vec3, dir: Vec3, point: Vec3) {\n    this.origin = origin;\n    this.dir = dir;\n    this.point = point;\n  }\n\n  distanceToPoint(point: Vec3) {\n    return vec3.distance(this.origin, point);\n  }\n\n  // https://commons.apache.org/proper/commons-math/javadocs/api-3.6/src-html/org/apache/commons/math3/geometry/euclidean/threed/Plane.html#line.394\n  planeIntersection(planeCoordinate: Vec3, planeNormal: Vec3): ?Vec3 {\n    const d = vec3.dot(planeNormal, planeCoordinate);\n    const cosine = vec3.dot(planeNormal, this.dir);\n\n    if (cosine === 0) {\n      return null;\n    }\n\n    const x = (d - vec3.dot(planeNormal, this.origin)) / cosine;\n    const contact = vec3.add([0, 0, 0], this.origin, vec3.scale(tempVec, this.dir, x));\n    return contact;\n  }\n}\n\n// adapted from https://github.com/regl-project/regl/blob/master/example/raycast.js\nexport function getRayFromClick(camera: CameraCommand, { clientX, clientY, width, height }: ClickInfo) {\n  const projectionMatrix = camera.getProjection();\n  const viewMatrix = camera.getView();\n\n  const vp = mat4.multiply(tempMat, projectionMatrix, viewMatrix);\n  const invVp = mat4.invert(tempMat, vp);\n\n  const mouseX = (2.0 * clientX) / width - 1.0;\n  const mouseY = (-2.0 * clientY) / height + 1.0;\n  // get a single point on the camera ray.\n  const rayPoint = vec3.transformMat4([0, 0, 0], [mouseX, mouseY, 0.0], invVp);\n\n  // get the position of the camera.\n  const rayOrigin = vec3.transformMat4([0, 0, 0], [0, 0, 0], mat4.invert(tempMat, viewMatrix));\n  const rayDir = vec3.normalize([0, 0, 0], vec3.subtract(tempVec, rayPoint, rayOrigin));\n\n  return new Ray(rayOrigin, rayDir, rayPoint);\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React from \"react\";\n\nimport { type WorldviewContextType } from \"./WorldviewContext\";\n\n// $FlowFixMe\nexport default React.createContext((undefined: WorldviewContextType | void));\n","// @flow\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type {\n  ComponentMouseHandler,\n  GetChildrenForHitmap,\n  MouseEventEnum,\n  RawCommand,\n  Color,\n  Point,\n  MouseEventObject,\n} from \"../types\";\nimport { getNodeEnv } from \"../utils/common\";\nimport { Ray } from \"../utils/Raycast\";\nimport { type WorldviewContextType } from \"../WorldviewContext\";\nimport WorldviewReactContext from \"../WorldviewReactContext\";\n\nexport const SUPPORTED_MOUSE_EVENTS = [\"onClick\", \"onMouseUp\", \"onMouseMove\", \"onMouseDown\", \"onDoubleClick\"];\n\nexport type MarkerDefault = {\n  id?: number,\n  points?: Point[],\n  color?: Color,\n};\n\nexport type CommonCommandProps = {\n  [MouseEventEnum]: ComponentMouseHandler,\n  layerIndex?: number,\n  getChildrenForHitmap?: GetChildrenForHitmap,\n};\n\ntype Props<T> = {\n  ...CommonCommandProps,\n  children?: T[] | T,\n  // Deprecated, but here for backwards compatibility\n  drawProps?: T[],\n  reglCommand: RawCommand<T>,\n};\n\nexport type CommandProps<T> = Props<T>;\n\n// Component to dispatch children (for drawing) and hitmap props and a reglCommand to the render loop to render with regl.\nexport default class Command<T> extends React.Component<Props<T>> {\n  context: ?WorldviewContextType;\n  static displayName = \"Command\";\n\n  constructor(props: Props<T>) {\n    super(props);\n    // In development put a check in to make sure the reglCommand prop is not mutated.\n    // Similar to how react checks for unsupported or deprecated calls in a development build.\n    if (getNodeEnv() !== \"production\") {\n      // $FlowFixMe\n      this.shouldComponentUpdate = (nextProps: Props) => {\n        if (nextProps.reglCommand !== this.props.reglCommand) {\n          console.error(\"Changing the regl command prop on a <Command /> is not supported.\");\n        }\n        return true;\n      };\n    }\n  }\n\n  componentDidMount() {\n    const context = this.context;\n    if (!context) {\n      return;\n    }\n    context.onMount(this, this.props.reglCommand);\n    this._updateContext();\n  }\n\n  componentDidUpdate() {\n    this._updateContext();\n  }\n\n  componentWillUnmount() {\n    const context = this.context;\n    if (!context) {\n      return;\n    }\n    context.onUnmount(this);\n  }\n\n  _updateContext() {\n    const context = this.context;\n    if (!context) {\n      return;\n    }\n\n    const { reglCommand, layerIndex, getChildrenForHitmap } = this.props;\n    const children = this.props.children || this.props.drawProps;\n    if (children == null) {\n      return;\n    }\n    context.registerDrawCall({\n      instance: this,\n      reglCommand,\n      children,\n      layerIndex,\n      getChildrenForHitmap,\n    });\n  }\n\n  handleMouseEvent(\n    objects: MouseEventObject[],\n    ray: Ray,\n    e: SyntheticMouseEvent<HTMLCanvasElement>,\n    mouseEventName: MouseEventEnum\n  ) {\n    const mouseHandler = this.props[mouseEventName];\n    if (!mouseHandler || !objects.length) {\n      return;\n    }\n    mouseHandler(e, { ray, objects });\n  }\n\n  render() {\n    return (\n      <WorldviewReactContext.Consumer>\n        {(ctx: ?WorldviewContextType) => {\n          if (ctx) {\n            this.context = ctx;\n          }\n          return null;\n        }}\n      </WorldviewReactContext.Consumer>\n    );\n  }\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\n// Takes an array of [value, key] and aggregates across the keys. Results in a Map of [key, values[]], in order of the\n// keys as seen in the array.\nexport default function aggregate<T, K>(array: Array<[T, K]>): Map<K, T[]> {\n  const aggregationMap = new Map<K, T[]>();\n  array.forEach(([item, key]) => {\n    const existingItems = aggregationMap.get(key) || [];\n    existingItems.push(item);\n    if (!aggregationMap.has(key)) {\n      aggregationMap.set(key, existingItems);\n    }\n  });\n  return aggregationMap;\n}\n","// @flow\n//\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React, { useEffect, useState, useCallback, type Node } from \"react\";\n\nimport { inWebWorker } from \"./common\";\n\ntype DimensionsParams = {| height: number, width: number, left: number, top: number |};\ntype Props = {|\n  children: (DimensionsParams) => Node,\n|};\n\n// Jest does not include ResizeObserver.\nclass ResizeObserverMock {\n  _callback: (ResizeObserverEntry[]) => void;\n  constructor(callback) {\n    this._callback = callback;\n  }\n\n  observe() {\n    const entry: any = { contentRect: { width: 150, height: 150 } };\n    this._callback([entry]);\n  }\n  unobserve() {}\n}\nconst ResizeObserverImpl =\n  process.env.NODE_ENV === \"test\" || inWebWorker() ? (ResizeObserverMock: any) : ResizeObserver;\n\n// Calculates the dimensions of the parent element, and passes those dimensions to the child function.\n// Uses resizeObserver, which is very performant.\n// Works by rendering an empty div, getting the parent element, and then once we know the dimensions of the parent\n// element, rendering the children. After the initial render it just observes the parent element.\n// We expect the parent element to never change.\nexport default function Dimensions({ children }: Props) {\n  const [parentElement, setParentElement] = useState(undefined);\n  const [dimensions, setDimensions] = useState<?DimensionsParams>();\n  // This resizeObserver should never change.\n  const [resizeObserver] = useState<ResizeObserver>(\n    () =>\n      new ResizeObserverImpl((entries) => {\n        if (!entries || !entries.length) {\n          return;\n        }\n\n        // We only observe a single element, so just use the first entry.\n        // We have to round because these could be sub-pixel values.\n        const newWidth = Math.round(entries[0].contentRect.width);\n        const newHeight = Math.round(entries[0].contentRect.height);\n        const newLeft = Math.round(entries[0].contentRect.left);\n        const newTop = Math.round(entries[0].contentRect.top);\n        setDimensions({ width: newWidth, height: newHeight, top: newTop, left: newLeft });\n      })\n  );\n\n  // This should only fire once, because `dimensions` should only be undefined at the beginning.\n  const setParentElementRef = useCallback((element) => {\n    if (element) {\n      setParentElement(element.parentElement);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!parentElement) {\n      return;\n    }\n    resizeObserver.observe(parentElement);\n    // Make sure to unobserve when we unmount the component.\n    return () => resizeObserver.unobserve(parentElement);\n  }, [parentElement, resizeObserver]);\n\n  // This only happens during the first render - we use it to grab the parentElement of this div.\n  if (dimensions == null) {\n    return <div ref={setParentElementRef} />;\n  }\n  return children(dimensions);\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport last from \"lodash/last\";\n\nimport Command from \"../commands/Command\";\nimport type { ObjectHitmapId, Vec4, MouseEventObject } from \"../types\";\nimport { intToRGB } from \"./commandUtils\";\n\nfunction fillArray(start: number, length: number): number[] {\n  return new Array(length).fill(0).map((_, index) => start + index);\n}\n\ntype CommandType = Command<any>;\n\n/*\n * This object manages the mapping between objects that are rendered into the scene and their IDs.\n * It supplies an API for generating IDs for a rendered object and then accessing those objects based on their ID.\n */\nexport default class HitmapObjectIdManager {\n  _objectsByObjectHitmapIdMap: { [ObjectHitmapId]: Object } = {};\n  _commandsByObjectMap: Map<Object, CommandType> = new Map();\n  _nextObjectHitmapId = 1;\n  _instanceIndexByObjectHitmapIdMap: { [ObjectHitmapId]: number } = {};\n\n  assignNextColors = (command: CommandType, object: Object, count: number): Vec4[] => {\n    if (count < 1) {\n      throw new Error(\"Must get at least 1 id\");\n    }\n\n    const ids: ObjectHitmapId[] = fillArray(this._nextObjectHitmapId, count);\n    this._nextObjectHitmapId = last(ids) + 1;\n\n    // Instanced rendering - add to the instanced ID map.\n    if (count > 1) {\n      ids.forEach((id, index) => {\n        this._instanceIndexByObjectHitmapIdMap[id] = index;\n      });\n    }\n\n    // Store the mapping of ID to original marker object\n    for (const id of ids) {\n      this._objectsByObjectHitmapIdMap[id] = object;\n    }\n    this._commandsByObjectMap.set(object, command);\n\n    // Return colors from the IDs.\n    const colors = ids.map((id) => intToRGB(id));\n    return colors;\n  };\n\n  getObjectByObjectHitmapId = (objectHitmapId: ObjectHitmapId): MouseEventObject => {\n    return {\n      object: this._objectsByObjectHitmapIdMap[objectHitmapId],\n      instanceIndex: this._instanceIndexByObjectHitmapIdMap[objectHitmapId],\n    };\n  };\n\n  getCommandForObject = (object: Object): ?CommandType => {\n    return this._commandsByObjectMap.get(object);\n  };\n}\n","// @flow\n//\n//  Copyright (c) 2019-present, Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nexport type Signal<T> = Promise<T> & {\n  resolve: (T) => void,\n  reject: (Error) => void,\n};\n\nexport function signal<T>(): Signal<T> {\n  let resolve;\n  let reject;\n  const promise: any = new Promise((res, rej) => {\n    resolve = res;\n    reject = rej;\n  });\n  promise.resolve = resolve;\n  promise.reject = reject;\n  return promise;\n}\n","// @flow\n//\n//  Copyright (c) 2019-present, Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { signal, type Signal } from \"./signal\";\n\ntype QueuedFn = ((...args: any[]) => Promise<any>) & { currentPromise: ?Promise<any> };\n\n// Wait for the previous promise to resolve before starting the next call to the function.\nexport default function queuePromise(fn: (...args: any[]) => Promise<any>): QueuedFn {\n  // Whether we are currently waiting for a promise returned by `fn` to resolve.\n  let calling = false;\n  // The list of calls made to the function was made while a call was in progress.\n  const nextCalls: {| args: any[], promise: Signal<any> |}[] = [];\n\n  function queuedFn(...args) {\n    if (calling) {\n      const returnPromise = signal();\n      nextCalls.push({ args, promise: returnPromise });\n      return returnPromise;\n    }\n    return start(...args);\n  }\n\n  function start(...args) {\n    calling = true;\n\n    const promise = fn(...args).finally(() => {\n      calling = false;\n      queuedFn.currentPromise = undefined;\n      if (nextCalls.length) {\n        const { promise: nextPromise, args: nextArgs } = nextCalls.shift();\n        start(...nextArgs)\n          .then((result) => nextPromise.resolve(result))\n          .catch((error) => nextPromise.reject(error));\n      }\n    });\n    queuedFn.currentPromise = promise;\n\n    return promise;\n  }\n\n  return queuedFn;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\nimport createREGL from \"regl\";\nimport shallowequal from \"shallowequal\";\n\nimport { camera, CameraStore } from \"./camera/index\";\nimport Command from \"./commands/Command\";\nimport type {\n  Dimensions,\n  RawCommand,\n  CompiledReglCommand,\n  CameraCommand,\n  Vec4,\n  CameraState,\n  MouseEventObject,\n  GetChildrenForHitmap,\n  AssignNextColorsFn,\n} from \"./types\";\nimport { getIdFromPixel, intToRGB } from \"./utils/commandUtils\";\nimport { getNodeEnv } from \"./utils/common\";\nimport HitmapObjectIdManager from \"./utils/HitmapObjectIdManager\";\nimport queuePromise from \"./utils/queuePromise\";\nimport { getRayFromClick } from \"./utils/Raycast\";\n\ntype Props = any;\n\ntype ConstructorArgs = {\n  dimension: Dimensions,\n  canvasBackgroundColor: Vec4,\n  cameraState: CameraState,\n  defaultCameraState?: CameraState,\n  onCameraStateChange: ?(CameraState) => void,\n  contextAttributes?: ?{ [string]: any },\n};\n\ntype InitializedData = {\n  _fbo: any,\n  regl: any,\n  camera: CameraCommand,\n};\n\nexport type DrawInput = {\n  instance: Command<any>,\n  reglCommand: RawCommand<any>,\n  children: Props,\n  layerIndex: ?number,\n  getChildrenForHitmap: ?GetChildrenForHitmap,\n};\n\nexport type PaintFn = () => void;\n\nexport type WorldviewContextType = {\n  onMount(instance: Command<any>, command: RawCommand<any>): void,\n  registerDrawCall(drawInput: DrawInput): void,\n  registerPaintCallback(PaintFn): void,\n  unregisterPaintCallback(PaintFn): void,\n  onUnmount(instance: Command<any>): void,\n  onDirty(): void,\n  +dimension: Dimensions,\n  +initializedData: ?InitializedData,\n};\n\n// Compile instructions with an initialized regl context into a regl command.\n// If the instructions are a function, pass the context to the instructions and compile the result\n// of the function; otherwise, compile the instructions directly\nfunction compile<T>(regl: any, cmd: RawCommand<T>): CompiledReglCommand<T> {\n  const src = cmd(regl);\n  return typeof src === \"function\" ? src : regl(src);\n}\n\n// This is made available to every Command component as `this.context`.\n// It contains all the regl interaction code and is responsible for collecting and executing\n// draw calls, hitmap calls, and raycasting.\n\nexport class WorldviewContext {\n  _commands: Set<RawCommand<any>> = new Set();\n  _compiled: Map<Function, CompiledReglCommand<any>> = new Map();\n  _drawCalls: Map<React.Component<any>, DrawInput> = new Map();\n  _frame: ?AnimationFrameID;\n  _needsPaint = false;\n  _paintCalls: Map<PaintFn, PaintFn> = new Map();\n  _hitmapObjectIdManager: HitmapObjectIdManager = new HitmapObjectIdManager();\n  _cachedReadHitmapCall: ?{\n    arguments: any[],\n    result: Array<[MouseEventObject, Command<any>]>,\n  } = undefined;\n  // store every compiled command object compiled for debugging purposes\n  reglCommandObjects: { stats: { count: number } }[] = [];\n  counters: { paint?: number, render?: number } = {};\n  dimension: Dimensions;\n  onDirty: () => void;\n  cameraStore: CameraStore;\n  canvasBackgroundColor: Vec4 = [0, 0, 0, 1];\n  // group all initialized data together so it can be checked for existence to verify initialization is complete\n  initializedData: ?InitializedData;\n  contextAttributes: ?{ [string]: any };\n\n  constructor({\n    dimension,\n    canvasBackgroundColor,\n    cameraState,\n    onCameraStateChange,\n    contextAttributes,\n  }: ConstructorArgs) {\n    // used for children to call paint() directly\n    this.dimension = dimension;\n    this.canvasBackgroundColor = canvasBackgroundColor;\n    this.contextAttributes = contextAttributes;\n    this.cameraStore = new CameraStore((cameraState: CameraState) => {\n      if (onCameraStateChange) {\n        onCameraStateChange(cameraState);\n      } else {\n        // this must be called for Worldview with defaultCameraState prop\n        this.paint();\n      }\n    }, cameraState);\n  }\n\n  initialize(canvas: HTMLCanvasElement) {\n    if (this.initializedData) {\n      throw new Error(\"can not initialize regl twice\");\n    }\n\n    const regl = this._instrumentCommands(\n      createREGL({\n        canvas,\n        attributes: this.contextAttributes || {},\n        extensions: [\n          \"angle_instanced_arrays\",\n          \"oes_texture_float\",\n          \"oes_element_index_uint\",\n          \"oes_standard_derivatives\",\n        ],\n        profile: getNodeEnv() !== \"production\",\n      })\n    );\n    // compile any components which mounted before regl is initialized\n    this._commands.forEach((uncompiledCommand) => {\n      const compiledCommand = compile(regl, uncompiledCommand);\n      this._compiled.set(uncompiledCommand, compiledCommand);\n    });\n\n    const Camera = compile(regl, camera);\n    const compiledCameraCommand = new Camera();\n    // framebuffer object from regl context\n    const fbo = regl.framebuffer({\n      width: Math.round(this.dimension.width),\n      height: Math.round(this.dimension.height),\n    });\n\n    this.initializedData = {\n      _fbo: fbo,\n      camera: compiledCameraCommand,\n      regl,\n    };\n  }\n\n  destroy() {\n    if (this.initializedData) {\n      this.initializedData.regl.destroy();\n    }\n    if (this._frame) {\n      cancelAnimationFrame(this._frame);\n    }\n  }\n\n  // compile a command when it is first mounted, and try to register in _commands and _compiled maps\n  onMount(instance: React.Component<any>, command: RawCommand<any>) {\n    const { initializedData } = this;\n    // do nothing if regl hasn't been initialized yet\n    if (!initializedData || this._commands.has(command)) {\n      return;\n    }\n    this._commands.add(command);\n\n    // for components that mount after regl is initialized\n    this._compiled.set(command, compile(initializedData.regl, command));\n  }\n\n  // unregister children hitmap and draw calls\n  onUnmount(instance: React.Component<any>) {\n    this._drawCalls.delete(instance);\n  }\n\n  unregisterPaintCallback(paintFn: PaintFn) {\n    this._paintCalls.delete(paintFn);\n  }\n\n  registerDrawCall(drawInput: DrawInput) {\n    this._drawCalls.set(drawInput.instance, drawInput);\n  }\n\n  registerPaintCallback(paintFn: PaintFn) {\n    this._paintCalls.set(paintFn, paintFn);\n  }\n\n  setDimension(dimension: Dimensions) {\n    this.dimension = dimension;\n  }\n\n  raycast = (canvasX: number, canvasY: number) => {\n    if (!this.initializedData) {\n      return undefined;\n    }\n\n    const { width, height } = this.dimension;\n    return getRayFromClick(this.initializedData.camera, {\n      clientX: canvasX,\n      clientY: canvasY,\n      width,\n      height,\n    });\n  };\n\n  paint() {\n    try {\n      this._paint();\n    } catch (error) {\n      // Regl automatically tries to reconnect when losing the canvas 3d context.\n      // We should log this error, but it's not important to throw it.\n      if (error.message === \"(regl) context lost\") {\n        console.warn(error);\n      } else {\n        throw error;\n      }\n    }\n  }\n\n  _paint() {\n    this._needsPaint = false;\n    const start = Date.now();\n    this.reglCommandObjects.forEach((cmd) => (cmd.stats.count = 0));\n    if (!this.initializedData) {\n      return;\n    }\n    this._cachedReadHitmapCall = null; // clear the cache every time we paint\n    const { regl, camera } = this.initializedData;\n    this._clearCanvas(regl);\n    camera.draw(this.cameraStore.state, () => {\n      const x = Date.now();\n      this._drawInput();\n      this.counters.paint = Date.now() - x;\n    });\n\n    this._paintCalls.forEach((paintCall) => {\n      paintCall();\n    });\n    this.counters.render = Date.now() - start;\n    // More React state updates may have happened while we were painting, since paint happens\n    // outside the normal React render flow. If this is the case, we need to paint again.\n    if (this._needsPaint) {\n      this._frame = requestAnimationFrame(() => this.paint());\n    } else {\n      this._frame = undefined;\n    }\n  }\n\n  onDirty = () => {\n    if (undefined === this._frame) {\n      this._frame = requestAnimationFrame(() => this.paint());\n    } else {\n      this._needsPaint = true;\n    }\n  };\n\n  readHitmap = queuePromise(\n    (\n      canvasX: number,\n      canvasY: number,\n      enableStackedObjectEvents: boolean,\n      maxStackedObjectCount: number\n    ): Promise<Array<[MouseEventObject, Command<any>]>> => {\n      if (!this.initializedData) {\n        return Promise.reject(new Error(\"regl data not initialized yet\"));\n      }\n      const args = [canvasX, canvasY, enableStackedObjectEvents, maxStackedObjectCount];\n\n      const cachedReadHitmapCall = this._cachedReadHitmapCall;\n      if (cachedReadHitmapCall) {\n        if (shallowequal(cachedReadHitmapCall.arguments, args)) {\n          // Make sure that we aren't returning the exact object identity of the mouseEventObject - we don't know what\n          // callers have done with it.\n          const result = cachedReadHitmapCall.result.map(([mouseEventObject, command]) => [\n            { ...mouseEventObject },\n            command,\n          ]);\n          return Promise.resolve(result);\n        }\n        this._cachedReadHitmapCall = undefined;\n      }\n\n      const { regl, camera, _fbo } = this.initializedData;\n      const { width, height } = this.dimension;\n\n      const x = canvasX;\n      // 0,0 corresponds to the bottom left in the webgl context, but the top left in window coordinates\n      const y = height - canvasY;\n\n      // regl will only resize the framebuffer if the size changed\n      // it uses floored whole pixel values\n      _fbo.resize(Math.floor(width), Math.floor(height));\n\n      return new Promise((resolve) => {\n        // tell regl to use a framebuffer for this render\n        regl({ framebuffer: _fbo })(() => {\n          // clear the framebuffer\n          regl.clear({ color: intToRGB(0), depth: 1 });\n          let currentObjectId = 0;\n          const excludedObjects = [];\n          const mouseEventsWithCommands = [];\n          let counter = 0;\n\n          camera.draw(this.cameraStore.state, () => {\n            // Every iteration in this loop clears the framebuffer, draws the hitmap objects that have NOT already been\n            // seen to the framebuffer, and then reads the pixel under the cursor to find the object on top.\n            // If `enableStackedObjectEvents` is false, we only do this iteration once - we only resolve with 0 or 1\n            // objects.\n            do {\n              if (counter >= maxStackedObjectCount) {\n                // Provide a max number of layers so this while loop doesn't crash the page.\n                console.error(\n                  `Hit ${maxStackedObjectCount} iterations. There is either a bug or that number of rendered hitmap layers under the mouse cursor.`\n                );\n                break;\n              }\n              counter++;\n              regl.clear({ color: intToRGB(0), depth: 1 });\n              this._drawInput(true, excludedObjects);\n\n              // it's possible to get x/y values outside the framebuffer size\n              // if the mouse quickly leaves the draw area during a read operation\n              // reading outside the bounds of the framebuffer causes errors\n              // and puts regl into a bad internal state.\n              // https://github.com/regl-project/regl/blob/28fbf71c871498c608d9ec741d47e34d44af0eb5/lib/read.js#L57\n              if (x < Math.floor(width) && y < Math.floor(height) && x >= 0 && y >= 0) {\n                const pixel = new Uint8Array(4);\n\n                // read pixel value from the frame buffer\n                regl.read({\n                  x,\n                  y,\n                  width: 1,\n                  height: 1,\n                  data: pixel,\n                });\n\n                currentObjectId = getIdFromPixel(pixel);\n                const mouseEventObject = this._hitmapObjectIdManager.getObjectByObjectHitmapId(currentObjectId);\n\n                // Check an error case: if we see an ID/color that we don't know about, it means that some command is\n                // drawing a color into the hitmap that it shouldn't be.\n                if (currentObjectId > 0 && !mouseEventObject) {\n                  console.error(\n                    `Clicked on an unknown object with id ${currentObjectId}. This likely means that a command is painting an incorrect color into the hitmap.`\n                  );\n                }\n                // Check an error case: if we've already seen this object, then the getHitmapFromChildren function\n                // is not respecting the excludedObjects correctly and we should notify the user of a bug.\n                if (\n                  excludedObjects.some(\n                    ({ object, instanceIndex }) =>\n                      object === mouseEventObject.object && instanceIndex === mouseEventObject.instanceIndex\n                  )\n                ) {\n                  console.error(\n                    `Saw object twice when reading from hitmap. There is likely an error in getHitmapFromChildren`,\n                    mouseEventObject\n                  );\n                  break;\n                }\n\n                if (currentObjectId > 0 && mouseEventObject.object) {\n                  const command = this._hitmapObjectIdManager.getCommandForObject(mouseEventObject.object);\n                  excludedObjects.push(mouseEventObject);\n                  if (command) {\n                    mouseEventsWithCommands.push([mouseEventObject, command]);\n                  }\n                }\n              }\n              // If we haven't enabled stacked object events, break out of the loop immediately.\n              // eslint-disable-next-line no-unmodified-loop-condition\n            } while (currentObjectId !== 0 && enableStackedObjectEvents);\n\n            this._cachedReadHitmapCall = {\n              arguments: args,\n              result: mouseEventsWithCommands,\n            };\n            resolve(mouseEventsWithCommands);\n          });\n        });\n      });\n    }\n  );\n\n  _drawInput = (isHitmap?: boolean, excludedObjects?: MouseEventObject[]) => {\n    if (isHitmap) {\n      this._hitmapObjectIdManager = new HitmapObjectIdManager();\n    }\n\n    const drawCalls = Array.from(this._drawCalls.values()).sort((a, b) => (a.layerIndex || 0) - (b.layerIndex || 0));\n    drawCalls.forEach((drawInput: DrawInput) => {\n      const { reglCommand, children, instance, getChildrenForHitmap } = drawInput;\n      if (!children) {\n        return console.debug(`${isHitmap ? \"hitmap\" : \"\"} draw skipped, props was falsy`, drawInput);\n      }\n      const cmd = this._compiled.get(reglCommand);\n      if (!cmd) {\n        return console.warn(\"could not find draw command for\", instance ? instance.constructor.displayName : \"Unknown\");\n      }\n      // draw hitmap\n      if (isHitmap && getChildrenForHitmap) {\n        const assignNextColorsFn: AssignNextColorsFn = (...rest) => {\n          return this._hitmapObjectIdManager.assignNextColors(instance, ...rest);\n        };\n        const hitmapProps = getChildrenForHitmap(children, assignNextColorsFn, excludedObjects || []);\n        if (hitmapProps) {\n          cmd(hitmapProps, true);\n        }\n      } else if (!isHitmap) {\n        cmd(children, false);\n      }\n    });\n  };\n\n  _clearCanvas = (regl: any) => {\n    // Since we aren't using regl.frame and only rendering when we need to,\n    // we need to tell regl to update its internal state.\n    regl.poll();\n    regl.clear({\n      color: this.canvasBackgroundColor,\n      depth: 1,\n    });\n  };\n\n  _instrumentCommands(regl: any) {\n    if (getNodeEnv() === \"production\") {\n      return regl;\n    }\n    return new Proxy(regl, {\n      apply: (target, thisArg, args) => {\n        const command = target(...args);\n        if (typeof command.stats === \"object\") {\n          this.reglCommandObjects.push(command);\n        }\n        return command;\n      },\n    });\n  }\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport mapValues from \"lodash/mapValues\";\nimport pickBy from \"lodash/pickBy\";\nimport * as React from \"react\";\n\nimport { CameraListener, DEFAULT_CAMERA_STATE } from \"./camera/index\";\nimport Command from \"./commands/Command\";\nimport type {\n  MouseHandler,\n  Dimensions,\n  Vec4,\n  CameraState,\n  CameraKeyMap,\n  MouseEventEnum,\n  MouseEventObject,\n} from \"./types\";\nimport aggregate from \"./utils/aggregate\";\nimport { getNodeEnv } from \"./utils/common\";\nimport ContainerDimensions from \"./utils/Dimensions\";\nimport { Ray } from \"./utils/Raycast\";\nimport { WorldviewContext } from \"./WorldviewContext\";\nimport WorldviewReactContext from \"./WorldviewReactContext\";\n\nconst DEFAULT_BACKGROUND_COLOR = [0, 0, 0, 1];\nexport const DEFAULT_MOUSE_CLICK_RADIUS = 3;\nconst DEFAULT_MAX_NUMBER_OF_HITMAP_LAYERS = 100;\n\nexport type BaseProps = {|\n  keyMap?: CameraKeyMap,\n  shiftKeys: boolean,\n  backgroundColor?: Vec4,\n  // (Deprecated) rendering the hitmap on mouse move is expensive, so disable it by default\n  hitmapOnMouseMove?: boolean,\n  // Disable hitmap generation for specific mouse events\n  // For example, if you want to disable hitmap generating on drag, use: [\"onMouseDown\", \"onMouseMove\", \"onMouseUp\"]\n  disableHitmapForEvents?: MouseEventEnum[],\n  // getting events for objects stacked on top of each other is expensive, so disable it by default\n  enableStackedObjectEvents?: boolean,\n  // allow users to specify the max stacked object count\n  maxStackedObjectCount: number,\n  showDebug?: boolean,\n  children?: React.Node,\n  style: { [styleAttribute: string]: number | string },\n\n  cameraState?: $Shape<CameraState>,\n  onCameraStateChange?: (CameraState) => void,\n  defaultCameraState?: $Shape<CameraState>,\n  // interactions\n  onDoubleClick?: MouseHandler,\n  onMouseDown?: MouseHandler,\n  onMouseUp?: MouseHandler,\n  onMouseMove?: MouseHandler,\n  onClick?: MouseHandler,\n\n  // Used to scale the canvas resolution and provide a higher image quality\n  resolutionScale?: number,\n  ...Dimensions,\n\n  // Context attributes passed into canvas.getContext.\n  contextAttributes?: ?{ [string]: any },\n  canvas?: HTMLCanvasElement,\n|};\n\ntype State = {|\n  worldviewContext: WorldviewContext,\n|};\n\nfunction handleWorldviewMouseInteraction(\n  objects: MouseEventObject[],\n  ray: Ray,\n  e: SyntheticMouseEvent<HTMLCanvasElement>,\n  handler: MouseHandler\n) {\n  const args = { ray, objects };\n\n  try {\n    handler(e, args);\n  } catch (err) {\n    console.error(\"Error during mouse handler\", err);\n  }\n}\n\n// responsible for camera and scene state management\n// takes in children that declaritively define what should be rendered\nexport class WorldviewBase extends React.Component<BaseProps, State> {\n  _canvas: { current: HTMLCanvasElement | null } = React.createRef();\n  _cameraListener: { current: CameraListener | null } = React.createRef();\n  _tick: AnimationFrameID | void;\n  _dragStartPos: ?{ x: number, y: number } = null;\n\n  static defaultProps = {\n    maxStackedObjectCount: DEFAULT_MAX_NUMBER_OF_HITMAP_LAYERS,\n    backgroundColor: DEFAULT_BACKGROUND_COLOR,\n    shiftKeys: true,\n    style: {},\n    resolutionScale: 1,\n  };\n\n  constructor(props: BaseProps) {\n    super(props);\n    const {\n      width,\n      height,\n      top,\n      left,\n      backgroundColor,\n      onCameraStateChange,\n      cameraState,\n      defaultCameraState,\n      hitmapOnMouseMove,\n      disableHitmapForEvents,\n      canvas,\n    } = props;\n    if (canvas) {\n      this._canvas.current = canvas;\n    }\n    if (onCameraStateChange) {\n      if (!cameraState) {\n        console.warn(\n          \"You provided `onCameraStateChange` without `cameraState`. Use Worldview as a controlled component with `cameraState` and `onCameraStateChange`, or uncontrolled with `defaultCameraState`.\"\n        );\n      }\n      if (cameraState && defaultCameraState) {\n        console.warn(\"You provided both `cameraState` and `defaultCameraState`. `defaultCameraState` will be ignored.\");\n      }\n    } else {\n      if (cameraState) {\n        console.warn(\n          \"You provided `cameraState` without an `onCameraStateChange` handler. This will prevent moving the camera. If the camera should be movable, use `defaultCameraState`, otherwise set `onCameraStateChange`.\"\n        );\n      }\n    }\n\n    if (hitmapOnMouseMove) {\n      if (disableHitmapForEvents) {\n        throw new Error(\n          \"Property 'hitmapOnMouseMove' is deprectated and will be ignored when used along with 'disableHitmapForEvents'.\"\n        );\n      } else {\n        console.warn(\n          \"Property 'hitmapOnMouseMove' is deprectated. Please use 'disableHitmapForEvents' property instead.\"\n        );\n      }\n    }\n\n    this.state = {\n      worldviewContext: new WorldviewContext({\n        dimension: { width, height, top, left },\n        canvasBackgroundColor: backgroundColor || DEFAULT_BACKGROUND_COLOR,\n        // DEFAULT_CAMERA_STATE is applied if both `cameraState` and `defaultCameraState` are not present\n        cameraState: props.cameraState || props.defaultCameraState || DEFAULT_CAMERA_STATE,\n        onCameraStateChange: props.onCameraStateChange || undefined,\n        contextAttributes: props.contextAttributes || {},\n      }),\n    };\n  }\n\n  static getDerivedStateFromProps({ width, height, top, left }: BaseProps, { worldviewContext }: State) {\n    worldviewContext.setDimension({ width, height, top, left });\n    return null;\n  }\n\n  componentDidMount() {\n    if (!this._canvas.current) {\n      return console.warn(\"missing canvas element\");\n    }\n    const { worldviewContext } = this.state;\n    worldviewContext.initialize(this._canvas.current);\n    // trigger rendering in children that require camera to be present, e.g. Text component\n    this.setState({}); //eslint-disable-line\n    // call paint to set the correct viewportWidth and viewportHeight for camera so non-regl components\n    // such as Text can get the correct screen coordinates for the first render\n    worldviewContext.paint();\n  }\n\n  componentWillUnmount() {\n    if (this._tick) {\n      cancelAnimationFrame(this._tick);\n    }\n    this.state.worldviewContext.destroy();\n  }\n\n  componentDidUpdate() {\n    const { worldviewContext } = this.state;\n    // update internal cameraState\n    if (this.props.cameraState) {\n      worldviewContext.cameraStore.setCameraState(this.props.cameraState);\n    }\n    worldviewContext.onDirty();\n  }\n\n  focus() {\n    if (this._cameraListener.current) {\n      this._cameraListener.current.focus();\n    }\n  }\n\n  handleOffscreenMouseEvent = (e: SyntheticMouseEvent<HTMLCanvasElement>, mouseEventName: MouseEventEnum) => {\n    if (mouseEventName === \"onDoubleClick\") {\n      this._onDoubleClick(e, true);\n    } else if (mouseEventName === \"onMouseDown\") {\n      this._onMouseDown(e, true);\n    } else if (mouseEventName === \"onMouseMove\") {\n      this._onMouseMove(e, true);\n    } else if (mouseEventName === \"onMouseUp\") {\n      this._onMouseUp(e, true);\n    }\n  };\n\n  _onDoubleClick = (e: SyntheticMouseEvent<HTMLCanvasElement>, fromOffscreenTarget: boolean) => {\n    this._onMouseInteraction(e, \"onDoubleClick\", fromOffscreenTarget);\n  };\n\n  _onMouseDown = (e: SyntheticMouseEvent<HTMLCanvasElement>, fromOffscreenTarget: boolean) => {\n    this._dragStartPos = { x: e.clientX, y: e.clientY };\n    this._onMouseInteraction(e, \"onMouseDown\", fromOffscreenTarget);\n  };\n\n  _onMouseMove = (e: SyntheticMouseEvent<HTMLCanvasElement>, fromOffscreenTarget: boolean) => {\n    this._onMouseInteraction(e, \"onMouseMove\", fromOffscreenTarget);\n  };\n\n  _onMouseUp = (e: SyntheticMouseEvent<HTMLCanvasElement>, fromOffscreenTarget: boolean) => {\n    this._onMouseInteraction(e, \"onMouseUp\", fromOffscreenTarget);\n    const { _dragStartPos } = this;\n    if (_dragStartPos) {\n      const deltaX = e.clientX - _dragStartPos.x;\n      const deltaY = e.clientY - _dragStartPos.y;\n      const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n      if (distance < DEFAULT_MOUSE_CLICK_RADIUS) {\n        this._onMouseInteraction(e, \"onClick\", fromOffscreenTarget);\n      }\n      this._dragStartPos = null;\n    }\n  };\n\n  _onMouseInteraction = (\n    e: SyntheticMouseEvent<HTMLCanvasElement>,\n    mouseEventName: MouseEventEnum,\n    fromOffscreenTarget: boolean\n  ) => {\n    const { worldviewContext } = this.state;\n    const worldviewHandler = this.props[mouseEventName];\n\n    // When working with offscreen canvases, window is not defined and the target\n    // might not be a valid HTMLElement. If so, we can asume any event coming\n    // from an offscreen canvas already has a relevant target.\n    if (!fromOffscreenTarget && (!(e.target instanceof window.HTMLElement) || e.button !== 0)) {\n      return;\n    }\n\n    // $FlowFixMe: Because of `fromOffscreenTarget`, target might not be an actual HTMLElement instance but still needs to implement `getBoundingClientRect`\n    const { top: clientTop, left: clientLeft } = e.target.getBoundingClientRect();\n    const { clientX, clientY } = e;\n\n    const canvasX = clientX - clientLeft;\n    const canvasY = clientY - clientTop;\n    const ray = worldviewContext.raycast(canvasX, canvasY);\n    if (!ray) {\n      return;\n    }\n\n    // Rendering the hitmap is expensive, so we should disable it for some events.\n    // If 'disableHitmapForEvents' is provided, we ignore any events contained in that property.\n    // Otherwise, we ignore 'onMouseMove' events by default unless 'hitmapOnMouseMove' is 'true'\n    const { hitmapOnMouseMove, disableHitmapForEvents = hitmapOnMouseMove ? [] : [\"onMouseMove\"] } = this.props;\n    if (disableHitmapForEvents.includes(mouseEventName)) {\n      if (worldviewHandler) {\n        return handleWorldviewMouseInteraction([], ray, e, worldviewHandler);\n      }\n      return;\n    }\n\n    // reading hitmap is async so we need to persist the event to use later in the event handler\n    (e: any).persist();\n    worldviewContext\n      .readHitmap(canvasX, canvasY, !!this.props.enableStackedObjectEvents, this.props.maxStackedObjectCount)\n      .then((mouseEventsWithCommands) => {\n        const mouseEventsByCommand: Map<Command<any>, Array<MouseEventObject>> = aggregate(mouseEventsWithCommands);\n        for (const [command, mouseEvents] of mouseEventsByCommand.entries()) {\n          command.handleMouseEvent(mouseEvents, ray, e, mouseEventName);\n          if (e.isPropagationStopped()) {\n            break;\n          }\n        }\n        if (worldviewHandler && !e.isPropagationStopped()) {\n          const mouseEvents = mouseEventsWithCommands.map(([mouseEventObject]) => mouseEventObject);\n          handleWorldviewMouseInteraction(mouseEvents, ray, e, worldviewHandler);\n        }\n      })\n      .catch((e) => {\n        console.error(e);\n      });\n  };\n\n  _renderDebug() {\n    const { worldviewContext } = this.state;\n    const initializedData = worldviewContext.initializedData;\n\n    if (getNodeEnv() === \"production\" || !initializedData) {\n      return null;\n    }\n    const { regl } = initializedData;\n    const mem = window.performance.memory;\n    const style = {\n      bottom: 5,\n      right: 10,\n      width: 200,\n      position: \"absolute\",\n      backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n      color: \"white\",\n      fontFamily: \"monospace\",\n      fontSize: 10,\n    };\n    const { counters, reglCommandObjects } = worldviewContext;\n    const data = mapValues(counters, (val) => `${val} ms`);\n    data[\"draw calls\"] = reglCommandObjects.reduce((total, cmd) => total + cmd.stats.count, 0);\n    if (mem) {\n      data[\"heap used\"] = `${((mem.usedJSHeapSize / mem.jsHeapSizeLimit) * 100).toFixed(3)}%`;\n    }\n\n    Object.assign(data, pickBy(regl.stats, (val) => typeof val === \"number\" && val !== 0));\n    if (regl.stats.bufferCount > 1000) {\n      throw new Error(\"Memory leak: Buffer count > 1000.\");\n    }\n\n    const rows = Object.keys(data).map((key) => {\n      return (\n        <tr key={key} style={{ backgroundColor: \"transparent\", border: \"none\" }}>\n          <td style={{ paddingRight: 10, border: \"none\" }}>{key}</td>\n          <td style={{ width: \"100%\", border: \"none\" }}>{data[key]}</td>\n        </tr>\n      );\n    });\n    return (\n      <table style={style}>\n        <tbody>{rows}</tbody>\n      </table>\n    );\n  }\n\n  render() {\n    const {\n      width,\n      height,\n      showDebug,\n      keyMap,\n      shiftKeys,\n      style,\n      cameraState,\n      onCameraStateChange,\n      resolutionScale,\n      canvas,\n    } = this.props;\n    const { worldviewContext } = this.state;\n    // If we are supplied controlled camera state and no onCameraStateChange callback\n    // then there is a 'fixed' camera from outside of worldview itself.\n    const isFixedCamera = cameraState && !onCameraStateChange;\n    const canvasScale = resolutionScale || 1;\n    const canvasHtml = canvas ? null : (\n      <React.Fragment>\n        <canvas\n          style={{ width, height, maxWidth: \"100%\", maxHeight: \"100%\" }}\n          width={width * canvasScale}\n          height={height * canvasScale}\n          ref={this._canvas}\n          onMouseUp={this._onMouseUp}\n          onMouseDown={this._onMouseDown}\n          onDoubleClick={this._onDoubleClick}\n          onMouseMove={this._onMouseMove}\n        />\n        {showDebug && this._renderDebug()}\n      </React.Fragment>\n    );\n\n    return (\n      <div style={{ position: \"relative\", overflow: \"hidden\", ...style }}>\n        {/* skip rendering CameraListener if Worldview has a fixed camera */}\n        {isFixedCamera ? (\n          canvasHtml\n        ) : (\n          <CameraListener\n            cameraStore={worldviewContext.cameraStore}\n            keyMap={keyMap}\n            shiftKeys={shiftKeys}\n            ref={(el) => (this._cameraListener.current = el)}>\n            {canvasHtml}\n          </CameraListener>\n        )}\n        {worldviewContext.initializedData && (\n          <WorldviewReactContext.Provider value={worldviewContext}>\n            {this.props.children}\n          </WorldviewReactContext.Provider>\n        )}\n      </div>\n    );\n  }\n}\n\nexport type Props = $Diff<React.ElementConfig<typeof WorldviewBase>, Dimensions>;\n\nconst Worldview = React.forwardRef<Props, _>((props: Props, ref) => (\n  <ContainerDimensions>\n    {({ width, height, left, top }) => (\n      <WorldviewBase width={width} height={height} left={left} top={top} ref={ref} {...props} />\n    )}\n  </ContainerDimensions>\n));\n\nWorldview.displayName = \"Worldview\";\n\nexport default Worldview;\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport type { Point } from \"../types\";\n\n// a single min/max value\nclass Bound {\n  min: number;\n  max: number;\n\n  constructor() {\n    this.min = Number.MAX_SAFE_INTEGER;\n    this.max = Number.MIN_SAFE_INTEGER;\n  }\n  // update the bound based on a value\n  update(value: number) {\n    this.min = Math.min(this.min, value);\n    this.max = Math.max(this.max, value);\n  }\n}\n\n// represents x, y, and z min & max bounds for a 3d scene\nexport default class Bounds {\n  x: Bound;\n  y: Bound;\n  z: Bound;\n\n  constructor() {\n    this.x = new Bound();\n    this.y = new Bound();\n    this.z = new Bound();\n  }\n\n  // update the bounds based on a point\n  update(point: Point) {\n    this.x.update(point.x);\n    this.y.update(point.y);\n    this.z.update(point.z);\n  }\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { mat3 } from \"gl-matrix\";\n\nimport type { Vec3, Vec4 } from \"../types\";\n\nconst scratch = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n\n// gl-matrix clone of three.js Euler.setFromQuaternion\n// assumes default XYZ order\nexport default function eulerFromQuaternion(out: number[], q: Vec4): Vec3 {\n  const m = mat3.fromQuat(scratch, q);\n  const m11 = m[0], m12 = m[3], m13 = m[6]; // prettier-ignore\n  const             m22 = m[4], m23 = m[7]; // prettier-ignore\n  const             m32 = m[5], m33 = m[8]; // prettier-ignore\n\n  out[1] = Math.asin(m13 < -1 ? -1 : m13 > 1 ? 1 : m13);\n  if (Math.abs(m13) < 0.99999) {\n    out[0] = Math.atan2(-m23, m33);\n    out[2] = Math.atan2(-m12, m11);\n  } else {\n    out[0] = Math.atan2(m32, m22);\n    out[2] = 0;\n  }\n  return (out: any);\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport type { ReglCommand, Vec3 } from \"../types\";\nimport { withPose, pointToVec3, defaultBlend, defaultDepth, shouldConvert, colorBuffer } from \"./commandUtils\";\n\n// Creates a regl command factory which will render any geometry described by point positions\n// and elements (indexes into the array of positions), and apply the object's pose, scale, and color to it.\nexport default (positions: Vec3[], elements: Vec3[]) => (regl: any): ReglCommand => {\n  const vertexArray = Float32Array.from([].concat(...positions));\n\n  if (elements.some((face) => face.some((i) => i < 0 || i >= 1 << 16))) {\n    throw new Error(\"Element index out of bounds for Uint16\");\n  }\n  const elementsArray = Uint16Array.from([].concat(...elements));\n\n  const buff = regl.buffer({\n    // tell the gpu this buffer's contents will change frequently\n    usage: \"dynamic\",\n    data: [],\n  });\n  const colorBuff = colorBuffer(regl);\n\n  return withPose({\n    vert: `\n    precision mediump float;\n    attribute vec3 point;\n    attribute vec3 offset;\n    attribute vec4 color;\n    uniform mat4 projection, view;\n    uniform vec3 scale;\n    varying vec4 vColor;\n\n    #WITH_POSE\n\n    void main () {\n      vec3 p = applyPose(scale * point) + offset;\n      vColor = color;\n      gl_Position = projection * view * vec4(p, 1);\n    }\n    `,\n    frag: `\n    precision mediump float;\n    varying vec4 vColor;\n    void main () {\n      gl_FragColor = vColor;\n    }`,\n\n    attributes: {\n      point: vertexArray,\n      color: (context, props) => {\n        return colorBuff(props.color, props.colors, props.points ? props.points.length : 1);\n      },\n\n      offset: (context, props) => {\n        const points = shouldConvert(props.points) ? props.points.map(pointToVec3) : props.points || [0, 0, 0];\n        return {\n          buffer: buff({\n            usage: \"dynamic\",\n            data: points,\n          }),\n          divisor: 1,\n        };\n      },\n    },\n\n    elements: elementsArray,\n\n    depth: defaultDepth,\n    blend: defaultBlend,\n\n    uniforms: {\n      scale: (context, props) => (shouldConvert(props.scale) ? pointToVec3(props.scale) : props.scale),\n    },\n\n    count: elementsArray.length,\n\n    instances: (context, props) => (props.points ? props.points.length : 1),\n  });\n};\n","// @flow\n\n//  Copyright (c) 2019-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\ntype TypedArray = Int8Array | Uint8Array | Int16Array | Uint16Array | Uint32Array | Float32Array;\n\nexport type GLBModel = {\n  json: Object,\n  accessors?: TypedArray[],\n  images?: ImageBitmap[],\n};\n\n// Parse a GLB file: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0\n//\n// Returns an object containing the raw json data as well as parsed images (Image) and\n// accessors (TypedArray).\nexport default async function parseGLB(arrayBuffer: ArrayBuffer): Promise<GLBModel> {\n  const data = new DataView(arrayBuffer);\n  let offset = 0;\n\n  function readUint32() {\n    const value = data.getUint32(offset, true);\n    offset += 4;\n    return value;\n  }\n\n  // magic header\n  const magic = readUint32();\n  if (magic !== 0x46546c67) {\n    throw new Error(`incorrect magic value 0x${magic.toString(16)}`);\n  }\n\n  // Binary glTF version\n  const version = readUint32();\n  if (version !== 2) {\n    throw new Error(`incorrect version ${version}`);\n  }\n\n  // total file length\n  const totalLength = readUint32();\n  if (totalLength !== data.byteLength) {\n    throw new Error(`length ${totalLength} doesn't match response length ${data.byteLength}`);\n  }\n\n  function findNextChunkOfType(type) {\n    do {\n      const chunkLength = readUint32();\n      const chunkType = readUint32();\n      if (chunkType === type) {\n        const chunkData = new DataView(data.buffer, offset, chunkLength);\n        offset += chunkLength;\n        return chunkData;\n      }\n      offset += chunkLength;\n    } while (offset < totalLength);\n  }\n\n  const jsonData = findNextChunkOfType(/* JSON */ 0x4e4f534a);\n  if (!jsonData) {\n    throw new Error(\"no JSON chunk found\");\n  }\n\n  const json = JSON.parse(new TextDecoder().decode(jsonData));\n\n  const binary = findNextChunkOfType(/* BIN */ 0x004e4942);\n  if (!binary) {\n    return { json };\n  }\n\n  if (json.buffers[0].uri !== undefined) {\n    throw new Error(\"expected GLB-stored buffer\");\n  }\n\n  // create a TypedArray for each accessor\n  const accessors = json.accessors.map((accessorInfo) => {\n    let arrayType;\n    // prettier-ignore\n    switch (accessorInfo.componentType) {\n      case WebGLRenderingContext.BYTE: arrayType = Int8Array; break;\n      case WebGLRenderingContext.UNSIGNED_BYTE: arrayType = Uint8Array; break;\n      case WebGLRenderingContext.SHORT: arrayType = Int16Array; break;\n      case WebGLRenderingContext.UNSIGNED_SHORT: arrayType = Uint16Array; break;\n      case WebGLRenderingContext.UNSIGNED_INT: arrayType = Uint32Array; break;\n      case WebGLRenderingContext.FLOAT: arrayType = Float32Array; break;\n      default:\n        throw new Error(`unrecognized componentType ${accessorInfo.componentType}`);\n    }\n    let numComponents;\n    // prettier-ignore\n    switch (accessorInfo.type) {\n      case \"SCALAR\": numComponents = 1; break;\n      case \"VEC2\": numComponents = 2; break;\n      case \"VEC3\": numComponents = 3; break;\n      case \"VEC4\": numComponents = 4; break;\n      case \"MAT2\": numComponents = 4; break;\n      case \"MAT3\": numComponents = 9; break;\n      case \"MAT4\": numComponents = 16; break;\n      default:\n        throw new Error(`unrecognized type ${accessorInfo.type}`);\n    }\n    const bufferView = json.bufferViews[accessorInfo.bufferView];\n    if (bufferView.buffer !== 0) {\n      throw new Error(\"only GLB-stored buffers are supported\");\n    }\n    if (bufferView.byteLength % arrayType.BYTES_PER_ELEMENT !== 0) {\n      throw new Error(\"bufferView.byteLength mismatch\");\n    }\n    return new arrayType(\n      binary.buffer,\n      binary.byteOffset + (bufferView.byteOffset || 0) + (accessorInfo.byteOffset || 0),\n      accessorInfo.count * numComponents\n    );\n  });\n\n  // load embedded images\n  const images =\n    json.images &&\n    (await Promise.all(\n      json.images.map((imgInfo) => {\n        const bufferView = json.bufferViews[imgInfo.bufferView];\n        const data = new DataView(binary.buffer, binary.byteOffset + bufferView.byteOffset, bufferView.byteLength);\n        return self.createImageBitmap(new Blob([data], { type: imgInfo.mimeType }));\n      })\n    ));\n\n  return { json, accessors, images };\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport type { AssignNextColorsFn, MouseEventObject } from \"../types\";\n\nfunction nonInstancedGetChildrenForHitmapFromSingleProp<T: any>(\n  prop: T,\n  assignNextColors: AssignNextColorsFn,\n  excludedObjects: MouseEventObject[],\n  useOriginalMarkerProp: boolean = false\n): ?T {\n  // The marker that we send to event callbacks.\n  const eventCallbackMarker = useOriginalMarkerProp ? prop.originalMarker : prop;\n  if (excludedObjects.some(({ object }) => object === eventCallbackMarker)) {\n    return null;\n  }\n  const hitmapProp = { ...prop };\n  const [hitmapColor] = assignNextColors(eventCallbackMarker, 1);\n  hitmapProp.color = hitmapColor;\n  if (hitmapProp.colors && hitmapProp.points && hitmapProp.points.length) {\n    hitmapProp.colors = new Array(hitmapProp.points.length).fill(hitmapColor);\n  }\n  return hitmapProp;\n}\n\nexport const nonInstancedGetChildrenForHitmap = <T: any>(\n  props: T,\n  assignNextColors: AssignNextColorsFn,\n  excludedObjects: MouseEventObject[]\n): ?T => {\n  if (Array.isArray(props)) {\n    return props\n      .map((prop) => nonInstancedGetChildrenForHitmapFromSingleProp(prop, assignNextColors, excludedObjects))\n      .filter(Boolean);\n  }\n  return nonInstancedGetChildrenForHitmapFromSingleProp(props, assignNextColors, excludedObjects);\n};\n\n// Almost identical to nonInstancedGetChildrenForHitmap, but instead the object passed to event callbacks is the object\n// at `prop.originalMarker`, not just `prop`.\nexport const getChildrenForHitmapWithOriginalMarker = <T: any>(\n  props: T,\n  assignNextColors: AssignNextColorsFn,\n  excludedObjects: MouseEventObject[]\n) => {\n  if (Array.isArray(props)) {\n    return props\n      .map((prop) => nonInstancedGetChildrenForHitmapFromSingleProp(prop, assignNextColors, excludedObjects, true))\n      .filter(Boolean);\n  }\n  return nonInstancedGetChildrenForHitmapFromSingleProp(props, assignNextColors, excludedObjects, true);\n};\n\nfunction instancedGetChildrenForHitmapFromSingleProp<T: any>(\n  prop: T,\n  assignNextColors: AssignNextColorsFn,\n  excludedObjects: MouseEventObject[],\n  pointCountPerInstance\n): ?T {\n  const matchedExcludedObjects = excludedObjects.filter(({ object, instanceIndex }) => object === prop);\n  const filteredIndices = matchedExcludedObjects\n    .map(({ object, instanceIndex }) => instanceIndex)\n    .filter((instanceIndex) => typeof instanceIndex === \"number\");\n  const hitmapProp = { ...prop };\n  const instanceCount = (hitmapProp.points && Math.ceil(hitmapProp.points.length / pointCountPerInstance)) || 1;\n  // This returns 1 color per instance.\n  const idColors = assignNextColors(prop, instanceCount);\n  const startColor = idColors[0];\n  // We have to map these instance colors to `pointCountPerInstance` number of points\n  if (hitmapProp.points && hitmapProp.points.length) {\n    const allColors = new Array(hitmapProp.points.length).fill().map(() => startColor);\n    for (let i = 0; i < instanceCount; i++) {\n      for (let j = 0; j < pointCountPerInstance; j++) {\n        const idx = i * pointCountPerInstance + j;\n        if (idx < allColors.length) {\n          allColors[idx] = idColors[i];\n        }\n      }\n    }\n    hitmapProp.colors = allColors;\n    if (filteredIndices.length) {\n      hitmapProp.points = hitmapProp.points.filter(\n        (_, index) => !filteredIndices.includes(Math.floor(index / pointCountPerInstance))\n      );\n      hitmapProp.colors = hitmapProp.colors.filter(\n        (_, index) => !filteredIndices.includes(Math.floor(index / pointCountPerInstance))\n      );\n    } else if (matchedExcludedObjects.length) {\n      // if we don't have instance indices, just filter out the whole object.\n      return null;\n    }\n  } else {\n    hitmapProp.color = startColor;\n    if (matchedExcludedObjects.length) {\n      return null;\n    }\n  }\n  return hitmapProp;\n}\n\nexport const createInstancedGetChildrenForHitmap = (pointCountPerInstance: number) => <T: any>(\n  props: T,\n  assignNextColors: AssignNextColorsFn,\n  excludedObjects: MouseEventObject[]\n): ?T => {\n  if (Array.isArray(props)) {\n    return props\n      .map((prop) =>\n        instancedGetChildrenForHitmapFromSingleProp(prop, assignNextColors, excludedObjects, pointCountPerInstance)\n      )\n      .filter(Boolean);\n  }\n  return instancedGetChildrenForHitmapFromSingleProp(props, assignNextColors, excludedObjects, pointCountPerInstance);\n};\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport memoize from \"lodash/memoize\";\n\nimport type { DepthState, BlendState } from \"../types\";\nimport { defaultReglDepth, defaultReglBlend } from \"./commandUtils\";\n\nconst withRenderStateOverrides = (command: any) => (regl: any) => {\n  // Generate the render command once\n  const reglCommand = command(regl);\n\n  // Use memoization to avoid generating multiple render commands for the same render states\n  // for the same render states\n  const memoizedRender = memoize(\n    (props: { depth: DepthState, blend: BlendState }) => {\n      const { depth, blend } = props;\n      return regl({ ...reglCommand, depth, blend });\n    },\n    (...args) => JSON.stringify(args)\n  );\n\n  const renderElement = (props) => {\n    // Get curstom render states from the given marker. Some commands, like <Arrows />\n    // will use the originalMarker property instead. If no custom render states\n    // are present, use either the ones provided in the command or the default ones. We do\n    // need to provide valid objects in order to make sure the hitmap works correctly.\n    const depth = props.depth || props.originalMarker?.depth || reglCommand.depth || defaultReglDepth;\n    const blend = props.blend || props.originalMarker?.blend || reglCommand.blend || defaultReglBlend;\n    memoizedRender({ depth, blend })(props);\n  };\n\n  return (props: any) => {\n    if (Array.isArray(props)) {\n      props.forEach(renderElement);\n    } else {\n      renderElement(props);\n    }\n  };\n};\n\nexport default withRenderStateOverrides;\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type { Cylinder } from \"../types\";\nimport fromGeometry from \"../utils/fromGeometry\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport withRenderStateOverrides from \"../utils/withRenderStateOverrides\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\nexport function createCylinderGeometry(numSegments: number, cone: boolean) {\n  // \"poles\" are the centers of top/bottom faces\n  const northPole = [0, 0, 0.5];\n  const southPole = [0, 0, -0.5];\n\n  const points = [northPole, southPole];\n\n  // Keep side faces separate from top/bottom to improve appearance for semi-transparent colors.\n  // We don't have a good approach to transparency right now but this is a small improvement over mixing the faces.\n  const sideFaces = [];\n  const endCapFaces = [];\n\n  for (let i = 0; i < numSegments; i++) {\n    const theta = (2 * Math.PI * i) / numSegments;\n    const x = 0.5 * Math.cos(theta);\n    const y = 0.5 * Math.sin(theta);\n    points.push([x, y, 0.5], [x, y, -0.5]);\n\n    const bottomLeftPt = points.length - 1;\n    const topRightPt = cone ? 0 : i + 1 === numSegments ? 2 : points.length;\n    const bottomRightPt = i + 1 === numSegments ? 3 : points.length + 1;\n    sideFaces.push([bottomLeftPt, topRightPt, bottomRightPt]);\n    endCapFaces.push([bottomLeftPt, bottomRightPt, 1]);\n    if (!cone) {\n      const topLeftPt = points.length - 2;\n      sideFaces.push([topLeftPt, bottomLeftPt, topRightPt]);\n      endCapFaces.push([topLeftPt, topRightPt, 0]);\n    }\n  }\n  return { points, sideFaces, endCapFaces };\n}\n\nconst { points, sideFaces, endCapFaces } = createCylinderGeometry(30, false);\n\nexport const cylinders = withRenderStateOverrides(fromGeometry(points, sideFaces.concat(endCapFaces)));\n\nconst getChildrenForHitmap = createInstancedGetChildrenForHitmap(1);\nexport default function Cylinders(props: { ...CommonCommandProps, children: Cylinder[] }) {\n  return <Command getChildrenForHitmap={getChildrenForHitmap} {...props} reglCommand={cylinders} />;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type { Cone } from \"../types\";\nimport fromGeometry from \"../utils/fromGeometry\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport withRenderStateOverrides from \"../utils/withRenderStateOverrides\";\nimport Command, { type CommonCommandProps } from \"./Command\";\nimport { createCylinderGeometry } from \"./Cylinders\";\n\nconst { points, sideFaces, endCapFaces } = createCylinderGeometry(30, true);\n\nexport const cones = withRenderStateOverrides(fromGeometry(points, sideFaces.concat(endCapFaces)));\n\nconst getChildrenForHitmap = createInstancedGetChildrenForHitmap(1);\nexport default function Cones(props: { ...CommonCommandProps, children: Cone[] }) {\n  return <Command getChildrenForHitmap={getChildrenForHitmap} {...props} reglCommand={cones} />;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { vec3, quat } from \"gl-matrix\";\nimport omit from \"lodash/omit\";\nimport React, { memo, Fragment } from \"react\";\n\nimport type { Arrow } from \"../types\";\nimport { pointToVec3, vec3ToPoint, orientationToVec4, vec4ToOrientation } from \"../utils/commandUtils\";\nimport { getChildrenForHitmapWithOriginalMarker } from \"../utils/getChildrenForHitmapDefaults\";\nimport type { CommonCommandProps } from \"./Command\";\nimport Cones, { cones } from \"./Cones\";\nimport Cylinders, { cylinders } from \"./Cylinders\";\n\nconst UNIT_X_VECTOR = Object.freeze([0, 0, 1]);\n\ntype Props = {\n  ...CommonCommandProps,\n  children: Arrow[],\n};\n\nconst generateArrowPrimitives = (markers: Arrow[]) => {\n  const cylinders = [];\n  const cones = [];\n\n  for (const marker of markers) {\n    let shaftWidthX;\n    let shaftWidthY;\n    let shaftLength;\n    let headWidthX;\n    let headWidthY;\n    let headLength;\n\n    let basePosition;\n    let orientation;\n    let dir;\n    if (marker.points && marker.points.length === 2) {\n      const [start, end] = marker.points;\n      basePosition = [start.x, start.y, start.z];\n      const tipPosition = [end.x, end.y, end.z];\n      const length = vec3.distance(basePosition, tipPosition);\n\n      dir = vec3.subtract([0, 0, 0], tipPosition, basePosition);\n      vec3.normalize(dir, dir);\n      orientation = quat.rotationTo([0, 0, 0, 0], UNIT_X_VECTOR, dir);\n\n      headWidthX = headWidthY = marker.scale.y;\n      headLength = marker.scale.z || length * 0.3;\n      shaftWidthX = shaftWidthY = marker.scale.x;\n      shaftLength = length - headLength;\n    } else {\n      basePosition = pointToVec3(marker.pose.position);\n      orientation = orientationToVec4(marker.pose.orientation);\n      quat.rotateY(orientation, orientation, Math.PI / 2);\n      dir = vec3.transformQuat([0, 0, 0], UNIT_X_VECTOR, orientation);\n\n      shaftWidthX = marker.scale.y || 1;\n      shaftWidthY = marker.scale.z || 1;\n      headWidthX = 2 * shaftWidthX;\n      headWidthY = 2 * shaftWidthY;\n\n      // these magic numbers taken from\n      // https://github.com/ros-visualization/rviz/blob/57325fa075893de70f234f4676cdd08b411858ff/src/rviz/default_plugin/markers/arrow_marker.cpp#L113\n      headLength = 0.23 * (marker.scale.x || 1);\n      shaftLength = 0.77 * (marker.scale.x || 1);\n    }\n\n    const shaftPosition = vec3.scaleAndAdd([0, 0, 0], basePosition, dir, shaftLength / 2);\n    const headPosition = vec3.scaleAndAdd([0, 0, 0], basePosition, dir, shaftLength + headLength / 2);\n\n    cylinders.push({\n      // Set the original marker so we can use it in mouse events\n      originalMarker: marker,\n      scale: { x: shaftWidthX, y: shaftWidthY, z: shaftLength },\n      color: marker.color,\n      pose: {\n        position: vec3ToPoint(shaftPosition),\n        orientation: vec4ToOrientation(orientation),\n      },\n    });\n    cones.push({\n      // Set the original marker so we can use it in mouse events\n      originalMarker: marker,\n      scale: { x: headWidthX, y: headWidthY, z: headLength },\n      color: marker.color,\n      pose: {\n        position: vec3ToPoint(headPosition),\n        orientation: vec4ToOrientation(orientation),\n      },\n    });\n  }\n\n  return {\n    cones,\n    cylinders,\n  };\n};\n\nexport const makeArrowsCommand = () => (regl: any) => {\n  const cylindersCommand = cylinders(regl);\n  const conesCommand = cones(regl);\n  return (props: any) => {\n    const { cylinders: cylinderPrimitives, cones: conePrimitives } = generateArrowPrimitives(props);\n    cylindersCommand(cylinderPrimitives);\n    conesCommand(conePrimitives);\n  };\n};\n\nfunction Arrows(props: Props) {\n  const passedProps = omit(props, \"children\");\n  const { cylinders, cones } = generateArrowPrimitives(props.children);\n  return (\n    <Fragment>\n      <Cylinders getChildrenForHitmap={getChildrenForHitmapWithOriginalMarker} {...passedProps}>\n        {cylinders}\n      </Cylinders>\n      <Cones getChildrenForHitmap={getChildrenForHitmapWithOriginalMarker} {...passedProps}>\n        {cones}\n      </Cones>\n    </Fragment>\n  );\n}\n\nexport default memo<Props>(Arrows);\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport flatten from \"lodash/flatten\";\nimport memoize from \"lodash/memoize\";\nimport * as React from \"react\";\n\nimport type { Line, Vec4, Color, Pose, DepthState, BlendState } from \"../types\";\nimport {\n  defaultBlend,\n  withPose,\n  toRGBA,\n  shouldConvert,\n  pointToVec3,\n  defaultReglDepth,\n  defaultReglBlend,\n} from \"../utils/commandUtils\";\nimport { nonInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\n/*\nTriangle-based line drawing.\n\n4 points (a strip of 2 triangles) are drawn for each segment of the line using instanced arrays.\nEach of the 4 points has a distinct \"point type\" which informs how the input point is offset to\nyield the vertices of the triangle.\n\nPassing the input point as an attribute with {divisor: 1} tells GL to use each point for 1 instance,\nthen move on to the next point -- something like `points.map((p) => draw2Triangles(p))`.\n\n4 attributes are used so the vertex shader can see 4 input points at once (reading from the same\nbuffer with different offsets). This is because the positions of the TL/BL endpoints depend on the\nangle ABC, and the positions of TR/BR depend on the angle BCD.\n\nRoughly the segment looks like:\n\n     TL   -   -   -  .TR\n      |          ,.-' |\nA - - B - - -,.-' - - C - - D\n      |  ,.-'         |\n     BL-' -   -   -   BR\n\nWhen two adjacent segments form an obtuse angle, we draw a miter join:\n\n                      TR/TL.\n                 , '   _/|   ' .\n             , '     _/  |       ' .\n         , '       _/    C           ' .\n     , '         _/      |               ' .\n   TL          _/        |        ______,----'TR\n    \\        _/       ,BR/BL.----'            /\n     B     _/    , '          ' .            D\n      \\  _/ , '                   ' .       /\n       BL'                            ' . BR\n\nBut when the angle gets too sharp, we switch to a \"fold\" join, where the two segments overlap at\nthe corner:\n\n        ,TR/BL---C--BR/TL\n       ,    |.\\__  ,     .\n      ,     | .  \\,_      .\n     ,      |  . ,  \\_     .\n    ,       |   ,     \\__   .\n   ,        |  , .       \\__ .\n  TL._      | ,   .        _.TR\n      'B._  |,     .   _.C'\n          'BL       BR'\n\n(A regular bevel join without any overlaps is harder to achieve without artifacts in the sharp-angle\nedge cases.)\n\n*/\n\nconst FLOAT_BYTES = Float32Array.BYTES_PER_ELEMENT;\nconst POINT_BYTES = 3 * FLOAT_BYTES;\nconst DEFAULT_MONOCHROME_COLOR = [1, 1, 1, 0.2];\n\n// The four points forming the triangles' vertices.\n// Values do not matter, they just need to be distinct.\nconst POINT_TYPES = { BL: 0, TR: 1, BR: 2, TL: 3 };\nconst VERTICES_PER_INSTANCE = Object.keys(POINT_TYPES).length;\n\nconst vert = `\nprecision mediump float;\n\nattribute float pointType;\n\n// per-instance attributes\nattribute vec4 colorB;\nattribute vec4 colorC;\nattribute vec3 positionA;\nattribute vec3 positionB;\nattribute vec3 positionC;\nattribute vec3 positionD;\n// per-instance pose attributes\nattribute vec3 posePosition;\nattribute vec4 poseRotation;\n\nuniform mat4 projection, view;\nuniform float viewportWidth;\nuniform float viewportHeight;\nuniform float alpha;\nuniform float thickness;\nuniform bool joined;\nuniform bool scaleInvariant;\n\nvarying vec4 vColor;\n\n${Object.keys(POINT_TYPES)\n  .map((k) => `const float POINT_${k} = ${POINT_TYPES[k]}.0;`)\n  .join(\"\\n\")}\n\n#WITH_POSE\n\nvec3 applyPoseInstance(vec3 point, vec4 rotation, vec3 position) {\n  // rotate the point and then add the position of the pose\n  // this function is defined in WITH_POSE\n  return rotate(point, rotation) + position;\n}\n\nvec2 rotateCCW(vec2 v) {\n  return vec2(-v.y, v.x);\n}\n\nvec2 normalizeOrZero(vec2 v) {\n  return length(v) < 0.00001 ? vec2(0, 0) : normalize(v);\n}\n\nvoid setPosition(vec4 proj, vec2 offset) {\n  gl_Position = proj;\n\n  offset *= thickness / 2.;\n\n  if (scaleInvariant) {\n    // The given thickness is a number of pixels on screen. Divide x by width/2 and\n    // y by height/2 so that they correspond to pixel distances when scaled from clip space to NDC.\n    offset.x /= viewportWidth / 2.0;\n    offset.y /= viewportHeight / 2.0;\n    // Compensate for automatic division by w\n    offset *= proj.w;\n  } else {\n    // The line thickness should be scaled the same way the camera scales other distances.\n    // projection[0].xyz is the result of projecting a unit x-vector, so its length represents\n    // how much distances are scaled by the camera projection.\n    offset *= length(projection[0].xyz);\n    offset.y *= viewportWidth / viewportHeight;\n  }\n\n  gl_Position.xy += offset;\n}\n\nvoid main () {\n  bool isStart = positionA == positionB;\n  bool isEnd = positionC == positionD;\n  bool isLeft = (pointType == POINT_TL || pointType == POINT_BL);\n  bool isTop = (pointType == POINT_TL || pointType == POINT_TR);\n  bool isEndpoint = isLeft ? isStart : isEnd;\n\n  float scale = isTop ? 1. : -1.;\n\n  mat4 projView = projection * view;\n  vec4 projA = projView * vec4(applyPose(applyPoseInstance(positionA, poseRotation, posePosition)), 1);\n  vec4 projB = projView * vec4(applyPose(applyPoseInstance(positionB, poseRotation, posePosition)), 1);\n  vec4 projC = projView * vec4(applyPose(applyPoseInstance(positionC, poseRotation, posePosition)), 1);\n  vec4 projD = projView * vec4(applyPose(applyPoseInstance(positionD, poseRotation, posePosition)), 1);\n\n  vec2 aspectVec = vec2(viewportWidth / viewportHeight, 1.0);\n  vec2 screenA = projA.xy / projA.w * aspectVec;\n  vec2 screenB = projB.xy / projB.w * aspectVec;\n  vec2 screenC = projC.xy / projC.w * aspectVec;\n  vec2 screenD = projD.xy / projD.w * aspectVec;\n\n  vec2 dirAB = normalizeOrZero(screenB - screenA);\n  vec2 dirBC = normalizeOrZero(screenC - screenB);\n  vec2 dirCD = normalizeOrZero(screenD - screenC);\n\n  vec2 perpAB = rotateCCW(dirAB); // vector perpendicular to AB\n  vec2 perpBC = rotateCCW(dirBC); // vector perpendicular to BC\n\n  vColor = isLeft ? colorB : colorC;\n  vColor.a *= alpha;\n\n  vec4 proj = isLeft ? projB : projC;\n\n  // simple case: non-joined line list\n  if (!joined || isEndpoint) {\n    setPosition(proj, scale * perpBC);\n    return;\n  }\n\n  // clamp to prevent rounding errors from breaking the sqrt()s below\n  float cosB = clamp(-dot(dirAB, dirBC), -1., 1.);\n  float cosC = clamp(-dot(dirBC, dirCD), -1., 1.);\n\n  bool tooSharpB = cosB > 0.01;\n  bool tooSharpC = cosC > 0.01;\n  bool tooSharp = isLeft ? tooSharpB : tooSharpC;\n\n  bool turningRightB = dot(dirAB, rotateCCW(dirBC)) > 0.;\n  bool turningRightC = dot(dirBC, rotateCCW(dirCD)) > 0.;\n  bool turningRight = isLeft ? turningRightB : turningRightC;\n\n  if (tooSharp) {\n    // \"fold join\"\n    vec2 perp = isLeft ? perpAB : perpBC;\n    vec2 dir = isLeft ? dirAB : dirBC;\n    float scalePerp = isLeft ? -1. : 1.;\n    float scaleDir = (turningRight == isLeft) ? 1. : -1.;\n    float tanHalfB = sqrt((1. - cosB) / (1. + cosB));\n    float tanHalfC = sqrt((1. - cosC) / (1. + cosC));\n    float tanHalf = isLeft ? tanHalfB : tanHalfC;\n    setPosition(proj, scale * (scalePerp * perp + scaleDir * dir * tanHalf));\n  } else {\n    // miter join\n    vec2 bisectorB = rotateCCW(normalize(dirAB + dirBC)); // angle bisector of ABC\n    vec2 bisectorC = rotateCCW(normalize(dirBC + dirCD)); // angle bisector of BCD\n    vec2 bisector = isLeft ? bisectorB : bisectorC;\n    float sinHalfB = sqrt((1. - cosB) / 2.);\n    float sinHalfC = sqrt((1. - cosC) / 2.);\n    float sinHalf = isLeft ? sinHalfB : sinHalfC;\n    setPosition(proj, scale * bisector / sinHalf);\n  }\n}\n`;\n\nconst frag = `\nprecision mediump float;\nvarying vec4 vColor;\nvoid main () {\n  gl_FragColor = vColor;\n}\n`;\n\nfunction pointsEqual(a, b) {\n  const [ax, ay, az] = shouldConvert(a) ? pointToVec3(a) : a;\n  const [bx, by, bz] = shouldConvert(b) ? pointToVec3(b) : b;\n  return ax === bx && ay === by && az === bz;\n}\n\nexport const lines = (regl: any) => {\n  // The point type attribute, reused for each instance\n  const pointTypeBuffer = regl.buffer({\n    type: \"uint16\",\n    usage: \"static\",\n    data: [POINT_TYPES.TL, POINT_TYPES.BL, POINT_TYPES.TR, POINT_TYPES.BR],\n  });\n  const debugColorBuffer = regl.buffer({\n    type: \"float\",\n    usage: \"static\",\n    data: [\n      [0, 1, 1, 1], // cyan\n      [1, 0, 0, 1], // red\n      [0, 1, 0, 1], // green\n      [1, 0, 1, 1], // magenta\n    ],\n  });\n  // The pose position and rotation buffers contain the identity position/rotation, for use when we don't have instanced\n  // poses.\n  const defaultPosePositionBuffer = regl.buffer({\n    type: \"float\",\n    usage: \"static\",\n    data: flatten(new Array(VERTICES_PER_INSTANCE).fill([0, 0, 0])),\n  });\n  const defaultPoseRotationBuffer = regl.buffer({\n    type: \"float\",\n    usage: \"static\",\n    // Rotation array identity is [x: 0, y: 0, z: 0, w: 1]\n    data: flatten(new Array(VERTICES_PER_INSTANCE).fill([0, 0, 0, 1])),\n  });\n\n  // The buffers used for input position & color data\n  const colorBuffer = regl.buffer({ type: \"float\" });\n\n  // All invocations of the vertex shader share data from the positions buffer, but with different\n  // offsets. However, when offset and stride are combined, 3 or 4 attributes reading from the same\n  // buffer produces incorrect results on certain Lenovo hardware running Ubuntu. As a workaround,\n  // we upload the same data into two buffers and have only two attributes reading from each buffer.\n  const positionBuffer1 = regl.buffer({ type: \"float\" });\n  const positionBuffer2 = regl.buffer({ type: \"float\" });\n\n  const posePositionBuffer = regl.buffer({ type: \"float\" });\n  const poseRotationBuffer = regl.buffer({ type: \"float\" });\n\n  const command = regl(\n    withPose({\n      vert,\n      frag,\n      blend: defaultBlend,\n      uniforms: {\n        thickness: regl.prop(\"scale.x\"),\n        viewportWidth: regl.context(\"viewportWidth\"),\n        viewportHeight: regl.context(\"viewportHeight\"),\n        alpha: regl.prop(\"alpha\"),\n        joined: regl.prop(\"joined\"),\n        scaleInvariant: regl.prop(\"scaleInvariant\"),\n      },\n      attributes: {\n        pointType: pointTypeBuffer,\n        colorB: (context, { joined, monochrome, debug }) => ({\n          buffer: debug ? debugColorBuffer : colorBuffer,\n          offset: 0,\n          stride: (joined || monochrome || debug ? 1 : 2) * 4 * FLOAT_BYTES,\n          divisor: monochrome || debug ? 0 : 1,\n        }),\n        colorC: (context, { joined, monochrome, debug }) => ({\n          buffer: debug ? debugColorBuffer : colorBuffer,\n          offset: monochrome || debug ? 0 : 4 * FLOAT_BYTES,\n          stride: (joined || monochrome || debug ? 1 : 2) * 4 * FLOAT_BYTES,\n          divisor: monochrome || debug ? 0 : 1,\n        }),\n        positionA: (context, { joined }) => ({\n          buffer: positionBuffer1,\n          offset: 0,\n          stride: (joined ? 1 : 2) * POINT_BYTES,\n          divisor: 1,\n        }),\n        positionB: (context, { joined }) => ({\n          buffer: positionBuffer1,\n          offset: POINT_BYTES,\n          stride: (joined ? 1 : 2) * POINT_BYTES,\n          divisor: 1,\n        }),\n        positionC: (context, { joined }) => ({\n          buffer: positionBuffer2,\n          offset: 2 * POINT_BYTES,\n          stride: (joined ? 1 : 2) * POINT_BYTES,\n          divisor: 1,\n        }),\n        positionD: (context, { joined }) => ({\n          buffer: positionBuffer2,\n          offset: 3 * POINT_BYTES,\n          stride: (joined ? 1 : 2) * POINT_BYTES,\n          divisor: 1,\n        }),\n        posePosition: (context, { hasInstancedPoses }) => ({\n          buffer: hasInstancedPoses ? posePositionBuffer : defaultPosePositionBuffer,\n          divisor: hasInstancedPoses ? 1 : 0,\n        }),\n        poseRotation: (context, { hasInstancedPoses }) => ({\n          buffer: hasInstancedPoses ? poseRotationBuffer : defaultPoseRotationBuffer,\n          divisor: hasInstancedPoses ? 1 : 0,\n        }),\n      },\n      count: VERTICES_PER_INSTANCE,\n      instances: regl.prop(\"instances\"),\n      primitive: regl.prop(\"primitive\"),\n    })\n  );\n\n  let colorArray = new Float32Array(VERTICES_PER_INSTANCE * 4);\n  let pointArray = new Float32Array(0);\n  let allocatedPoints = 0;\n  let positionArray = new Float32Array(0);\n  let rotationArray = new Float32Array(0);\n\n  function fillPointArray(points: any[], alreadyClosed: boolean, shouldClose: boolean): Float32Array {\n    const numTotalPoints = points.length + (shouldClose ? 3 : 2);\n    if (allocatedPoints < numTotalPoints) {\n      pointArray = new Float32Array(numTotalPoints * 3);\n      allocatedPoints = numTotalPoints;\n    }\n    points.forEach((point, i) => {\n      const [x, y, z] = shouldConvert(point) ? pointToVec3(point) : point;\n      const off = 3 + i * 3;\n      pointArray[off + 0] = x;\n      pointArray[off + 1] = y;\n      pointArray[off + 2] = z;\n    });\n\n    // The \"prior\" point (A) and \"next\" point (D) need to be set when rendering the first & last\n    // segments, so we copy data from the last point(s) to the beginning of the array, and from the\n    // first point(s) to the end of the array.\n    const n = numTotalPoints * 3;\n    if (alreadyClosed) {\n      // First and last points already match; \"prior\" should be the second-to-last\n      // and \"next\" should be the second.\n      pointArray.copyWithin(0, n - 9, n - 6);\n      pointArray.copyWithin(n - 3, 6, 9);\n    } else if (shouldClose) {\n      // First point is being reused after last point; first *two* points need to be copied at the end\n      pointArray.copyWithin(0, n - 9, n - 6);\n      pointArray.copyWithin(n - 6, 3, 9);\n    } else {\n      // Endpoints are separate; just duplicate first & last points, resulting in square-looking endcaps\n      pointArray.copyWithin(0, 3, 6);\n      pointArray.copyWithin(n - 3, n - 6, n - 3);\n    }\n    return pointArray.subarray(0, n);\n  }\n\n  function fillPoseArrays(\n    instances: number,\n    poses: Pose[]\n  ): { positionData: Float32Array, rotationData: Float32Array } {\n    if (positionArray.length < instances * 3) {\n      positionArray = new Float32Array(instances * 3);\n      rotationArray = new Float32Array(instances * 4);\n    }\n    for (let index = 0; index < poses.length; index++) {\n      const positionOffset = index * 3;\n      const rotationOffset = index * 4;\n      const { position, orientation: r } = poses[index];\n      const convertedPosition = Array.isArray(position) ? position : pointToVec3(position);\n      positionArray[positionOffset + 0] = convertedPosition[0];\n      positionArray[positionOffset + 1] = convertedPosition[1];\n      positionArray[positionOffset + 2] = convertedPosition[2];\n\n      const convertedRotation = Array.isArray(r) ? r : [r.x, r.y, r.z, r.w];\n      rotationArray[rotationOffset + 0] = convertedRotation[0];\n      rotationArray[rotationOffset + 1] = convertedRotation[1];\n      rotationArray[rotationOffset + 2] = convertedRotation[2];\n      rotationArray[rotationOffset + 3] = convertedRotation[3];\n    }\n    return {\n      positionData: positionArray.subarray(0, instances * 3),\n      rotationData: rotationArray.subarray(0, instances * 4),\n    };\n  }\n\n  function convertColors(colors: any): Vec4[] {\n    return shouldConvert(colors) ? colors.map(toRGBA) : colors;\n  }\n\n  function fillColorArray(\n    color: ?Color | ?Vec4,\n    colors: ?((Color | Vec4)[]),\n    monochrome: boolean,\n    shouldClose: boolean\n  ): Float32Array {\n    if (monochrome) {\n      if (colorArray.length < VERTICES_PER_INSTANCE * 4) {\n        colorArray = new Float32Array(VERTICES_PER_INSTANCE * 4);\n      }\n      const monochromeColor = color || DEFAULT_MONOCHROME_COLOR;\n      const [convertedMonochromeColor] = convertColors([monochromeColor]);\n      const [r, g, b, a] = convertedMonochromeColor;\n      for (let index = 0; index < VERTICES_PER_INSTANCE; index++) {\n        const offset = index * 4;\n        colorArray[offset + 0] = r;\n        colorArray[offset + 1] = g;\n        colorArray[offset + 2] = b;\n        colorArray[offset + 3] = a;\n      }\n      return colorArray.subarray(0, VERTICES_PER_INSTANCE * 4);\n    } else if (colors) {\n      const length = shouldClose ? colors.length + 1 : colors.length;\n      if (colorArray.length < length * 4) {\n        colorArray = new Float32Array(length * 4);\n      }\n      const convertedColors = convertColors(colors);\n      for (let index = 0; index < convertedColors.length; index++) {\n        const offset = index * 4;\n        const [r, g, b, a] = convertedColors[index];\n        colorArray[offset + 0] = r;\n        colorArray[offset + 1] = g;\n        colorArray[offset + 2] = b;\n        colorArray[offset + 3] = a;\n      }\n\n      if (shouldClose) {\n        const [r, g, b, a] = convertedColors[0];\n        const lastIndex = length - 1;\n        colorArray[lastIndex * 4 + 0] = r;\n        colorArray[lastIndex * 4 + 1] = g;\n        colorArray[lastIndex * 4 + 2] = b;\n        colorArray[lastIndex * 4 + 3] = a;\n      }\n      return colorArray.subarray(0, length * 4);\n    }\n    throw new Error(\"Impossible: !monochrome implies !!colors.\");\n  }\n\n  // Create a new render function based on rendering settings\n  // Memoization is required in order to prevent creating too many functions\n  // that use the same arguments, potentially leading to memory leaks.\n  const memoizedRender = memoize(\n    (props: { depth?: DepthState, blend?: BlendState }) => {\n      const { depth = defaultReglDepth, blend = defaultReglBlend } = props;\n      return regl({ depth, blend });\n    },\n    (...args) => JSON.stringify(args)\n  );\n\n  // Disable depth for debug rendering (so lines stay visible)\n  const render = (props: { debug?: boolean, depth?: DepthState, blend?: BlendState }, commands: any) => {\n    const { debug } = props;\n    if (debug) {\n      memoizedRender({ depth: { enable: false } })(commands);\n    } else {\n      memoizedRender(props)(commands);\n    }\n  };\n\n  // Render one line list/strip\n  function renderLine(props) {\n    const { debug, primitive = \"lines\", scaleInvariant = false, depth, blend } = props;\n    const numInputPoints = props.points.length;\n\n    if (numInputPoints < 2) {\n      return;\n    }\n\n    const alreadyClosed = numInputPoints > 2 && pointsEqual(props.points[0], props.points[numInputPoints - 1]);\n    // whether the first point needs to be duplicated after the last point\n    const shouldClose = !alreadyClosed && props.closed;\n\n    const pointData = fillPointArray(props.points, alreadyClosed, shouldClose);\n    positionBuffer1({ data: pointData, usage: \"dynamic\" });\n    positionBuffer2({ data: pointData, usage: \"dynamic\" });\n\n    const monochrome = !(props.colors && props.colors.length);\n    const colorData = fillColorArray(props.color, props.colors, monochrome, shouldClose);\n    colorBuffer({ data: colorData, usage: \"dynamic\" });\n\n    const joined = primitive === \"line strip\";\n    const effectiveNumPoints = numInputPoints + (shouldClose ? 1 : 0);\n    const instances = joined ? effectiveNumPoints - 1 : Math.floor(effectiveNumPoints / 2);\n\n    // fill instanced pose buffers\n    const { poses } = props;\n    const hasInstancedPoses = !!poses && poses.length > 0;\n    if (hasInstancedPoses && poses) {\n      if (instances !== poses.length) {\n        console.error(`Expected ${instances} poses but given ${poses.length} poses: will result in webgl error.`);\n        return;\n      }\n      const { positionData, rotationData } = fillPoseArrays(instances, poses);\n      posePositionBuffer({ data: positionData, usage: \"dynamic\" });\n      poseRotationBuffer({ data: rotationData, usage: \"dynamic\" });\n    }\n\n    render({ debug, depth, blend }, () => {\n      // Use Object.assign because it's actually faster than babel's object spread polyfill.\n      command(\n        Object.assign({}, props, {\n          joined,\n          primitive: \"triangle strip\",\n          alpha: debug ? 0.2 : 1,\n          monochrome,\n          instances,\n          scaleInvariant,\n          hasInstancedPoses,\n        })\n      );\n      if (debug) {\n        command(\n          Object.assign({}, props, {\n            joined,\n            primitive: \"line strip\",\n            alpha: 1,\n            monochrome,\n            instances,\n            scaleInvariant,\n            hasInstancedPoses,\n          })\n        );\n      }\n    });\n  }\n\n  return (inProps: any) => {\n    if (Array.isArray(inProps)) {\n      inProps.forEach(renderLine);\n    } else {\n      renderLine(inProps);\n    }\n  };\n};\n\nexport default function Lines(props: { ...CommonCommandProps, children: Line[] }) {\n  return <Command getChildrenForHitmap={nonInstancedGetChildrenForHitmap} {...props} reglCommand={lines} />;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React from \"react\";\n\nimport type { Point, Vec3, Line } from \"../types\";\nimport Lines from \"./Lines\";\n\nconst pointToVec3 = (p: Vec3): Point => ({\n  x: p[0],\n  y: p[1],\n  z: p[2],\n});\n\nconst scale = 100;\nconst x = 1 * scale;\nconst xAxisPoints = [[-x, 0, 0], [x, 0, 0]].map(pointToVec3);\nconst yAxisPoints = [[0, -100, 0], [0, 100, 0]].map(pointToVec3);\nconst zAxisPoints = [[0, 0, -100], [0, 0, 100]].map(pointToVec3);\nconst pose = {\n  orientation: { x: 0, y: 0, z: 0, w: 0 },\n  position: { x: 0, y: 0, z: 0 },\n};\nconst xAxis = {\n  pose,\n  points: xAxisPoints,\n  scale: { x: 0.5, y: 0.5, z: 0.5 },\n  color: { r: 0.95, g: 0.26, b: 0.4, a: 1 },\n};\nconst yAxis = {\n  pose,\n  points: yAxisPoints,\n  scale: { x: 0.5, y: 0.5, z: 0.5 },\n  color: { r: 0.02, g: 0.82, b: 0.49, a: 1 },\n};\nconst zAxis = {\n  pose,\n  points: zAxisPoints,\n  scale: { x: 0.5, y: 0.5, z: 0.5 },\n  color: { r: 0.11, g: 0.51, b: 0.92, a: 1 },\n};\n\ntype Axis = Line;\n\ntype Props = {\n  children: Axis[],\n};\n\n// Renders lines along the x, y, and z axes; useful for debugging.\nexport default class Axes extends React.Component<Props> {\n  static defaultProps: Props = {\n    children: [xAxis, yAxis, zAxis],\n  };\n\n  render() {\n    return <Lines>{this.props.children}</Lines>;\n  }\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type { Cube } from \"../types\";\nimport fromGeometry from \"../utils/fromGeometry\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport withRenderStateOverrides from \"../utils/withRenderStateOverrides\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\nexport const cubes = withRenderStateOverrides(\n  fromGeometry(\n    [\n      // bottom face corners\n      [-0.5, -0.5, -0.5],\n      [-0.5, 0.5, -0.5],\n      [0.5, -0.5, -0.5],\n      [0.5, 0.5, -0.5],\n      // top face corners\n      [-0.5, -0.5, 0.5],\n      [-0.5, 0.5, 0.5],\n      [0.5, -0.5, 0.5],\n      [0.5, 0.5, 0.5],\n    ],\n    [\n      // bottom\n      [0, 1, 2],\n      [1, 2, 3],\n      // top\n      [4, 5, 6],\n      [5, 6, 7],\n      // left\n      [0, 2, 4],\n      [2, 4, 6],\n      // right\n      [1, 3, 5],\n      [3, 5, 7],\n      //front\n      [2, 3, 6],\n      [3, 6, 7],\n      //back\n      [0, 1, 4],\n      [1, 4, 5],\n    ]\n  )\n);\n\nconst getChildrenForHitmap = createInstancedGetChildrenForHitmap(1);\nexport default function Cubes(props: { ...CommonCommandProps, children: Cube[] }) {\n  return <Command getChildrenForHitmap={getChildrenForHitmap} {...props} reglCommand={cubes} />;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type { SphereList } from \"../types\";\nimport fromGeometry from \"../utils/fromGeometry\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport withRenderStateOverrides from \"../utils/withRenderStateOverrides\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\nconst NUM_PARALLELS = 15;\nconst NUM_MERIDIANS = 15;\nconst RADIUS = 0.5;\n\nconst northPole = [0, 0, RADIUS];\nconst southPole = [0, 0, -RADIUS];\nconst points = [northPole, southPole];\nconst faces = [];\n\nfor (let i = 0; i < NUM_PARALLELS; i++) {\n  for (let j = 0; j < NUM_MERIDIANS; j++) {\n    const phi = ((i + 1) / (NUM_PARALLELS + 1)) * Math.PI;\n    const z = RADIUS * Math.cos(phi);\n    const width = RADIUS * Math.sin(phi);\n    const theta = (j * 2 * Math.PI) / NUM_MERIDIANS;\n    const x = width * Math.cos(theta);\n    const y = width * Math.sin(theta);\n    points.push([x, y, z]);\n    if (j > 0) {\n      // connect to previous parallel (or north pole)\n      const prevMeridianPt = i === 0 ? 0 : points.length - 1 - NUM_MERIDIANS;\n      faces.push([points.length - 2, points.length - 1, prevMeridianPt]);\n      if (i > 0) {\n        faces.push([points.length - 2, prevMeridianPt - 1, prevMeridianPt]);\n      }\n    }\n  }\n  // connect to previous parallel (or north pole)\n  const prevMeridianPt = i === 0 ? 0 : points.length - 2 * NUM_MERIDIANS;\n  faces.push([points.length - 1, points.length - NUM_MERIDIANS, prevMeridianPt]);\n  if (i > 0) {\n    faces.push([points.length - 1, points.length - NUM_MERIDIANS - 1, prevMeridianPt]);\n  }\n}\n// connect last parallel to south pole\nfor (let j = 0; j < NUM_MERIDIANS; j++) {\n  const pt = points.length - NUM_MERIDIANS + j;\n  const prevPt = j === 0 ? points.length - 1 : pt - 1;\n  faces.push([pt, prevPt, 1]);\n}\n\nexport const spheres = withRenderStateOverrides(fromGeometry(points, faces));\n\nconst getChildrenForHitmap = createInstancedGetChildrenForHitmap(1);\nexport default function Spheres(props: { ...CommonCommandProps, children: SphereList[] }) {\n  return <Command getChildrenForHitmap={getChildrenForHitmap} {...props} reglCommand={spheres} />;\n}\n","// @flow\n\n//  Copyright (c) 2019-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React from \"react\";\n\nimport type { Line, Point, Vec3, Scale, GetChildrenForHitmap, SphereList } from \"../../types\";\nimport { vec4ToRGBA, vec3ToPoint } from \"../../utils/commandUtils\";\nimport Lines from \"../Lines\";\nimport Spheres from \"../Spheres\";\n\nexport function multiplyScale(scale: Scale, factor: number): Scale {\n  return { x: scale.x * factor, y: scale.y * factor, z: scale.z * factor };\n}\n\nexport const DEFAULT_COLOR = [1, 1, 1, 1];\nexport const ACTIVE_POLYGON_COLOR = [0.8, 0, 0.8, 1];\nexport const ACTIVE_POINT_COLOR = [1, 0.2, 1, 1];\nexport const LINE_STRIP = \"line strip\";\nconst POINT_SIZE_FACTOR = 1.3;\nexport const DRAW_SCALE = { x: 0.1, y: 0.1, z: 0.1 };\nexport const DRAW_POINT_SCALE = multiplyScale(DRAW_SCALE, POINT_SIZE_FACTOR);\nexport const HITMAP_SCALE = { x: 0.5, y: 0.5, z: 0.5 };\nexport const HITMAP_POINT_SCALE = multiplyScale(HITMAP_SCALE, POINT_SIZE_FACTOR);\nexport const POSE = {\n  position: { x: 0, y: 0, z: 0 },\n  orientation: { x: 0, y: 0, z: 0, w: 0 },\n};\n\nlet count = 1;\n\nexport class PolygonPoint {\n  id: number;\n  point: Vec3;\n  active: boolean = false;\n\n  constructor(points: Vec3) {\n    this.id = count++;\n    this.point = points;\n  }\n}\n\nexport class Polygon {\n  id: number;\n  name: string;\n  points: PolygonPoint[] = [];\n  active: boolean = false;\n\n  constructor(name: string = \"\") {\n    this.name = name;\n    this.id = count++;\n  }\n}\n\nexport type DrawPolygonType = Polygon;\n\ntype Props = {\n  children: DrawPolygonType[],\n};\n\nconst polygonLinesGetChildrenForHitmap: GetChildrenForHitmap = <T: any>(\n  props: T,\n  assignNextColors,\n  excludedObjects\n) => {\n  // This is almost identical to the default nonInstancedGetChildrenForHitmap, with changes marked.\n  return props\n    .map((prop) => {\n      if (excludedObjects.some(({ object }) => object === prop)) {\n        return null;\n      }\n      const hitmapProp = { ...prop };\n      // Change from original: pass the original marker as a callback object instead of this marker.\n      const [hitmapColor] = assignNextColors(prop.originalMarker, 1);\n      // Change from original: increase scale for hitmap\n      hitmapProp.scale = HITMAP_SCALE;\n\n      hitmapProp.color = hitmapColor;\n      if (hitmapProp.colors && hitmapProp.points && hitmapProp.points.length) {\n        hitmapProp.colors = new Array(hitmapProp.points.length).fill(hitmapColor);\n      }\n      return hitmapProp;\n    })\n    .filter(Boolean);\n};\n\n/**\n * Draw the polygon lines\n */\nclass PolygonLines extends React.Component<Props> {\n  render() {\n    const polygons = this.props.children;\n    const lines: Line[] = [];\n    for (const poly of polygons) {\n      const color = poly.active ? ACTIVE_POLYGON_COLOR : DEFAULT_COLOR;\n      const points: (Point | Vec3)[] = poly.points.map(({ point }) => vec3ToPoint(point));\n\n      lines.push({\n        primitive: LINE_STRIP,\n        pose: POSE,\n        points,\n        scale: DRAW_SCALE,\n        color: vec4ToRGBA(color),\n        originalMarker: poly,\n      });\n    }\n\n    return <Lines getChildrenForHitmap={polygonLinesGetChildrenForHitmap}>{lines}</Lines>;\n  }\n}\n\nconst polygonPointsGetChildrenForHitmap: GetChildrenForHitmap = <T: any>(\n  props: T,\n  assignNextColors,\n  excludedObjects\n) => {\n  // This is similar to the default nonInstancedGetChildrenForHitmap, with changes marked.\n  return props\n    .map((prop) => {\n      if (excludedObjects.some(({ object }) => object === prop)) {\n        return null;\n      }\n      const hitmapProp = { ...prop };\n      // Change from original: assign a non-instanced color to each point color, even though this marker uses\n      // instancing.\n      // This is so that we can have a unique callback object for each point.\n      hitmapProp.colors = hitmapProp.colors.map((color, index) => {\n        return assignNextColors(prop.originalMarkers[index], 1);\n      });\n      // Change from original: increase scale for hitmap\n      hitmapProp.scale = HITMAP_POINT_SCALE;\n      return hitmapProp;\n    })\n    .filter(Boolean);\n};\n\n/**\n * Draw the polygon points at the end of each lines\n */\nclass PolygonPoints extends React.Component<Props> {\n  render() {\n    const polygons = this.props.children;\n    const points = [];\n    const colors = [];\n    const originalMarkers = [];\n\n    for (const poly of polygons) {\n      const color = poly.active ? ACTIVE_POLYGON_COLOR : DEFAULT_COLOR;\n      for (const point of poly.points) {\n        const convertedPoint = vec3ToPoint(point.point);\n        points.push(convertedPoint);\n        colors.push(point.active ? ACTIVE_POINT_COLOR : color);\n        originalMarkers.push(point);\n      }\n    }\n\n    const sphereList: SphereList = {\n      points,\n      colors,\n      pose: POSE,\n      scale: DRAW_POINT_SCALE,\n      originalMarkers,\n    };\n\n    return <Spheres getChildrenForHitmap={polygonPointsGetChildrenForHitmap}>{[sphereList]}</Spheres>;\n  }\n}\n\nexport default function DrawPolygons({ children: polygons = [] }: Props) {\n  if (polygons.length === 0) {\n    return null;\n  }\n\n  return (\n    <React.Fragment>\n      <PolygonLines>{polygons}</PolygonLines>\n      <PolygonPoints>{polygons}</PolygonPoints>\n    </React.Fragment>\n  );\n}\n","// @flow\n\n//  Copyright (c) 2019-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport distance from \"distance-to-line-segment\";\n\nimport type { Vec3, MouseHandler } from \"../../types\";\nimport { PolygonPoint, Polygon } from \"./index\";\n\ntype OptionalZPoint = {\n  x: number,\n  y: number,\n  z?: number,\n};\n\ntype PolygonAddCommand = {\n  points: OptionalZPoint[],\n  name?: string,\n};\n\nfunction areEqual(point1: PolygonPoint, point2: PolygonPoint) {\n  const [x1, y1, z1] = point1.point;\n  const [x2, y2, z2] = point2.point;\n  return x1 === x2 && y1 === y2 && z1 === z2;\n}\n\nfunction isClosed(polygon: Polygon): boolean {\n  const { points } = polygon;\n  for (let i = 0; i < points.length - 1; i++) {\n    if (areEqual(points[i], points[i + 1])) {\n      return true;\n    }\n  }\n  const firstPoint = points[0];\n  const lastPoint = points[points.length - 1];\n  return areEqual(firstPoint, lastPoint);\n}\n\n// Has listeners you can pass to Worldview for mouse interactions\n// internally builds a list of polygons and modifies the polygons\n// based on mouse & keyboard interactions. For now we use mututation internally\n// instead of immutability to keep the number of allocations lower and make\n// the implementation a bit more straightforward\n\nexport default class PolygonBuilder {\n  mouseDown: boolean = false;\n  polygons: Polygon[];\n  onChange: () => void = () => {};\n  activePolygon: ?Polygon;\n  activePoint: ?PolygonPoint;\n  mouseDownPoint: Vec3;\n\n  constructor(polygons: Polygon[] = []) {\n    this.polygons = polygons;\n  }\n\n  isActivePolygonClosed(): boolean {\n    return !!this.activePolygon && isClosed(this.activePolygon);\n  }\n\n  // adds a polygon to the builder, transforming it into the internal representation\n  addPolygon(cmd: PolygonAddCommand): void {\n    const { points, name } = cmd;\n    if (points.length < 3) {\n      return;\n    }\n    // clear any selections\n    this.selectObject();\n\n    const polygon = new Polygon(name);\n    polygon.points = points.map((p) => new PolygonPoint([p.x, p.y, p.z || 0]));\n    if (!isClosed(polygon)) {\n      polygon.points.push(polygon.points[0]);\n    }\n    this.polygons.push(polygon);\n  }\n\n  // push a new point - either adds to the active polygon\n  // or creates a new polygon at this point\n  pushPoint(point: Vec3): void {\n    const { activePolygon } = this;\n    if (activePolygon) {\n      // do not push a point on a closed polygon\n      if (!isClosed(activePolygon)) {\n        const newPoint = new PolygonPoint(point);\n        activePolygon.points.push(newPoint);\n        this.selectObject(newPoint);\n        return;\n      }\n    }\n\n    const polygon = new Polygon();\n    polygon.points.push(new PolygonPoint(point));\n    const floatingPoint = new PolygonPoint(point);\n    polygon.points.push(floatingPoint);\n    this.polygons.push(polygon);\n    this.selectObject(floatingPoint);\n    this.onChange();\n  }\n\n  // updates the active point to the new position\n  updateActivePoint(point: Vec3): void {\n    if (this.activePoint) {\n      this.activePoint.point = point;\n      this.onChange();\n    }\n  }\n\n  // closes the active polygon by either deleting it if\n  // is only 2 points (no \"single sided\" polygons...)\n  // or inserts an 'overlap' point by making the first point\n  // and last point a reference to the same point in the list\n  // this structure of overlap is similar to the structure used by geoJSON\n  // though \"left to right\" ordering is not enforced\n  closeActivePolygon(): void {\n    const polygon = this.activePolygon;\n    if (!polygon) {\n      return;\n    }\n\n    // remove single lines\n    if (polygon.points.length === 2) {\n      this.deletePolygon(polygon);\n    } else {\n      polygon.points.push(polygon.points[0]);\n    }\n    this.onChange();\n  }\n\n  // mouse move handler - should be added to Worldview as a prop\n  onMouseMove: MouseHandler = (e, args) => {\n    // prevent the camera from responding to move if we\n    // have an active object being edited\n    if (this.activePolygon) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n    //const cursor = e.ctrlKey ? 'crosshair' : '';\n    //document.body.style.cursor = cursor;\n\n    if (!this.mouseDown) {\n      return;\n    }\n    if (!args) {\n      return;\n    }\n\n    // early return to only raycast when mouse moves during interaction\n    if (!this.activePoint && !this.activePolygon) {\n      return;\n    }\n\n    const { ray } = args;\n    const point = ray.planeIntersection([0, 0, 0], [0, 0, 1]);\n    // satisfy flow\n    if (!point) {\n      return;\n    }\n\n    // satisfy flow\n    const { activePolygon } = this;\n\n    if (this.activePoint) {\n      this.updateActivePoint(point);\n    } else if (activePolygon && this.mouseDownPoint) {\n      // move polygon\n      const [pointX, pointY] = point;\n      const [mouseX, mouseY] = this.mouseDownPoint;\n      // figure out how far the mouse has moved\n      const dX = pointX - mouseX;\n      const dY = pointY - mouseY;\n\n      // save the new mouse position as for the next computation\n      this.mouseDownPoint = point;\n\n      // only update the 'overlap' point once\n      const uniquePoints = activePolygon.points.reduce((acc, point) => {\n        if (!acc.includes(point)) {\n          acc.push(point);\n        }\n        return acc;\n      }, []);\n\n      // adjust each point's location\n      for (const polygonPoint of uniquePoints) {\n        const { point } = polygonPoint;\n        point[0] = point[0] + dX;\n        point[1] = point[1] + dY;\n      }\n\n      this.onChange();\n    }\n  };\n\n  // deletes a polygon\n  deletePolygon(polygon: Polygon): void {\n    this.polygons = this.polygons.filter((poly) => poly !== polygon);\n    this.activePolygon = null;\n  }\n\n  // deletes a point in the active polygon\n  // if the point is the 'overlap point' create a new one\n  // also deletes the entire polygon if the polygon becomes a 1-sided polygon\n  deletePoint(point: PolygonPoint): void {\n    const { activePolygon } = this;\n    if (!activePolygon) {\n      return;\n    }\n    const newPoints = activePolygon.points.filter((p) => p.id !== point.id);\n    // if the 'overlap' point is deleted, create a new start/end overlap point\n    if (newPoints.length === activePolygon.points.length - 2) {\n      newPoints.push(newPoints[0]);\n    }\n    activePolygon.points = newPoints;\n    this.activePoint = null;\n    if (activePolygon.points.length < 4) {\n      this.deletePolygon(activePolygon);\n    }\n    this.onChange();\n  }\n\n  // key down handler - to be passed to Worldview as a prop\n  onKeyDown = (e: KeyboardEvent): void => {\n    // only respond to key events if we have a selected polygon\n    const { activePolygon } = this;\n    if (!activePolygon) {\n      return;\n    }\n\n    switch (e.key) {\n      case \"Delete\":\n      case \"Backspace\":\n        if (this.activePoint) {\n          this.deletePoint(this.activePoint);\n        } else {\n          this.deletePolygon(activePolygon);\n        }\n        this.onChange();\n        break;\n      default:\n        break;\n    }\n  };\n\n  // select either a point or polygon by id\n  selectObject(object?: Polygon | PolygonPoint) {\n    // clear out any previously active objects\n    this.activePolygon = null;\n    if (this.activePoint) {\n      this.activePoint.active = false;\n    }\n    this.activePoint = null;\n\n    for (const polygon of this.polygons) {\n      let isActive = polygon === object;\n      polygon.active = isActive;\n      if (isActive) {\n        this.activePolygon = polygon;\n      }\n      for (const point of polygon.points) {\n        if (point === object) {\n          // if a point is selected, activate both it\n          // and the polygon it belongs to\n          this.activePoint = point;\n          point.active = true;\n          polygon.active = true;\n          this.activePolygon = polygon;\n          isActive = true;\n        }\n      }\n    }\n\n    this.onChange();\n  }\n\n  // mouse up handler - to be passed to Worldview as a prop\n  onMouseUp: MouseHandler = (e, args) => {\n    if (!e.ctrlKey) {\n      this.mouseDown = false;\n    }\n  };\n\n  // double click handler - to be passed to Worldview as a prop\n  onDoubleClick: MouseHandler = (e, args) => {\n    // satisfy flow\n    if (!args) {\n      return;\n    }\n    if (!args.objects.length) {\n      return;\n    }\n\n    this.selectObject(args.objects[0].object);\n\n    // if a point was double-clicked, delete it\n    if (this.activePoint) {\n      this.deletePoint(this.activePoint);\n      return;\n    }\n\n    // otherwise insert a new point into the nearest line of the active polygon\n    const { activePolygon } = this;\n\n    // if no polygon is active, don't do anything w/ the double-click\n    if (!activePolygon) {\n      return;\n    }\n\n    let shortestDistance = Number.MAX_SAFE_INTEGER;\n    let shortestIndex = -1;\n    const { ray } = args;\n    const point = ray.planeIntersection([0, 0, 0], [0, 0, 1]);\n    if (!point) {\n      return;\n    }\n    const [px, py] = point;\n\n    // find the closest line segment of the active polygon\n    const { points } = activePolygon;\n    for (let i = 0; i < points.length - 1; i++) {\n      const point1 = points[i];\n      const point2 = points[i + 1];\n      const [x1, y1] = point1.point;\n      const [x2, y2] = point2.point;\n\n      // distance.squared is faster since we don't care about the\n      // actual distance, just which line produces the shortest distance\n      const dist = distance.squared(x1, y1, x2, y2, px, py);\n      if (dist < shortestDistance) {\n        shortestDistance = dist;\n        shortestIndex = i;\n      }\n    }\n\n    // insert a new point in the nearest line\n    if (shortestIndex > -1) {\n      const newPoint = new PolygonPoint(point);\n      activePolygon.points.splice(shortestIndex + 1, 0, newPoint);\n      this.activePoint = newPoint;\n    }\n    this.onChange();\n  };\n\n  // mouse down handler - to be passed to Worldview as a prop\n  onMouseDown: MouseHandler = (e, args) => {\n    if (!args) {\n      return;\n    }\n    const { ray } = args;\n\n    const point = ray.planeIntersection([0, 0, 0], [0, 0, 1]);\n\n    // satisfy flow but raycasting should always work\n    if (!point) {\n      return;\n    }\n\n    const isFirstClick = !this.mouseDown;\n    this.mouseDown = true;\n    this.mouseDownPoint = point;\n    const isCtrlClick = e.ctrlKey;\n\n    // single click or click+drag is for selection & moving\n    if (isFirstClick && !isCtrlClick) {\n      const clickObject = args.objects[0];\n      this.selectObject(clickObject && clickObject.object);\n      return this.onChange();\n    }\n\n    // ctrl+click always inserts a point\n    if (isCtrlClick) {\n      this.pushPoint(point);\n      return this.onChange();\n    }\n\n    // if mouse was down & we have a non-control click, close the active polygon\n    this.closeActivePolygon();\n    return this.onChange();\n  };\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type { Regl, TriangleList } from \"../types\";\nimport {\n  defaultBlend,\n  getVertexColors,\n  pointToVec3Array,\n  shouldConvert,\n  toRGBA,\n  withPose,\n} from \"../utils/commandUtils\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport withRenderStateOverrides from \"../utils/withRenderStateOverrides\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\n// TODO(Audrey): default to the actual regl defaults before 1.x release\nconst defaultSingleColorDepth = { enable: true, mask: false };\nconst defaultVetexColorDepth = {\n  enable: true,\n  mask: true,\n  func: \"<=\",\n};\n\nconst singleColor = (regl) =>\n  withPose({\n    primitive: \"triangles\",\n    vert: `\n  precision mediump float;\n\n  attribute vec3 point;\n\n  uniform mat4 projection, view;\n\n  #WITH_POSE\n\n  void main () {\n    vec3 pos = applyPose(point);\n    gl_Position = projection * view * vec4(pos, 1);\n  }\n  `,\n    frag: `\n  precision mediump float;\n  uniform vec4 color;\n  void main () {\n    gl_FragColor = color;\n  }\n  `,\n    attributes: {\n      point: (context, props) => {\n        if (shouldConvert(props.points)) {\n          return pointToVec3Array(props.points);\n        }\n        return props.points;\n      },\n    },\n    uniforms: {\n      color: (context, props) => {\n        if (shouldConvert(props.color)) {\n          return toRGBA(props.color);\n        }\n        return props.color;\n      },\n    },\n    // can pass in { enable: true, depth: false } to turn off depth to prevent flicker\n    // because multiple items are rendered to the same z plane\n    depth: {\n      enable: (context, props) => {\n        return (props.depth && props.depth.enable) || defaultSingleColorDepth.enable;\n      },\n      mask: (context, props) => {\n        return (props.depth && props.depth.mask) || defaultSingleColorDepth.mask;\n      },\n    },\n    blend: defaultBlend,\n\n    count: (context, props) => props.points.length,\n  });\n\nconst vertexColors = (regl) =>\n  withPose({\n    primitive: \"triangles\",\n    vert: `\n  precision mediump float;\n\n  attribute vec3 point;\n  attribute vec4 color;\n\n  uniform mat4 projection, view;\n\n  varying vec4 vColor;\n\n  #WITH_POSE\n\n  void main () {\n    vec3 pos = applyPose(point);\n    vColor = color;\n    gl_Position = projection * view * vec4(pos, 1);\n  }\n  `,\n    frag: `\n  precision mediump float;\n  varying vec4 vColor;\n  void main () {\n    gl_FragColor = vColor;\n  }\n  `,\n    attributes: {\n      point: (context, props) => {\n        if (shouldConvert(props.points)) {\n          return pointToVec3Array(props.points);\n        }\n        return props.points;\n      },\n      color: (context, props) => {\n        if (!props.colors || !props.colors.length) {\n          throw new Error(`Invalid empty or null prop \"colors\" when rendering triangles using vertex colors`);\n        }\n        if (shouldConvert(props.colors)) {\n          return getVertexColors(props);\n        }\n        return props.colors;\n      },\n    },\n\n    depth: {\n      enable: (context, props) => {\n        return (props.depth && props.depth.enable) || defaultVetexColorDepth.enable;\n      },\n      mask: (context, props) => {\n        return (props.depth && props.depth.mask) || defaultVetexColorDepth.mask;\n      },\n    },\n    blend: defaultBlend,\n\n    count: (context, props) => props.points.length,\n  });\n\n// command to render triangle lists optionally supporting vertex colors for each triangle\nconst triangles = (regl: Regl) => {\n  const single = withRenderStateOverrides(singleColor)(regl);\n  const vertex = withRenderStateOverrides(vertexColors)(regl);\n  return (props: any, isHitmap: boolean) => {\n    const items: TriangleList[] = Array.isArray(props) ? props : [props];\n    const singleColorItems = [];\n    const vertexColorItems = [];\n    items.forEach((item) => {\n      // If the item has onlyRenderInHitmap set, only render it in the hitmap.\n      if (isHitmap || !item.onlyRenderInHitmap) {\n        if (item.colors && item.colors.length) {\n          vertexColorItems.push(item);\n        } else {\n          singleColorItems.push(item);\n        }\n      }\n    });\n\n    single(singleColorItems);\n    vertex(vertexColorItems);\n  };\n};\n\nexport const makeTrianglesCommand = () => {\n  return triangles;\n};\n\nconst getChildrenForHitmap = createInstancedGetChildrenForHitmap(3);\nexport default function Triangles(props: { ...CommonCommandProps, children: TriangleList[] }) {\n  return <Command getChildrenForHitmap={getChildrenForHitmap} {...props} reglCommand={triangles} />;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport earcut from \"earcut\";\nimport React from \"react\";\n\nimport type { Vec3, Point, PolygonType } from \"../types\";\nimport { shouldConvert, pointToVec3 } from \"../utils/commandUtils\";\nimport { getChildrenForHitmapWithOriginalMarker } from \"../utils/getChildrenForHitmapDefaults\";\nimport Triangles, { makeTrianglesCommand } from \"./Triangles\";\n\nconst NO_POSE = {\n  position: { x: 0, y: 0, z: 0 },\n  orientation: { x: 0, y: 0, z: 0, w: 0 },\n};\n\nconst DEFAULT_SCALE = { x: 1, y: 1, z: 1 };\n\nfunction flatten3D(points: Vec3[]): Float32Array {\n  const array = new Float32Array(points.length * 3);\n  for (let i = 0; i < points.length; i++) {\n    const [x, y, z] = points[i];\n    array[i * 3] = x;\n    array[i * 3 + 1] = y;\n    array[i * 3 + 2] = z;\n  }\n  return array;\n}\n\nfunction getEarcutPoints(points: Vec3[]): (Vec3 | Point)[] {\n  const flattenedPoints = flatten3D(points);\n  const indices = earcut(flattenedPoints, null, 3);\n  const newPoints = [];\n  for (let i = 0; i < indices.length; i++) {\n    const originalIndex = indices[i];\n    newPoints.push(points[originalIndex]);\n  }\n  return newPoints;\n}\n\ntype Props = {\n  children: PolygonType[],\n};\n\nconst generateTriangles = (polygons: PolygonType[]) => {\n  return polygons.map((poly) => {\n    // $FlowFixMe flow doesn't know how shouldConvert works\n    const points: Vec3[] = shouldConvert(poly.points) ? poly.points.map(pointToVec3) : poly.points;\n    const pose = poly.pose ? poly.pose : NO_POSE;\n    const earcutPoints = getEarcutPoints(points);\n    return {\n      ...poly,\n      points: earcutPoints,\n      pose,\n      scale: DEFAULT_SCALE,\n      originalMarker: poly,\n    };\n  });\n};\n\nexport const makeFilledPolygonsCommand = () => (regl: any) => {\n  const trianglesCommand = makeTrianglesCommand()(regl);\n  return (props: any) => {\n    trianglesCommand(generateTriangles(props), false);\n  };\n};\n\n// command to draw a filled polygon\nfunction FilledPolygons({ children: polygons = [], ...rest }: Props) {\n  const triangles = generateTriangles(polygons);\n\n  // Overwrite the triangle's default getChildrenForHitmap because we want to event as if each triangle is a single\n  // polygon.\n  return (\n    <Triangles getChildrenForHitmap={getChildrenForHitmapWithOriginalMarker} {...rest}>\n      {triangles}\n    </Triangles>\n  );\n}\n\nexport default FilledPolygons;\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React from \"react\";\n\nimport type { Point, CameraCommand, Dimensions, Color, Pose, Scale, Vec4 } from \"../types\";\nimport { getCSSColor, toColor } from \"../utils/commandUtils\";\nimport { type WorldviewContextType } from \"../WorldviewContext\";\nimport WorldviewReactContext from \"../WorldviewReactContext\";\n\nconst BG_COLOR_LIGHT = \"#ffffff\";\nconst BG_COLOR_DARK = \"rgba(0,0,0,0.8)\";\nconst BRIGHTNESS_THRESHOLD = 128;\nconst DEFAULT_TEXT_COLOR = { r: 1, g: 1, b: 1, a: 1 };\nconst DEFAULT_BG_COLOR = { r: 0, g: 0, b: 0, a: 0.8 };\n\nexport type TextMarker = {\n  name?: string,\n  pose: Pose,\n  scale: Scale,\n  color?: Color | Vec4,\n  colors?: (Color | Vec4)[],\n  text: string,\n};\n\nlet cssHasBeenInserted = false;\nfunction insertGlobalCss() {\n  if (cssHasBeenInserted) {\n    return;\n  }\n  const style = document.createElement(\"style\");\n  style.innerHTML = `\n    .regl-worldview-text-wrapper {\n      position: absolute;\n      white-space: nowrap;\n      z-index: 100;\n      pointer-events: none;\n      top: 0;\n      left: 0;\n      will-change: transform;\n    }\n    .regl-worldview-text-inner {\n      position: relative;\n      left: -50%;\n      top: -0.5em;\n      white-space: pre-line;\n    }\n  `;\n  if (document.body) {\n    document.body.appendChild(style);\n  }\n  cssHasBeenInserted = true;\n}\n\nexport function isColorDark({ r, g, b }: Color): boolean {\n  // ITU-R BT.709 https://en.wikipedia.org/wiki/Rec._709\n  // 0.2126 * 255 * r + 0.7152 * 255 * g + 0.0722 * 255 * b\n  const luma = 54.213 * r + 182.376 * g + 18.411 * b;\n  return luma < BRIGHTNESS_THRESHOLD;\n}\n\nfunction isColorEqual(a: Color, b: Color): boolean {\n  return a.r === b.r && a.g === b.g && a.b === b.b && a.a === b.a;\n}\n\nclass TextElement {\n  wrapper = document.createElement(\"span\");\n  _inner = document.createElement(\"span\");\n  _text = document.createTextNode(\"\");\n  // store prev colors to improve perf\n  _prevTextColor: Color = DEFAULT_TEXT_COLOR;\n  _prevBgColor: ?Color = DEFAULT_BG_COLOR;\n  _prevAutoBackgroundColor: ?boolean = null;\n\n  constructor() {\n    insertGlobalCss();\n    this.wrapper.className = \"regl-worldview-text-wrapper\";\n    this._inner.className = \"regl-worldview-text-inner\";\n    this.wrapper.appendChild(this._inner);\n    this._inner.appendChild(this._text);\n    this.wrapper.style.color = getCSSColor(DEFAULT_TEXT_COLOR);\n  }\n\n  update(marker: TextMarker, left: number, top: number, autoBackgroundColor?: boolean) {\n    this.wrapper.style.transform = `translate(${left.toFixed()}px,${top.toFixed()}px)`;\n    const { color, colors = [] } = marker;\n    const hasBgColor = colors.length >= 2;\n    const textColor = toColor(hasBgColor ? colors[0] : color || [0, 0, 0, 1]);\n\n    if (textColor) {\n      const backgroundColor = toColor(colors[1]);\n      if (!isColorEqual(this._prevTextColor, textColor)) {\n        this._prevTextColor = textColor;\n        this.wrapper.style.color = getCSSColor(textColor);\n      }\n\n      if (!autoBackgroundColor && autoBackgroundColor !== this._prevAutoBackgroundColor) {\n        // remove background color if autoBackgroundColor has changed\n        this._inner.style.background = \"transparent\";\n        this._prevBgColor = null;\n      } else {\n        if (\n          autoBackgroundColor &&\n          (!this._prevBgColor || (this._prevBgColor && !isColorEqual(textColor, this._prevBgColor)))\n        ) {\n          // update background color with automatic dark/light color\n          this._prevBgColor = textColor;\n          const isTextColorDark = isColorDark(textColor);\n          const hexBgColor = isTextColorDark ? BG_COLOR_LIGHT : BG_COLOR_DARK;\n          this._inner.style.background = hexBgColor;\n        } else if (hasBgColor && this._prevBgColor && !isColorEqual(backgroundColor, this._prevBgColor)) {\n          // update background color with colors[1] data\n          this._prevBgColor = backgroundColor;\n          this._inner.style.background = getCSSColor(backgroundColor);\n        }\n      }\n    }\n    this._prevAutoBackgroundColor = autoBackgroundColor;\n\n    if (this._text.textContent !== marker.text) {\n      this._text.textContent = marker.text || \"\";\n    }\n  }\n}\n\ntype Props = {\n  children: TextMarker[],\n  autoBackgroundColor?: boolean,\n};\n\n// Render text on a scene using DOM nodes, similar to the Overlay command.\n// Implementation uses manual DOM manipulation to avoid the performance hit from React tree reconciliation.\nexport default class Text extends React.Component<Props> {\n  _context: ?WorldviewContextType;\n  _textComponents: Map<string | TextMarker, TextElement> = new Map();\n  _textContainerRef: { current: HTMLDivElement | null } = React.createRef();\n\n  static defaultProps = {\n    children: [],\n  };\n\n  componentDidMount() {\n    if (this._context) {\n      this._context.registerPaintCallback(this.paint);\n    }\n  }\n\n  componentWillUnmount = () => {\n    if (this._context) {\n      this._context.unregisterPaintCallback(this.paint);\n    }\n  };\n\n  paint = () => {\n    const context = this._context;\n    const textComponents = this._textComponents;\n    const { children: markers, autoBackgroundColor } = this.props;\n    const { current: textContainer } = this._textContainerRef;\n    const initializedData = context && context.initializedData;\n\n    if (!textContainer || !context || !initializedData) {\n      return;\n    }\n    const {\n      dimension,\n      dimension: { width, height },\n    } = context;\n    const { camera } = initializedData;\n\n    const componentsToRemove = new Set(textComponents.keys());\n\n    for (const marker of markers) {\n      const { pose, name } = marker;\n      const { position } = pose;\n      const coord = this.project(position, camera, dimension);\n      if (!coord) {\n        continue;\n      }\n\n      const [left, top] = coord;\n      if (left < -10 || top < -10 || left > width + 10 || top > height + 10) {\n        continue;\n      }\n\n      let el = textComponents.get(name || marker);\n      if (el) {\n        componentsToRemove.delete(name || marker);\n      } else {\n        el = new TextElement();\n        textComponents.set(name || marker, el);\n        textContainer.appendChild(el.wrapper);\n      }\n\n      el.update(marker, left, top, autoBackgroundColor);\n    }\n\n    for (const key of componentsToRemove) {\n      const el = textComponents.get(key);\n      if (!el) {\n        continue;\n      }\n      el.wrapper.remove();\n      textComponents.delete(key);\n    }\n  };\n\n  project = (point: Point, camera: CameraCommand, dimension: Dimensions) => {\n    const vec = [point.x, point.y, point.z];\n    const { left, top, width, height } = dimension;\n    const viewport = [left, top, width, height];\n    return camera.toScreenCoord(viewport, vec);\n  };\n\n  render() {\n    return (\n      <React.Fragment>\n        <div ref={this._textContainerRef} />\n        <WorldviewReactContext.Consumer>\n          {(ctx: ?WorldviewContextType) => {\n            if (ctx) {\n              this._context = ctx;\n            }\n            return null;\n          }}\n        </WorldviewReactContext.Consumer>\n      </React.Fragment>\n    );\n  }\n}\n","// @flow\n\nimport TinySDF from \"@mapbox/tiny-sdf\";\nimport difference from \"lodash/difference\";\nimport memoizeOne from \"memoize-one\";\nimport React, { useState } from \"react\";\n\nimport type { Color } from \"../types\";\nimport { defaultBlend, defaultDepth, toColor } from \"../utils/commandUtils\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport Command, { type CommonCommandProps } from \"./Command\";\nimport { isColorDark, type TextMarker } from \"./Text\";\n\n// The GLText command renders text from a Signed Distance Field texture.\n// There are many external resources about SDFs and text rendering in WebGL, including:\n// https://steamcdn-a.akamaihd.net/apps/valve/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\n// https://blog.mapbox.com/drawing-text-with-signed-distance-fields-in-mapbox-gl-b0933af6f817\n// http://hack.chrons.me/opengl-text-rendering/\n// https://stackoverflow.com/questions/25956272/better-quality-text-in-webgl\n//\n// Approach\n// ========\n// Characters from the font are measured using a <canvas> and the SDFs are drawn into a texture up front\n// (and whenever new characters are being rendered). Then one instanced draw call is made with an instance\n// per character which reads from the corresponding place in the texture atlas.\n//\n// Possible future improvements\n// ============================\n// - Allow customization of font style, maybe highlight ranges.\n// - Consider a solid rectangular background instead of an outline. This is challenging because the\n//   instances currently overlap, so there will be z-fighting, but might be possible using the stencil buffer and multiple draw calls.\n// - Somehow support kerning and more advanced font metrics. However, the web font APIs may not\n//   provide support for this. Some font info could be generated/stored offline, possibly including the atlas.\n// - Explore multi-channel SDFs.\n\ntype CharacterLocations = {\n  [char: string]: {|\n    x: number,\n    y: number,\n    width: number,\n  |},\n};\n\nexport type GeneratedAtlas = {|\n  charInfo: CharacterLocations,\n  textureWidth: number,\n  textureHeight: number,\n  textureData: Uint8Array,\n|};\n\ntype TextMarkerProps = TextMarker & {\n  billboard?: ?boolean,\n  highlightedIndices?: Array<number>,\n  highlightColor?: ?Color,\n};\n\ntype GLTextProps = {|\n  autoBackgroundColor?: boolean,\n  scaleInvariantFontSize?: number,\n  resolution?: number,\n  alphabet?: string[],\n  textAtlas?: GeneratedAtlas,\n|};\n\ntype Props = {\n  // $FlowFixMe: flow does not know how to handle the indexed property in CommonCommandProps\n  ...CommonCommandProps,\n  ...GLTextProps,\n  children: $ReadOnlyArray<TextMarkerProps>,\n};\n\n// Font size used in rendering the atlas. This is independent of the `scale` of the rendered text.\nconst MIN_RESOLUTION = 40;\nconst DEFAULT_RESOLUTION = 160;\nconst SDF_RADIUS = 8;\nconst CUTOFF = 0.25;\nconst BUFFER = 10;\n\nconst BG_COLOR_LIGHT = Object.freeze({ r: 1, g: 1, b: 1, a: 1 });\nconst BG_COLOR_DARK = Object.freeze({ r: 0, g: 0, b: 0, a: 1 });\n\nconst memoizedCreateCanvas = memoizeOne((font) => {\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\");\n  ctx.font = font;\n  return ctx;\n});\n\nconst hashMarkerPosition = (marker: TextMarker): string => {\n  const { x, y, z } = marker.pose.position;\n  // The hash is a simple string with all three components\n  return `x${x}y${y}z${z}`;\n};\n\nconst getMarkerYOffset = (offsets: Map<string, number>, marker: TextMarker) => {\n  return offsets.get(hashMarkerPosition(marker)) || 0;\n};\n\nconst setMarkerYOffset = (offsets: Map<string, number>, marker: TextMarker, yOffset: number) => {\n  offsets.set(hashMarkerPosition(marker), yOffset);\n};\n\n// Build a single font atlas: a texture containing all characters and position/size data for each character.\nconst createMemoizedGenerateAtlas = () =>\n  memoizeOne(\n    // We update charSet mutably but monotonically. Pass in the size to invalidate the cache.\n    (charSet: Set<string>, _setSize, resolution: number, maxAtlasWidth: number): GeneratedAtlas => {\n      const tinySDF = new TinySDF(resolution, BUFFER, SDF_RADIUS, CUTOFF, \"sans-serif\", \"normal\");\n      const ctx = memoizedCreateCanvas(`${resolution}px sans-serif`);\n\n      let textureWidth = 0;\n      const rowHeight = resolution + 2 * BUFFER;\n      const charInfo = {};\n\n      // Measure and assign positions to all characters\n      let x = 0;\n      let y = 0;\n      for (const char of charSet) {\n        const width = ctx.measureText(char).width;\n        const dx = Math.ceil(width) + 2 * BUFFER;\n        if (x + dx > maxAtlasWidth) {\n          x = 0;\n          y += rowHeight;\n        }\n        charInfo[char] = { x, y, width };\n        x += dx;\n        textureWidth = Math.max(textureWidth, x);\n      }\n\n      const textureHeight = y + rowHeight;\n      const textureData = new Uint8Array(textureWidth * textureHeight);\n\n      // Use tiny-sdf to create SDF images for each character and copy them into a single texture\n      for (const char of charSet) {\n        const { x, y } = charInfo[char];\n        const data = tinySDF.draw(char);\n        for (let i = 0; i < tinySDF.size; i++) {\n          for (let j = 0; j < tinySDF.size; j++) {\n            // if this character is near the right edge, we don't actually copy the whole square of data\n            if (x + j < textureWidth) {\n              textureData[textureWidth * (y + i) + x + j] = data[i * tinySDF.size + j];\n            }\n          }\n        }\n      }\n\n      return {\n        charInfo,\n        textureWidth,\n        textureHeight,\n        textureData,\n      };\n    }\n  );\n\nconst createMemoizedDrawAtlasTexture = () =>\n  memoizeOne((textAtlas: GeneratedAtlas, atlasTexture: any) => {\n    atlasTexture({\n      data: textAtlas.textureData,\n      width: textAtlas.textureWidth,\n      height: textAtlas.textureHeight,\n      format: \"alpha\",\n      wrap: \"clamp\",\n      mag: \"linear\",\n      min: \"linear\",\n    });\n  });\n\nconst vert = `\n  precision mediump float;\n\n  uniform mat4 projection, view, billboardRotation;\n  uniform float fontSize;\n  uniform vec2 atlasSize;\n  uniform bool scaleInvariant;\n  uniform float scaleInvariantSize;\n  uniform float viewportHeight;\n  uniform float viewportWidth;\n  uniform bool isPerspective;\n  uniform float cameraFovY;\n\n  // per-vertex attributes\n  attribute vec2 texCoord;\n  attribute vec2 position;\n\n  // per-instance (character) attributes\n  attribute vec2 srcOffset;\n  attribute float srcWidth;\n  attribute vec2 destOffset;\n\n  // per-marker attributes\n  attribute vec3 scale;\n  attribute float billboard;\n  attribute vec2 alignmentOffset;\n  attribute float enableBackground;\n  attribute float enableHighlight;\n  attribute vec4 foregroundColor;\n  attribute vec4 backgroundColor;\n  attribute vec4 highlightColor;\n  attribute vec3 posePosition;\n  attribute vec4 poseOrientation;\n\n  varying vec2 vTexCoord;\n  varying float vEnableBackground;\n  varying vec4 vForegroundColor;\n  varying vec4 vBackgroundColor;\n  varying vec4 vHighlightColor;\n  varying float vEnableHighlight;\n  varying float vBillboard;\n\n  // rotate a 3d point v by a rotation quaternion q\n  // like applyPose(), but we need to use a custom per-instance pose\n  vec3 rotate(vec3 v, vec4 q) {\n    vec3 temp = cross(q.xyz, v) + q.w * v;\n    return v + (2.0 * cross(q.xyz, temp));\n  }\n\n  vec4 computeVertexPosition(vec3 markerPos) {\n    vec3 pos;\n    if (billboard == 1.0) {\n      pos = (billboardRotation * vec4(markerPos, 1.0)).xyz + posePosition;\n    } else {\n      pos = rotate(markerPos, poseOrientation) + posePosition;\n    }\n    return projection * view * vec4(pos, 1.0);\n  }\n\n  void main () {\n    // Scale invariance only works for billboards\n    bool scaleInvariantEnabled = scaleInvariant && billboard == 1.0;\n\n    vec2 srcSize = vec2(srcWidth, fontSize);\n    vec3 markerSpacePos = vec3((destOffset + position * srcSize + alignmentOffset) / fontSize, 0);\n\n    if (!scaleInvariantEnabled) {\n      // Apply marker scale only when scale invariance is disabled\n      markerSpacePos *= scale;\n    } else {\n      // If scale invariance is enabled, the text will be rendered at a constant\n      // scale regardless of the zoom level.\n      // The given scaleInvariantSize is in pixels. We need to scale it based on\n      // the current canvas resolution to get the proper dimensions later in NDC\n      float scaleInvariantFactor = scaleInvariantSize / viewportHeight;\n      if (isPerspective) {\n        // When using a perspective projection, the effect is achieved by using\n        // the w-component for scaling, which is obtained by first projecting\n        // the marker position into clip space.\n        gl_Position = computeVertexPosition(markerSpacePos);\n        scaleInvariantFactor *= gl_Position.w;\n        // We also need to take into account the camera's half vertical FOV\n        scaleInvariantFactor *= cameraFovY;\n      } else {\n        // Compute inverse aspect ratio\n        float invAspect = viewportHeight / viewportWidth;\n        // When using orthographic projection, the scaling factor is obtain from\n        // the camera projection itself.\n        // We also need applied the inverse aspect ratio\n        scaleInvariantFactor *= 2.0 * invAspect / length(projection[0].xyz);\n      }\n      // Apply scale invariant factor\n      markerSpacePos *= scaleInvariantFactor;\n    }\n\n    // Compute final vertex position\n    gl_Position = computeVertexPosition(markerSpacePos);\n\n    vTexCoord = (srcOffset + texCoord * srcSize) / atlasSize;\n    vEnableBackground = enableBackground;\n    vForegroundColor = foregroundColor;\n    vBackgroundColor = backgroundColor;\n    vHighlightColor = highlightColor;\n    vEnableHighlight = enableHighlight;\n    vBillboard = billboard;\n  }\n`;\n\nconst frag = `\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n  uniform mat4 projection;\n  uniform sampler2D atlas;\n  uniform float cutoff;\n  uniform bool scaleInvariant;\n  uniform float scaleInvariantSize;\n  uniform bool isHitmap;\n\n  varying vec2 vTexCoord;\n  varying float vEnableBackground;\n  varying vec4 vForegroundColor;\n  varying vec4 vBackgroundColor;\n  varying vec4 vHighlightColor;\n  varying float vEnableHighlight;\n  varying float vBillboard;\n\n  void main() {\n    float dist = texture2D(atlas, vTexCoord).a;\n\n    // fwidth(dist) is used to provide some anti-aliasing. However it's currently only used\n    // when the solid background is enabled, because the alpha blending and\n    // depth test don't work together nicely for partially-transparent pixels.\n    float edgeStep = smoothstep(1.0 - cutoff - fwidth(dist), 1.0 - cutoff, dist);\n\n    if (scaleInvariant && vBillboard == 1.0 && scaleInvariantSize <= 20.0) {\n      // If scale invariant is enabled and scaleInvariantSize is \"too small\", do not interpolate\n      // the raw distance value since at such small scale, the SDF approach causes some\n      // visual artifacts.\n      // The value used for checking if scaleInvariantSize is \"too small\" is arbitrary and\n      // was defined after some experimentation.\n      edgeStep = dist;\n    }\n\n    if (isHitmap) {\n      // When rendering for the hitmap buffer, we draw flat polygons using the foreground color\n      // instead of the actual glyphs. This way we increase the selection range and provide a\n      // better user experience.\n      gl_FragColor = vForegroundColor;\n    } else if (vEnableHighlight > 0.5) {\n      gl_FragColor = mix(vHighlightColor, vec4(0, 0, 0, 1), edgeStep);\n    } else if (vEnableBackground > 0.5) {\n      gl_FragColor = mix(vBackgroundColor, vForegroundColor, edgeStep);\n    } else {\n      gl_FragColor = vForegroundColor;\n      gl_FragColor.a *= edgeStep;\n    }\n\n    if (gl_FragColor.a == 0.) {\n      discard;\n    }\n  }\n`;\n\nfunction makeTextCommand(alphabet?: string[]) {\n  // Keep the set of rendered characters around so we don't have to rebuild the font atlas too often.\n  const charSet = new Set(alphabet || []);\n  const memoizedGenerateAtlas = createMemoizedGenerateAtlas();\n  const memoizedDrawAtlasTexture = createMemoizedDrawAtlasTexture();\n\n  const command = (regl: any) => {\n    const atlasTexture = regl.texture();\n\n    const drawText = regl({\n      // When using scale invariance, we want the text to be drawn on top\n      // of other elements. This is achieved by disabling depth testing\n      // In addition, make sure the <GLText /> command is the last one\n      // being rendered.\n      depth: {\n        enable: (ctx, props) => (props.scaleInvariant ? false : defaultDepth.enable(ctx, props)),\n        mask: (ctx, props) => (props.scaleInvariant ? false : defaultDepth.mask(ctx, props)),\n      },\n      blend: defaultBlend,\n      primitive: \"triangle strip\",\n      vert,\n      frag,\n      uniforms: {\n        atlas: atlasTexture,\n        atlasSize: () => [atlasTexture.width, atlasTexture.height],\n        fontSize: regl.prop(\"resolution\"),\n        cutoff: CUTOFF,\n        scaleInvariant: regl.prop(\"scaleInvariant\"),\n        scaleInvariantSize: regl.prop(\"scaleInvariantSize\"),\n        isHitmap: regl.prop(\"isHitmap\"),\n        viewportHeight: regl.context(\"viewportHeight\"),\n        viewportWidth: regl.context(\"viewportWidth\"),\n        isPerspective: regl.context(\"isPerspective\"),\n        cameraFovY: regl.context(\"fovy\"),\n      },\n      instances: regl.prop(\"instances\"),\n      count: 4,\n      attributes: {\n        position: [[0, 0], [0, -1], [1, 0], [1, -1]],\n        texCoord: [[0, 0], [0, 1], [1, 0], [1, 1]], // flipped\n        srcOffset: (ctx, props) => ({ buffer: props.srcOffsets, divisor: 1 }),\n        destOffset: (ctx, props) => ({ buffer: props.destOffsets, divisor: 1 }),\n        srcWidth: (ctx, props) => ({ buffer: props.srcWidths, divisor: 1 }),\n        scale: (ctx, props) => ({ buffer: props.scale, divisor: 1 }),\n        alignmentOffset: (ctx, props) => ({ buffer: props.alignmentOffset, divisor: 1 }),\n        billboard: (ctx, props) => ({ buffer: props.billboard, divisor: 1 }),\n        foregroundColor: (ctx, props) => ({ buffer: props.foregroundColor, divisor: 1 }),\n        backgroundColor: (ctx, props) => ({ buffer: props.backgroundColor, divisor: 1 }),\n        highlightColor: (ctx, props) => ({ buffer: props.highlightColor, divisor: 1 }),\n        enableBackground: (ctx, props) => ({ buffer: props.enableBackground, divisor: 1 }),\n        enableHighlight: (ctx, props) => ({ buffer: props.enableHighlight, divisor: 1 }),\n        posePosition: (ctx, props) => ({ buffer: props.posePosition, divisor: 1 }),\n        poseOrientation: (ctx, props) => ({ buffer: props.poseOrientation, divisor: 1 }),\n      },\n    });\n\n    return (props: $ReadOnlyArray<TextMarkerProps>, isHitmap: boolean) => {\n      let estimatedInstances = 0;\n      for (const { text } of props) {\n        if (typeof text !== \"string\") {\n          throw new Error(`Expected typeof 'text' to be a string. But got type '${typeof text}' instead.`);\n        }\n\n        for (const char of text) {\n          ++estimatedInstances;\n          charSet.add(char);\n        }\n      }\n\n      let generatedAtlas = command.textAtlas;\n      const generatedAtlasChars = generatedAtlas ? Object.keys(generatedAtlas.charInfo) : [];\n      const textChars = Array.from(charSet);\n      const generatedAtlasHasAllChars = difference(textChars, generatedAtlasChars).length === 0;\n      if (!generatedAtlas || !generatedAtlasHasAllChars) {\n        // See http://webglstats.com/webgl/parameter/MAX_TEXTURE_SIZE - everyone has at least min 2048 texture size, and\n        // almost everyone has at least 4096. With a 2048 width we have ~900 height with a full character set.\n        const maxAtlasWidth: number = regl.limits.maxTextureSize || 2048;\n        generatedAtlas = memoizedGenerateAtlas(charSet, charSet.size, command.resolution, maxAtlasWidth);\n      }\n      memoizedDrawAtlasTexture(generatedAtlas, atlasTexture);\n\n      const destOffsets = new Float32Array(estimatedInstances * 2);\n      const srcWidths = new Float32Array(estimatedInstances);\n      const srcOffsets = new Float32Array(estimatedInstances * 2);\n\n      // These don't vary across characters within a marker, but the divisor can't be dynamic so we have to duplicate the data for each character.\n      const alignmentOffset = new Float32Array(estimatedInstances * 2);\n      const scale = new Float32Array(estimatedInstances * 3);\n      const foregroundColor = new Float32Array(estimatedInstances * 4);\n      const backgroundColor = new Float32Array(estimatedInstances * 4);\n      const highlightColor = new Float32Array(estimatedInstances * 4);\n      const enableBackground = new Float32Array(estimatedInstances);\n      const billboard = new Float32Array(estimatedInstances);\n      const posePosition = new Float32Array(estimatedInstances * 3);\n      const poseOrientation = new Float32Array(estimatedInstances * 4);\n      const enableHighlight = new Float32Array(estimatedInstances);\n\n      let totalInstances = 0;\n\n      // Markers sharing the same position will be rendered in multiple lines.\n      // We keep track of offsets for the y-coordinate.\n      // We cannot use same value comparison here, so the\n      // key of the map is a hash based on the marker's position\n      // (see hashMarkerPosition() above).\n      const yOffsets = new Map<string, number>();\n\n      for (const marker of props) {\n        let totalWidth = 0;\n        let x = 0;\n        let y = getMarkerYOffset(yOffsets, marker);\n        let markerInstances = 0;\n        let lineCount = 1; // every text has at least one line\n\n        // If we need to render text for hitmap framebuffer, we only render the polygons using\n        // the foreground color (which needs to be converted to RGBA since it's a vec4).\n        // See comment on fragment shader above\n        const fgColor = toColor(\n          isHitmap ? marker.color || [0, 0, 0, 1] : marker.colors?.[0] || marker.color || BG_COLOR_LIGHT\n        );\n        const outline = marker.colors?.[1] != null || command.autoBackgroundColor;\n        const bgColor = toColor(\n          marker.colors?.[1] || (command.autoBackgroundColor && isColorDark(fgColor) ? BG_COLOR_LIGHT : BG_COLOR_DARK)\n        );\n        const hlColor = marker?.highlightColor || { r: 1, b: 0, g: 1, a: 1 };\n\n        for (let i = 0; i < marker.text.length; i++) {\n          const char = marker.text[i];\n          if (char === \"\\n\") {\n            x = 0;\n            // Make sure every line in the text is offsetted correctly\n            y += command.resolution;\n            lineCount++;\n            continue;\n          }\n          const info = generatedAtlas.charInfo[char];\n          const index = totalInstances + markerInstances;\n\n          // Calculate per-character attributes\n          destOffsets[2 * index + 0] = x;\n          destOffsets[2 * index + 1] = -y;\n          srcOffsets[2 * index + 0] = info.x + BUFFER;\n          // In order to make sure there's enough room for glyphs' descenders (i.e. 'g'),\n          // we need to apply an extra offset based on the font resolution.\n          // The value used to compute the offset is a result of experimentation.\n          srcOffsets[2 * index + 1] = info.y + BUFFER + 0.05 * command.resolution;\n          srcWidths[index] = info.width;\n\n          x += info.width;\n          totalWidth = Math.max(totalWidth, x);\n\n          // Copy per-marker attributes. These are duplicated per character so that we can draw\n          // all characters from all markers in a single draw call.\n\n          billboard[index] = marker.billboard ?? true ? 1 : 0;\n\n          scale[3 * index + 0] = marker.scale.x;\n          scale[3 * index + 1] = marker.scale.y;\n          scale[3 * index + 2] = marker.scale.z;\n\n          posePosition[3 * index + 0] = marker.pose.position.x;\n          posePosition[3 * index + 1] = marker.pose.position.y;\n          posePosition[3 * index + 2] = marker.pose.position.z;\n\n          poseOrientation[4 * index + 0] = marker.pose.orientation.x;\n          poseOrientation[4 * index + 1] = marker.pose.orientation.y;\n          poseOrientation[4 * index + 2] = marker.pose.orientation.z;\n          poseOrientation[4 * index + 3] = marker.pose.orientation.w;\n\n          foregroundColor[4 * index + 0] = fgColor.r;\n          foregroundColor[4 * index + 1] = fgColor.g;\n          foregroundColor[4 * index + 2] = fgColor.b;\n          foregroundColor[4 * index + 3] = fgColor.a;\n\n          backgroundColor[4 * index + 0] = bgColor.r;\n          backgroundColor[4 * index + 1] = bgColor.g;\n          backgroundColor[4 * index + 2] = bgColor.b;\n          backgroundColor[4 * index + 3] = bgColor.a;\n\n          highlightColor[4 * index + 0] = hlColor.r;\n          highlightColor[4 * index + 1] = hlColor.g;\n          highlightColor[4 * index + 2] = hlColor.b;\n          highlightColor[4 * index + 3] = hlColor.a;\n\n          enableHighlight[index] = marker.highlightedIndices && marker.highlightedIndices.includes(i) ? 1 : 0;\n\n          enableBackground[index] = outline ? 1 : 0;\n\n          ++markerInstances;\n        }\n\n        const totalHeight = y + command.resolution;\n        for (let i = 0; i < markerInstances; i++) {\n          alignmentOffset[2 * (totalInstances + i) + 0] = -totalWidth / 2;\n          alignmentOffset[2 * (totalInstances + i) + 1] = totalHeight / 2;\n        }\n\n        // Compute the y-coordinate's offset for the next overlapped marker, if any.\n        // Basically, we add as many offsets as numbers of lines in the marker's text.\n        // Since the y-coordinate is inverted when computing destOffset[] a few lines above\n        // we need an additional command.resolution offset (precomputed in totalHeight).\n        setMarkerYOffset(yOffsets, marker, totalHeight + lineCount * command.resolution);\n\n        totalInstances += markerInstances;\n      }\n\n      drawText({\n        instances: totalInstances,\n\n        isHitmap: !!isHitmap,\n        scaleInvariant: command.scaleInvariant,\n        resolution: command.resolution,\n        scaleInvariantSize: command.scaleInvariantSize,\n\n        // per-character\n        srcOffsets,\n        destOffsets,\n        srcWidths,\n\n        // per-marker\n        alignmentOffset,\n        billboard,\n        enableBackground,\n        enableHighlight,\n        foregroundColor,\n        backgroundColor,\n        highlightColor,\n        poseOrientation,\n        posePosition,\n        scale,\n      });\n    };\n  };\n  command.autoBackgroundColor = false;\n  return command;\n}\n\nexport const makeGLTextCommand = (props: GLTextProps) => {\n  const command = makeTextCommand(props.alphabet);\n  // HACK: Worldview doesn't provide an easy way to pass a command-level prop into the regl commands,\n  // so just attach it to the command object for now.\n  command.autoBackgroundColor = props.autoBackgroundColor;\n  command.resolution = Math.max(MIN_RESOLUTION, props.resolution || DEFAULT_RESOLUTION);\n  command.scaleInvariant = props.scaleInvariantFontSize != null;\n  command.scaleInvariantSize = props.scaleInvariantFontSize ?? 0;\n  command.textAtlas = props.textAtlas;\n  return command;\n};\n\nexport default function GLText(props: Props) {\n  const [command] = useState(() => makeGLTextCommand(props));\n  const getChildrenForHitmap = createInstancedGetChildrenForHitmap(1);\n\n  return <Command getChildrenForHitmap={getChildrenForHitmap} reglCommand={command} {...props} />;\n}\n","// @flow\n\n//  Copyright (c) 2019-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport { mat4 } from \"gl-matrix\";\nimport memoizeWeak from \"memoize-weak\";\nimport React, { useContext, useState, useEffect, useCallback, useDebugValue } from \"react\";\n\nimport type { Pose, Scale, MouseHandler } from \"../types\";\nimport { defaultBlend, pointToVec3, orientationToVec4 } from \"../utils/commandUtils\";\nimport { getChildrenForHitmapWithOriginalMarker } from \"../utils/getChildrenForHitmapDefaults\";\nimport parseGLB, { type GLBModel } from \"../utils/parseGLB\";\nimport WorldviewReactContext from \"../WorldviewReactContext\";\nimport Command from \"./Command\";\n\nfunction glConstantToRegl(value: ?number): ?string {\n  if (value === undefined) {\n    return undefined;\n  }\n  // prettier-ignore\n  switch (value) {\n    // min/mag filters\n    case WebGLRenderingContext.NEAREST: return \"nearest\";\n    case WebGLRenderingContext.LINEAR: return \"linear\";\n    case WebGLRenderingContext.NEAREST_MIPMAP_NEAREST: return \"nearest mipmap nearest\";\n    case WebGLRenderingContext.NEAREST_MIPMAP_LINEAR: return \"nearest mipmap linear\";\n    case WebGLRenderingContext.LINEAR_MIPMAP_NEAREST: return \"linear mipmap nearest\";\n    case WebGLRenderingContext.LINEAR_MIPMAP_LINEAR: return \"linear mipmap linear\";\n    // texture wrapping modes\n    case WebGLRenderingContext.REPEAT: return \"repeat\";\n    case WebGLRenderingContext.CLAMP_TO_EDGE: return \"clamp\";\n    case WebGLRenderingContext.MIRRORED_REPEAT: return \"mirror\";\n  }\n  throw new Error(`unhandled constant value ${JSON.stringify(value)}`);\n}\n\n// Default sampler set based on GLTF recommendations:\n// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#texture\nconst getDefaultSampler = () => ({\n  minFilter: WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,\n  magFilter: WebGLRenderingContext.LINEAR,\n  wrapS: WebGLRenderingContext.REPEAT,\n  wrapT: WebGLRenderingContext.REPEAT,\n});\n\nconst getSceneToDraw = ({ json }) => {\n  if (json.scene != null) {\n    return json.scene;\n  }\n  // Draw the first scene if the scene key is missing.\n  const keys = Object.keys(json.scenes ?? {});\n  if (keys.length === 0) {\n    throw new Error(\"No scenes to render\");\n  }\n  return keys[0];\n};\n\nconst drawModel = (regl) => {\n  const command = regl({\n    primitive: \"triangles\",\n    blend: defaultBlend,\n    uniforms: {\n      globalAlpha: regl.context(\"globalAlpha\"),\n      poseMatrix: regl.context(\"poseMatrix\"),\n\n      baseColorTexture: regl.prop(\"baseColorTexture\"),\n      baseColorFactor: regl.prop(\"baseColorFactor\"),\n      nodeMatrix: regl.prop(\"nodeMatrix\"),\n      \"light.direction\": [0, 0, -1],\n      \"light.ambientIntensity\": 0.5,\n      \"light.diffuseIntensity\": 0.5,\n      hitmapColor: regl.context(\"hitmapColor\"),\n      isHitmap: regl.context(\"isHitmap\"),\n    },\n    attributes: {\n      position: regl.prop(\"positions\"),\n      normal: regl.prop(\"normals\"),\n      texCoord: regl.prop(\"texCoords\"),\n    },\n    elements: regl.prop(\"indices\"),\n    vert: `\n  uniform mat4 projection, view;\n  uniform mat4 nodeMatrix;\n  uniform mat4 poseMatrix;\n  attribute vec3 position, normal;\n  varying vec3 vNormal;\n  attribute vec2 texCoord;\n  varying vec2 vTexCoord;\n\n  void main() {\n    // using the projection matrix for normals breaks lighting for orthographic mode\n    mat4 mv = view * poseMatrix * nodeMatrix;\n    vNormal = normalize((mv * vec4(normal, 0)).xyz);\n    vTexCoord = texCoord;\n    gl_Position = projection * mv * vec4(position, 1);\n  }\n  `,\n    frag: `\n  precision mediump float;\n  uniform bool isHitmap;\n  uniform vec4 hitmapColor;\n  uniform float globalAlpha;\n  uniform sampler2D baseColorTexture;\n  uniform vec4 baseColorFactor;\n  varying mediump vec2 vTexCoord;\n  varying mediump vec3 vNormal;\n\n  // Basic directional lighting from:\n  // http://ogldev.atspace.co.uk/www/tutorial18/tutorial18.html\n  struct DirectionalLight {\n    mediump vec3 direction;\n    lowp float ambientIntensity;\n    lowp float diffuseIntensity;\n  };\n  uniform DirectionalLight light;\n\n  void main() {\n    vec4 baseColor = texture2D(baseColorTexture, vTexCoord) * baseColorFactor;\n    float diffuse = light.diffuseIntensity * max(0.0, dot(vNormal, -light.direction));\n    gl_FragColor = isHitmap ? hitmapColor : vec4((light.ambientIntensity + diffuse) * baseColor.rgb, baseColor.a * globalAlpha);\n  }\n  `,\n  });\n\n  // default values for when baseColorTexture is not specified\n  const singleTexCoord = regl.buffer([0, 0]);\n  const whiteTexture = regl.texture({\n    data: [255, 255, 255, 255],\n    width: 1,\n    height: 1,\n  });\n\n  // build the draw calls needed to draw the model. This will happen whenever the model changes.\n  const getDrawCalls = memoizeWeak((model: GLBModel) => {\n    // upload textures to the GPU\n    const { accessors } = model;\n    const textures =\n      model.json.textures &&\n      model.json.textures.map((textureInfo) => {\n        const sampler = textureInfo.sampler ? model.json.samplers[textureInfo.sampler] : getDefaultSampler();\n        const bitmap = model.images && model.images[textureInfo.source];\n        const texture = regl.texture({\n          data: bitmap,\n          min: glConstantToRegl(sampler.minFilter),\n          mag: glConstantToRegl(sampler.magFilter),\n          wrapS: glConstantToRegl(sampler.wrapS),\n          wrapT: glConstantToRegl(sampler.wrapT),\n        });\n        return texture;\n      });\n    if (model.images) {\n      model.images.forEach((bitmap: ImageBitmap) => bitmap.close());\n    }\n\n    const drawCalls = [];\n    // helper to draw the primitives comprising a mesh\n    function drawMesh(mesh, nodeMatrix) {\n      for (const primitive of mesh.primitives) {\n        const material = model.json.materials[primitive.material];\n        const texInfo = material.pbrMetallicRoughness.baseColorTexture;\n        if (!accessors) {\n          throw new Error(\"Error decoding GLB model: Missing `accessors` in JSON data\");\n        }\n        drawCalls.push({\n          indices: accessors[primitive.indices],\n          positions: accessors[primitive.attributes.POSITION],\n          normals: accessors[primitive.attributes.NORMAL],\n          texCoords: texInfo\n            ? accessors[primitive.attributes[`TEXCOORD_${texInfo.texCoord || 0}`]]\n            : { divisor: 1, buffer: singleTexCoord },\n          baseColorTexture: texInfo ? textures[texInfo.index] : whiteTexture,\n          baseColorFactor: material.pbrMetallicRoughness.baseColorFactor || [1, 1, 1, 1],\n          nodeMatrix,\n        });\n      }\n    }\n\n    // helper to draw all the meshes contained in a node and its child nodes\n    function drawNode(node, parentMatrix) {\n      const nodeMatrix = node.matrix\n        ? mat4.clone(node.matrix)\n        : mat4.fromRotationTranslationScale(\n            mat4.create(),\n            node.rotation || [0, 0, 0, 1],\n            node.translation || [0, 0, 0],\n            node.scale || [1, 1, 1]\n          );\n      mat4.mul(nodeMatrix, parentMatrix, nodeMatrix);\n      if (node.mesh != null) {\n        drawMesh(model.json.meshes[node.mesh], nodeMatrix);\n      }\n      if (node.children) {\n        for (const childIdx of node.children) {\n          drawNode(model.json.nodes[childIdx], nodeMatrix);\n        }\n      }\n    }\n\n    // finally, draw each of the main scene's nodes. Use the first scene if one isn't specified\n    // explicitly.\n    for (const nodeIdx of model.json.scenes[getSceneToDraw(model)].nodes) {\n      const rootTransform = mat4.create();\n      mat4.rotateX(rootTransform, rootTransform, Math.PI / 2);\n      mat4.rotateY(rootTransform, rootTransform, Math.PI / 2);\n      drawNode(model.json.nodes[nodeIdx], rootTransform);\n    }\n    return drawCalls;\n  });\n\n  // create a regl command to set the context for each draw call\n  const withContext = regl({\n    context: {\n      poseMatrix: (context, props) =>\n        mat4.fromRotationTranslationScale(\n          mat4.create(),\n          orientationToVec4(props.pose.orientation),\n          pointToVec3(props.pose.position),\n          props.scale ? pointToVec3(props.scale) : [1, 1, 1]\n        ),\n      globalAlpha: (context, props) => (props.alpha == null ? 1 : props.alpha),\n      hitmapColor: (context, props) => props.color || [0, 0, 0, 1],\n      isHitmap: (context, props) => !!props.isHitmap,\n    },\n  });\n\n  return (props, isHitmap) => {\n    const drawCalls = getDrawCalls(props.model);\n    withContext(isHitmap ? { ...props, isHitmap } : props, () => {\n      command(drawCalls);\n    });\n  };\n};\n\ntype Props = {|\n  model: string | (() => Promise<GLBModel>),\n  onClick?: MouseHandler,\n  onDoubleClick?: MouseHandler,\n  onMouseDown?: MouseHandler,\n  onMouseMove?: MouseHandler,\n  onMouseUp?: MouseHandler,\n  children: {\n    pose: Pose,\n    scale: Scale,\n    alpha?: ?number,\n  },\n|};\n\nfunction useAsyncValue<T>(fn: () => Promise<T>, deps: ?(any[])): ?T {\n  const [value, setValue] = useState<?T>();\n  useEffect(\n    useCallback(() => {\n      let unloaded = false;\n      fn().then((result) => {\n        if (!unloaded) {\n          setValue(result);\n        }\n      });\n      return () => {\n        unloaded = true;\n        setValue(undefined);\n      };\n    }, deps || [fn]),\n    deps || [fn]\n  );\n  return value;\n}\n\nfunction useModel(model: string | (() => Promise<GLBModel>)): ?GLBModel {\n  useDebugValue(model);\n  return useAsyncValue(async () => {\n    if (typeof model === \"function\") {\n      return model();\n    }\n    if (typeof model === \"string\") {\n      const response = await fetch(model);\n      if (!response.ok) {\n        throw new Error(`failed to fetch GLTF model: ${response.status}`);\n      }\n      return parseGLB(await response.arrayBuffer());\n    }\n\n    /*:: (model: empty) */\n    throw new Error(`unsupported model prop: ${typeof model}`);\n  }, [model]);\n}\n\nexport default function GLTFScene(props: Props) {\n  const { children, model, ...rest } = props;\n\n  const context = useContext(WorldviewReactContext);\n  const loadedModel = useModel(model);\n  useEffect(() => {\n    if (context) {\n      context.onDirty();\n    }\n  }, [context, loadedModel]);\n\n  if (!loadedModel) {\n    return null;\n  }\n\n  return (\n    <Command {...rest} reglCommand={drawModel} getChildrenForHitmap={getChildrenForHitmapWithOriginalMarker}>\n      {{ ...children, model: loadedModel, originalMarker: children }}\n    </Command>\n  );\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React from \"react\";\n\nimport { withPose } from \"../utils/commandUtils\";\nimport { nonInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\nconst DEFAULT_GRID_COLOR = [0.3, 0.3, 0.3, 1];\n\nexport function grid() {\n  return withPose({\n    vert: `\n    precision mediump float;\n    uniform mat4 projection, view;\n\n    attribute vec3 point;\n    attribute vec4 color;\n    varying vec4 fragColor;\n\n    void main () {\n      fragColor = color;\n      vec3 p = point;\n      gl_Position = projection * view * vec4(p, 1);\n    }\n    `,\n    frag: `\n      precision mediump float;\n      varying vec4 fragColor;\n      void main () {\n        gl_FragColor = fragColor;\n      }\n    `,\n    primitive: \"lines\",\n    attributes: {\n      point: (context, props) => {\n        const points = [];\n        const bound = props.count;\n        for (let i = -props.count; i < props.count; i++) {\n          points.push([-bound, i, 0]);\n          points.push([bound, i, 0]);\n          points.push([i, -bound, 0]);\n          points.push([i, bound, 0]);\n        }\n        return points;\n      },\n      color: (context, props) => {\n        const color = props.color || DEFAULT_GRID_COLOR;\n        return new Array(props.count * 4 * 2).fill(color);\n      },\n    },\n    count: (context, props) => {\n      // 8 points per count\n      const count = props.count * 4 * 2;\n      return count;\n    },\n  });\n}\n\ntype Props = {\n  ...CommonCommandProps,\n  count: number,\n};\n\n// useful for rendering a grid for debugging in stories\n\nexport default function Grid({ count, ...rest }: Props) {\n  const children = { count };\n  return (\n    <Command getChildrenForHitmap={nonInstancedGetChildrenForHitmap} {...rest} reglCommand={grid}>\n      {children}\n    </Command>\n  );\n}\n\nGrid.defaultProps = { count: 6 };\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport * as React from \"react\";\n\nimport type { Point, Vec3, Dimensions, Pose } from \"../types\";\nimport { type WorldviewContextType } from \"../WorldviewContext\";\nimport WorldviewReactContext from \"../WorldviewReactContext\";\n\ntype PoseObj = { pose: Pose };\ntype RenderItemInput<T: PoseObj> = {\n  item: T,\n  coordinates: ?Vec3,\n  index: number,\n  dimension: Dimensions,\n};\n\ntype Props<T: PoseObj> = {\n  children: T[],\n  renderItem: (RenderItemInput<T>) => React.Node,\n};\n\ntype State = {\n  items: React.Node[],\n};\n\n// A command that renders arbitrary DOM nodes on top of the Worldview 3D scene.\n// It supplies coordinates to the `renderItem` prop for positioning DOM nodes relative to the canvas.\nexport default class Overlay<T: PoseObj> extends React.Component<Props<T>, State> {\n  _context: ?WorldviewContextType;\n  state = { items: [] };\n\n  componentDidMount() {\n    if (this._context) {\n      this._context.registerPaintCallback(this.paint);\n    }\n  }\n\n  componentWillUnmount = () => {\n    if (this._context) {\n      this._context.unregisterPaintCallback(this.paint);\n    }\n  };\n\n  paint = () => {\n    const context = this._context;\n    const dimension = context && context.dimension;\n    const { renderItem, children } = this.props;\n    if (!context || !dimension) {\n      return;\n    }\n    const items = children.map((item, index) => {\n      const coordinates = this.project(item.pose.position, context);\n      return renderItem({ item, index, coordinates, dimension });\n    });\n    this.setState({ items });\n  };\n\n  project = (point: Point, context: ?WorldviewContextType): ?Vec3 => {\n    if (!context || !context.initializedData) {\n      return;\n    }\n    const { dimension } = context;\n    const { camera } = context.initializedData;\n\n    const vec = [point.x, point.y, point.z];\n    const { left, top, width, height } = dimension;\n    const viewport = [left, top, width, height];\n    return camera.toScreenCoord(viewport, vec);\n  };\n\n  render() {\n    return (\n      <React.Fragment>\n        <WorldviewReactContext.Consumer>\n          {(ctx: ?WorldviewContextType) => {\n            if (ctx) {\n              this._context = ctx;\n            }\n            return this.state.items;\n          }}\n        </WorldviewReactContext.Consumer>\n      </React.Fragment>\n    );\n  }\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport React, { useState } from \"react\";\n\nimport type { PointType, Regl } from \"../types\";\nimport { getVertexColors, pointToVec3, withPose } from \"../utils/commandUtils\";\nimport { createInstancedGetChildrenForHitmap } from \"../utils/getChildrenForHitmapDefaults\";\nimport Command, { type CommonCommandProps } from \"./Command\";\n\ntype PointsProps = {|\n  useWorldSpaceSize?: boolean,\n|};\n\ntype Props = {\n  // $FlowFixMe: flow does not know how to handle the indexed property in CommonCommandProps\n  ...CommonCommandProps,\n  ...PointsProps,\n  children: $ReadOnlyArray<PointType>,\n};\n\nexport const makePointsCommand = ({ useWorldSpaceSize }: PointsProps) => {\n  return (regl: Regl) => {\n    const [minLimitPointSize, maxLimitPointSize] = regl.limits.pointSizeDims;\n    return withPose({\n      primitive: \"points\",\n      vert: `\n    precision mediump float;\n\n    #WITH_POSE\n\n    uniform mat4 projection, view;\n    uniform float pointSize;\n    uniform bool useWorldSpaceSize;\n    uniform float viewportWidth;\n    uniform float viewportHeight;\n    uniform float minPointSize;\n    uniform float maxPointSize;\n\n    attribute vec3 point;\n    attribute vec4 color;\n    varying vec4 fragColor;\n    void main () {\n      vec3 pos = applyPose(point);\n      gl_Position = projection * view * vec4(pos, 1);\n      fragColor = color;\n\n      if (useWorldSpaceSize) {\n        // Calculate the point size based on world dimensions:\n        // First, we need to compute a new point that is one unit away from\n        // the center of the current point being rendered. We do it in view space\n        // in order to make sure the new point is always one unit up and it's not\n        // affected by view rotation.\n        vec4 up = projection * (view * vec4(pos, 1.0) + vec4(0.0, 1.0, 0.0, 0.0));\n\n        // Then, we compute the distance between both points in clip space, dividing\n        // by the w-component to account for distance in perspective projection.\n        float d = length(up.xyz / up.w - gl_Position.xyz / gl_Position.w);\n\n        // Finally, the point size is calculated using the size of the render target\n        // and it's aspect ratio. We multiply it by 0.5 since distance in clip space\n        // is in range [0, 2] (because clip space's range is [-1, 1]) and\n        // we need it to be [0, 1].\n        float invAspect = viewportHeight / viewportWidth;\n        gl_PointSize = pointSize * 0.5 * d * viewportWidth * invAspect;\n      } else {\n        gl_PointSize = pointSize;\n      }\n\n      // Finally, ensure the calculated point size is within the limits.\n      gl_PointSize = min(maxPointSize, max(minPointSize, gl_PointSize));\n    }\n    `,\n      frag: `\n    precision mediump float;\n    varying vec4 fragColor;\n    void main () {\n      gl_FragColor = vec4(fragColor.x, fragColor.y, fragColor.z, 1);\n    }\n    `,\n      attributes: {\n        point: (context, props) => {\n          return props.points.map((point) => (Array.isArray(point) ? point : pointToVec3(point)));\n        },\n        color: (context, props) => {\n          const colors = getVertexColors(props);\n          return colors;\n        },\n      },\n\n      uniforms: {\n        pointSize: (context, props) => {\n          return props.scale.x || 1;\n        },\n        useWorldSpaceSize: !!useWorldSpaceSize,\n        viewportWidth: regl.context(\"viewportWidth\"),\n        viewportHeight: regl.context(\"viewportHeight\"),\n        minPointSize: minLimitPointSize,\n        maxPointSize: maxLimitPointSize,\n      },\n\n      count: regl.prop(\"points.length\"),\n    });\n  };\n};\n\nconst getChildrenForHitmap = createInstancedGetChildrenForHitmap(1);\nexport default function Points(props: Props) {\n  const [command] = useState(() => makePointsCommand(props));\n  return <Command getChildrenForHitmap={getChildrenForHitmap} {...props} reglCommand={command} />;\n}\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nexport { default as Arrows, makeArrowsCommand } from \"./Arrows\";\nexport { default as Axes } from \"./Axes\";\nexport { default as Command, SUPPORTED_MOUSE_EVENTS } from \"./Command\";\nexport { default as Cones, cones } from \"./Cones\";\nexport { default as Cubes, cubes } from \"./Cubes\";\nexport { default as Cylinders, cylinders } from \"./Cylinders\";\nexport { default as DrawPolygons, Polygon, PolygonPoint } from \"./DrawPolygon/index\";\nexport { default as PolygonBuilder } from \"./DrawPolygon/PolygonBuilder\";\nexport { default as FilledPolygons, makeFilledPolygonsCommand } from \"./FilledPolygons\";\nexport { default as GLText, makeGLTextCommand } from \"./GLText\";\nexport { default as GLTFScene } from \"./GLTFScene\";\nexport { default as Grid } from \"./Grid\";\nexport { default as Lines, lines } from \"./Lines\";\nexport { default as Overlay } from \"./Overlay\";\nexport { default as Points, makePointsCommand } from \"./Points\";\nexport { default as Spheres, spheres } from \"./Spheres\";\nexport { default as Text } from \"./Text\";\nexport { default as Triangles, makeTrianglesCommand } from \"./Triangles\";\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport type { CameraState } from \"../camera/CameraStore\";\nimport { Ray } from \"../utils/Raycast\";\nimport type { BaseProps, Props } from \"../Worldview\";\n\nexport type { CameraState, BaseProps, Props };\n\nexport type Dimensions = {|\n  width: number,\n  height: number,\n  left: number,\n  top: number,\n|};\n\nexport type ReglCommand = {\n  vert: string,\n  frag: string,\n  uniforms?: any,\n};\n\nexport type CompiledReglCommand<T> = (props: T, context: any) => void;\n\nexport type ReglFn = <T>(ReglCommand) => CompiledReglCommand<T>;\n\ntype Command<T> = (T | T[], ...args: any[]) => void;\n\nexport type RawCommand<T> = (regl: any) => {} | Command<T>;\n\nexport type Regl = {\n  // https://github.com/gajus/eslint-plugin-flowtype/issues/346\n  // eslint-disable-next-line no-undef\n  [[call]]: ReglFn,\n  limits: {\n    pointSizeDims: [number, number],\n  },\n  prop: (string) => any,\n  context: (string) => any,\n};\n\nexport type CommandProps = {\n  [string]: any,\n};\n\nexport type CommandDict = {\n  [string]: Command<any>,\n};\n\n// [left, top, width, height]\nexport type Viewport = [number, number, number, number];\nexport type Vec2 = [number, number];\nexport type Vec3 = [number, number, number];\nexport type Vec4 = [number, number, number, number];\nexport type Mat4 = [\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n  number,\n];\n\nexport interface CameraCommand {\n  getProjection(): Mat4;\n  getView(): Mat4;\n  toScreenCoord(viewport: Viewport, point: Vec3): ?Vec3;\n  draw(props: {}, (ctx: any) => void): void;\n}\n\nexport type ReglContext = {\n  regl: ReglFn,\n  camera: CameraCommand,\n  commands: CommandDict,\n};\n\nexport type ArrowSize = {\n  shaftLength: number,\n  shaftWidth: number,\n  headLength: number,\n  headWidth: number,\n};\n\ntype ClickedObject = {\n  object: Object,\n  instanceIndex?: ?number,\n};\n\nexport type ReglClickInfo = {\n  ray: Ray,\n  objects: Array<ClickedObject>,\n};\n\nexport type ComponentReglClickInfo = {\n  ray: Ray,\n  objects: Array<ClickedObject>,\n};\n\nexport type MouseHandler = (SyntheticMouseEvent<HTMLCanvasElement>, ReglClickInfo) => void;\n\nexport type ComponentMouseHandler = (SyntheticMouseEvent<HTMLCanvasElement>, ComponentReglClickInfo) => void;\n\nexport type Coordinate = [number, number];\n\nexport type Point = {\n  x: number,\n  y: number,\n  z: number,\n};\n\nexport type Position = Point;\n\nexport type Orientation = {\n  x: number,\n  y: number,\n  z: number,\n  w: number,\n};\n\nexport type Scale = {\n  x: number,\n  y: number,\n  z: number,\n};\n\nexport type Color = {\n  r: number,\n  g: number,\n  b: number,\n  a: number,\n};\n\nexport type Colors = Color[];\n\nexport type Pose = {\n  position: Position,\n  orientation: Orientation,\n};\n\nexport type BaseShape = {\n  pose: Pose,\n  scale: Scale,\n  color?: Color | Vec4,\n};\n\nexport type Arrow = BaseShape & {\n  points?: Point[],\n  interactionData?: any,\n};\n\nexport type Cube = BaseShape & {\n  colors?: (Color | Vec4)[],\n  points?: (Point | Vec3)[],\n};\n\nexport type Cone = BaseShape & {\n  colors?: (Color | Vec4)[],\n  points?: (Point | Vec3)[],\n};\n\nexport type Cylinder = BaseShape & {\n  colors?: (Color | Vec4)[],\n  points?: (Point | Vec3)[],\n};\n\nexport type Line = BaseShape & {\n  points: (Point | Vec3)[],\n  poses?: Pose[],\n};\n\nexport type PointType = BaseShape & {\n  colors?: (Color | Vec4)[],\n  points: (Point | Vec3)[],\n};\n\nexport type SphereList = BaseShape & {\n  points?: (Point | Vec3)[],\n};\n\nexport type TriangleList = BaseShape & {\n  points: (Point | Vec3)[],\n  colors?: (Color | Vec4)[],\n  // Pass true to not render the triangles to the screen - just the hitmap.\n  onlyRenderInHitmap?: boolean,\n};\n\nexport type PolygonType = BaseShape & {\n  points: (Point | Vec3)[],\n};\n\nexport type MouseEventObject = {\n  object: BaseShape,\n  instanceIndex: ?number,\n};\n\nexport type DepthState = {\n  enable?: boolean,\n  mask?: boolean,\n};\n\nexport type BlendFuncValue = string | number;\n\nexport type BlendState = {\n  enable?: boolean,\n  func?:\n    | BlendFuncValue\n    | {\n        src?: BlendFuncValue,\n        dst?: BlendFuncValue,\n        srcAlpha?: BlendFuncValue,\n        srcRGB?: BlendFuncValue,\n        dstRGB?: BlendFuncValue,\n        dstAlpha?: BlendFuncValue,\n      },\n  equation?: string | { rgb: string, alpha: string },\n  color?: Vec4,\n};\n\nexport type ObjectHitmapId = number;\n/*\n * object: the object to pass to event callbacks when this object is interacted with.\n * count: How many colors to map to the callback object. If this is greater than 1, this assigns instance indices for\n          the object.\n * return type: an array of the colors assigned.\n */\nexport type AssignNextColorsFn = (object: Object, count: number) => Vec4[];\nexport type GetChildrenForHitmap = <T>(prop: T, AssignNextColorsFn, MouseEventObject[]) => T;\n\nexport type MouseEventEnum = \"onClick\" | \"onMouseUp\" | \"onMouseMove\" | \"onMouseDown\" | \"onDoubleClick\";\n\nexport type CameraAction =\n  | \"moveDown\"\n  | \"moveLeft\"\n  | \"moveRight\"\n  | \"moveUp\"\n  | \"rotateLeft\"\n  | \"rotateRight\"\n  | \"tiltDown\"\n  | \"tiltUp\"\n  | \"zoomIn\"\n  | \"zoomOut\";\nexport type CameraKeyMap = { [string]: CameraAction | false | null };\n","// @flow\n\n//  Copyright (c) 2018-present, GM Cruise LLC\n//\n//  This source code is licensed under the Apache License, Version 2.0,\n//  found in the LICENSE file in the root directory of this source tree.\n//  You may not use this file except in compliance with the License.\n\nimport Worldview, { WorldviewBase as OffscreenWorldview } from \"./Worldview\";\n\nexport { default as Bounds } from \"./utils/Bounds\";\nexport {\n  camera,\n  selectors as cameraStateSelectors,\n  CameraStore,\n  DEFAULT_CAMERA_STATE,\n  CameraListener,\n} from \"./camera/index\";\nexport * from \"./utils/commandUtils\";\nexport { default as eulerFromQuaternion } from \"./utils/eulerFromQuaternion\";\nexport { default as fromGeometry } from \"./utils/fromGeometry\";\nexport { default as parseGLB } from \"./utils/parseGLB\";\nexport * from \"./utils/Raycast\";\nexport * from \"./commands/index\";\nexport * from \"./types/index\";\nexport * from \"./utils/getChildrenForHitmapDefaults\";\nexport { default as WorldviewReactContext } from \"./WorldviewReactContext\";\nexport { Worldview, OffscreenWorldview };\nexport default Worldview;\n"],"names":["BoundingBox","constructor","left","top","right","bottom","width","Math","abs","height","getOrthographicBounds","zDistance","aspect","distanceToGround","NEAR_RANGE","FAR_RANGE","tmp4","cameraProject","out","vec","viewport","combinedProjView","vX","vY","vWidth","vHeight","n","f","vec4","set","transformMat4","w","rotateGLSL","DEFAULT_TEXT_COLOR","r","g","b","a","pointToVec3","x","y","z","orientationToVec4","vec3ToPoint","vec4ToOrientation","pointToVec3Array","points","result","Float32Array","length","i","toRGBA","val","vec4ToRGBA","color","toColor","Array","isArray","getCSSColor","toFixed","toRGBAArray","colors","constantRGBAArray","count","defaultReglBlend","enable","func","src","dst","srcAlpha","dstAlpha","equation","rgb","alpha","defaultReglDepth","mask","defaultDepth","context","props","depth","defaultBlend","blend","withPose","command","vert","uniforms","newVert","replace","newUniforms","_position","position","pose","_rotation","orientation","getVertexColors","shouldConvert","hasNestedArrays","arr","colorBuffer","regl","buffer","usage","data","divisor","isNaN","intToRGB","getIdFromColor","getIdFromPixel","fromSpherical","theta","phi","rSinPhi","sin","cos","UNIT_X_VECTOR","Object","freeze","TEMP_VEC3","TEMP_MAT","TEMP_QUAT","stateSelector","state","perspectiveSelector","createSelector","perspective","distanceSelector","distance","phiSelector","thetaOffsetSelector","thetaOffset","targetOrientationSelector","targetOrientation","targetHeadingSelector","vec3","transformQuat","heading","atan2","orientationSelector","quat","identity","rotateZ","rotateX","positionSelector","viewSelector","target","targetOffset","targetHeading","m","mat4","multiply","fromQuat","invert","translate","negate","billboardRotation","create","view","UNIT_Z_VECTOR","DEFAULT_CAMERA_STATE","PI","fovy","near","far","distanceAfterZoom","startingDistance","zoomPercent","max","CameraStore","handler","initialCameraState","key","value","entries","setCameraState","min","_onChange","offset","setAxisAngle","add","newDistance","Camera","projection","viewportWidth","viewportHeight","cameraState","getProjection","getView","selectors","isPerspective","bounds","ortho","toScreenCoord","point","project","undefined","diffY","diffX","PAN_SPEED","MOUSE_ZOOM_SPEED","KEYBOARD_MOVE_SPEED","KEYBOARD_ZOOM_SPEED","KEYBOARD_SPIN_SPEED","DEFAULT_KEYMAP","KeyA","KeyD","KeyE","KeyF","KeyQ","KeyR","KeyS","KeyW","KeyX","KeyZ","CameraListener","React","Set","mouse","clientX","clientY","_rect","e","_el","preventDefault","_buttons","button","focus","getBoundingClientRect","_initialMouse","_getMouseOnScreen","startDragging","size","_shiftKey","shiftKey","cameraStore","cameraMove","cameraRotate","moveX","moveY","document","pointerLockElement","movementX","movementY","_isRightMouseDown","magnitude","_getMagnitude","_isLeftMouseDown","_getMoveMagnitude","delete","_endDragging","contains","clear","code","moveSpeed","zoomSpeed","spinSpeed","keyMap","shiftKeys","action","zoom","yaw","tilt","console","warn","_metaKey","metaKey","_ctrlKey","ctrlKey","nativeEvent","repeat","_keys","has","stopPropagation","altKey","_getKeyMotion","_startKeyTimer","pixelX","pixelY","normalizeWheel","wheelAmount","dir","sign","amount","percentage","zoomPercentage","cameraZoom","_stopKeyTimer","componentDidMount","listen","name","fn","addEventListener","_listeners","push","_onBlur","window","_onWindowMouseUp","_onWheel","passive","componentWillUnmount","forEach","listener","removeEventListener","base","requestPointerLock","_onWindowMouseMove","exitPointerLock","_moveKeyboard","dt","motion","lastStamp","_keyTimer","requestAnimationFrame","stamp","cancelAnimationFrame","render","children","React.createElement","outline","el","_onMouseDown","_onMouseUp","_onContextMenu","_onKeyDown","_onKeyUp","getNodeEnv","process","env","NODE_ENV","inWebWorker","global","postMessage","WorkerGlobalScope","self","tempVec","tempMat","Ray","origin","distanceToPoint","planeIntersection","planeCoordinate","planeNormal","d","dot","cosine","contact","scale","getRayFromClick","camera","projectionMatrix","viewMatrix","vp","invVp","mouseX","mouseY","rayPoint","rayOrigin","rayDir","normalize","subtract","createContext","SUPPORTED_MOUSE_EVENTS","Command","shouldComponentUpdate","nextProps","reglCommand","error","onMount","_updateContext","componentDidUpdate","onUnmount","layerIndex","getChildrenForHitmap","drawProps","registerDrawCall","instance","handleMouseEvent","objects","ray","mouseEventName","mouseHandler","ctx","aggregate","array","aggregationMap","Map","item","existingItems","get","ResizeObserverMock","callback","_callback","observe","entry","contentRect","unobserve","ResizeObserverImpl","ResizeObserver","Dimensions","parentElement","setParentElement","useState","dimensions","setDimensions","resizeObserver","newWidth","round","newHeight","newLeft","newTop","setParentElementRef","useCallback","element","useEffect","fillArray","start","fill","map","_","index","HitmapObjectIdManager","object","Error","ids","_nextObjectHitmapId","last","id","_instanceIndexByObjectHitmapIdMap","_objectsByObjectHitmapIdMap","_commandsByObjectMap","objectHitmapId","instanceIndex","signal","resolve","reject","promise","Promise","res","rej","queuePromise","calling","nextCalls","queuedFn","args","returnPromise","finally","currentPromise","nextPromise","nextArgs","shift","then","catch","compile","cmd","WorldviewContext","dimension","canvasBackgroundColor","onCameraStateChange","contextAttributes","canvasX","canvasY","initializedData","_frame","paint","_needsPaint","enableStackedObjectEvents","maxStackedObjectCount","cachedReadHitmapCall","_cachedReadHitmapCall","shallowequal","arguments","mouseEventObject","_fbo","resize","floor","framebuffer","currentObjectId","excludedObjects","mouseEventsWithCommands","counter","draw","_drawInput","pixel","Uint8Array","read","_hitmapObjectIdManager","getObjectByObjectHitmapId","some","getCommandForObject","isHitmap","drawCalls","from","_drawCalls","values","sort","drawInput","debug","_compiled","displayName","assignNextColorsFn","rest","assignNextColors","hitmapProps","poll","initialize","canvas","_instrumentCommands","createREGL","attributes","extensions","profile","_commands","uncompiledCommand","compiledCommand","compiledCameraCommand","fbo","destroy","unregisterPaintCallback","paintFn","_paintCalls","registerPaintCallback","setDimension","_paint","message","Date","now","reglCommandObjects","stats","_clearCanvas","counters","paintCall","Proxy","apply","thisArg","DEFAULT_BACKGROUND_COLOR","DEFAULT_MOUSE_CLICK_RADIUS","DEFAULT_MAX_NUMBER_OF_HITMAP_LAYERS","handleWorldviewMouseInteraction","err","WorldviewBase","_onDoubleClick","_onMouseMove","fromOffscreenTarget","_onMouseInteraction","_dragStartPos","deltaX","deltaY","sqrt","worldviewContext","worldviewHandler","HTMLElement","clientTop","clientLeft","raycast","hitmapOnMouseMove","disableHitmapForEvents","includes","persist","readHitmap","mouseEventsByCommand","mouseEvents","isPropagationStopped","backgroundColor","defaultCameraState","_canvas","current","getDerivedStateFromProps","setState","_tick","onDirty","_cameraListener","_renderDebug","mem","performance","memory","style","fontFamily","fontSize","mapValues","reduce","total","usedJSHeapSize","jsHeapSizeLimit","assign","pickBy","bufferCount","rows","keys","border","paddingRight","showDebug","resolutionScale","isFixedCamera","canvasScale","canvasHtml","React.Fragment","maxWidth","maxHeight","overflow","Worldview","ref","ContainerDimensions","Bound","Number","MAX_SAFE_INTEGER","MIN_SAFE_INTEGER","update","Bounds","scratch","eulerFromQuaternion","q","mat3","m11","m12","m13","m22","m23","m32","m33","asin","positions","elements","vertexArray","concat","face","elementsArray","Uint16Array","buff","colorBuff","frag","instances","parseGLB","arrayBuffer","DataView","readUint32","getUint32","magic","toString","version","totalLength","byteLength","findNextChunkOfType","type","chunkLength","chunkType","chunkData","jsonData","json","JSON","parse","TextDecoder","decode","binary","buffers","uri","accessors","accessorInfo","arrayType","componentType","WebGLRenderingContext","BYTE","Int8Array","UNSIGNED_BYTE","SHORT","Int16Array","UNSIGNED_SHORT","UNSIGNED_INT","Uint32Array","FLOAT","numComponents","bufferView","bufferViews","BYTES_PER_ELEMENT","byteOffset","images","all","imgInfo","createImageBitmap","Blob","mimeType","nonInstancedGetChildrenForHitmapFromSingleProp","prop","useOriginalMarkerProp","eventCallbackMarker","originalMarker","hitmapProp","hitmapColor","nonInstancedGetChildrenForHitmap","filter","Boolean","getChildrenForHitmapWithOriginalMarker","instancedGetChildrenForHitmapFromSingleProp","pointCountPerInstance","matchedExcludedObjects","filteredIndices","instanceCount","ceil","idColors","startColor","allColors","j","idx","createInstancedGetChildrenForHitmap","withRenderStateOverrides","memoizedRender","memoize","stringify","renderElement","createCylinderGeometry","numSegments","cone","northPole","southPole","sideFaces","endCapFaces","bottomLeftPt","topRightPt","bottomRightPt","topLeftPt","cylinders","fromGeometry","Cylinders","cones","Cones","generateArrowPrimitives","markers","marker","shaftWidthX","shaftWidthY","shaftLength","headWidthX","headWidthY","headLength","basePosition","end","tipPosition","rotationTo","rotateY","shaftPosition","scaleAndAdd","headPosition","makeArrowsCommand","cylindersCommand","conesCommand","cylinderPrimitives","conePrimitives","Arrows","passedProps","omit","Fragment","memo","FLOAT_BYTES","POINT_BYTES","DEFAULT_MONOCHROME_COLOR","POINT_TYPES","BL","TR","BR","TL","VERTICES_PER_INSTANCE","k","join","pointsEqual","ax","ay","az","bx","by","bz","lines","pointTypeBuffer","debugColorBuffer","defaultPosePositionBuffer","flatten","defaultPoseRotationBuffer","positionBuffer1","positionBuffer2","posePositionBuffer","poseRotationBuffer","thickness","joined","scaleInvariant","pointType","colorB","monochrome","stride","colorC","positionA","positionB","positionC","positionD","posePosition","hasInstancedPoses","poseRotation","primitive","colorArray","pointArray","allocatedPoints","positionArray","rotationArray","fillPointArray","alreadyClosed","shouldClose","numTotalPoints","off","copyWithin","subarray","fillPoseArrays","poses","positionOffset","rotationOffset","convertedPosition","convertedRotation","positionData","rotationData","convertColors","fillColorArray","monochromeColor","convertedMonochromeColor","convertedColors","lastIndex","commands","renderLine","numInputPoints","closed","pointData","colorData","effectiveNumPoints","inProps","Lines","p","xAxisPoints","yAxisPoints","zAxisPoints","xAxis","yAxis","zAxis","Axes","Component","cubes","Cubes","NUM_PARALLELS","NUM_MERIDIANS","RADIUS","faces","prevMeridianPt","pt","prevPt","spheres","Spheres","multiplyScale","factor","DEFAULT_COLOR","ACTIVE_POLYGON_COLOR","ACTIVE_POINT_COLOR","LINE_STRIP","POINT_SIZE_FACTOR","DRAW_SCALE","DRAW_POINT_SCALE","HITMAP_SCALE","HITMAP_POINT_SCALE","POSE","PolygonPoint","Polygon","polygonLinesGetChildrenForHitmap","PolygonLines","polygons","poly","active","polygonPointsGetChildrenForHitmap","originalMarkers","PolygonPoints","convertedPoint","sphereList","DrawPolygons","areEqual","point1","point2","x1","y1","z1","x2","y2","z2","isClosed","polygon","firstPoint","lastPoint","PolygonBuilder","activePolygon","mouseDown","activePoint","updateActivePoint","mouseDownPoint","pointX","pointY","dX","dY","uniquePoints","acc","polygonPoint","onChange","deletePoint","deletePolygon","selectObject","shortestDistance","shortestIndex","px","py","dist","squared","newPoint","splice","isFirstClick","isCtrlClick","clickObject","pushPoint","closeActivePolygon","isActivePolygonClosed","addPolygon","floatingPoint","newPoints","isActive","defaultSingleColorDepth","defaultVetexColorDepth","singleColor","vertexColors","triangles","single","vertex","items","singleColorItems","vertexColorItems","onlyRenderInHitmap","makeTrianglesCommand","Triangles","NO_POSE","DEFAULT_SCALE","flatten3D","getEarcutPoints","flattenedPoints","indices","earcut","originalIndex","generateTriangles","earcutPoints","makeFilledPolygonsCommand","trianglesCommand","FilledPolygons","BG_COLOR_LIGHT","BG_COLOR_DARK","BRIGHTNESS_THRESHOLD","DEFAULT_BG_COLOR","cssHasBeenInserted","insertGlobalCss","createElement","innerHTML","body","appendChild","isColorDark","luma","isColorEqual","TextElement","createTextNode","wrapper","className","_inner","_text","autoBackgroundColor","transform","hasBgColor","textColor","_prevTextColor","_prevAutoBackgroundColor","background","_prevBgColor","isTextColorDark","hexBgColor","textContent","text","Text","createRef","_context","textComponents","_textComponents","textContainer","_textContainerRef","componentsToRemove","coord","remove","MIN_RESOLUTION","DEFAULT_RESOLUTION","SDF_RADIUS","CUTOFF","BUFFER","memoizedCreateCanvas","memoizeOne","font","getContext","hashMarkerPosition","getMarkerYOffset","offsets","setMarkerYOffset","yOffset","createMemoizedGenerateAtlas","charSet","_setSize","resolution","maxAtlasWidth","tinySDF","TinySDF","textureWidth","rowHeight","charInfo","char","measureText","dx","textureHeight","textureData","createMemoizedDrawAtlasTexture","textAtlas","atlasTexture","format","wrap","mag","makeTextCommand","alphabet","memoizedGenerateAtlas","memoizedDrawAtlasTexture","texture","drawText","atlas","atlasSize","cutoff","scaleInvariantSize","cameraFovY","texCoord","srcOffset","srcOffsets","destOffset","destOffsets","srcWidth","srcWidths","alignmentOffset","billboard","foregroundColor","highlightColor","enableBackground","enableHighlight","poseOrientation","estimatedInstances","generatedAtlas","generatedAtlasChars","textChars","generatedAtlasHasAllChars","difference","limits","maxTextureSize","totalInstances","yOffsets","totalWidth","markerInstances","lineCount","fgColor","bgColor","hlColor","info","highlightedIndices","totalHeight","makeGLTextCommand","scaleInvariantFontSize","GLText","glConstantToRegl","NEAREST","LINEAR","NEAREST_MIPMAP_NEAREST","NEAREST_MIPMAP_LINEAR","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","REPEAT","CLAMP_TO_EDGE","MIRRORED_REPEAT","getDefaultSampler","minFilter","magFilter","wrapS","wrapT","getSceneToDraw","scene","scenes","drawModel","globalAlpha","poseMatrix","baseColorTexture","baseColorFactor","nodeMatrix","normal","singleTexCoord","whiteTexture","getDrawCalls","memoizeWeak","model","textures","textureInfo","sampler","samplers","bitmap","source","close","drawMesh","mesh","primitives","material","materials","texInfo","pbrMetallicRoughness","POSITION","normals","NORMAL","texCoords","drawNode","node","parentMatrix","matrix","clone","fromRotationTranslationScale","rotation","translation","mul","meshes","childIdx","nodes","nodeIdx","rootTransform","withContext","useAsyncValue","deps","setValue","unloaded","useModel","useDebugValue","response","fetch","ok","status","GLTFScene","useContext","WorldviewReactContext","loadedModel","DEFAULT_GRID_COLOR","grid","bound","Grid","defaultProps","Overlay","renderItem","coordinates","makePointsCommand","useWorldSpaceSize","minLimitPointSize","maxLimitPointSize","pointSizeDims","pointSize","minPointSize","maxPointSize","Points"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;;;;AAMA,MAAMA,WAAN,CAAkB;EAQhBC,WAAW,CAACC,IAAD,EAAeC,GAAf,EAA4B;;;;;;;;;;;;;SAChCD,IAAL,GAAYA,IAAZ;SACKC,GAAL,GAAWA,GAAX;SACKC,KAAL,GAAa,CAACF,IAAd;SACKG,MAAL,GAAc,CAACF,GAAf;SACKG,KAAL,GAAaC,IAAI,CAACC,GAAL,CAASN,IAAT,IAAiB,CAA9B;SACKO,MAAL,GAAcF,IAAI,CAACC,GAAL,CAASL,GAAT,IAAgB,CAA9B;;;;;AAIJ,AAAe,SAASO,qBAAT,CAA+BC,SAA/B,EAAkDL,KAAlD,EAAiEG,MAAjE,EAA8F;QACrGG,MAAM,GAAGN,KAAK,GAAGG,MAAvB,CAD2G;;QAGrGI,gBAAgB,GAAGN,IAAI,CAACC,GAAL,CAASG,SAAT,CAAzB;QACMT,IAAI,GAAI,CAACW,gBAAD,GAAoB,CAArB,GAA0BD,MAAvC;QACMT,GAAG,GAAGU,gBAAgB,GAAG,CAA/B;SACO,IAAIb,WAAJ,CAAgBE,IAAhB,EAAsBC,GAAtB,CAAP;;;AC9BF;AACA,AAYA,MAAMW,UAAU,GAAG,CAAnB;AACA,MAAMC,SAAS,GAAG,CAAlB;AACA,MAAMC,IAAI,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAb;AAEA,AAAe,SAASC,aAAT,CAAuBC,GAAvB,EAAiCC,GAAjC,EAA4CC,QAA5C,EAA4DC,gBAA5D,EAA0F;QACjGC,EAAE,GAAGF,QAAQ,CAAC,CAAD,CAAnB;QACEG,EAAE,GAAGH,QAAQ,CAAC,CAAD,CADf;QAEEI,MAAM,GAAGJ,QAAQ,CAAC,CAAD,CAFnB;QAGEK,OAAO,GAAGL,QAAQ,CAAC,CAAD,CAHpB;QAIEM,CAAC,GAAGZ,UAJN;QAKEa,CAAC,GAAGZ,SALN,CADuG;;;EAUvGa,aAAI,CAACC,GAAL,CAASb,IAAT,EAAeG,GAAG,CAAC,CAAD,CAAlB,EAAuBA,GAAG,CAAC,CAAD,CAA1B,EAA+BA,GAAG,CAAC,CAAD,CAAlC,EAAuC,GAAvC,EAVuG;;EAavGS,aAAI,CAACE,aAAL,CAAmBd,IAAnB,EAAyBA,IAAzB,EAA+BK,gBAA/B,EAbuG;;QAgBjGU,CAAC,GAAGf,IAAI,CAAC,CAAD,CAAd;;MACIe,CAAC,KAAK,CAAV,EAAa;;IAEXf,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAJ,GAAUe,CAApB;IACAf,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAJ,GAAUe,CAApB;IACAf,IAAI,CAAC,CAAD,CAAJ,GAAUA,IAAI,CAAC,CAAD,CAAJ,GAAUe,CAApB;GArBqG;;;;;EA2BvGb,GAAG,CAAC,CAAD,CAAH,GAASI,EAAE,GAAIE,MAAM,GAAG,CAAV,GAAeR,IAAI,CAAC,CAAD,CAAxB,IAA+B,IAAIQ,MAAM,GAAG,CAA5C,CAAT;EACAN,GAAG,CAAC,CAAD,CAAH,GAASK,EAAE,GAAIE,OAAO,GAAG,CAAX,GAAgBT,IAAI,CAAC,CAAD,CAAzB,IAAgC,IAAIS,OAAO,GAAG,CAA9C,CAAT;EACAP,GAAG,CAAC,CAAD,CAAH,GAAU,CAACS,CAAC,GAAGD,CAAL,IAAU,CAAX,GAAgBV,IAAI,CAAC,CAAD,CAApB,GAA0B,CAACW,CAAC,GAAGD,CAAL,IAAU,CAA7C;EACAR,GAAG,CAAC,CAAD,CAAH,GAASa,CAAC,KAAK,CAAN,GAAU,CAAV,GAAc,IAAIA,CAA3B;SACOb,GAAP;;;AChDF;;;;;AAQA,MAAMc,UAAU,GAAI;;;;;;;;;;;;;;CAApB;AAgBA,MAAMC,kBAAkB,GAAG;EAAEC,CAAC,EAAE,CAAL;EAAQC,CAAC,EAAE,CAAX;EAAcC,CAAC,EAAE,CAAjB;EAAoBC,CAAC,EAAE;CAAlD;AAEA,MAAaC,WAAW,GAAG,CAAC;EAAEC,CAAF;EAAKC,CAAL;EAAQC;CAAT,KAA8B;SAChD,CAACF,CAAD,EAAIC,CAAJ,EAAOC,CAAP,CAAP;CADK;AAGP,MAAaC,iBAAiB,GAAG,CAAC;EAAEH,CAAF;EAAKC,CAAL;EAAQC,CAAR;EAAWV;CAAZ,KAAuC;SAC/D,CAACQ,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUV,CAAV,CAAP;CADK;AAIP,MAAaY,WAAW,GAAG,CAAC,CAACJ,CAAD,EAAIC,CAAJ,EAAOC,CAAP,CAAD,MAA6B;EAAEF,CAAF;EAAKC,CAAL;EAAQC;CAArC,CAApB;AAEP,MAAaG,iBAAiB,GAAG,CAAC,CAACL,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUV,CAAV,CAAD,MAAsC;EAAEQ,CAAF;EAAKC,CAAL;EAAQC,CAAR;EAAWV;CAAjD,CAA1B;AAEP,MAAac,gBAAgB,GAAIC,MAAD,IAAqB;QAC7CC,MAAM,GAAG,IAAIC,YAAJ,CAAiBF,MAAM,CAACG,MAAP,GAAgB,CAAjC,CAAf;MACIC,CAAC,GAAG,CAAR;;qBAC0BJ,MAA1B,EAAkC;UAAvB;MAAEP,CAAF;MAAKC,CAAL;MAAQC;KAAe;IAChCM,MAAM,CAACG,CAAC,EAAF,CAAN,GAAcX,CAAd;IACAQ,MAAM,CAACG,CAAC,EAAF,CAAN,GAAcV,CAAd;IACAO,MAAM,CAACG,CAAC,EAAF,CAAN,GAAcT,CAAd;;;SAEKM,MAAP;CARK;AAWP,MAAaI,MAAM,GAAIC,GAAD,IAAgB;SAC7B,CAACA,GAAG,CAAClB,CAAL,EAAQkB,GAAG,CAACjB,CAAZ,EAAeiB,GAAG,CAAChB,CAAnB,EAAsBgB,GAAG,CAACf,CAA1B,CAAP;CADK;AAIP,MAAagB,UAAU,GAAIC,KAAD,KAAyB;EAAEpB,CAAC,EAAEoB,KAAK,CAAC,CAAD,CAAV;EAAenB,CAAC,EAAEmB,KAAK,CAAC,CAAD,CAAvB;EAA4BlB,CAAC,EAAEkB,KAAK,CAAC,CAAD,CAApC;EAAyCjB,CAAC,EAAEiB,KAAK,CAAC,CAAD;CAA1E,CAAnB;AAEP,MAAaC,OAAO,GAAIH,GAAD,IAA+BI,KAAK,CAACC,OAAN,CAAcL,GAAd,IAAqBC,UAAU,CAACD,GAAD,CAA/B,GAAuCA,GAAtF;AAEP,AAAO,SAASM,WAAT,CAAqBJ,KAAY,GAAGrB,kBAApC,EAAwD;QACvD;IAAEC,CAAF;IAAKC,CAAL;IAAQC,CAAR;IAAWC;MAAMiB,KAAvB;SACQ,QAAO,CAACpB,CAAC,GAAG,GAAL,EAAUyB,OAAV,EAAoB,KAAI,CAACxB,CAAC,GAAG,GAAL,EAAUwB,OAAV,EAAoB,KAAI,CAACvB,CAAC,GAAG,GAAL,EAAUuB,OAAV,EAAoB,KAAItB,CAAC,CAACsB,OAAF,CAAU,CAAV,CAAa,GAApG;;;AAGF,MAAMC,WAAW,GAAIC,MAAD,IAAiD;QAC7Dd,MAAM,GAAG,IAAIC,YAAJ,CAAiBa,MAAM,CAACZ,MAAP,GAAgB,CAAjC,CAAf;MACIC,CAAC,GAAG,CAAR;;sBAC6BW,MAA7B,EAAqC;UAA1B;MAAE3B,CAAF;MAAKC,CAAL;MAAQC,CAAR;MAAWC;KAAe;IACnCU,MAAM,CAACG,CAAC,EAAF,CAAN,GAAchB,CAAd;IACAa,MAAM,CAACG,CAAC,EAAF,CAAN,GAAcf,CAAd;IACAY,MAAM,CAACG,CAAC,EAAF,CAAN,GAAcd,CAAd;IACAW,MAAM,CAACG,CAAC,EAAF,CAAN,GAAcb,CAAd;;;SAEKU,MAAP;CATF;;AAYA,MAAMe,iBAAiB,GAAG,CAACC,KAAD,EAAgB;EAAE7B,CAAF;EAAKC,CAAL;EAAQC,CAAR;EAAWC;CAA3B,KAAwD;QAC1EU,MAAM,GAAG,IAAIC,YAAJ,CAAiBe,KAAK,GAAG,CAAzB,CAAf;;OACK,IAAIb,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGa,KAApB,EAA2Bb,CAAC,EAA5B,EAAgC;IAC9BH,MAAM,CAAC,IAAIG,CAAJ,GAAQ,CAAT,CAAN,GAAoBhB,CAApB;IACAa,MAAM,CAAC,IAAIG,CAAJ,GAAQ,CAAT,CAAN,GAAoBf,CAApB;IACAY,MAAM,CAAC,IAAIG,CAAJ,GAAQ,CAAT,CAAN,GAAoBd,CAApB;IACAW,MAAM,CAAC,IAAIG,CAAJ,GAAQ,CAAT,CAAN,GAAoBb,CAApB;;;SAEKU,MAAP;CARF;;;AAYA,MAAaiB,gBAAgB,GAAG;EAC9BC,MAAM,EAAE,IADsB;;EAG9BC,IAAI,EAAE;IACJC,GAAG,EAAE,WADD;IAEJC,GAAG,EAAE,qBAFD;IAGJC,QAAQ,EAAE,CAHN;IAIJC,QAAQ,EAAE;GAPkB;EAS9BC,QAAQ,EAAE;IACRC,GAAG,EAAE,KADG;IAERC,KAAK,EAAE;;CAXJ;AAeP,MAAaC,gBAAgB,GAAG;EAC9BT,MAAM,EAAE,IADsB;EAE9BU,IAAI,EAAE;CAFD;AAKP,MAAaC,YAAY,GAAG;EAC1BX,MAAM,EAAE,CAACY,OAAD,EAAeC,KAAf,KAA+BA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACC,KAAN,CAAYd,MAA5B,IAAuCS,gBAAgB,CAACT,MADpE;EAE1BU,IAAI,EAAE,CAACE,OAAD,EAAeC,KAAf,KAA+BA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACC,KAAN,CAAYJ,IAA5B,IAAqCD,gBAAgB,CAACC;CAFrF;AAKP,MAAaK,YAAY,qBACpBhB,gBADoB;EAEvBC,MAAM,EAAE,CAACY,OAAD,EAAeC,KAAf,KAA+BA,KAAK,CAACG,KAAN,IAAeH,KAAK,CAACG,KAAN,CAAYhB,MAA5B,IAAuCD,gBAAgB,CAACC,MAFvE;EAGvBC,IAAI,EAAE,CAACW,OAAD,EAAeC,KAAf,KAA+BA,KAAK,CAACG,KAAN,IAAeH,KAAK,CAACG,KAAN,CAAYf,IAA5B,IAAqCF,gBAAgB,CAACE;EAHrF;;AAOP,MAAae,KAAK,GAAGD,YAAd;;;;AAKP,AAAO,SAASE,QAAT,CAAkBC,OAAlB,EAAqD;QACpD;IAAEC,IAAF;IAAQC;MAAaF,OAA3B;QACMG,OAAO,GAAGF,IAAI,CAACG,OAAL,CAAa,YAAb,EAA2BvD,UAA3B,CAAhB;;QACMwD,WAAW,qBACZH,QADY;IAEfI,SAAS,EAAE,CAACZ,OAAD,EAAUC,KAAV,KAAoB;YACvB;QAAEY;UAAaZ,KAAK,CAACa,IAA3B;aACOnC,KAAK,CAACC,OAAN,CAAciC,QAAd,IAA0BA,QAA1B,GAAqCpD,WAAW,CAACoD,QAAD,CAAvD;KAJa;IAMfE,SAAS,EAAE,CAACf,OAAD,EAAUC,KAAV,KAAoB;YACvB;QAAEe,WAAW,EAAE3D;UAAM4C,KAAK,CAACa,IAAjC;aACOnC,KAAK,CAACC,OAAN,CAAcvB,CAAd,IAAmBA,CAAnB,GAAuB,CAACA,CAAC,CAACK,CAAH,EAAML,CAAC,CAACM,CAAR,EAAWN,CAAC,CAACO,CAAb,EAAgBP,CAAC,CAACH,CAAlB,CAA9B;;IARJ;;2BAYKoD,OADL;IAEEC,IAAI,EAAEE,OAFR;IAGED,QAAQ,EAAEG;;;AAId,AAAO,SAASM,eAAT,CAAyB;EAC9BjC,MAD8B;EAE9BP,KAF8B;EAG9BR;CAHK,EAQiC;MAClC,CAAC,CAACe,MAAD,IAAW,CAACA,MAAM,CAACZ,MAApB,KAA+BK,KAAnC,EAA0C;WACjCQ,iBAAiB,CAAChB,MAAM,CAACG,MAAR,EAAgBK,KAAhB,CAAxB;;;MAEEO,MAAJ,EAAY;;WAEHkC,aAAa,CAAClC,MAAD,CAAb,GAAwBD,WAAW,CAACC,MAAD,CAAnC,GAA8CA,MAArD;;;SAEK,EAAP;;;AAGF,SAASmC,eAAT,CAAyBC,GAAzB,EAAqC;SAC5BA,GAAG,CAAChD,MAAJ,IAAcO,KAAK,CAACC,OAAN,CAAcwC,GAAG,CAAC,CAAD,CAAjB,CAArB;;;;;;;AAOF,AAAO,SAASC,WAAT,CAAqBC,IAArB,EAAgC;QAC/BC,MAAM,GAAGD,IAAI,CAACC,MAAL,CAAY;IACzBC,KAAK,EAAE,SADkB;IAEzBC,IAAI,EAAE;GAFO,CAAf;SAKO,UAAShD,KAAT,EAAqBO,MAArB,EAAkCZ,MAAlC,EAAkD;QACnDqD,IAAJ,EAAUC,OAAV;;QACI,CAAC1C,MAAD,IAAW,CAACA,MAAM,CAACZ,MAAvB,EAA+B;MAC7BqD,IAAI,GAAGP,aAAa,CAACzC,KAAD,CAAb,GAAuBH,MAAM,CAACG,KAAD,CAA7B,GAAuCA,KAA9C;MACAiD,OAAO,GAAGtD,MAAV;KAFF,MAGO;MACLqD,IAAI,GAAGP,aAAa,CAAClC,MAAD,CAAb,GAAwBD,WAAW,CAACC,MAAD,CAAnC,GAA8CA,MAArD;MACA0C,OAAO,GAAG,CAAV;;;WAEK;MACLH,MAAM,EAAEA,MAAM,CAAC;QACbC,KAAK,EAAE,SADM;QAEbC;OAFY,CADT;MAKLC;KALF;GATF;;;AAoBF,AAAO,SAASR,aAAT,CAAuBjB,KAAvB,EAAmC;MACpC,CAACA,KAAD,IAAUkB,eAAe,CAAClB,KAAD,CAAzB,IAAoC,CAAC0B,KAAK,CAAC1B,KAAK,CAAC,CAAD,CAAN,CAA9C,EAA0D;WACjD,KAAP;;;SAEK,IAAP;;AAGF,AAAO,SAAS2B,QAAT,CAAkBvD,CAAS,GAAG,CAA9B,EAAuC;QACtChB,CAAC,GAAG,CAAEgB,CAAC,IAAI,EAAN,GAAY,GAAb,IAAoB,GAA9B;QACMf,CAAC,GAAG,CAAEe,CAAC,IAAI,CAAN,GAAW,GAAZ,IAAmB,GAA7B;QACMd,CAAC,GAAG,CAACc,CAAC,GAAG,GAAL,IAAY,GAAtB;SACO,CAAChB,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAU,CAAV,CAAP;;AAGF,AAAO,SAASsE,cAAT,CAAwBlC,GAAxB,EAA2C;QAC1CtC,CAAC,GAAGsC,GAAG,CAAC,CAAD,CAAH,GAAS,GAAnB;QACMrC,CAAC,GAAGqC,GAAG,CAAC,CAAD,CAAH,GAAS,GAAnB;QACMpC,CAAC,GAAGoC,GAAG,CAAC,CAAD,CAAH,GAAS,GAAnB;SACOpC,CAAC,GAAID,CAAC,IAAI,CAAV,GAAgBD,CAAC,IAAI,EAA5B;;AAGF,AAAO,SAASyE,cAAT,CAAwBnC,GAAxB,EAAiD;QAChDtC,CAAC,GAAGsC,GAAG,CAAC,CAAD,CAAb;QACMrC,CAAC,GAAGqC,GAAG,CAAC,CAAD,CAAb;QACMpC,CAAC,GAAGoC,GAAG,CAAC,CAAD,CAAb;SACOpC,CAAC,GAAID,CAAC,IAAI,CAAV,GAAgBD,CAAC,IAAI,EAA5B;;;;;AAMF,AAAO,SAAS0E,aAAT,CAAuB1F,GAAvB,EAAsCgB,CAAtC,EAAiD2E,KAAjD,EAAgEC,GAAhE,EAAmF;QAClFC,OAAO,GAAG7E,CAAC,GAAG3B,IAAI,CAACyG,GAAL,CAASF,GAAT,CAApB;EACA5F,GAAG,CAAC,CAAD,CAAH,GAAS6F,OAAO,GAAGxG,IAAI,CAACyG,GAAL,CAASH,KAAT,CAAnB;EACA3F,GAAG,CAAC,CAAD,CAAH,GAASgB,CAAC,GAAG3B,IAAI,CAAC0G,GAAL,CAASH,GAAT,CAAb;EACA5F,GAAG,CAAC,CAAD,CAAH,GAAS6F,OAAO,GAAGxG,IAAI,CAAC0G,GAAL,CAASJ,KAAT,CAAnB;SACQ3F,GAAR;;;ACxOF;AACA,AAWA,MAAMgG,aAAa,GAAGC,MAAM,CAACC,MAAP,CAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAd,CAAtB;;AAGA,MAAMC,SAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAlB;AACA,MAAMC,QAAQ,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAjB;AACA,MAAMC,SAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAlB;;AAEA,MAAMC,aAAa,GAAIC,KAAD,IAAwBA,KAA9C;;AAEA,MAAMC,mBAAmB,GAAGC,uBAAc,CACxCH,aADwC,EAExC,CAAC;EAAEI;CAAH,KAAqBA,WAFmB,CAA1C;AAIA,MAAMC,gBAAgB,GAAGF,uBAAc,CACrCH,aADqC,EAErC,CAAC;YAAEM;CAAH,KAAkBA,WAFmB,CAAvC;AAIA,MAAMC,WAAW,GAAGJ,uBAAc,CAChCH,aADgC,EAEhC,CAAC;EAAEV;CAAH,KAAaA,GAFmB,CAAlC;AAIA,MAAMkB,mBAAmB,GAAGL,uBAAc,CACxCH,aADwC,EAExC,CAAC;EAAES;CAAH,KAAqBA,WAFmB,CAA1C;AAIA,MAAMC,yBAAyB,GAAGP,uBAAc,CAC9CH,aAD8C,EAE9C,CAAC;EAAEW;CAAH,KAA2BA,iBAFmB,CAAhD;;AAMA,MAAMC,qBAA8C,GAAGT,uBAAc,CACnEO,yBADmE,EAElEC,iBAAD,IAAuB;QACfjH,GAAG,GAAGmH,aAAI,CAACC,aAAL,CAAmBjB,SAAnB,EAA8BH,aAA9B,EAA6CiB,iBAA7C,CAAZ;QACMI,OAAO,GAAG,CAAChI,IAAI,CAACiI,KAAL,CAAWtH,GAAG,CAAC,CAAD,CAAd,EAAmBA,GAAG,CAAC,CAAD,CAAtB,CAAjB;SACOqH,OAAP;CALiE,CAArE;;AAUA,MAAME,mBAA0C,GAAGd,uBAAc,CAC/DD,mBAD+D,EAE/DK,WAF+D,EAG/DC,mBAH+D,EAI/D,CAACJ,WAAD,EAAcd,GAAd,EAAmBmB,WAAnB,KAAmC;QAC3BlF,MAAM,GAAG2F,aAAI,CAACC,QAAL,CAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAd,CAAf;EACAD,aAAI,CAACE,OAAL,CAAa7F,MAAb,EAAqBA,MAArB,EAA6B,CAACkF,WAA9B,EAFiC;;MAK7BL,WAAJ,EAAiB;IACfc,aAAI,CAACG,OAAL,CAAa9F,MAAb,EAAqBA,MAArB,EAA6B+D,GAA7B;;;SAEK/D,MAAP;CAZ6D,CAAjE;;AAiBA,MAAM+F,gBAAuC,GAAGnB,uBAAc,CAC5DK,mBAD4D,EAE5DD,WAF4D,EAG5DF,gBAH4D,EAI5D,CAACI,WAAD,EAAcnB,GAAd,EAAmBgB,WAAnB,KAAgC;QACxBpC,QAAQ,GAAGkB,aAAa,CAAC,EAAD,EAAKkB,WAAL,EAAeG,WAAf,EAA4BnB,GAA5B,CAA9B,CAD8B;;QAIxB,CAACvE,CAAD,EAAIC,CAAJ,EAAOC,CAAP,IAAYiD,QAAlB;EACAA,QAAQ,CAAC,CAAD,CAAR,GAAc,CAACnD,CAAf;EACAmD,QAAQ,CAAC,CAAD,CAAR,GAAc,CAACjD,CAAf;EACAiD,QAAQ,CAAC,CAAD,CAAR,GAAclD,CAAd;SAEOkD,QAAP;CAb0D,CAA9D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkFA,MAAMqD,YAAmC,GAAGpB,uBAAc,CACxDH,aADwD,EAExDiB,mBAFwD,EAGxDK,gBAHwD,EAIxDV,qBAJwD,EAKxD,CAAC;EAAEY,MAAF;EAAUC,YAAV;EAAwBrB;CAAzB,EAAwC/B,WAAxC,EAAqDH,QAArD,EAA+DwD,aAA/D,KAAiF;QACzEC,CAAC,GAAGC,aAAI,CAACT,QAAL,CAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAd,CAAV,CAD+E;;;EAM/ES,aAAI,CAACC,QAAL,CAAcF,CAAd,EAAiBA,CAAjB,EAAoBC,aAAI,CAACE,QAAL,CAAchC,QAAd,EAAwBoB,aAAI,CAACa,MAAL,CAAYhC,SAAZ,EAAuB1B,WAAvB,CAAxB,CAApB,EAN+E;;MAS3E+B,WAAJ,EAAiB;IACfwB,aAAI,CAACI,SAAL,CAAeL,CAAf,EAAkBA,CAAlB,EAAqBd,aAAI,CAACoB,MAAL,CAAYpC,SAAZ,EAAuB3B,QAAvB,CAArB;GAV6E;;;EAc/E0D,aAAI,CAACI,SAAL,CAAeL,CAAf,EAAkBA,CAAlB,EAAqBd,aAAI,CAACoB,MAAL,CAAYpC,SAAZ,EAAuB4B,YAAvB,CAArB,EAd+E;;EAiB/EG,aAAI,CAACR,OAAL,CAAaO,CAAb,EAAgBA,CAAhB,EAAmBD,aAAnB,EAjB+E;;EAoB/Eb,aAAI,CAACoB,MAAL,CAAYpC,SAAZ,EAAuB2B,MAAvB;;MACI,CAACpB,WAAL,EAAkB;;;IAGhBP,SAAS,CAAC,CAAD,CAAT,GAAe,CAAC,IAAhB;;;EAEF+B,aAAI,CAACI,SAAL,CAAeL,CAAf,EAAkBA,CAAlB,EAAqB9B,SAArB;SAEO8B,CAAP;CAjCsD,CAA1D;AAqCA,MAAMO,iBAAwC,GAAG/B,uBAAc,CAC7Dc,mBAD6D,EAE7DL,qBAF6D,EAG7D,CAACvC,WAAD,EAAcqD,aAAd,KAAgC;QACxBC,CAAC,GAAGC,aAAI,CAACT,QAAL,CAAcS,aAAI,CAACO,MAAL,EAAd,CAAV;EACAP,aAAI,CAACR,OAAL,CAAaO,CAAb,EAAgBA,CAAhB,EAAmB,CAACD,aAApB;EACAE,aAAI,CAACC,QAAL,CAAcF,CAAd,EAAiBA,CAAjB,EAAoBC,aAAI,CAACE,QAAL,CAAchC,QAAd,EAAwBzB,WAAxB,CAApB;SACOsD,CAAP;CAP2D,CAA/D;AAWA,gBAAe;EACbtD,WAAW,EAAE4C,mBADA;EAEb/C,QAAQ,EAAEoD,gBAFG;EAGbI,aAAa,EAAEd,qBAHF;EAIbwB,IAAI,EAAEb,YAJO;EAKbW;CALF;;AChLA;AACA,MAAMG,aAAa,GAAG1C,MAAM,CAACC,MAAP,CAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAd,CAAtB;;AAEA,MAAMG,WAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAlB;AAEA,MAAauC,oBAAiC,GAAG;EAC/ChC,QAAQ,EAAE,EADqC;EAE/CF,WAAW,EAAE,IAFkC;EAG/Cd,GAAG,EAAEvG,IAAI,CAACwJ,EAAL,GAAU,CAHgC;EAI/Cf,MAAM,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAJuC;EAK/CC,YAAY,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CALiC;EAM/Cd,iBAAiB,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAN4B;EAO/CF,WAAW,EAAE,CAPkC;EAQ/C+B,IAAI,EAAEzJ,IAAI,CAACwJ,EAAL,GAAU,CAR+B;EAS/CE,IAAI,EAAE,IATyC;EAU/CC,GAAG,EAAE;CAVA;;AAaP,SAASC,iBAAT,CAA2BC,gBAA3B,EAAqDC,WAArD,EAAkF;;SAEzE9J,IAAI,CAAC+J,GAAL,CAAS,KAAT,EAAgBF,gBAAgB,IAAI,IAAIC,WAAW,GAAG,GAAtB,CAAhC,CAAP;;;AAGF,AAAe,MAAME,WAAN,CAAkB;EAK/BtK,WAAW,CACTuK,OAA8B,GAAG,MAAM,EAD9B,EAETC,kBAAuC,GAAGX,oBAFjC,EAGT;;;;;4CAKgBrC,KAAD,IAAgC;;;;WAK1C,MAAM,CAACiD,GAAD,EAAMC,KAAN,CAAX,IAA2BxD,MAAM,CAACyD,OAAP,CAAed,oBAAf,CAA3B,EAAiE;YAC3DrC,KAAK,CAACiD,GAAD,CAAL,IAAc,IAAlB,EAAwB;UACtBjD,KAAK,CAACiD,GAAD,CAAL,GAAaC,KAAb;;OAP2C;;;;WAY1ClD,KAAL,GAAcA,KAAd;KAjBA;;0CAoBa,CAAC,CAAClF,CAAD,EAAIC,CAAJ,CAAD,KAAkB;;UAE3BD,CAAC,KAAK,CAAN,IAAWC,CAAC,KAAK,CAArB,EAAwB;;;;YAGlB;QAAEyF,WAAF;QAAenB;UAAQ,KAAKW,KAAlC;WACKoD,cAAL,mBACK,KAAKpD,KADV;QAEEQ,WAAW,EAAEA,WAAW,GAAG1F,CAF7B;QAGEuE,GAAG,EAAEvG,IAAI,CAAC+J,GAAL,CAAS,CAAT,EAAY/J,IAAI,CAACuK,GAAL,CAAShE,GAAG,GAAGtE,CAAf,EAAkBjC,IAAI,CAACwJ,EAAvB,CAAZ;;;WAEFgB,SAAL,CAAe,KAAKtD,KAApB;KA/BA;;wCAmCW,CAAC,CAAClF,CAAD,EAAIC,CAAJ,CAAD,KAAkB;;UAEzBD,CAAC,KAAK,CAAN,IAAWC,CAAC,KAAK,CAArB,EAAwB;;;;YAIlB;QAAEyG,YAAF;QAAgBhB;UAAgB,KAAKR,KAA3C,CAN6B;;YASvB1E,MAAM,GAAG,CAACR,CAAD,EAAIC,CAAJ,EAAO,CAAP,CAAf;YACMwI,MAAM,GAAG3C,aAAI,CAACC,aAAL,CAAmBvF,MAAnB,EAA2BA,MAA3B,EAAmC2F,aAAI,CAACuC,YAAL,CAAkB1D,WAAlB,EAA6BsC,aAA7B,EAA4C,CAAC5B,WAA7C,CAAnC,CAAf;WAEK4C,cAAL,mBACK,KAAKpD,KADV;QAEEwB,YAAY,EAAEZ,aAAI,CAAC6C,GAAL,CAASF,MAAT,EAAiB/B,YAAjB,EAA+B+B,MAA/B;;;WAEXD,SAAL,CAAe,KAAKtD,KAApB;KAnDA;;wCAsDY4C,WAAD,IAAyB;YAC9B;kBAAEvC;UAAa,KAAKL,KAA1B;YACM0D,WAAmB,GAAGhB,iBAAiB,CAACrC,WAAD,EAAWuC,WAAX,CAA7C;;UACIvC,WAAQ,KAAKqD,WAAjB,EAA8B;;;;WAIzBN,cAAL,mBACK,KAAKpD,KADV;QAEEK,QAAQ,EAAEqD;;;WAEPJ,SAAL,CAAe,KAAKtD,KAApB;KAjEA;;SACKsD,SAAL,GAAiBP,OAAjB;SACKK,cAAL,CAAoBJ,kBAApB;;;;;AC5CJ,MAAMnD,UAAQ,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAjB;;;AAIA,cAAgBnB,IAAD,IAAe;SACrB,MAAMiF,MAAN,CAAsC;;6CACnB,CADmB;;8CAElB,CAFkB;;2CAGhBtB,oBAHgB;;oCAqCpC3D,IAAI,CAAC;;QAEVtB,OAAO,EAAE;;;UAGPwG,UAAU,CAACxG,OAAD,EAAUC,KAAV,EAAiB;kBACnB;cAAEwG,aAAF;cAAiBC;gBAAmB1G,OAA1C,CADyB;;;iBAIpByG,aAAL,GAAqBA,aAArB;iBACKC,cAAL,GAAsBA,cAAtB;iBACKC,WAAL,GAAmB1G,KAAnB;mBACO,KAAK2G,aAAL,EAAP;WAVK;;UAaP7B,IAAI,CAAC/E,OAAD,EAAUC,KAAV,EAAiB;mBACZ,KAAK4G,OAAL,EAAP;WAdK;;;UAkBPhC,iBAAiB,CAAC7E,OAAD,EAAUC,KAAV,EAAiB;mBACzB6G,SAAS,CAACjC,iBAAV,CAA4B,KAAK8B,WAAjC,CAAP;WAnBK;;UAsBPI,aAAa,CAAC/G,OAAD,EAAUC,KAAV,EAAiB;mBACrB,KAAK0G,WAAL,CAAiB5D,WAAxB;WAvBK;;UA0BPoC,IAAI,CAACnF,OAAD,EAAUC,KAAV,EAAiB;mBACZ,KAAK0G,WAAL,CAAiBxB,IAAxB;;;SA7BM;;;QAmCV3E,QAAQ,EAAE;UACRuE,IAAI,EAAEzD,IAAI,CAACtB,OAAL,CAAa,MAAb,CADE;UAER6E,iBAAiB,EAAEvD,IAAI,CAACtB,OAAL,CAAa,mBAAb,CAFX;UAGRwG,UAAU,EAAElF,IAAI,CAACtB,OAAL,CAAa,YAAb;;OAtCL,CArCgC;;;IAK3C4G,aAAa,GAAS;YACd;QAAExB,IAAF;QAAQC,GAAR;kBAAapC,WAAb;QAAuBkC;UAAS,KAAKwB,WAA3C;;UACI,CAAC,KAAKA,WAAL,CAAiB5D,WAAtB,EAAmC;cAC3BiE,MAAM,GAAGnL,qBAAqB,CAACoH,WAAD,EAAW,KAAKwD,aAAhB,EAA+B,KAAKC,cAApC,CAApC;cACM;UAAErL,IAAF;UAAQE,KAAR;UAAeC,MAAf;UAAuBF;YAAQ0L,MAArC;eACOzC,aAAI,CAAC0C,KAAL,CAAW,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAX,EAA6D5L,IAA7D,EAAmEE,KAAnE,EAA0EC,MAA1E,EAAkFF,GAAlF,EAAuF8J,IAAvF,EAA6FC,GAA7F,CAAP;;;YAEItJ,MAAM,GAAG,KAAK0K,aAAL,GAAqB,KAAKC,cAAzC;aACOnC,aAAI,CAACxB,WAAL,CAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAjB,EAAmEoC,IAAnE,EAAyEpJ,MAAzE,EAAiFqJ,IAAjF,EAAuFC,GAAvF,CAAP;;;IAGFwB,OAAO,GAAS;aACPC,SAAS,CAAC/B,IAAV,CAAe,KAAK4B,WAApB,CAAP;KAjByC;;;IAqB3CO,aAAa,CAAC3K,QAAD,EAAqB4K,KAArB,EAAkC;YACvCX,UAAU,GAAG,KAAKI,aAAL,EAAnB;YACM7B,IAAI,GAAG+B,SAAS,CAAC/B,IAAV,CAAe,KAAK4B,WAApB,CAAb;YACMnK,gBAAgB,GAAG+H,aAAI,CAACC,QAAL,CAAc/B,UAAd,EAAwB+D,UAAxB,EAAoCzB,IAApC,CAAzB;YACM,CAACrH,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUV,CAAV,IAAekK,aAAO,CAAC,EAAD,EAAKD,KAAL,EAAY5K,QAAZ,EAAsBC,gBAAtB,CAA5B;;UACIoB,CAAC,GAAG,CAAJ,IAASA,CAAC,GAAG,CAAb,IAAkBV,CAAC,GAAG,CAA1B,EAA6B;;eAEpBmK,SAAP;;;YAEIC,KAAK,GAAG/K,QAAQ,CAAC,CAAD,CAAR,GAAcA,QAAQ,CAAC,CAAD,CAApC;YACMgL,KAAK,GAAGhL,QAAQ,CAAC,CAAD,CAAtB,CAV6C;;;aAatC,CAACmB,CAAC,GAAG6J,KAAL,EAAYD,KAAK,GAAG3J,CAApB,EAAuBC,CAAvB,CAAP;;;GAlCJ;CADF;;ACJA,MAAM4J,SAAS,GAAG,CAAlB;AACA,MAAMC,gBAAgB,GAAG,GAAzB;AACA,MAAMC,mBAAmB,GAAG,GAA5B;AACA,MAAMC,mBAAmB,GAAG,GAA5B;AACA,MAAMC,mBAAmB,GAAG,GAA5B;AAEA,MAAMC,cAA4B,GAAG;EACnCC,IAAI,EAAE,UAD6B;EAEnCC,IAAI,EAAE,WAF6B;EAGnCC,IAAI,EAAE,aAH6B;EAInCC,IAAI,EAAE,QAJ6B;EAKnCC,IAAI,EAAE,YAL6B;EAMnCC,IAAI,EAAE,UAN6B;EAOnCC,IAAI,EAAE,UAP6B;EAQnCC,IAAI,EAAE,QAR6B;EASnCC,IAAI,EAAE,SAT6B;EAUnCC,IAAI,EAAE;CAVR;;AAuBA,AAAe,MAAMC,cAAN,SAA6BC,eAA7B,CAAoD;;;;;;mCAE5C,IAAIC,GAAJ,EAF4C;;sCAGzC,IAAIA,GAAJ,EAHyC;;wCAIpD,EAJoD;;uCAKrD,KALqD;;sCAMtD,KANsD;;sCAOtD,KAPsD;;;;;;;;+CA+C5CC,KAAD,IAAuB;YACnC;QAAEC,OAAF;QAAWC;UAAYF,KAA7B;YACM;QAAErN,GAAF;QAAOD,IAAP;QAAaI,KAAb;QAAoBG;UAAW,KAAKkN,KAA1C;YACMpL,CAAC,GAAG,CAACkL,OAAO,GAAGvN,IAAX,IAAmBI,KAA7B;YACMkC,CAAC,GAAG,CAACkL,OAAO,GAAGvN,GAAX,IAAkBM,MAA5B;aACO,CAAC8B,CAAD,EAAIC,CAAJ,CAAP;KApD+D;;0CAuDjDoL,CAAD,IAAmB;YAC1B;QAAEC;UAAQ,IAAhB;;UACI,CAACA,GAAL,EAAU;;;;MAIVD,CAAC,CAACE,cAAF;;WACKC,QAAL,CAAc7C,GAAd,CAAkB0C,CAAC,CAACI,MAApB;;MACAH,GAAG,CAACI,KAAJ;;WACKN,KAAL,GAAaE,GAAG,CAACK,qBAAJ,EAAb;WACKC,aAAL,GAAqB,KAAKC,iBAAL,CAAuBR,CAAvB,CAArB;WACKS,aAAL,CAAmBT,CAAnB;KAlE+D;;gDAwG3CA,CAAD,IAAmB;UAClC,CAAC,KAAKG,QAAL,CAAcO,IAAnB,EAAyB;;;;WAGpBC,SAAL,GAAiBX,CAAC,CAACY,QAAnB;YACM;QACJC,WAAW,EAAE;UACXC,UADW;UAEXC,YAFW;UAGXlH,KAAK,EAAE;YAAEG;;;UAET,KAAK9C,KANT,CALsC;;UAclC8J,KAAJ,EAAWC,KAAX;;YACMrB,KAAK,GAAG,KAAKY,iBAAL,CAAuBR,CAAvB,CAAd,CAfsC;;;;;UAmBjCkB,QAAD,CAAgBC,kBAAhB,KAAuCnB,CAAC,CAACoB,SAAF,IAAepB,CAAC,CAACqB,SAAxD,CAAJ,EAAwE;QACtEL,KAAK,GAAG,CAAChB,CAAC,CAACoB,SAAH,GAAe,KAAKrB,KAAL,CAAWrN,KAAlC;QACAuO,KAAK,GAAG,CAACjB,CAAC,CAACqB,SAAH,GAAe,KAAKtB,KAAL,CAAWlN,MAAlC;OAFF,MAGO;QACLmO,KAAK,GAAG,KAAKT,aAAL,CAAmB,CAAnB,IAAwBX,KAAK,CAAC,CAAD,CAArC;QACAqB,KAAK,GAAG,KAAKV,aAAL,CAAmB,CAAnB,IAAwBX,KAAK,CAAC,CAAD,CAArC;;;WAEGW,aAAL,GAAqBX,KAArB;;UAEI,KAAK0B,iBAAL,EAAJ,EAA8B;cACtBC,SAAS,GAAG,KAAKC,aAAL,CAAmB/C,SAAnB,CAAlB,CAD4B;;;cAGtB9J,CAAC,GAAG,CAACqF,WAAW,GAAGgH,KAAH,GAAW,CAACA,KAAxB,IAAiCO,SAA3C,CAH4B;;cAKtB3M,CAAC,GAAGoF,WAAW,GAAGiH,KAAK,GAAGM,SAAX,GAAuB,CAA5C;QACAR,YAAY,CAAC,CAACpM,CAAD,EAAIC,CAAJ,CAAD,CAAZ;;;UAGE,KAAK6M,gBAAL,EAAJ,EAA6B;cACrB;UAAE9M,CAAF;UAAKC;YAAM,KAAK8M,iBAAL,EAAjB;;QACAZ,UAAU,CAAC,CAAC,KAAKU,aAAL,CAAmBR,KAAK,GAAGrM,CAA3B,CAAD,EAAgC,KAAK6M,aAAL,CAAmB,CAACP,KAAD,GAASrM,CAA5B,CAAhC,CAAD,CAAV;;KA/I6D;;wCAmJnDoL,CAAD,IAAmB;WACzBG,QAAL,CAAcwB,MAAd,CAAqB3B,CAAC,CAACI,MAAvB;;WACKwB,YAAL;KArJ+D;;8CAwJ7C5B,CAAD,IAAmB;YAC9B;QAAEC;UAAQ,IAAhB;;UACI,CAACA,GAAL,EAAU;;OAF0B;;;UAOhCA,GAAG,CAAC4B,QAAJ,CAAc7B,CAAC,CAAC5E,MAAhB,KAAiC4E,CAAC,CAAC5E,MAAF,KAAa6E,GAAlD,EAAuD;;OAPnB;;;;;WAa/BE,QAAL,CAAc2B,KAAd;;WACKF,YAAL;KAtK+D;;2CAuLhDG,IAAD,IAA8B;YACtCC,SAAS,GAAG,KAAKR,aAAL,CAAmB7C,mBAAnB,CAAlB;;YACMsD,SAAS,GAAG,KAAKT,aAAL,CAAmB5C,mBAAnB,CAAlB;;YACMsD,SAAS,GAAG,KAAKV,aAAL,CAAmB3C,mBAAnB,CAAlB;;YACM;QAAEsD,MAAF;QAAUC;UAAc,KAAKlL,KAAnC;YACMmL,MAA4B,GAAIF,MAAM,IAAIA,MAAM,CAACJ,IAAD,CAAjB,IAA4BjD,cAAc,CAACiD,IAAD,CAA1C,IAAoD,KAAzF;;UAEI,KAAKpB,SAAL,IAAkB,CAACyB,SAAvB,EAAkC;eACzB,IAAP;;;cAGMC,MAAR;aACO,WAAL;iBACS;YAAE1N,CAAC,EAAEqN;WAAZ;;aACG,UAAL;iBACS;YAAErN,CAAC,EAAE,CAACqN;WAAb;;aACG,QAAL;iBACS;YAAEpN,CAAC,EAAEoN;WAAZ;;aACG,UAAL;iBACS;YAAEpN,CAAC,EAAE,CAACoN;WAAb;;aACG,QAAL;iBACS;YAAEM,IAAI,EAAEL;WAAf;;aACG,SAAL;iBACS;YAAEK,IAAI,EAAE,CAACL;WAAhB;;aACG,YAAL;iBACS;YAAEM,GAAG,EAAE,CAACL;WAAf;;aACG,aAAL;iBACS;YAAEK,GAAG,EAAEL;WAAd;;aACG,QAAL;iBACS;YAAEM,IAAI,EAAE,CAACN;WAAhB;;aACG,UAAL;iBACS;YAAEM,IAAI,EAAEN;WAAf;;aACG,KAAL;iBACS,IAAP;;;AAECG,AACDI,UAAAA,OAAO,CAACC,IAAR,CAAa,0BAAb,EAAyCL,MAAzC;iBACO,IAAP;;KA5N2D;;wCA0RnDrC,CAAD,IAA+C;YACpD;QAAEmC;UAAW,KAAKjL,KAAxB;WACKyJ,SAAL,GAAiBX,CAAC,CAACY,QAAnB;WACK+B,QAAL,GAAgB3C,CAAC,CAAC4C,OAAlB;WACKC,QAAL,GAAgB7C,CAAC,CAAC8C,OAAlB;YACMf,IAAI,GAAK/B,CAAC,CAAC+C,WAAJ,CAAsChB,IAAnD,CAL0D;;UAQtD/B,CAAC,CAACgD,MAAF,IAAY,KAAKC,KAAL,CAAWC,GAAX,CAAenB,IAAf,CAAhB,EAAsC;QACpC/B,CAAC,CAACmD,eAAF;QACAnD,CAAC,CAACE,cAAF;;;;UAIEF,CAAC,CAACoD,MAAF,IAAYpD,CAAC,CAAC8C,OAAd,IAAyB9C,CAAC,CAAC4C,OAA/B,EAAwC;;;OAdkB;;;UAoBtDT,MAAM,IAAIJ,IAAI,IAAII,MAAlB,IAA4B,CAACA,MAAM,CAACJ,IAAD,CAAvC,EAA+C;eACtC,KAAP;OArBwD;;;UAyBtD,KAAKsB,aAAL,CAAmBtB,IAAnB,CAAJ,EAA8B;aACvBkB,KAAL,CAAW3F,GAAX,CAAeyE,IAAf;;aACKuB,cAAL;;QACAtD,CAAC,CAACmD,eAAF;QACAnD,CAAC,CAACE,cAAF;;KAvT6D;;sCA2TrDF,CAAD,IAA+C;WACnDW,SAAL,GAAiBX,CAAC,CAACY,QAAnB;WACK+B,QAAL,GAAgB3C,CAAC,CAAC4C,OAAlB;WACKC,QAAL,GAAgB7C,CAAC,CAAC8C,OAAlB;;WAEKG,KAAL,CAAWtB,MAAX,CAAoB3B,CAAC,CAAC+C,WAAJ,CAAsChB,IAAxD;KAhU+D;;sCAmUrD/B,CAAD,IAAmB;;;MAG5BA,CAAC,CAACE,cAAF;MACAF,CAAC,CAACmD,eAAF;WACKxC,SAAL,GAAiBX,CAAC,CAACY,QAAnB,CAL4B;;;YAStB;QAAE2C,MAAF;QAAUC;UAAWC,cAAc,CAACzD,CAAD,CAAzC,CAT4B;;YAYtB0D,WAAW,GAAGF,MAAM,IAAID,MAA9B,CAZ4B;;;YAgBtBI,GAAG,GAAGhR,IAAI,CAACiR,IAAL,CAAUF,WAAV,IAAyB,CAAC,CAAtC;YACMG,MAAM,GAAGlR,IAAI,CAACC,GAAL,CAAS8Q,WAAT,CAAf,CAjB4B;;YAmBtBI,UAAU,GAAGnR,IAAI,CAAC+J,GAAL,CAAS,CAAT,EAAY/J,IAAI,CAACuK,GAAL,CAAS2G,MAAT,EAAiB,EAAjB,CAAZ,CAAnB,CAnB4B;;YAsBtBE,cAAc,GAAG,KAAKvC,aAAL,CAAmBsC,UAAU,GAAGH,GAAb,GAAmBjF,gBAAtC,CAAvB;;WACKxH,KAAL,CAAW2J,WAAX,CAAuBmD,UAAvB,CAAkCD,cAAlC;KA1V+D;;qCAgWtD/D,CAAD,IAAmB;WACtBiD,KAAL,GAAa,IAAItD,GAAJ,EAAb;WACKkD,QAAL,GAAgB,KAAhB;WACKlC,SAAL,GAAiB,KAAjB;WACKgC,QAAL,GAAgB,KAAhB;;WACKsB,aAAL;KArW+D;;4CAwW/CjE,CAAD,IAAmB;MAClCA,CAAC,CAACE,cAAF;MACAF,CAAC,CAACmD,eAAF;KA1W+D;;;EAajEe,iBAAiB,GAAG;UACZ;MAAEjE;QAAQ,IAAhB;;QACI,CAACA,GAAL,EAAU;;;;SAILF,KAAL,GAAaE,GAAG,CAACK,qBAAJ,EAAb;;UACM6D,MAAM,GAAG,CAAC/I,MAAD,EAAcgJ,IAAd,EAA4BC,EAA5B,KAAmC;MAChDjJ,MAAM,CAACkJ,gBAAP,CAAwBF,IAAxB,EAA8BC,EAA9B;;WACKE,UAAL,CAAgBC,IAAhB,CAAqB;QAAEpJ,MAAF;QAAUgJ,IAAV;QAAgBC;OAArC;KAFF;;IAIAF,MAAM,CAACjD,QAAD,EAAW,MAAX,EAAmB,KAAKuD,OAAxB,CAAN;IACAN,MAAM,CAACO,MAAD,EAAS,SAAT,EAAoB,KAAKC,gBAAzB,CAAN;;IACA1E,GAAG,CAACqE,gBAAJ,CAAqB,OAArB,EAA8B,KAAKM,QAAnC,EAA6C;MAAEC,OAAO,EAAE;KAAxD;;;EAGFC,oBAAoB,GAAG;SAChBP,UAAL,CAAgBQ,OAAhB,CAAyBC,QAAD,IAAc;MACpCA,QAAQ,CAAC5J,MAAT,CAAgB6J,mBAAhB,CAAoCD,QAAQ,CAACZ,IAA7C,EAAmDY,QAAQ,CAACX,EAA5D;KADF;;SAGKzC,YAAL;;UACM;MAAE3B;QAAQ,IAAhB;;QACI,CAACA,GAAL,EAAU;;;;IAGVA,GAAG,CAACgF,mBAAJ,CAAwB,OAAxB,EAAiC,KAAKL,QAAtC,EAAgD;MAAEC,OAAO,EAAE;KAA3D;;;EAGFxE,KAAK,GAAG;QACF,KAAKJ,GAAT,EAAc;WACPA,GAAL,CAASI,KAAT;;;;EA0BJoB,gBAAgB,GAAG;WACV,KAAKtB,QAAL,CAAc+C,GAAd,CAAkB,CAAlB,CAAP;;;EAGF5B,iBAAiB,GAAG;WACX,KAAKnB,QAAL,CAAc+C,GAAd,CAAkB,CAAlB,CAAP;;;EAGF1B,aAAa,CAAC0D,IAAY,GAAG,CAAhB,EAAmB;WACvB,KAAKvE,SAAL,GAAiBuE,IAAI,GAAG,EAAxB,GAA6BA,IAApC;;;EAGFxD,iBAAiB,GAAG;;QAEd,KAAKmB,QAAT,EAAmB;aACV;QAAElO,CAAC,EAAE,CAAL;QAAQC,CAAC,EAAE;OAAlB;;;UAGI;MACJiM,WAAW,EAAE;QACXhH,KAAK,EAAE;oBAAEK,WAAF;UAAYF;;;QAEnB,KAAK9C,KAJT;;QAKI8C,WAAJ,EAAiB;;;aAGR;QAAErF,CAAC,EAAEuF,WAAL;QAAetF,CAAC,EAAEsF;OAAzB;KAdgB;;;;UAkBZ;MAAExH,KAAF;MAASG;QAAW,KAAKkN,KAA/B;UACM9B,MAAM,GAAGnL,qBAAqB,CAACoH,WAAD,EAAWxH,KAAX,EAAkBG,MAAlB,CAApC;WACO;MAAE8B,CAAC,EAAEsJ,MAAM,CAACvL,KAAZ;MAAmBkC,CAAC,EAAEqJ,MAAM,CAACpL;KAApC;;;EAoEF4N,aAAa,CAACT,CAAD,EAAgB;QACvBA,CAAC,CAACI,MAAF,KAAa,CAAb,IAAkB,KAAKH,GAAvB,IAA8B,OAAO,KAAKA,GAAL,CAASkF,kBAAhB,KAAuC,UAAzE,EAAqF;WAC9ElF,GAAL,CAASkF,kBAAT;;;IAEFT,MAAM,CAACJ,gBAAP,CAAwB,WAAxB,EAAqC,KAAKc,kBAA1C;;;EAGFxD,YAAY,GAAG;IACb8C,MAAM,CAACO,mBAAP,CAA2B,WAA3B,EAAwC,KAAKG,kBAA7C;;QACI,OAAQlE,QAAD,CAAgBmE,eAAvB,KAA2C,UAA/C,EAA2D;MACxDnE,QAAD,CAAgBmE,eAAhB;;;;EA6CJC,aAAa,CAACC,EAAD,EAAa;UAClBC,MAAM,GAAG;MAAE7Q,CAAC,EAAE,CAAL;MAAQC,CAAC,EAAE,CAAX;MAAc0N,IAAI,EAAE,CAApB;MAAuBC,GAAG,EAAE,CAA5B;MAA+BC,IAAI,EAAE;KAApD;;SACKS,KAAL,CAAW8B,OAAX,CAAoBhD,IAAD,IAAU;YACrB;QAAEpN,CAAC,GAAG,CAAN;QAASC,CAAC,GAAG,CAAb;QAAgB0N,IAAI,GAAG,CAAvB;QAA0BC,GAAG,GAAG,CAAhC;QAAmCC,IAAI,GAAG;UAAM,KAAKa,aAAL,CAAmBtB,IAAnB,KAA4B,EAAlF;MACAyD,MAAM,CAAC7Q,CAAP,IAAYA,CAAZ;MACA6Q,MAAM,CAAC5Q,CAAP,IAAYA,CAAZ;MACA4Q,MAAM,CAAClD,IAAP,IAAeA,IAAf;MACAkD,MAAM,CAACjD,GAAP,IAAcA,GAAd;MACAiD,MAAM,CAAChD,IAAP,IAAeA,IAAf;KANF;;UASM;MACJ3B,WAAW,EAAE;QACXC,UADW;QAEXC,YAFW;QAGXiD,UAHW;QAIXnK,KAAK,EAAE;UAAEG;;;QAET,KAAK9C,KAPT;;QASIsO,MAAM,CAAC7Q,CAAP,IAAY6Q,MAAM,CAAC5Q,CAAvB,EAA0B;YAClB;QAAED,CAAF;QAAKC;UAAM,KAAK8M,iBAAL,EAAjB;;MACAZ,UAAU,CAAC,CAAC0E,MAAM,CAAC7Q,CAAP,GAAWA,CAAX,GAAe4Q,EAAhB,EAAoBC,MAAM,CAAC5Q,CAAP,GAAWA,CAAX,GAAe2Q,EAAnC,CAAD,CAAV;;;QAEEC,MAAM,CAACjD,GAAP,IAAevI,WAAW,IAAIwL,MAAM,CAAChD,IAAzC,EAAgD;MAC9CzB,YAAY,CAAC,CAACyE,MAAM,CAACjD,GAAP,GAAagD,EAAd,EAAkBvL,WAAW,GAAGwL,MAAM,CAAChD,IAAP,GAAc+C,EAAjB,GAAsB,CAAnD,CAAD,CAAZ;;;QAEEC,MAAM,CAAClD,IAAX,EAAiB;MACf0B,UAAU,CAACwB,MAAM,CAAClD,IAAP,GAAciD,EAAf,CAAV;;;;EAIJjC,cAAc,CAACmC,SAAD,EAAqB;QAC7B,KAAKC,SAAT,EAAoB;;;;SAGfA,SAAL,GAAiBC,qBAAqB,CAAEC,KAAD,IAAW;WAC3CN,aAAL,CAAmB,CAACG,SAAS,GAAGG,KAAK,GAAGH,SAAX,GAAuB,CAAjC,IAAsC,IAAzD;;WACKC,SAAL,GAAiBpH,SAAjB,CAFgD;;;;;;UAS5C,KAAK2E,KAAL,CAAWvC,IAAf,EAAqB;aACd4C,cAAL,CAAoBsC,KAApB;;KAVkC,CAAtC;;;EAeF3B,aAAa,GAAG;QACV,KAAKyB,SAAT,EAAoB;MAClBG,oBAAoB,CAAC,KAAKH,SAAN,CAApB;;;SAEGA,SAAL,GAAiBpH,SAAjB;;;EAsFFwH,MAAM,GAAG;UACD;MAAEC;QAAa,KAAK7O,KAA1B;WAEE8O;MACE,QAAQ,EAAE,CADZ;MAEE,KAAK,EAAE;QAAEC,OAAO,EAAE;OAFpB;MAGE,SAAS,MAHX;MAIE,GAAG,EAAGC,EAAD,IAAS,KAAKjG,GAAL,GAAWiG,EAJ3B;MAKE,WAAW,EAAE,KAAKC,YALpB;MAME,SAAS,EAAE,KAAKC,UANlB;MAOE,MAAM,EAAE,KAAK3B,OAPf;MAQE,aAAa,EAAE,KAAK4B,cARtB;MASE,SAAS,EAAE,KAAKC,UATlB;MAUE,OAAO,EAAE,KAAKC;OACbR,QAXH,CADF;;;;;ACzZJ;;ACAA;;;;;AAMA,AAAO,SAASS,UAAT,GAAsB;SACpBC,OAAO,IAAIA,OAAO,CAACC,GAAnB,IAA0BD,OAAO,CAACC,GAAR,CAAYC,QAA7C;;;;AAIF,AAAO,MAAMC,WAAW,GAAG,MACzBC,MAAM,CAACC,WAAP,IAAsB,OAAOC,iBAAP,KAA6B,WAAnD,IAAkEC,IAAI,YAAYD,iBAD7E;;ACCP,MAAME,OAAO,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAhB;AACA,MAAMC,OAAO,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAhB;AAEA,AAAO,MAAMC,GAAN,CAAU;EAKf9U,WAAW,CAAC+U,MAAD,EAAezD,GAAf,EAA0BvF,KAA1B,EAAuC;;;;;;;SAC3CgJ,MAAL,GAAcA,MAAd;SACKzD,GAAL,GAAWA,GAAX;SACKvF,KAAL,GAAaA,KAAb;;;EAGFiJ,eAAe,CAACjJ,KAAD,EAAc;WACpB3D,aAAI,CAACP,QAAL,CAAc,KAAKkN,MAAnB,EAA2BhJ,KAA3B,CAAP;GAZa;;;EAgBfkJ,iBAAiB,CAACC,eAAD,EAAwBC,WAAxB,EAAkD;UAC3DC,CAAC,GAAGhN,aAAI,CAACiN,GAAL,CAASF,WAAT,EAAsBD,eAAtB,CAAV;UACMI,MAAM,GAAGlN,aAAI,CAACiN,GAAL,CAASF,WAAT,EAAsB,KAAK7D,GAA3B,CAAf;;QAEIgE,MAAM,KAAK,CAAf,EAAkB;aACT,IAAP;;;UAGIhT,CAAC,GAAG,CAAC8S,CAAC,GAAGhN,aAAI,CAACiN,GAAL,CAASF,WAAT,EAAsB,KAAKJ,MAA3B,CAAL,IAA2CO,MAArD;UACMC,OAAO,GAAGnN,aAAI,CAAC6C,GAAL,CAAS,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAT,EAAoB,KAAK8J,MAAzB,EAAiC3M,aAAI,CAACoN,KAAL,CAAWZ,OAAX,EAAoB,KAAKtD,GAAzB,EAA8BhP,CAA9B,CAAjC,CAAhB;WACOiT,OAAP;;;;;AAKJ,AAAO,SAASE,eAAT,CAAyBC,MAAzB,EAAgD;EAAElI,OAAF;EAAWC,OAAX;EAAoBpN,KAApB;EAA2BG;CAA3E,EAAgG;QAC/FmV,gBAAgB,GAAGD,MAAM,CAAClK,aAAP,EAAzB;QACMoK,UAAU,GAAGF,MAAM,CAACjK,OAAP,EAAnB;QAEMoK,EAAE,GAAG1M,aAAI,CAACC,QAAL,CAAcyL,OAAd,EAAuBc,gBAAvB,EAAyCC,UAAzC,CAAX;QACME,KAAK,GAAG3M,aAAI,CAACG,MAAL,CAAYuL,OAAZ,EAAqBgB,EAArB,CAAd;QAEME,MAAM,GAAI,MAAMvI,OAAP,GAAkBnN,KAAlB,GAA0B,GAAzC;QACM2V,MAAM,GAAI,CAAC,GAAD,GAAOvI,OAAR,GAAmBjN,MAAnB,GAA4B,GAA3C,CARqG;;QAU/FyV,QAAQ,GAAG7N,aAAI,CAACvG,aAAL,CAAmB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAnB,EAA8B,CAACkU,MAAD,EAASC,MAAT,EAAiB,GAAjB,CAA9B,EAAqDF,KAArD,CAAjB,CAVqG;;QAa/FI,SAAS,GAAG9N,aAAI,CAACvG,aAAL,CAAmB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAnB,EAA8B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA9B,EAAyCsH,aAAI,CAACG,MAAL,CAAYuL,OAAZ,EAAqBe,UAArB,CAAzC,CAAlB;QACMO,MAAM,GAAG/N,aAAI,CAACgO,SAAL,CAAe,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAf,EAA0BhO,aAAI,CAACiO,QAAL,CAAczB,OAAd,EAAuBqB,QAAvB,EAAiCC,SAAjC,CAA1B,CAAf;SAEO,IAAIpB,GAAJ,CAAQoB,SAAR,EAAmBC,MAAnB,EAA2BF,QAA3B,CAAP;;;AC9DF;AACA,AASA;AACA,4BAAe5I,cAAK,CAACiJ,aAAN,CAAqBrK,SAArB,CAAf;;MCUasK,sBAAsB,GAAG,CAAC,SAAD,EAAY,WAAZ,EAAyB,aAAzB,EAAwC,aAAxC,EAAuD,eAAvD,CAA/B;;AAyBP,AAAe,MAAMC,OAAN,SAAyBnJ,eAAzB,CAAmD;EAIhErN,WAAW,CAAC6E,KAAD,EAAkB;UACrBA,KAAN,EAD2B;;;;;QAIvBsP,UAAU,OAAO,YAArB,EAAmC;;WAE5BsC,qBAAL,GAA8BC,SAAD,IAAsB;YAC7CA,SAAS,CAACC,WAAV,KAA0B,KAAK9R,KAAL,CAAW8R,WAAzC,EAAsD;UACpDvG,OAAO,CAACwG,KAAR,CAAc,mEAAd;;;eAEK,IAAP;OAJF;;;;EASJ/E,iBAAiB,GAAG;UACZjN,OAAO,GAAG,KAAKA,OAArB;;QACI,CAACA,OAAL,EAAc;;;;IAGdA,OAAO,CAACiS,OAAR,CAAgB,IAAhB,EAAsB,KAAKhS,KAAL,CAAW8R,WAAjC;;SACKG,cAAL;;;EAGFC,kBAAkB,GAAG;SACdD,cAAL;;;EAGFrE,oBAAoB,GAAG;UACf7N,OAAO,GAAG,KAAKA,OAArB;;QACI,CAACA,OAAL,EAAc;;;;IAGdA,OAAO,CAACoS,SAAR,CAAkB,IAAlB;;;EAGFF,cAAc,GAAG;UACTlS,OAAO,GAAG,KAAKA,OAArB;;QACI,CAACA,OAAL,EAAc;;;;UAIR;MAAE+R,WAAF;MAAeM,UAAf;MAA2BC;QAAyB,KAAKrS,KAA/D;UACM6O,QAAQ,GAAG,KAAK7O,KAAL,CAAW6O,QAAX,IAAuB,KAAK7O,KAAL,CAAWsS,SAAnD;;QACIzD,QAAQ,IAAI,IAAhB,EAAsB;;;;IAGtB9O,OAAO,CAACwS,gBAAR,CAAyB;MACvBC,QAAQ,EAAE,IADa;MAEvBV,WAFuB;MAGvBjD,QAHuB;MAIvBuD,UAJuB;MAKvBC;KALF;;;EASFI,gBAAgB,CACdC,OADc,EAEdC,GAFc,EAGd7J,CAHc,EAId8J,cAJc,EAKd;UACMC,YAAY,GAAG,KAAK7S,KAAL,CAAW4S,cAAX,CAArB;;QACI,CAACC,YAAD,IAAiB,CAACH,OAAO,CAACvU,MAA9B,EAAsC;;;;IAGtC0U,YAAY,CAAC/J,CAAD,EAAI;MAAE6J,GAAF;MAAOD;KAAX,CAAZ;;;EAGF9D,MAAM,GAAG;WAELE,oBAAC,qBAAD,CAAuB,QAAvB,QACIgE,GAAD,IAAgC;UAC3BA,GAAJ,EAAS;aACF/S,OAAL,GAAe+S,GAAf;;;aAEK,IAAP;KALJ,CADF;;;;;gBA1EiBnB,wBAEE;;AChDvB;;;;;;;AAQA,AAAe,SAASoB,SAAT,CAAyBC,KAAzB,EAA4D;QACnEC,cAAc,GAAG,IAAIC,GAAJ,EAAvB;EACAF,KAAK,CAACnF,OAAN,CAAc,CAAC,CAACsF,IAAD,EAAOvN,GAAP,CAAD,KAAiB;UACvBwN,aAAa,GAAGH,cAAc,CAACI,GAAf,CAAmBzN,GAAnB,KAA2B,EAAjD;IACAwN,aAAa,CAAC9F,IAAd,CAAmB6F,IAAnB;;QACI,CAACF,cAAc,CAACjH,GAAf,CAAmBpG,GAAnB,CAAL,EAA8B;MAC5BqN,cAAc,CAAClW,GAAf,CAAmB6I,GAAnB,EAAwBwN,aAAxB;;GAJJ;SAOOH,cAAP;;;ACFF;AACA,MAAMK,kBAAN,CAAyB;EAEvBnY,WAAW,CAACoY,QAAD,EAAW;;;SACfC,SAAL,GAAiBD,QAAjB;;;EAGFE,OAAO,GAAG;UACFC,KAAU,GAAG;MAAEC,WAAW,EAAE;QAAEnY,KAAK,EAAE,GAAT;QAAcG,MAAM,EAAE;;KAAxD;;SACK6X,SAAL,CAAe,CAACE,KAAD,CAAf;;;EAEFE,SAAS,GAAG;;;;AAEd,MAAMC,kBAAkB,GACtBtE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,MAAzB,IAAmCC,WAAW,EAA9C,GAAoD4D,kBAApD,GAA+EQ,cADjF;;;;;;AAQA,AAAe,SAASC,UAAT,CAAoB;EAAElF;CAAtB,EAAyC;QAChD,CAACmF,aAAD,EAAgBC,gBAAhB,IAAoCC,cAAQ,CAAC9M,SAAD,CAAlD;QACM,CAAC+M,UAAD,EAAaC,aAAb,IAA8BF,cAAQ,EAA5C,CAFsD;;QAIhD,CAACG,cAAD,IAAmBH,cAAQ,CAC/B,MACE,IAAIL,kBAAJ,CAAwB/N,OAAD,IAAa;QAC9B,CAACA,OAAD,IAAY,CAACA,OAAO,CAAC3H,MAAzB,EAAiC;;KADC;;;;UAO5BmW,QAAQ,GAAG7Y,IAAI,CAAC8Y,KAAL,CAAWzO,OAAO,CAAC,CAAD,CAAP,CAAW6N,WAAX,CAAuBnY,KAAlC,CAAjB;UACMgZ,SAAS,GAAG/Y,IAAI,CAAC8Y,KAAL,CAAWzO,OAAO,CAAC,CAAD,CAAP,CAAW6N,WAAX,CAAuBhY,MAAlC,CAAlB;UACM8Y,OAAO,GAAGhZ,IAAI,CAAC8Y,KAAL,CAAWzO,OAAO,CAAC,CAAD,CAAP,CAAW6N,WAAX,CAAuBvY,IAAlC,CAAhB;UACMsZ,MAAM,GAAGjZ,IAAI,CAAC8Y,KAAL,CAAWzO,OAAO,CAAC,CAAD,CAAP,CAAW6N,WAAX,CAAuBtY,GAAlC,CAAf;IACA+Y,aAAa,CAAC;MAAE5Y,KAAK,EAAE8Y,QAAT;MAAmB3Y,MAAM,EAAE6Y,SAA3B;MAAsCnZ,GAAG,EAAEqZ,MAA3C;MAAmDtZ,IAAI,EAAEqZ;KAA1D,CAAb;GAXF,CAF6B,CAAjC,CAJsD;;QAsBhDE,mBAAmB,GAAGC,iBAAW,CAAEC,OAAD,IAAa;QAC/CA,OAAJ,EAAa;MACXZ,gBAAgB,CAACY,OAAO,CAACb,aAAT,CAAhB;;GAFmC,EAIpC,EAJoC,CAAvC;EAMAc,eAAS,CAAC,MAAM;QACV,CAACd,aAAL,EAAoB;;;;IAGpBK,cAAc,CAACZ,OAAf,CAAuBO,aAAvB,EAJc;;WAMP,MAAMK,cAAc,CAACT,SAAf,CAAyBI,aAAzB,CAAb;GANO,EAON,CAACA,aAAD,EAAgBK,cAAhB,CAPM,CAAT,CA5BsD;;MAsClDF,UAAU,IAAI,IAAlB,EAAwB;WACf3L;MAAK,GAAG,EAAEmM;MAAjB;;;SAEK9F,QAAQ,CAACsF,UAAD,CAAf;;;ACjEF,SAASY,SAAT,CAAmBC,KAAnB,EAAkC7W,MAAlC,EAA4D;SACnD,IAAIO,KAAJ,CAAUP,MAAV,EAAkB8W,IAAlB,CAAuB,CAAvB,EAA0BC,GAA1B,CAA8B,CAACC,CAAD,EAAIC,KAAJ,KAAcJ,KAAK,GAAGI,KAApD,CAAP;;;;;;;AASF,AAAe,MAAMC,qBAAN,CAA4B;;yDACmB,EADnB;;kDAEQ,IAAInC,GAAJ,EAFR;;iDAGnB,CAHmB;;+DAIyB,EAJzB;;8CAMtB,CAAC7S,OAAD,EAAuBiV,MAAvB,EAAuCrW,KAAvC,KAAiE;UAC9EA,KAAK,GAAG,CAAZ,EAAe;cACP,IAAIsW,KAAJ,CAAU,wBAAV,CAAN;;;YAGIC,GAAqB,GAAGT,SAAS,CAAC,KAAKU,mBAAN,EAA2BxW,KAA3B,CAAvC;WACKwW,mBAAL,GAA2BC,IAAI,CAACF,GAAD,CAAJ,GAAY,CAAvC,CANkF;;UAS9EvW,KAAK,GAAG,CAAZ,EAAe;QACbuW,GAAG,CAAC3H,OAAJ,CAAY,CAAC8H,EAAD,EAAKP,KAAL,KAAe;eACpBQ,iCAAL,CAAuCD,EAAvC,IAA6CP,KAA7C;SADF;OAVgF;;;WAgB7E,MAAMO,EAAX,IAAiBH,GAAjB,EAAsB;aACfK,2BAAL,CAAiCF,EAAjC,IAAuCL,MAAvC;;;WAEGQ,oBAAL,CAA0B/Y,GAA1B,CAA8BuY,MAA9B,EAAsCjV,OAAtC,EAnBkF;;;YAsB5EtB,MAAM,GAAGyW,GAAG,CAACN,GAAJ,CAASS,EAAD,IAAQhU,QAAQ,CAACgU,EAAD,CAAxB,CAAf;aACO5W,MAAP;KA7BuC;;uDAgCZgX,cAAD,IAAsD;aACzE;QACLT,MAAM,EAAE,KAAKO,2BAAL,CAAiCE,cAAjC,CADH;QAELC,aAAa,EAAE,KAAKJ,iCAAL,CAAuCG,cAAvC;OAFjB;KAjCuC;;iDAuClBT,MAAD,IAAkC;aAC/C,KAAKQ,oBAAL,CAA0BzC,GAA1B,CAA8BiC,MAA9B,CAAP;KAxCuC;;;;;ACvB3C;;;;;;AAYA,AAAO,SAASW,MAAT,GAAgC;MACjCC,OAAJ;MACIC,MAAJ;QACMC,OAAY,GAAG,IAAIC,OAAJ,CAAY,CAACC,GAAD,EAAMC,GAAN,KAAc;IAC7CL,OAAO,GAAGI,GAAV;IACAH,MAAM,GAAGI,GAAT;GAFmB,CAArB;EAIAH,OAAO,CAACF,OAAR,GAAkBA,OAAlB;EACAE,OAAO,CAACD,MAAR,GAAiBA,MAAjB;SACOC,OAAP;;;ACrBF;AACA,AAUA;AACA,AAAe,SAASI,YAAT,CAAsBrJ,EAAtB,EAAsE;;MAE/EsJ,OAAO,GAAG,KAAd,CAFmF;;QAI7EC,SAAoD,GAAG,EAA7D;;WAESC,QAAT,CAAkB,GAAGC,IAArB,EAA2B;QACrBH,OAAJ,EAAa;YACLI,aAAa,GAAGZ,MAAM,EAA5B;MACAS,SAAS,CAACpJ,IAAV,CAAe;QAAEsJ,IAAF;QAAQR,OAAO,EAAES;OAAhC;aACOA,aAAP;;;WAEK7B,KAAK,CAAC,GAAG4B,IAAJ,CAAZ;;;WAGO5B,KAAT,CAAe,GAAG4B,IAAlB,EAAwB;IACtBH,OAAO,GAAG,IAAV;UAEML,OAAO,GAAGjJ,EAAE,CAAC,GAAGyJ,IAAJ,CAAF,CAAYE,OAAZ,CAAoB,MAAM;MACxCL,OAAO,GAAG,KAAV;MACAE,QAAQ,CAACI,cAAT,GAA0B3P,SAA1B;;UACIsP,SAAS,CAACvY,MAAd,EAAsB;cACd;UAAEiY,OAAO,EAAEY,WAAX;UAAwBJ,IAAI,EAAEK;YAAaP,SAAS,CAACQ,KAAV,EAAjD;QACAlC,KAAK,CAAC,GAAGiC,QAAJ,CAAL,CACGE,IADH,CACSlZ,MAAD,IAAY+Y,WAAW,CAACd,OAAZ,CAAoBjY,MAApB,CADpB,EAEGmZ,KAFH,CAEUrF,KAAD,IAAWiF,WAAW,CAACb,MAAZ,CAAmBpE,KAAnB,CAFpB;;KALY,CAAhB;IAUA4E,QAAQ,CAACI,cAAT,GAA0BX,OAA1B;WAEOA,OAAP;;;SAGKO,QAAP;;;ACuBF;;;AAGA,SAASU,OAAT,CAAoBhW,IAApB,EAA+BiW,GAA/B,EAA2E;QACnEjY,GAAG,GAAGiY,GAAG,CAACjW,IAAD,CAAf;SACO,OAAOhC,GAAP,KAAe,UAAf,GAA4BA,GAA5B,GAAkCgC,IAAI,CAAChC,GAAD,CAA7C;;;;;;AAOF,AAAO,MAAMkY,gBAAN,CAAuB;;;EAuB5Bpc,WAAW,CAAC;IACVqc,SADU;IAEVC,qBAFU;IAGV/Q,WAHU;IAIVgR,mBAJU;IAKVC;GALS,EAMS;uCA5Bc,IAAIlP,GAAJ,EA4Bd;;uCA3BiC,IAAIyK,GAAJ,EA2BjC;;wCA1B+B,IAAIA,GAAJ,EA0B/B;;;;yCAxBN,KAwBM;;yCAvBiB,IAAIA,GAAJ,EAuBjB;;oDAtB4B,IAAImC,qBAAJ,EAsB5B;;mDAlBhBjO,SAkBgB;;gDAhBiC,EAgBjC;;sCAf4B,EAe5B;;;;;;;;mDAXU,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAWV;;;;;;qCAiGV,CAACwQ,OAAD,EAAkBC,OAAlB,KAAsC;UAC1C,CAAC,KAAKC,eAAV,EAA2B;eAClB1Q,SAAP;;;YAGI;QAAE5L,KAAF;QAASG;UAAW,KAAK6b,SAA/B;aACO5G,eAAe,CAAC,KAAKkH,eAAL,CAAqBjH,MAAtB,EAA8B;QAClDlI,OAAO,EAAEiP,OADyC;QAElDhP,OAAO,EAAEiP,OAFyC;QAGlDrc,KAHkD;QAIlDG;OAJoB,CAAtB;KAvGkB;;qCA0JV,MAAM;UACVyL,SAAS,KAAK,KAAK2Q,MAAvB,EAA+B;aACxBA,MAAL,GAActJ,qBAAqB,CAAC,MAAM,KAAKuJ,KAAL,EAAP,CAAnC;OADF,MAEO;aACAC,WAAL,GAAmB,IAAnB;;KA9JgB;;wCAkKPzB,YAAY,CACvB,CACEoB,OADF,EAEEC,OAFF,EAGEK,yBAHF,EAIEC,qBAJF,KAKuD;UACjD,CAAC,KAAKL,eAAV,EAA2B;eAClBzB,OAAO,CAACF,MAAR,CAAe,IAAIZ,KAAJ,CAAU,+BAAV,CAAf,CAAP;;;YAEIqB,IAAI,GAAG,CAACgB,OAAD,EAAUC,OAAV,EAAmBK,yBAAnB,EAA8CC,qBAA9C,CAAb;YAEMC,oBAAoB,GAAG,KAAKC,qBAAlC;;UACID,oBAAJ,EAA0B;YACpBE,YAAY,CAACF,oBAAoB,CAACG,SAAtB,EAAiC3B,IAAjC,CAAhB,EAAwD;;;gBAGhD3Y,MAAM,GAAGma,oBAAoB,CAACna,MAArB,CAA4BiX,GAA5B,CAAgC,CAAC,CAACsD,gBAAD,EAAmBnY,OAAnB,CAAD,KAAiC,mBACzEmY,gBADyE,GAE9EnY,OAF8E,CAAjE,CAAf;iBAIOgW,OAAO,CAACH,OAAR,CAAgBjY,MAAhB,CAAP;;;aAEGoa,qBAAL,GAA6BjR,SAA7B;;;YAGI;QAAE/F,IAAF;gBAAQwP,SAAR;QAAgB4H;UAAS,KAAKX,eAApC;YACM;QAAEtc,KAAF;QAASG;UAAW,KAAK6b,SAA/B;YAEM/Z,CAAC,GAAGma,OAAV,CAvBqD;;YAyB/Cla,CAAC,GAAG/B,MAAM,GAAGkc,OAAnB,CAzBqD;;;MA6BrDY,IAAI,CAACC,MAAL,CAAYjd,IAAI,CAACkd,KAAL,CAAWnd,KAAX,CAAZ,EAA+BC,IAAI,CAACkd,KAAL,CAAWhd,MAAX,CAA/B;;aAEO,IAAI0a,OAAJ,CAAaH,OAAD,IAAa;;QAE9B7U,IAAI,CAAC;UAAEuX,WAAW,EAAEH;SAAhB,CAAJ,CAA4B,MAAM;;UAEhCpX,IAAI,CAACuJ,KAAL,CAAW;YAAEpM,KAAK,EAAEmD,QAAQ,CAAC,CAAD,CAAjB;YAAsB1B,KAAK,EAAE;WAAxC;cACI4Y,eAAe,GAAG,CAAtB;gBACMC,eAAe,GAAG,EAAxB;gBACMC,uBAAuB,GAAG,EAAhC;cACIC,OAAO,GAAG,CAAd;UAEAnI,SAAM,CAACoI,IAAP,CAAY,KAAKtP,WAAL,CAAiBhH,KAA7B,EAAoC,MAAM;;;;;eAKrC;kBACGqW,OAAO,IAAIb,qBAAf,EAAsC;;gBAEpC5M,OAAO,CAACwG,KAAR,CACG,OAAMoG,qBAAsB,qGAD/B;;;;cAKFa,OAAO;cACP3X,IAAI,CAACuJ,KAAL,CAAW;gBAAEpM,KAAK,EAAEmD,QAAQ,CAAC,CAAD,CAAjB;gBAAsB1B,KAAK,EAAE;eAAxC;;mBACKiZ,UAAL,CAAgB,IAAhB,EAAsBJ,eAAtB,EAVC;;;;;;;kBAiBGrb,CAAC,GAAGhC,IAAI,CAACkd,KAAL,CAAWnd,KAAX,CAAJ,IAAyBkC,CAAC,GAAGjC,IAAI,CAACkd,KAAL,CAAWhd,MAAX,CAA7B,IAAmD8B,CAAC,IAAI,CAAxD,IAA6DC,CAAC,IAAI,CAAtE,EAAyE;sBACjEyb,KAAK,GAAG,IAAIC,UAAJ,CAAe,CAAf,CAAd,CADuE;;gBAIvE/X,IAAI,CAACgY,IAAL,CAAU;kBACR5b,CADQ;kBAERC,CAFQ;kBAGRlC,KAAK,EAAE,CAHC;kBAIRG,MAAM,EAAE,CAJA;kBAKR6F,IAAI,EAAE2X;iBALR;gBAQAN,eAAe,GAAGhX,cAAc,CAACsX,KAAD,CAAhC;;sBACMX,gBAAgB,GAAG,KAAKc,sBAAL,CAA4BC,yBAA5B,CAAsDV,eAAtD,CAAzB,CAbuE;;;;oBAiBnEA,eAAe,GAAG,CAAlB,IAAuB,CAACL,gBAA5B,EAA8C;kBAC5CjN,OAAO,CAACwG,KAAR,CACG,wCAAuC8G,eAAgB,oFAD1D;iBAlBqE;;;;oBAyBrEC,eAAe,CAACU,IAAhB,CACE,CAAC;kBAAElE,MAAF;kBAAUU;iBAAX,KACEV,MAAM,KAAKkD,gBAAgB,CAAClD,MAA5B,IAAsCU,aAAa,KAAKwC,gBAAgB,CAACxC,aAF7E,CADF,EAKE;kBACAzK,OAAO,CAACwG,KAAR,CACG,8FADH,EAEEyG,gBAFF;;;;oBAOEK,eAAe,GAAG,CAAlB,IAAuBL,gBAAgB,CAAClD,MAA5C,EAAoD;wBAC5CjV,OAAO,GAAG,KAAKiZ,sBAAL,CAA4BG,mBAA5B,CAAgDjB,gBAAgB,CAAClD,MAAjE,CAAhB;;kBACAwD,eAAe,CAACxL,IAAhB,CAAqBkL,gBAArB;;sBACInY,OAAJ,EAAa;oBACX0Y,uBAAuB,CAACzL,IAAxB,CAA6B,CAACkL,gBAAD,EAAmBnY,OAAnB,CAA7B;;;eA1DL;;;aAAH,QAgESwY,eAAe,KAAK,CAApB,IAAyBX,yBAhElC;;iBAkEKG,qBAAL,GAA6B;cAC3BE,SAAS,EAAE3B,IADgB;cAE3B3Y,MAAM,EAAE8a;aAFV;YAIA7C,OAAO,CAAC6C,uBAAD,CAAP;WA3EF;SARF;OAFK,CAAP;KArCqB,CAlKL;;wCAmSP,CAACW,QAAD,EAAqBZ,eAArB,KAA8D;UACrEY,QAAJ,EAAc;aACPJ,sBAAL,GAA8B,IAAIjE,qBAAJ,EAA9B;;;YAGIsE,SAAS,GAAGjb,KAAK,CAACkb,IAAN,CAAW,KAAKC,UAAL,CAAgBC,MAAhB,EAAX,EAAqCC,IAArC,CAA0C,CAACxc,CAAD,EAAID,CAAJ,KAAU,CAACC,CAAC,CAAC6U,UAAF,IAAgB,CAAjB,KAAuB9U,CAAC,CAAC8U,UAAF,IAAgB,CAAvC,CAApD,CAAlB;MACAuH,SAAS,CAAC9L,OAAV,CAAmBmM,SAAD,IAA0B;cACpC;UAAElI,WAAF;UAAejD,QAAf;UAAyB2D,QAAzB;UAAmCH;YAAyB2H,SAAlE;;YACI,CAACnL,QAAL,EAAe;iBACNtD,OAAO,CAAC0O,KAAR,CAAe,GAAEP,QAAQ,GAAG,QAAH,GAAc,EAAG,gCAA1C,EAA2EM,SAA3E,CAAP;;;cAEI1C,GAAG,GAAG,KAAK4C,SAAL,CAAe7G,GAAf,CAAmBvB,WAAnB,CAAZ;;YACI,CAACwF,GAAL,EAAU;iBACD/L,OAAO,CAACC,IAAR,CAAa,iCAAb,EAAgDgH,QAAQ,GAAGA,QAAQ,CAACrX,WAAT,CAAqBgf,WAAxB,GAAsC,SAA9F,CAAP;SAPwC;;;YAUtCT,QAAQ,IAAIrH,oBAAhB,EAAsC;gBAC9B+H,kBAAsC,GAAG,CAAC,GAAGC,IAAJ,KAAa;mBACnD,KAAKf,sBAAL,CAA4BgB,gBAA5B,CAA6C9H,QAA7C,EAAuD,GAAG6H,IAA1D,CAAP;WADF;;gBAGME,WAAW,GAAGlI,oBAAoB,CAACxD,QAAD,EAAWuL,kBAAX,EAA+BtB,eAAe,IAAI,EAAlD,CAAxC;;cACIyB,WAAJ,EAAiB;YACfjD,GAAG,CAACiD,WAAD,EAAc,IAAd,CAAH;;SANJ,MAQO,IAAI,CAACb,QAAL,EAAe;UACpBpC,GAAG,CAACzI,QAAD,EAAW,KAAX,CAAH;;OAnBJ;KAzSkB;;0CAiUJxN,IAAD,IAAe;;;MAG5BA,IAAI,CAACmZ,IAAL;MACAnZ,IAAI,CAACuJ,KAAL,CAAW;QACTpM,KAAK,EAAE,KAAKiZ,qBADH;QAETxX,KAAK,EAAE;OAFT;KArUkB;;;SAEbuX,SAAL,GAAiBA,SAAjB;SACKC,qBAAL,GAA6BA,qBAA7B;SACKE,iBAAL,GAAyBA,iBAAzB;SACKhO,WAAL,GAAmB,IAAIlE,WAAJ,CAAiBiB,WAAD,IAA8B;UAC3DgR,mBAAJ,EAAyB;QACvBA,mBAAmB,CAAChR,WAAD,CAAnB;OADF,MAEO;;aAEAsR,KAAL;;KALe,EAOhBtR,WAPgB,CAAnB;;;EAUF+T,UAAU,CAACC,MAAD,EAA4B;QAChC,KAAK5C,eAAT,EAA0B;YAClB,IAAIvC,KAAJ,CAAU,+BAAV,CAAN;;;UAGIlU,IAAI,GAAG,KAAKsZ,mBAAL,CACXC,UAAU,CAAC;MACTF,MADS;MAETG,UAAU,EAAE,KAAKlD,iBAAL,IAA0B,EAF7B;MAGTmD,UAAU,EAAE,CACV,wBADU,EAEV,mBAFU,EAGV,wBAHU,EAIV,0BAJU,CAHH;MASTC,OAAO,EAAEzL,UAAU,OAAO;KATlB,CADC,CAAb,CALoC;;;SAmB/B0L,SAAL,CAAenN,OAAf,CAAwBoN,iBAAD,IAAuB;YACtCC,eAAe,GAAG7D,OAAO,CAAChW,IAAD,EAAO4Z,iBAAP,CAA/B;;WACKf,SAAL,CAAend,GAAf,CAAmBke,iBAAnB,EAAsCC,eAAtC;KAFF;;UAKM5U,MAAM,GAAG+Q,OAAO,CAAChW,IAAD,EAAOwP,MAAP,CAAtB;UACMsK,qBAAqB,GAAG,IAAI7U,MAAJ,EAA9B,CAzBoC;;UA2B9B8U,GAAG,GAAG/Z,IAAI,CAACuX,WAAL,CAAiB;MAC3Bpd,KAAK,EAAEC,IAAI,CAAC8Y,KAAL,CAAW,KAAKiD,SAAL,CAAehc,KAA1B,CADoB;MAE3BG,MAAM,EAAEF,IAAI,CAAC8Y,KAAL,CAAW,KAAKiD,SAAL,CAAe7b,MAA1B;KAFE,CAAZ;SAKKmc,eAAL,GAAuB;MACrBW,IAAI,EAAE2C,GADe;MAErBvK,MAAM,EAAEsK,qBAFa;MAGrB9Z;KAHF;;;EAOFga,OAAO,GAAG;QACJ,KAAKvD,eAAT,EAA0B;WACnBA,eAAL,CAAqBzW,IAArB,CAA0Bga,OAA1B;;;QAEE,KAAKtD,MAAT,EAAiB;MACfpJ,oBAAoB,CAAC,KAAKoJ,MAAN,CAApB;;GAxFwB;;;EA6F5B/F,OAAO,CAACQ,QAAD,EAAiCnS,OAAjC,EAA2D;UAC1D;MAAEyX;QAAoB,IAA5B,CADgE;;QAG5D,CAACA,eAAD,IAAoB,KAAKkD,SAAL,CAAehP,GAAf,CAAmB3L,OAAnB,CAAxB,EAAqD;;;;SAGhD2a,SAAL,CAAe5U,GAAf,CAAmB/F,OAAnB,EANgE;;;SAS3D6Z,SAAL,CAAend,GAAf,CAAmBsD,OAAnB,EAA4BgX,OAAO,CAACS,eAAe,CAACzW,IAAjB,EAAuBhB,OAAvB,CAAnC;GAtG0B;;;EA0G5B8R,SAAS,CAACK,QAAD,EAAiC;SACnCqH,UAAL,CAAgBpP,MAAhB,CAAuB+H,QAAvB;;;EAGF8I,uBAAuB,CAACC,OAAD,EAAmB;SACnCC,WAAL,CAAiB/Q,MAAjB,CAAwB8Q,OAAxB;;;EAGFhJ,gBAAgB,CAACyH,SAAD,EAAuB;SAChCH,UAAL,CAAgB9c,GAAhB,CAAoBid,SAAS,CAACxH,QAA9B,EAAwCwH,SAAxC;;;EAGFyB,qBAAqB,CAACF,OAAD,EAAmB;SACjCC,WAAL,CAAiBze,GAAjB,CAAqBwe,OAArB,EAA8BA,OAA9B;;;EAGFG,YAAY,CAAClE,SAAD,EAAwB;SAC7BA,SAAL,GAAiBA,SAAjB;;;EAiBFQ,KAAK,GAAG;QACF;WACG2D,MAAL;KADF,CAEE,OAAO5J,KAAP,EAAc;;;UAGVA,KAAK,CAAC6J,OAAN,KAAkB,qBAAtB,EAA6C;QAC3CrQ,OAAO,CAACC,IAAR,CAAauG,KAAb;OADF,MAEO;cACCA,KAAN;;;;;EAKN4J,MAAM,GAAG;SACF1D,WAAL,GAAmB,KAAnB;UACMjD,KAAK,GAAG6G,IAAI,CAACC,GAAL,EAAd;SACKC,kBAAL,CAAwBlO,OAAxB,CAAiCyJ,GAAD,IAAUA,GAAG,CAAC0E,KAAJ,CAAU/c,KAAV,GAAkB,CAA5D;;QACI,CAAC,KAAK6Y,eAAV,EAA2B;;;;SAGtBO,qBAAL,GAA6B,IAA7B,CAPO;;UAQD;MAAEhX,IAAF;cAAQwP;QAAW,KAAKiH,eAA9B;;SACKmE,YAAL,CAAkB5a,IAAlB;;IACAwP,SAAM,CAACoI,IAAP,CAAY,KAAKtP,WAAL,CAAiBhH,KAA7B,EAAoC,MAAM;YAClClF,CAAC,GAAGoe,IAAI,CAACC,GAAL,EAAV;;WACK5C,UAAL;;WACKgD,QAAL,CAAclE,KAAd,GAAsB6D,IAAI,CAACC,GAAL,KAAare,CAAnC;KAHF;;SAMK+d,WAAL,CAAiB3N,OAAjB,CAA0BsO,SAAD,IAAe;MACtCA,SAAS;KADX;;SAGKD,QAAL,CAActN,MAAd,GAAuBiN,IAAI,CAACC,GAAL,KAAa9G,KAApC,CAnBO;;;QAsBH,KAAKiD,WAAT,EAAsB;WACfF,MAAL,GAActJ,qBAAqB,CAAC,MAAM,KAAKuJ,KAAL,EAAP,CAAnC;KADF,MAEO;WACAD,MAAL,GAAc3Q,SAAd;;;;EAqLJuT,mBAAmB,CAACtZ,IAAD,EAAY;QACzBiO,UAAU,OAAO,YAArB,EAAmC;aAC1BjO,IAAP;;;WAEK,IAAI+a,KAAJ,CAAU/a,IAAV,EAAgB;MACrBgb,KAAK,EAAE,CAACnY,MAAD,EAASoY,OAAT,EAAkB1F,IAAlB,KAA2B;cAC1BvW,OAAO,GAAG6D,MAAM,CAAC,GAAG0S,IAAJ,CAAtB;;YACI,OAAOvW,OAAO,CAAC2b,KAAf,KAAyB,QAA7B,EAAuC;eAChCD,kBAAL,CAAwBzO,IAAxB,CAA6BjN,OAA7B;;;eAEKA,OAAP;;KANG,CAAP;;;;;AC/ZJ,MAAMkc,wBAAwB,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAjC;AACA,AAAO,MAAMC,0BAA0B,GAAG,CAAnC;AACP,MAAMC,mCAAmC,GAAG,GAA5C;;AA0CA,SAASC,+BAAT,CACEhK,OADF,EAEEC,GAFF,EAGE7J,CAHF,EAIEpD,OAJF,EAKE;QACMkR,IAAI,GAAG;IAAEjE,GAAF;IAAOD;GAApB;;MAEI;IACFhN,OAAO,CAACoD,CAAD,EAAI8N,IAAJ,CAAP;GADF,CAEE,OAAO+F,GAAP,EAAY;IACZpR,OAAO,CAACwG,KAAR,CAAc,4BAAd,EAA4C4K,GAA5C;;;;;;AAMJ,AAAO,MAAMC,aAAN,SAA4BpU,eAA5B,CAA8D;EAcnErN,WAAW,CAAC6E,KAAD,EAAmB;UACtBA,KAAN;;qCAd+CwI,eAAA,EAanB;;6CAZwBA,eAAA,EAYxB;;;;2CAVa,IAUb;;uDAmGF,CAACM,CAAD,EAA4C8J,cAA5C,KAA+E;UACrGA,cAAc,KAAK,eAAvB,EAAwC;aACjCiK,cAAL,CAAoB/T,CAApB,EAAuB,IAAvB;OADF,MAEO,IAAI8J,cAAc,KAAK,aAAvB,EAAsC;aACtC3D,YAAL,CAAkBnG,CAAlB,EAAqB,IAArB;OADK,MAEA,IAAI8J,cAAc,KAAK,aAAvB,EAAsC;aACtCkK,YAAL,CAAkBhU,CAAlB,EAAqB,IAArB;OADK,MAEA,IAAI8J,cAAc,KAAK,WAAvB,EAAoC;aACpC1D,UAAL,CAAgBpG,CAAhB,EAAmB,IAAnB;;KA3G0B;;4CA+Gb,CAACA,CAAD,EAA4CiU,mBAA5C,KAA6E;WACvFC,mBAAL,CAAyBlU,CAAzB,EAA4B,eAA5B,EAA6CiU,mBAA7C;KAhH4B;;0CAmHf,CAACjU,CAAD,EAA4CiU,mBAA5C,KAA6E;WACrFE,aAAL,GAAqB;QAAExf,CAAC,EAAEqL,CAAC,CAACH,OAAP;QAAgBjL,CAAC,EAAEoL,CAAC,CAACF;OAA1C;;WACKoU,mBAAL,CAAyBlU,CAAzB,EAA4B,aAA5B,EAA2CiU,mBAA3C;KArH4B;;0CAwHf,CAACjU,CAAD,EAA4CiU,mBAA5C,KAA6E;WACrFC,mBAAL,CAAyBlU,CAAzB,EAA4B,aAA5B,EAA2CiU,mBAA3C;KAzH4B;;wCA4HjB,CAACjU,CAAD,EAA4CiU,mBAA5C,KAA6E;WACnFC,mBAAL,CAAyBlU,CAAzB,EAA4B,WAA5B,EAAyCiU,mBAAzC;;YACM;QAAEE;UAAkB,IAA1B;;UACIA,aAAJ,EAAmB;cACXC,MAAM,GAAGpU,CAAC,CAACH,OAAF,GAAYsU,aAAa,CAACxf,CAAzC;cACM0f,MAAM,GAAGrU,CAAC,CAACF,OAAF,GAAYqU,aAAa,CAACvf,CAAzC;cACMsF,WAAQ,GAAGvH,IAAI,CAAC2hB,IAAL,CAAUF,MAAM,GAAGA,MAAT,GAAkBC,MAAM,GAAGA,MAArC,CAAjB;;YACIna,WAAQ,GAAGwZ,0BAAf,EAA2C;eACpCQ,mBAAL,CAAyBlU,CAAzB,EAA4B,SAA5B,EAAuCiU,mBAAvC;;;aAEGE,aAAL,GAAqB,IAArB;;KAtI0B;;iDA0IR,CACpBnU,CADoB,EAEpB8J,cAFoB,EAGpBmK,mBAHoB,KAIjB;YACG;QAAEM;UAAqB,KAAK1a,KAAlC;YACM2a,gBAAgB,GAAG,KAAKtd,KAAL,CAAW4S,cAAX,CAAzB,CAFG;;;;UAOC,CAACmK,mBAAD,KAAyB,EAAEjU,CAAC,CAAC5E,MAAF,YAAoBsJ,MAAM,CAAC+P,WAA7B,KAA6CzU,CAAC,CAACI,MAAF,KAAa,CAAnF,CAAJ,EAA2F;;OAPxF;;;YAYG;QAAE7N,GAAG,EAAEmiB,SAAP;QAAkBpiB,IAAI,EAAEqiB;UAAe3U,CAAC,CAAC5E,MAAF,CAASkF,qBAAT,EAA7C;YACM;QAAET,OAAF;QAAWC;UAAYE,CAA7B;YAEM8O,OAAO,GAAGjP,OAAO,GAAG8U,UAA1B;YACM5F,OAAO,GAAGjP,OAAO,GAAG4U,SAA1B;YACM7K,GAAG,GAAG0K,gBAAgB,CAACK,OAAjB,CAAyB9F,OAAzB,EAAkCC,OAAlC,CAAZ;;UACI,CAAClF,GAAL,EAAU;;OAlBP;;;;;YAyBG;QAAEgL,iBAAF;QAAqBC,sBAAsB,GAAGD,iBAAiB,GAAG,EAAH,GAAQ,CAAC,aAAD;UAAoB,KAAK3d,KAAtG;;UACI4d,sBAAsB,CAACC,QAAvB,CAAgCjL,cAAhC,CAAJ,EAAqD;YAC/C0K,gBAAJ,EAAsB;iBACbZ,+BAA+B,CAAC,EAAD,EAAK/J,GAAL,EAAU7J,CAAV,EAAawU,gBAAb,CAAtC;;;;OA5BD;;;MAkCFxU,CAAD,CAASgV,OAAT;MACAT,gBAAgB,CACbU,UADH,CACcnG,OADd,EACuBC,OADvB,EACgC,CAAC,CAAC,KAAK7X,KAAL,CAAWkY,yBAD7C,EACwE,KAAKlY,KAAL,CAAWmY,qBADnF,EAEGhB,IAFH,CAES4B,uBAAD,IAA6B;cAC3BiF,oBAAgE,GAAGjL,SAAS,CAACgG,uBAAD,CAAlF;;aACK,MAAM,CAAC1Y,OAAD,EAAU4d,WAAV,CAAX,IAAqCD,oBAAoB,CAAClY,OAArB,EAArC,EAAqE;UACnEzF,OAAO,CAACoS,gBAAR,CAAyBwL,WAAzB,EAAsCtL,GAAtC,EAA2C7J,CAA3C,EAA8C8J,cAA9C;;cACI9J,CAAC,CAACoV,oBAAF,EAAJ,EAA8B;;;;;YAI5BZ,gBAAgB,IAAI,CAACxU,CAAC,CAACoV,oBAAF,EAAzB,EAAmD;gBAC3CD,WAAW,GAAGlF,uBAAuB,CAAC7D,GAAxB,CAA4B,CAAC,CAACsD,gBAAD,CAAD,KAAwBA,gBAApD,CAApB;UACAkE,+BAA+B,CAACuB,WAAD,EAActL,GAAd,EAAmB7J,CAAnB,EAAsBwU,gBAAtB,CAA/B;;OAZN,EAeGlG,KAfH,CAeUtO,CAAD,IAAO;QACZyC,OAAO,CAACwG,KAAR,CAAcjJ,CAAd;OAhBJ;KAjL4B;;UAEtB;MACJtN,KADI;MAEJG,MAFI;MAGJN,GAHI;MAIJD,IAJI;MAKJ+iB,eALI;MAMJzG,mBANI;MAOJhR,WAPI;MAQJ0X,kBARI;MASJT,iBAAiB,EAAjBA,kBATI;MAUJC,sBAAsB,EAAtBA,uBAVI;MAWJlD;QACE1a,KAZJ;;QAaI0a,MAAJ,EAAY;WACL2D,OAAL,CAAaC,OAAb,GAAuB5D,MAAvB;;;QAEEhD,mBAAJ,EAAyB;UACnB,CAAChR,WAAL,EAAkB;QAChB6E,OAAO,CAACC,IAAR,CACE,4LADF;;;UAIE9E,WAAW,IAAI0X,kBAAnB,EAAuC;QACrC7S,OAAO,CAACC,IAAR,CAAa,iGAAb;;KAPJ,MASO;UACD9E,WAAJ,EAAiB;QACf6E,OAAO,CAACC,IAAR,CACE,2MADF;;;;QAMAmS,kBAAJ,EAAuB;UACjBC,uBAAJ,EAA4B;cACpB,IAAIrI,KAAJ,CACJ,gHADI,CAAN;OADF,MAIO;QACLhK,OAAO,CAACC,IAAR,CACE,oGADF;;;;SAMC7I,KAAL,GAAa;MACX0a,gBAAgB,EAAE,IAAI9F,gBAAJ,CAAqB;QACrCC,SAAS,EAAE;UAAEhc,KAAF;UAASG,MAAT;UAAiBN,GAAjB;UAAsBD;SADI;QAErCqc,qBAAqB,EAAE0G,eAAe,IAAI5B,wBAFL;;QAIrC7V,WAAW,EAAE1G,KAAK,CAAC0G,WAAN,IAAqB1G,KAAK,CAACoe,kBAA3B,IAAiDpZ,oBAJzB;QAKrC0S,mBAAmB,EAAE1X,KAAK,CAAC0X,mBAAN,IAA6BtQ,SALb;QAMrCuQ,iBAAiB,EAAE3X,KAAK,CAAC2X,iBAAN,IAA2B;OAN9B;KADpB;;;SAYK4G,wBAAP,CAAgC;IAAE/iB,KAAF;IAASG,MAAT;IAAiBN,GAAjB;IAAsBD;GAAtD,EAAyE;IAAEiiB;GAA3E,EAAsG;IACpGA,gBAAgB,CAAC3B,YAAjB,CAA8B;MAAElgB,KAAF;MAASG,MAAT;MAAiBN,GAAjB;MAAsBD;KAApD;WACO,IAAP;;;EAGF4R,iBAAiB,GAAG;QACd,CAAC,KAAKqR,OAAL,CAAaC,OAAlB,EAA2B;aAClB/S,OAAO,CAACC,IAAR,CAAa,wBAAb,CAAP;;;UAEI;MAAE6R;QAAqB,KAAK1a,KAAlC;IACA0a,gBAAgB,CAAC5C,UAAjB,CAA4B,KAAK4D,OAAL,CAAaC,OAAzC,EALkB;;SAObE,QAAL,CAAc,EAAd,EAPkB;;;;IAUlBnB,gBAAgB,CAACrF,KAAjB;;;EAGFpK,oBAAoB,GAAG;QACjB,KAAK6Q,KAAT,EAAgB;MACd9P,oBAAoB,CAAC,KAAK8P,KAAN,CAApB;;;SAEG9b,KAAL,CAAW0a,gBAAX,CAA4BhC,OAA5B;;;EAGFnJ,kBAAkB,GAAG;UACb;MAAEmL;QAAqB,KAAK1a,KAAlC,CADmB;;QAGf,KAAK3C,KAAL,CAAW0G,WAAf,EAA4B;MAC1B2W,gBAAgB,CAAC1T,WAAjB,CAA6B5D,cAA7B,CAA4C,KAAK/F,KAAL,CAAW0G,WAAvD;;;IAEF2W,gBAAgB,CAACqB,OAAjB;;;EAGFvV,KAAK,GAAG;QACF,KAAKwV,eAAL,CAAqBL,OAAzB,EAAkC;WAC3BK,eAAL,CAAqBL,OAArB,CAA6BnV,KAA7B;;;;EAsGJyV,YAAY,GAAG;UACP;MAAEvB;QAAqB,KAAK1a,KAAlC;UACMmV,eAAe,GAAGuF,gBAAgB,CAACvF,eAAzC;;QAEIxI,UAAU,OAAO,YAAjB,IAAiC,CAACwI,eAAtC,EAAuD;aAC9C,IAAP;;;UAEI;MAAEzW;QAASyW,eAAjB;UACM+G,GAAG,GAAGrR,MAAM,CAACsR,WAAP,CAAmBC,MAA/B;UACMC,KAAK,GAAG;MACZzjB,MAAM,EAAE,CADI;MAEZD,KAAK,EAAE,EAFK;MAGZE,KAAK,EAAE,GAHK;MAIZoF,QAAQ,EAAE,UAJE;MAKZud,eAAe,EAAE,oBALL;MAMZ3f,KAAK,EAAE,OANK;MAOZygB,UAAU,EAAE,WAPA;MAQZC,QAAQ,EAAE;KARZ;UAUM;MAAEhD,QAAF;MAAYH;QAAuBsB,gBAAzC;UACM7b,IAAI,GAAG2d,SAAS,CAACjD,QAAD,EAAY5d,GAAD,IAAU,GAAEA,GAAI,KAA3B,CAAtB;IACAkD,IAAI,CAAC,YAAD,CAAJ,GAAqBua,kBAAkB,CAACqD,MAAnB,CAA0B,CAACC,KAAD,EAAQ/H,GAAR,KAAgB+H,KAAK,GAAG/H,GAAG,CAAC0E,KAAJ,CAAU/c,KAA5D,EAAmE,CAAnE,CAArB;;QACI4f,GAAJ,EAAS;MACPrd,IAAI,CAAC,WAAD,CAAJ,GAAqB,GAAE,CAAEqd,GAAG,CAACS,cAAJ,GAAqBT,GAAG,CAACU,eAA1B,GAA6C,GAA9C,EAAmD1gB,OAAnD,CAA2D,CAA3D,CAA8D,GAArF;;;IAGFwD,MAAM,CAACmd,MAAP,CAAche,IAAd,EAAoBie,MAAM,CAACpe,IAAI,CAAC2a,KAAN,EAAc1d,GAAD,IAAS,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,CAAzD,CAA1B;;QACI+C,IAAI,CAAC2a,KAAL,CAAW0D,WAAX,GAAyB,IAA7B,EAAmC;YAC3B,IAAInK,KAAJ,CAAU,mCAAV,CAAN;;;UAGIoK,IAAI,GAAGtd,MAAM,CAACud,IAAP,CAAYpe,IAAZ,EAAkB0T,GAAlB,CAAuBtP,GAAD,IAAS;aAExCkJ;QAAI,GAAG,EAAElJ,GAAT;QAAc,KAAK,EAAE;UAAEuY,eAAe,EAAE,aAAnB;UAAkC0B,MAAM,EAAE;;SAC7D/Q;QAAI,KAAK,EAAE;UAAEgR,YAAY,EAAE,EAAhB;UAAoBD,MAAM,EAAE;;SAAWja,GAAlD,CADF,EAEEkJ;QAAI,KAAK,EAAE;UAAEtT,KAAK,EAAE,MAAT;UAAiBqkB,MAAM,EAAE;;SAAWre,IAAI,CAACoE,GAAD,CAAnD,CAFF,CADF;KADW,CAAb;WASEkJ;MAAO,KAAK,EAAEkQ;OACZlQ,mCAAQ6Q,IAAR,CADF,CADF;;;EAOF/Q,MAAM,GAAG;UACD;MACJpT,KADI;MAEJG,MAFI;MAGJokB,SAHI;MAIJ9U,MAJI;MAKJC,SALI;MAMJ8T,KANI;MAOJtY,WAPI;MAQJgR,mBARI;MASJsI,eATI;MAUJtF;QACE,KAAK1a,KAXT;UAYM;MAAEqd;QAAqB,KAAK1a,KAAlC,CAbO;;;UAgBDsd,aAAa,GAAGvZ,WAAW,IAAI,CAACgR,mBAAtC;UACMwI,WAAW,GAAGF,eAAe,IAAI,CAAvC;UACMG,UAAU,GAAGzF,MAAM,GAAG,IAAH,GACvB5L,oBAACsR,cAAD,QACEtR;MACE,KAAK,EAAE;QAAEtT,KAAF;QAASG,MAAT;QAAiB0kB,QAAQ,EAAE,MAA3B;QAAmCC,SAAS,EAAE;OADvD;MAEE,KAAK,EAAE9kB,KAAK,GAAG0kB,WAFjB;MAGE,MAAM,EAAEvkB,MAAM,GAAGukB,WAHnB;MAIE,GAAG,EAAE,KAAK7B,OAJZ;MAKE,SAAS,EAAE,KAAKnP,UALlB;MAME,WAAW,EAAE,KAAKD,YANpB;MAOE,aAAa,EAAE,KAAK4N,cAPtB;MAQE,WAAW,EAAE,KAAKC;MATtB,EAWGiD,SAAS,IAAI,KAAKnB,YAAL,EAXhB,CADF;WAiBE9P;MAAK,KAAK;QAAIlO,QAAQ,EAAE,UAAd;QAA0B2f,QAAQ,EAAE;SAAavB,KAAjD;OAEPiB,aAAa,GACZE,UADY,GAGZrR,oBAAC,cAAD;MACE,WAAW,EAAEuO,gBAAgB,CAAC1T,WADhC;MAEE,MAAM,EAAEsB,MAFV;MAGE,SAAS,EAAEC,SAHb;MAIE,GAAG,EAAG8D,EAAD,IAAS,KAAK2P,eAAL,CAAqBL,OAArB,GAA+BtP;OAC5CmR,UALH,CALJ,EAaG9C,gBAAgB,CAACvF,eAAjB,IACChJ,oBAAC,qBAAD,CAAuB,QAAvB;MAAgC,KAAK,EAAEuO;OACpC,KAAKrd,KAAL,CAAW6O,QADd,CAdJ,CADF;;;;;gBAnSS+N,+BAMW;EACpBzE,qBAAqB,EAAEsE,mCADH;EAEpB0B,eAAe,EAAE5B,wBAFG;EAGpBrR,SAAS,EAAE,IAHS;EAIpB8T,KAAK,EAAE,EAJa;EAKpBgB,eAAe,EAAE;;;AAkTrB,MAAMQ,SAAS,GAAGhY,gBAAA,CAA2B,CAACxI,KAAD,EAAeygB,GAAf,KAC3C3R,oBAAC4R,UAAD,QACG,CAAC;EAAEllB,KAAF;EAASG,MAAT;EAAiBP,IAAjB;EAAuBC;CAAxB,KACCyT,oBAAC,aAAD;EAAe,KAAK,EAAEtT,KAAtB;EAA6B,MAAM,EAAEG,MAArC;EAA6C,IAAI,EAAEP,IAAnD;EAAyD,GAAG,EAAEC,GAA9D;EAAmE,GAAG,EAAEolB;GAASzgB,KAAjF,EAFJ,CADgB,CAAlB;AAQAwgB,SAAS,CAACrG,WAAV,GAAwB,WAAxB;;AC9ZA;;;;;;AASA,MAAMwG,KAAN,CAAY;EAIVxlB,WAAW,GAAG;;;;;SACP6K,GAAL,GAAW4a,MAAM,CAACC,gBAAlB;SACKrb,GAAL,GAAWob,MAAM,CAACE,gBAAlB;GANQ;;;EASVC,MAAM,CAAClb,KAAD,EAAgB;SACfG,GAAL,GAAWvK,IAAI,CAACuK,GAAL,CAAS,KAAKA,GAAd,EAAmBH,KAAnB,CAAX;SACKL,GAAL,GAAW/J,IAAI,CAAC+J,GAAL,CAAS,KAAKA,GAAd,EAAmBK,KAAnB,CAAX;;;;;;AAKJ,AAAe,MAAMmb,MAAN,CAAa;EAK1B7lB,WAAW,GAAG;;;;;;;SACPsC,CAAL,GAAS,IAAIkjB,KAAJ,EAAT;SACKjjB,CAAL,GAAS,IAAIijB,KAAJ,EAAT;SACKhjB,CAAL,GAAS,IAAIgjB,KAAJ,EAAT;GARwB;;;EAY1BI,MAAM,CAAC7Z,KAAD,EAAe;SACdzJ,CAAL,CAAOsjB,MAAP,CAAc7Z,KAAK,CAACzJ,CAApB;SACKC,CAAL,CAAOqjB,MAAP,CAAc7Z,KAAK,CAACxJ,CAApB;SACKC,CAAL,CAAOojB,MAAP,CAAc7Z,KAAK,CAACvJ,CAApB;;;;;ACxCJ;AACA,AASA,MAAMsjB,OAAO,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,CAAhB;;;AAIA,AAAe,SAASC,mBAAT,CAA6B9kB,GAA7B,EAA4C+kB,CAA5C,EAA2D;QAClE9c,CAAC,GAAG+c,aAAI,CAAC5c,QAAL,CAAcyc,OAAd,EAAuBE,CAAvB,CAAV;QACME,GAAG,GAAGhd,CAAC,CAAC,CAAD,CAAb;QAAkBid,GAAG,GAAGjd,CAAC,CAAC,CAAD,CAAzB;QAA8Bkd,GAAG,GAAGld,CAAC,CAAC,CAAD,CAArC,CAFwE;;QAGtDmd,GAAG,GAAGnd,CAAC,CAAC,CAAD,CAAzB;QAA8Bod,GAAG,GAAGpd,CAAC,CAAC,CAAD,CAArC,CAHwE;;QAItDqd,GAAG,GAAGrd,CAAC,CAAC,CAAD,CAAzB;QAA8Bsd,GAAG,GAAGtd,CAAC,CAAC,CAAD,CAArC,CAJwE;;EAMxEjI,GAAG,CAAC,CAAD,CAAH,GAASX,IAAI,CAACmmB,IAAL,CAAUL,GAAG,GAAG,CAAC,CAAP,GAAW,CAAC,CAAZ,GAAgBA,GAAG,GAAG,CAAN,GAAU,CAAV,GAAcA,GAAxC,CAAT;;MACI9lB,IAAI,CAACC,GAAL,CAAS6lB,GAAT,IAAgB,OAApB,EAA6B;IAC3BnlB,GAAG,CAAC,CAAD,CAAH,GAASX,IAAI,CAACiI,KAAL,CAAW,CAAC+d,GAAZ,EAAiBE,GAAjB,CAAT;IACAvlB,GAAG,CAAC,CAAD,CAAH,GAASX,IAAI,CAACiI,KAAL,CAAW,CAAC4d,GAAZ,EAAiBD,GAAjB,CAAT;GAFF,MAGO;IACLjlB,GAAG,CAAC,CAAD,CAAH,GAASX,IAAI,CAACiI,KAAL,CAAWge,GAAX,EAAgBF,GAAhB,CAAT;IACAplB,GAAG,CAAC,CAAD,CAAH,GAAS,CAAT;;;SAEMA,GAAR;;;AC5BF;AACA,AASA;;AACA,oBAAe,CAACylB,SAAD,EAAoBC,QAApB,KAA0CzgB,IAAD,IAA4B;QAC5E0gB,WAAW,GAAG7jB,YAAY,CAAC0b,IAAb,CAAkB,GAAGoI,MAAH,CAAU,GAAGH,SAAb,CAAlB,CAApB;;MAEIC,QAAQ,CAACtI,IAAT,CAAeyI,IAAD,IAAUA,IAAI,CAACzI,IAAL,CAAWpb,CAAD,IAAOA,CAAC,GAAG,CAAJ,IAASA,CAAC,IAAI,KAAK,EAApC,CAAxB,CAAJ,EAAsE;UAC9D,IAAImX,KAAJ,CAAU,wCAAV,CAAN;;;QAEI2M,aAAa,GAAGC,WAAW,CAACvI,IAAZ,CAAiB,GAAGoI,MAAH,CAAU,GAAGF,QAAb,CAAjB,CAAtB;QAEMM,IAAI,GAAG/gB,IAAI,CAACC,MAAL,CAAY;;IAEvBC,KAAK,EAAE,SAFgB;IAGvBC,IAAI,EAAE;GAHK,CAAb;QAKM6gB,SAAS,GAAGjhB,WAAW,CAACC,IAAD,CAA7B;SAEOjB,QAAQ,CAAC;IACdE,IAAI,EAAG;;;;;;;;;;;;;;;;KADO;IAkBdgiB,IAAI,EAAG;;;;;MAlBO;IAyBdzH,UAAU,EAAE;MACV3T,KAAK,EAAE6a,WADG;MAEVvjB,KAAK,EAAE,CAACuB,OAAD,EAAUC,KAAV,KAAoB;eAClBqiB,SAAS,CAACriB,KAAK,CAACxB,KAAP,EAAcwB,KAAK,CAACjB,MAApB,EAA4BiB,KAAK,CAAChC,MAAN,GAAegC,KAAK,CAAChC,MAAN,CAAaG,MAA5B,GAAqC,CAAjE,CAAhB;OAHQ;MAMV+H,MAAM,EAAE,CAACnG,OAAD,EAAUC,KAAV,KAAoB;cACpBhC,MAAM,GAAGiD,aAAa,CAACjB,KAAK,CAAChC,MAAP,CAAb,GAA8BgC,KAAK,CAAChC,MAAN,CAAakX,GAAb,CAAiB1X,WAAjB,CAA9B,GAA8DwC,KAAK,CAAChC,MAAN,IAAgB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAA7F;eACO;UACLsD,MAAM,EAAE8gB,IAAI,CAAC;YACX7gB,KAAK,EAAE,SADI;YAEXC,IAAI,EAAExD;WAFI,CADP;UAKLyD,OAAO,EAAE;SALX;;KAjCU;IA2CdqgB,QAAQ,EAAEI,aA3CI;IA6CdjiB,KAAK,EAAEH,YA7CO;IA8CdK,KAAK,EAAED,YA9CO;IAgDdK,QAAQ,EAAE;MACRoQ,KAAK,EAAE,CAAC5Q,OAAD,EAAUC,KAAV,KAAqBiB,aAAa,CAACjB,KAAK,CAAC2Q,KAAP,CAAb,GAA6BnT,WAAW,CAACwC,KAAK,CAAC2Q,KAAP,CAAxC,GAAwD3Q,KAAK,CAAC2Q;KAjD9E;IAoDd1R,KAAK,EAAEijB,aAAa,CAAC/jB,MApDP;IAsDdokB,SAAS,EAAE,CAACxiB,OAAD,EAAUC,KAAV,KAAqBA,KAAK,CAAChC,MAAN,GAAegC,KAAK,CAAChC,MAAN,CAAaG,MAA5B,GAAqC;GAtDxD,CAAf;CAfF;;ACXA;;;;;;;;;AAkBA,AAAe,eAAeqkB,QAAf,CAAwBC,WAAxB,EAAqE;QAC5EjhB,IAAI,GAAG,IAAIkhB,QAAJ,CAAaD,WAAb,CAAb;MACIvc,MAAM,GAAG,CAAb;;WAESyc,UAAT,GAAsB;UACd9c,KAAK,GAAGrE,IAAI,CAACohB,SAAL,CAAe1c,MAAf,EAAuB,IAAvB,CAAd;IACAA,MAAM,IAAI,CAAV;WACOL,KAAP;GAPgF;;;QAW5Egd,KAAK,GAAGF,UAAU,EAAxB;;MACIE,KAAK,KAAK,UAAd,EAA0B;UAClB,IAAItN,KAAJ,CAAW,2BAA0BsN,KAAK,CAACC,QAAN,CAAe,EAAf,CAAmB,EAAxD,CAAN;GAbgF;;;QAiB5EC,OAAO,GAAGJ,UAAU,EAA1B;;MACII,OAAO,KAAK,CAAhB,EAAmB;UACX,IAAIxN,KAAJ,CAAW,qBAAoBwN,OAAQ,EAAvC,CAAN;GAnBgF;;;QAuB5EC,WAAW,GAAGL,UAAU,EAA9B;;MACIK,WAAW,KAAKxhB,IAAI,CAACyhB,UAAzB,EAAqC;UAC7B,IAAI1N,KAAJ,CAAW,UAASyN,WAAY,kCAAiCxhB,IAAI,CAACyhB,UAAW,EAAjF,CAAN;;;WAGOC,mBAAT,CAA6BC,IAA7B,EAAmC;OAC9B;YACKC,WAAW,GAAGT,UAAU,EAA9B;YACMU,SAAS,GAAGV,UAAU,EAA5B;;UACIU,SAAS,KAAKF,IAAlB,EAAwB;cAChBG,SAAS,GAAG,IAAIZ,QAAJ,CAAalhB,IAAI,CAACF,MAAlB,EAA0B4E,MAA1B,EAAkCkd,WAAlC,CAAlB;QACAld,MAAM,IAAIkd,WAAV;eACOE,SAAP;;;MAEFpd,MAAM,IAAIkd,WAAV;KARF,QASSld,MAAM,GAAG8c,WATlB;;;QAYIO,QAAQ,GAAGL,mBAAmB;;YAAA,CAApC;;MACI,CAACK,QAAL,EAAe;UACP,IAAIhO,KAAJ,CAAU,qBAAV,CAAN;;;QAGIiO,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAW,IAAIC,WAAJ,GAAkBC,MAAlB,CAAyBL,QAAzB,CAAX,CAAb;QAEMM,MAAM,GAAGX,mBAAmB;;YAAA,CAAlC;;MACI,CAACW,MAAL,EAAa;WACJ;MAAEL;KAAT;;;MAGEA,IAAI,CAACM,OAAL,CAAa,CAAb,EAAgBC,GAAhB,KAAwB3c,SAA5B,EAAuC;UAC/B,IAAImO,KAAJ,CAAU,4BAAV,CAAN;GAtDgF;;;QA0D5EyO,SAAS,GAAGR,IAAI,CAACQ,SAAL,CAAe9O,GAAf,CAAoB+O,YAAD,IAAkB;QACjDC,SAAJ,CADqD;;YAG7CD,YAAY,CAACE,aAArB;WACOC,qBAAqB,CAACC,IAA3B;QAAiCH,SAAS,GAAGI,SAAZ;;;WAC5BF,qBAAqB,CAACG,aAA3B;QAA0CL,SAAS,GAAG9K,UAAZ;;;WACrCgL,qBAAqB,CAACI,KAA3B;QAAkCN,SAAS,GAAGO,UAAZ;;;WAC7BL,qBAAqB,CAACM,cAA3B;QAA2CR,SAAS,GAAG/B,WAAZ;;;WACtCiC,qBAAqB,CAACO,YAA3B;QAAyCT,SAAS,GAAGU,WAAZ;;;WACpCR,qBAAqB,CAACS,KAA3B;QAAkCX,SAAS,GAAGhmB,YAAZ;;;;cAE1B,IAAIqX,KAAJ,CAAW,8BAA6B0O,YAAY,CAACE,aAAc,EAAnE,CAAN;;;QAEAW,aAAJ,CAbqD;;YAe7Cb,YAAY,CAACd,IAArB;WACO,QAAL;QAAe2B,aAAa,GAAG,CAAhB;;;WACV,MAAL;QAAaA,aAAa,GAAG,CAAhB;;;WACR,MAAL;QAAaA,aAAa,GAAG,CAAhB;;;WACR,MAAL;QAAaA,aAAa,GAAG,CAAhB;;;WACR,MAAL;QAAaA,aAAa,GAAG,CAAhB;;;WACR,MAAL;QAAaA,aAAa,GAAG,CAAhB;;;WACR,MAAL;QAAaA,aAAa,GAAG,EAAhB;;;;cAEL,IAAIvP,KAAJ,CAAW,qBAAoB0O,YAAY,CAACd,IAAK,EAAjD,CAAN;;;UAEE4B,UAAU,GAAGvB,IAAI,CAACwB,WAAL,CAAiBf,YAAY,CAACc,UAA9B,CAAnB;;QACIA,UAAU,CAACzjB,MAAX,KAAsB,CAA1B,EAA6B;YACrB,IAAIiU,KAAJ,CAAU,uCAAV,CAAN;;;QAEEwP,UAAU,CAAC9B,UAAX,GAAwBiB,SAAS,CAACe,iBAAlC,KAAwD,CAA5D,EAA+D;YACvD,IAAI1P,KAAJ,CAAU,gCAAV,CAAN;;;WAEK,IAAI2O,SAAJ,CACLL,MAAM,CAACviB,MADF,EAELuiB,MAAM,CAACqB,UAAP,IAAqBH,UAAU,CAACG,UAAX,IAAyB,CAA9C,KAAoDjB,YAAY,CAACiB,UAAb,IAA2B,CAA/E,CAFK,EAGLjB,YAAY,CAAChlB,KAAb,GAAqB6lB,aAHhB,CAAP;GAjCgB,CAAlB,CA1DkF;;QAmG5EK,MAAM,GACV3B,IAAI,CAAC2B,MAAL,KACC,MAAM9O,OAAO,CAAC+O,GAAR,CACL5B,IAAI,CAAC2B,MAAL,CAAYjQ,GAAZ,CAAiBmQ,OAAD,IAAa;UACrBN,UAAU,GAAGvB,IAAI,CAACwB,WAAL,CAAiBK,OAAO,CAACN,UAAzB,CAAnB;UACMvjB,IAAI,GAAG,IAAIkhB,QAAJ,CAAamB,MAAM,CAACviB,MAApB,EAA4BuiB,MAAM,CAACqB,UAAP,GAAoBH,UAAU,CAACG,UAA3D,EAAuEH,UAAU,CAAC9B,UAAlF,CAAb;WACOnT,IAAI,CAACwV,iBAAL,CAAuB,IAAIC,IAAJ,CAAS,CAAC/jB,IAAD,CAAT,EAAiB;MAAE2hB,IAAI,EAAEkC,OAAO,CAACG;KAAjC,CAAvB,CAAP;GAHF,CADK,CADP,CADF;SAUO;IAAEhC,IAAF;IAAQQ,SAAR;IAAmBmB;GAA1B;;;AC/HF;;;;;AAQA,SAASM,8CAAT,CACEC,IADF,EAEEpL,gBAFF,EAGExB,eAHF,EAIE6M,qBAA8B,GAAG,KAJnC,EAKM;;QAEEC,mBAAmB,GAAGD,qBAAqB,GAAGD,IAAI,CAACG,cAAR,GAAyBH,IAA1E;;MACI5M,eAAe,CAACU,IAAhB,CAAqB,CAAC;IAAElE;GAAH,KAAgBA,MAAM,KAAKsQ,mBAAhD,CAAJ,EAA0E;WACjE,IAAP;;;QAEIE,UAAU,qBAAQJ,IAAR,CAAhB;;QACM,CAACK,WAAD,IAAgBzL,gBAAgB,CAACsL,mBAAD,EAAsB,CAAtB,CAAtC;EACAE,UAAU,CAACtnB,KAAX,GAAmBunB,WAAnB;;MACID,UAAU,CAAC/mB,MAAX,IAAqB+mB,UAAU,CAAC9nB,MAAhC,IAA0C8nB,UAAU,CAAC9nB,MAAX,CAAkBG,MAAhE,EAAwE;IACtE2nB,UAAU,CAAC/mB,MAAX,GAAoB,IAAIL,KAAJ,CAAUonB,UAAU,CAAC9nB,MAAX,CAAkBG,MAA5B,EAAoC8W,IAApC,CAAyC8Q,WAAzC,CAApB;;;SAEKD,UAAP;;;AAGF,MAAaE,gCAAgC,GAAG,CAC9ChmB,KAD8C,EAE9Csa,gBAF8C,EAG9CxB,eAH8C,KAIvC;MACHpa,KAAK,CAACC,OAAN,CAAcqB,KAAd,CAAJ,EAA0B;WACjBA,KAAK,CACTkV,GADI,CACCwQ,IAAD,IAAUD,8CAA8C,CAACC,IAAD,EAAOpL,gBAAP,EAAyBxB,eAAzB,CADxD,EAEJmN,MAFI,CAEGC,OAFH,CAAP;;;SAIKT,8CAA8C,CAACzlB,KAAD,EAAQsa,gBAAR,EAA0BxB,eAA1B,CAArD;CAVK;;;AAeP,MAAaqN,sCAAsC,GAAG,CACpDnmB,KADoD,EAEpDsa,gBAFoD,EAGpDxB,eAHoD,KAIjD;MACCpa,KAAK,CAACC,OAAN,CAAcqB,KAAd,CAAJ,EAA0B;WACjBA,KAAK,CACTkV,GADI,CACCwQ,IAAD,IAAUD,8CAA8C,CAACC,IAAD,EAAOpL,gBAAP,EAAyBxB,eAAzB,EAA0C,IAA1C,CADxD,EAEJmN,MAFI,CAEGC,OAFH,CAAP;;;SAIKT,8CAA8C,CAACzlB,KAAD,EAAQsa,gBAAR,EAA0BxB,eAA1B,EAA2C,IAA3C,CAArD;CAVK;;AAaP,SAASsN,2CAAT,CACEV,IADF,EAEEpL,gBAFF,EAGExB,eAHF,EAIEuN,qBAJF,EAKM;QACEC,sBAAsB,GAAGxN,eAAe,CAACmN,MAAhB,CAAuB,CAAC;IAAE3Q,MAAF;IAAUU;GAAX,KAA+BV,MAAM,KAAKoQ,IAAjE,CAA/B;QACMa,eAAe,GAAGD,sBAAsB,CAC3CpR,GADqB,CACjB,CAAC;IAAEI,MAAF;IAAUU;GAAX,KAA+BA,aADd,EAErBiQ,MAFqB,CAEbjQ,aAAD,IAAmB,OAAOA,aAAP,KAAyB,QAF9B,CAAxB;;QAGM8P,UAAU,qBAAQJ,IAAR,CAAhB;;QACMc,aAAa,GAAIV,UAAU,CAAC9nB,MAAX,IAAqBvC,IAAI,CAACgrB,IAAL,CAAUX,UAAU,CAAC9nB,MAAX,CAAkBG,MAAlB,GAA2BkoB,qBAArC,CAAtB,IAAsF,CAA5G,CANI;;QAQEK,QAAQ,GAAGpM,gBAAgB,CAACoL,IAAD,EAAOc,aAAP,CAAjC;QACMG,UAAU,GAAGD,QAAQ,CAAC,CAAD,CAA3B,CATI;;MAWAZ,UAAU,CAAC9nB,MAAX,IAAqB8nB,UAAU,CAAC9nB,MAAX,CAAkBG,MAA3C,EAAmD;UAC3CyoB,SAAS,GAAG,IAAIloB,KAAJ,CAAUonB,UAAU,CAAC9nB,MAAX,CAAkBG,MAA5B,EAAoC8W,IAApC,GAA2CC,GAA3C,CAA+C,MAAMyR,UAArD,CAAlB;;SACK,IAAIvoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGooB,aAApB,EAAmCpoB,CAAC,EAApC,EAAwC;WACjC,IAAIyoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,qBAApB,EAA2CQ,CAAC,EAA5C,EAAgD;cACxCC,GAAG,GAAG1oB,CAAC,GAAGioB,qBAAJ,GAA4BQ,CAAxC;;YACIC,GAAG,GAAGF,SAAS,CAACzoB,MAApB,EAA4B;UAC1ByoB,SAAS,CAACE,GAAD,CAAT,GAAiBJ,QAAQ,CAACtoB,CAAD,CAAzB;;;;;IAIN0nB,UAAU,CAAC/mB,MAAX,GAAoB6nB,SAApB;;QACIL,eAAe,CAACpoB,MAApB,EAA4B;MAC1B2nB,UAAU,CAAC9nB,MAAX,GAAoB8nB,UAAU,CAAC9nB,MAAX,CAAkBioB,MAAlB,CAClB,CAAC9Q,CAAD,EAAIC,KAAJ,KAAc,CAACmR,eAAe,CAAC1I,QAAhB,CAAyBpiB,IAAI,CAACkd,KAAL,CAAWvD,KAAK,GAAGiR,qBAAnB,CAAzB,CADG,CAApB;MAGAP,UAAU,CAAC/mB,MAAX,GAAoB+mB,UAAU,CAAC/mB,MAAX,CAAkBknB,MAAlB,CAClB,CAAC9Q,CAAD,EAAIC,KAAJ,KAAc,CAACmR,eAAe,CAAC1I,QAAhB,CAAyBpiB,IAAI,CAACkd,KAAL,CAAWvD,KAAK,GAAGiR,qBAAnB,CAAzB,CADG,CAApB;KAJF,MAOO,IAAIC,sBAAsB,CAACnoB,MAA3B,EAAmC;;aAEjC,IAAP;;GApBJ,MAsBO;IACL2nB,UAAU,CAACtnB,KAAX,GAAmBmoB,UAAnB;;QACIL,sBAAsB,CAACnoB,MAA3B,EAAmC;aAC1B,IAAP;;;;SAGG2nB,UAAP;;;AAGF,MAAaiB,mCAAmC,GAAIV,qBAAD,IAAmC,CACpFrmB,KADoF,EAEpFsa,gBAFoF,EAGpFxB,eAHoF,KAI7E;MACHpa,KAAK,CAACC,OAAN,CAAcqB,KAAd,CAAJ,EAA0B;WACjBA,KAAK,CACTkV,GADI,CACCwQ,IAAD,IACHU,2CAA2C,CAACV,IAAD,EAAOpL,gBAAP,EAAyBxB,eAAzB,EAA0CuN,qBAA1C,CAFxC,EAIJJ,MAJI,CAIGC,OAJH,CAAP;;;SAMKE,2CAA2C,CAACpmB,KAAD,EAAQsa,gBAAR,EAA0BxB,eAA1B,EAA2CuN,qBAA3C,CAAlD;CAZK;;AC5FP,MAAMW,wBAAwB,GAAI3mB,OAAD,IAAmBgB,IAAD,IAAe;;QAE1DyQ,WAAW,GAAGzR,OAAO,CAACgB,IAAD,CAA3B,CAFgE;;;QAM1D4lB,cAAc,GAAGC,OAAO,CAC3BlnB,KAAD,IAAqD;UAC7C;MAAEC,KAAF;aAASE;QAAUH,KAAzB;WACOqB,IAAI,mBAAMyQ,WAAN;MAAmB7R,KAAnB;aAA0BE;OAArC;GAH0B,EAK5B,CAAC,GAAGyW,IAAJ,KAAa6M,IAAI,CAAC0D,SAAL,CAAevQ,IAAf,CALe,CAA9B;;QAQMwQ,aAAa,GAAIpnB,KAAD,IAAW;;;;;;;UAKzBC,KAAK,GAAGD,KAAK,CAACC,KAAN,8BAAeD,KAAK,CAAC6lB,cAArB,0DAAe,sBAAsB5lB,KAArC,KAA8C6R,WAAW,CAAC7R,KAA1D,IAAmEL,gBAAjF;UACMO,QAAK,GAAGH,KAAK,CAACG,KAAN,+BAAeH,KAAK,CAAC6lB,cAArB,2DAAe,uBAAsB1lB,KAArC,KAA8C2R,WAAW,CAAC3R,KAA1D,IAAmEjB,gBAAjF;IACA+nB,cAAc,CAAC;MAAEhnB,KAAF;aAASE;KAAV,CAAd,CAAiCH,KAAjC;GAPF;;SAUQA,KAAD,IAAgB;QACjBtB,KAAK,CAACC,OAAN,CAAcqB,KAAd,CAAJ,EAA0B;MACxBA,KAAK,CAAC6N,OAAN,CAAcuZ,aAAd;KADF,MAEO;MACLA,aAAa,CAACpnB,KAAD,CAAb;;GAJJ;CAxBF;;ACGO,SAASqnB,sBAAT,CAAgCC,WAAhC,EAAqDC,IAArD,EAAoE;;QAEnEC,SAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,GAAP,CAAlB;QACMC,SAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAC,GAAR,CAAlB;QAEMzpB,MAAM,GAAG,CAACwpB,SAAD,EAAYC,SAAZ,CAAf,CALyE;;;QASnEC,SAAS,GAAG,EAAlB;QACMC,WAAW,GAAG,EAApB;;OAEK,IAAIvpB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkpB,WAApB,EAAiClpB,CAAC,EAAlC,EAAsC;UAC9B2D,KAAK,GAAI,IAAItG,IAAI,CAACwJ,EAAT,GAAc7G,CAAf,GAAoBkpB,WAAlC;UACM7pB,CAAC,GAAG,MAAMhC,IAAI,CAAC0G,GAAL,CAASJ,KAAT,CAAhB;UACMrE,CAAC,GAAG,MAAMjC,IAAI,CAACyG,GAAL,CAASH,KAAT,CAAhB;IACA/D,MAAM,CAACsP,IAAP,CAAY,CAAC7P,CAAD,EAAIC,CAAJ,EAAO,GAAP,CAAZ,EAAyB,CAACD,CAAD,EAAIC,CAAJ,EAAO,CAAC,GAAR,CAAzB;UAEMkqB,YAAY,GAAG5pB,MAAM,CAACG,MAAP,GAAgB,CAArC;UACM0pB,UAAU,GAAGN,IAAI,GAAG,CAAH,GAAOnpB,CAAC,GAAG,CAAJ,KAAUkpB,WAAV,GAAwB,CAAxB,GAA4BtpB,MAAM,CAACG,MAAjE;UACM2pB,aAAa,GAAG1pB,CAAC,GAAG,CAAJ,KAAUkpB,WAAV,GAAwB,CAAxB,GAA4BtpB,MAAM,CAACG,MAAP,GAAgB,CAAlE;IACAupB,SAAS,CAACpa,IAAV,CAAe,CAACsa,YAAD,EAAeC,UAAf,EAA2BC,aAA3B,CAAf;IACAH,WAAW,CAACra,IAAZ,CAAiB,CAACsa,YAAD,EAAeE,aAAf,EAA8B,CAA9B,CAAjB;;QACI,CAACP,IAAL,EAAW;YACHQ,SAAS,GAAG/pB,MAAM,CAACG,MAAP,GAAgB,CAAlC;MACAupB,SAAS,CAACpa,IAAV,CAAe,CAACya,SAAD,EAAYH,YAAZ,EAA0BC,UAA1B,CAAf;MACAF,WAAW,CAACra,IAAZ,CAAiB,CAACya,SAAD,EAAYF,UAAZ,EAAwB,CAAxB,CAAjB;;;;SAGG;IAAE7pB,MAAF;IAAU0pB,SAAV;IAAqBC;GAA5B;;AAGF,MAAM;EAAE3pB,MAAF;EAAU0pB,SAAV;EAAqBC;IAAgBN,sBAAsB,CAAC,EAAD,EAAK,KAAL,CAAjE;AAEA,MAAaW,SAAS,GAAGhB,wBAAwB,CAACiB,YAAY,CAACjqB,MAAD,EAAS0pB,SAAS,CAAC1F,MAAV,CAAiB2F,WAAjB,CAAT,CAAb,CAA1C;AAEP,MAAMtV,oBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;AACA,AAAe,SAASmB,SAAT,CAAmBloB,KAAnB,EAA2E;SACjF8O,oBAAC,OAAD;IAAS,oBAAoB,EAAEuD;KAA0BrS,KAAzD;IAAgE,WAAW,EAAEgoB;KAApF;;;ACrCF,MAAM;UAAEhqB,QAAF;aAAU0pB,WAAV;eAAqBC;IAAgBN,sBAAsB,CAAC,EAAD,EAAK,IAAL,CAAjE;AAEA,MAAac,KAAK,GAAGnB,wBAAwB,CAACiB,YAAY,CAACjqB,QAAD,EAAS0pB,WAAS,CAAC1F,MAAV,CAAiB2F,aAAjB,CAAT,CAAb,CAAtC;AAEP,MAAMtV,sBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;AACA,AAAe,SAASqB,KAAT,CAAepoB,KAAf,EAAmE;SACzE8O,oBAAC,OAAD;IAAS,oBAAoB,EAAEuD;KAA0BrS,KAAzD;IAAgE,WAAW,EAAEmoB;KAApF;;;ACJF,MAAM/lB,eAAa,GAAGC,MAAM,CAACC,MAAP,CAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAd,CAAtB;;AAOA,MAAM+lB,uBAAuB,GAAIC,OAAD,IAAsB;QAC9CN,YAAS,GAAG,EAAlB;QACMG,QAAK,GAAG,EAAd;;OAEK,MAAMI,MAAX,IAAqBD,OAArB,EAA8B;QACxBE,WAAJ;QACIC,WAAJ;QACIC,WAAJ;QACIC,UAAJ;QACIC,UAAJ;QACIC,UAAJ;QAEIC,YAAJ;QACI/nB,WAAJ;QACI0L,GAAJ;;QACI8b,MAAM,CAACvqB,MAAP,IAAiBuqB,MAAM,CAACvqB,MAAP,CAAcG,MAAd,KAAyB,CAA9C,EAAiD;YACzC,CAAC6W,KAAD,EAAQ+T,GAAR,IAAeR,MAAM,CAACvqB,MAA5B;MACA8qB,YAAY,GAAG,CAAC9T,KAAK,CAACvX,CAAP,EAAUuX,KAAK,CAACtX,CAAhB,EAAmBsX,KAAK,CAACrX,CAAzB,CAAf;YACMqrB,WAAW,GAAG,CAACD,GAAG,CAACtrB,CAAL,EAAQsrB,GAAG,CAACrrB,CAAZ,EAAeqrB,GAAG,CAACprB,CAAnB,CAApB;YACMQ,MAAM,GAAGoF,aAAI,CAACP,QAAL,CAAc8lB,YAAd,EAA4BE,WAA5B,CAAf;MAEAvc,GAAG,GAAGlJ,aAAI,CAACiO,QAAL,CAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAd,EAAyBwX,WAAzB,EAAsCF,YAAtC,CAAN;MACAvlB,aAAI,CAACgO,SAAL,CAAe9E,GAAf,EAAoBA,GAApB;MACA1L,WAAW,GAAG6C,aAAI,CAACqlB,UAAL,CAAgB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAhB,EAA8B7mB,eAA9B,EAA6CqK,GAA7C,CAAd;MAEAkc,UAAU,GAAGC,UAAU,GAAGL,MAAM,CAAC5X,KAAP,CAAajT,CAAvC;MACAmrB,UAAU,GAAGN,MAAM,CAAC5X,KAAP,CAAahT,CAAb,IAAkBQ,MAAM,GAAG,GAAxC;MACAqqB,WAAW,GAAGC,WAAW,GAAGF,MAAM,CAAC5X,KAAP,CAAalT,CAAzC;MACAirB,WAAW,GAAGvqB,MAAM,GAAG0qB,UAAvB;KAbF,MAcO;MACLC,YAAY,GAAGtrB,WAAW,CAAC+qB,MAAM,CAAC1nB,IAAP,CAAYD,QAAb,CAA1B;MACAG,WAAW,GAAGnD,iBAAiB,CAAC2qB,MAAM,CAAC1nB,IAAP,CAAYE,WAAb,CAA/B;MACA6C,aAAI,CAACslB,OAAL,CAAanoB,WAAb,EAA0BA,WAA1B,EAAuCtF,IAAI,CAACwJ,EAAL,GAAU,CAAjD;MACAwH,GAAG,GAAGlJ,aAAI,CAACC,aAAL,CAAmB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAnB,EAA8BpB,eAA9B,EAA6CrB,WAA7C,CAAN;MAEAynB,WAAW,GAAGD,MAAM,CAAC5X,KAAP,CAAajT,CAAb,IAAkB,CAAhC;MACA+qB,WAAW,GAAGF,MAAM,CAAC5X,KAAP,CAAahT,CAAb,IAAkB,CAAhC;MACAgrB,UAAU,GAAG,IAAIH,WAAjB;MACAI,UAAU,GAAG,IAAIH,WAAjB,CATK;;;MAaLI,UAAU,GAAG,QAAQN,MAAM,CAAC5X,KAAP,CAAalT,CAAb,IAAkB,CAA1B,CAAb;MACAirB,WAAW,GAAG,QAAQH,MAAM,CAAC5X,KAAP,CAAalT,CAAb,IAAkB,CAA1B,CAAd;;;UAGI0rB,aAAa,GAAG5lB,aAAI,CAAC6lB,WAAL,CAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAjB,EAA4BN,YAA5B,EAA0Crc,GAA1C,EAA+Cic,WAAW,GAAG,CAA7D,CAAtB;UACMW,YAAY,GAAG9lB,aAAI,CAAC6lB,WAAL,CAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAjB,EAA4BN,YAA5B,EAA0Crc,GAA1C,EAA+Cic,WAAW,GAAGG,UAAU,GAAG,CAA1E,CAArB;IAEAb,YAAS,CAAC1a,IAAV,CAAe;;MAEbuY,cAAc,EAAE0C,MAFH;MAGb5X,KAAK,EAAE;QAAElT,CAAC,EAAE+qB,WAAL;QAAkB9qB,CAAC,EAAE+qB,WAArB;QAAkC9qB,CAAC,EAAE+qB;OAH/B;MAIblqB,KAAK,EAAE+pB,MAAM,CAAC/pB,KAJD;MAKbqC,IAAI,EAAE;QACJD,QAAQ,EAAE/C,WAAW,CAACsrB,aAAD,CADjB;QAEJpoB,WAAW,EAAEjD,iBAAiB,CAACiD,WAAD;;KAPlC;IAUAonB,QAAK,CAAC7a,IAAN,CAAW;;MAETuY,cAAc,EAAE0C,MAFP;MAGT5X,KAAK,EAAE;QAAElT,CAAC,EAAEkrB,UAAL;QAAiBjrB,CAAC,EAAEkrB,UAApB;QAAgCjrB,CAAC,EAAEkrB;OAHjC;MAITrqB,KAAK,EAAE+pB,MAAM,CAAC/pB,KAJL;MAKTqC,IAAI,EAAE;QACJD,QAAQ,EAAE/C,WAAW,CAACwrB,YAAD,CADjB;QAEJtoB,WAAW,EAAEjD,iBAAiB,CAACiD,WAAD;;KAPlC;;;SAYK;WACLonB,QADK;eAELH;GAFF;CAvEF;;AA6EA,MAAasB,iBAAiB,GAAG,MAAOjoB,IAAD,IAAe;QAC9CkoB,gBAAgB,GAAGvB,SAAS,CAAC3mB,IAAD,CAAlC;QACMmoB,YAAY,GAAGrB,KAAK,CAAC9mB,IAAD,CAA1B;SACQrB,KAAD,IAAgB;UACf;MAAEgoB,SAAS,EAAEyB,kBAAb;MAAiCtB,KAAK,EAAEuB;QAAmBrB,uBAAuB,CAACroB,KAAD,CAAxF;IACAupB,gBAAgB,CAACE,kBAAD,CAAhB;IACAD,YAAY,CAACE,cAAD,CAAZ;GAHF;CAHK;;AAUP,SAASC,MAAT,CAAgB3pB,KAAhB,EAA8B;QACtB4pB,WAAW,GAAGC,IAAI,CAAC7pB,KAAD,EAAQ,UAAR,CAAxB;QACM;eAAEgoB,YAAF;WAAaG;MAAUE,uBAAuB,CAACroB,KAAK,CAAC6O,QAAP,CAApD;SAEErG,6BAACshB,cAAD,QACEthB,6BAAC,SAAD;IAAW,oBAAoB,EAAE2d;KAA4CyD,WAA7E,GACG5B,YADH,CADF,EAIExf,6BAAC,KAAD;IAAO,oBAAoB,EAAE2d;KAA4CyD,WAAzE,GACGzB,QADH,CAJF,CADF;;;AAYF,eAAe4B,UAAI,CAAQJ,MAAR,CAAnB;;ACvGA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA,MAAMK,WAAW,GAAG9rB,YAAY,CAAC+mB,iBAAjC;AACA,MAAMgF,WAAW,GAAG,IAAID,WAAxB;AACA,MAAME,wBAAwB,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,GAAV,CAAjC;;;AAIA,MAAMC,WAAW,GAAG;EAAEC,EAAE,EAAE,CAAN;EAASC,EAAE,EAAE,CAAb;EAAgBC,EAAE,EAAE,CAApB;EAAuBC,EAAE,EAAE;CAA/C;AACA,MAAMC,qBAAqB,GAAGnoB,MAAM,CAACud,IAAP,CAAYuK,WAAZ,EAAyBhsB,MAAvD;AAEA,MAAMmC,IAAI,GAAI;;;;;;;;;;;;;;;;;;;;;;;;;;EA0BZ+B,MAAM,CAACud,IAAP,CAAYuK,WAAZ,EACCjV,GADD,CACMuV,CAAD,IAAQ,qBAAoBA,CAAE,MAAKN,WAAW,CAACM,CAAD,CAAI,KADvD,EAECC,IAFD,CAEM,IAFN,CAEY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA5Bd;AA+IA,MAAMpI,IAAI,GAAI;;;;;;CAAd;;AAQA,SAASqI,WAAT,CAAqBptB,CAArB,EAAwBD,CAAxB,EAA2B;QACnB,CAACstB,EAAD,EAAKC,EAAL,EAASC,EAAT,IAAe7pB,aAAa,CAAC1D,CAAD,CAAb,GAAmBC,WAAW,CAACD,CAAD,CAA9B,GAAoCA,CAAzD;QACM,CAACwtB,EAAD,EAAKC,EAAL,EAASC,EAAT,IAAehqB,aAAa,CAAC3D,CAAD,CAAb,GAAmBE,WAAW,CAACF,CAAD,CAA9B,GAAoCA,CAAzD;SACOstB,EAAE,KAAKG,EAAP,IAAaF,EAAE,KAAKG,EAApB,IAA0BF,EAAE,KAAKG,EAAxC;;;AAGF,MAAaC,KAAK,GAAI7pB,IAAD,IAAe;;QAE5B8pB,eAAe,GAAG9pB,IAAI,CAACC,MAAL,CAAY;IAClC6hB,IAAI,EAAE,QAD4B;IAElC5hB,KAAK,EAAE,QAF2B;IAGlCC,IAAI,EAAE,CAAC2oB,WAAW,CAACI,EAAb,EAAiBJ,WAAW,CAACC,EAA7B,EAAiCD,WAAW,CAACE,EAA7C,EAAiDF,WAAW,CAACG,EAA7D;GAHgB,CAAxB;QAKMc,gBAAgB,GAAG/pB,IAAI,CAACC,MAAL,CAAY;IACnC6hB,IAAI,EAAE,OAD6B;IAEnC5hB,KAAK,EAAE,QAF4B;IAGnCC,IAAI,EAAE,CACJ,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADI;KAEH,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAFI;KAGH,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAHI;KAIH,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAJI;GAHiB,CAAzB,CAPkC;;;QAmB5B6pB,yBAAyB,GAAGhqB,IAAI,CAACC,MAAL,CAAY;IAC5C6hB,IAAI,EAAE,OADsC;IAE5C5hB,KAAK,EAAE,QAFqC;IAG5CC,IAAI,EAAE8pB,OAAO,CAAC,IAAI5sB,KAAJ,CAAU8rB,qBAAV,EAAiCvV,IAAjC,CAAsC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAtC,CAAD;GAHmB,CAAlC;QAKMsW,yBAAyB,GAAGlqB,IAAI,CAACC,MAAL,CAAY;IAC5C6hB,IAAI,EAAE,OADsC;IAE5C5hB,KAAK,EAAE,QAFqC;;IAI5CC,IAAI,EAAE8pB,OAAO,CAAC,IAAI5sB,KAAJ,CAAU8rB,qBAAV,EAAiCvV,IAAjC,CAAsC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAtC,CAAD;GAJmB,CAAlC,CAxBkC;;QAgC5B7T,cAAW,GAAGC,IAAI,CAACC,MAAL,CAAY;IAAE6hB,IAAI,EAAE;GAApB,CAApB,CAhCkC;;;;;QAsC5BqI,eAAe,GAAGnqB,IAAI,CAACC,MAAL,CAAY;IAAE6hB,IAAI,EAAE;GAApB,CAAxB;QACMsI,eAAe,GAAGpqB,IAAI,CAACC,MAAL,CAAY;IAAE6hB,IAAI,EAAE;GAApB,CAAxB;QAEMuI,kBAAkB,GAAGrqB,IAAI,CAACC,MAAL,CAAY;IAAE6hB,IAAI,EAAE;GAApB,CAA3B;QACMwI,kBAAkB,GAAGtqB,IAAI,CAACC,MAAL,CAAY;IAAE6hB,IAAI,EAAE;GAApB,CAA3B;QAEM9iB,OAAO,GAAGgB,IAAI,CAClBjB,QAAQ,CAAC;IACPE,IADO;IAEPgiB,IAFO;IAGPniB,KAAK,EAAED,YAHA;IAIPK,QAAQ,EAAE;MACRqrB,SAAS,EAAEvqB,IAAI,CAACqkB,IAAL,CAAU,SAAV,CADH;MAERlf,aAAa,EAAEnF,IAAI,CAACtB,OAAL,CAAa,eAAb,CAFP;MAGR0G,cAAc,EAAEpF,IAAI,CAACtB,OAAL,CAAa,gBAAb,CAHR;MAIRJ,KAAK,EAAE0B,IAAI,CAACqkB,IAAL,CAAU,OAAV,CAJC;MAKRmG,MAAM,EAAExqB,IAAI,CAACqkB,IAAL,CAAU,QAAV,CALA;MAMRoG,cAAc,EAAEzqB,IAAI,CAACqkB,IAAL,CAAU,gBAAV;KAVX;IAYP7K,UAAU,EAAE;MACVkR,SAAS,EAAEZ,eADD;MAEVa,MAAM,EAAE,CAACjsB,OAAD,EAAU;QAAE8rB,MAAF;QAAUI,UAAV;QAAsBhS;OAAhC,MAA6C;QACnD3Y,MAAM,EAAE2Y,KAAK,GAAGmR,gBAAH,GAAsBhqB,cADgB;QAEnD8E,MAAM,EAAE,CAF2C;QAGnDgmB,MAAM,EAAE,CAACL,MAAM,IAAII,UAAV,IAAwBhS,KAAxB,GAAgC,CAAhC,GAAoC,CAArC,IAA0C,CAA1C,GAA8C+P,WAHH;QAInDvoB,OAAO,EAAEwqB,UAAU,IAAIhS,KAAd,GAAsB,CAAtB,GAA0B;OAJ7B,CAFE;MAQVkS,MAAM,EAAE,CAACpsB,OAAD,EAAU;QAAE8rB,MAAF;QAAUI,UAAV;QAAsBhS;OAAhC,MAA6C;QACnD3Y,MAAM,EAAE2Y,KAAK,GAAGmR,gBAAH,GAAsBhqB,cADgB;QAEnD8E,MAAM,EAAE+lB,UAAU,IAAIhS,KAAd,GAAsB,CAAtB,GAA0B,IAAI+P,WAFa;QAGnDkC,MAAM,EAAE,CAACL,MAAM,IAAII,UAAV,IAAwBhS,KAAxB,GAAgC,CAAhC,GAAoC,CAArC,IAA0C,CAA1C,GAA8C+P,WAHH;QAInDvoB,OAAO,EAAEwqB,UAAU,IAAIhS,KAAd,GAAsB,CAAtB,GAA0B;OAJ7B,CARE;MAcVmS,SAAS,EAAE,CAACrsB,OAAD,EAAU;QAAE8rB;OAAZ,MAA0B;QACnCvqB,MAAM,EAAEkqB,eAD2B;QAEnCtlB,MAAM,EAAE,CAF2B;QAGnCgmB,MAAM,EAAE,CAACL,MAAM,GAAG,CAAH,GAAO,CAAd,IAAmB5B,WAHQ;QAInCxoB,OAAO,EAAE;OAJA,CAdD;MAoBV4qB,SAAS,EAAE,CAACtsB,OAAD,EAAU;QAAE8rB;OAAZ,MAA0B;QACnCvqB,MAAM,EAAEkqB,eAD2B;QAEnCtlB,MAAM,EAAE+jB,WAF2B;QAGnCiC,MAAM,EAAE,CAACL,MAAM,GAAG,CAAH,GAAO,CAAd,IAAmB5B,WAHQ;QAInCxoB,OAAO,EAAE;OAJA,CApBD;MA0BV6qB,SAAS,EAAE,CAACvsB,OAAD,EAAU;QAAE8rB;OAAZ,MAA0B;QACnCvqB,MAAM,EAAEmqB,eAD2B;QAEnCvlB,MAAM,EAAE,IAAI+jB,WAFuB;QAGnCiC,MAAM,EAAE,CAACL,MAAM,GAAG,CAAH,GAAO,CAAd,IAAmB5B,WAHQ;QAInCxoB,OAAO,EAAE;OAJA,CA1BD;MAgCV8qB,SAAS,EAAE,CAACxsB,OAAD,EAAU;QAAE8rB;OAAZ,MAA0B;QACnCvqB,MAAM,EAAEmqB,eAD2B;QAEnCvlB,MAAM,EAAE,IAAI+jB,WAFuB;QAGnCiC,MAAM,EAAE,CAACL,MAAM,GAAG,CAAH,GAAO,CAAd,IAAmB5B,WAHQ;QAInCxoB,OAAO,EAAE;OAJA,CAhCD;MAsCV+qB,YAAY,EAAE,CAACzsB,OAAD,EAAU;QAAE0sB;OAAZ,MAAqC;QACjDnrB,MAAM,EAAEmrB,iBAAiB,GAAGf,kBAAH,GAAwBL,yBADA;QAEjD5pB,OAAO,EAAEgrB,iBAAiB,GAAG,CAAH,GAAO;OAFrB,CAtCJ;MA0CVC,YAAY,EAAE,CAAC3sB,OAAD,EAAU;QAAE0sB;OAAZ,MAAqC;QACjDnrB,MAAM,EAAEmrB,iBAAiB,GAAGd,kBAAH,GAAwBJ,yBADA;QAEjD9pB,OAAO,EAAEgrB,iBAAiB,GAAG,CAAH,GAAO;OAFrB;KAtDT;IA2DPxtB,KAAK,EAAEurB,qBA3DA;IA4DPjI,SAAS,EAAElhB,IAAI,CAACqkB,IAAL,CAAU,WAAV,CA5DJ;IA6DPiH,SAAS,EAAEtrB,IAAI,CAACqkB,IAAL,CAAU,WAAV;GA7DL,CADU,CAApB;MAkEIkH,UAAU,GAAG,IAAI1uB,YAAJ,CAAiBssB,qBAAqB,GAAG,CAAzC,CAAjB;MACIqC,UAAU,GAAG,IAAI3uB,YAAJ,CAAiB,CAAjB,CAAjB;MACI4uB,eAAe,GAAG,CAAtB;MACIC,aAAa,GAAG,IAAI7uB,YAAJ,CAAiB,CAAjB,CAApB;MACI8uB,aAAa,GAAG,IAAI9uB,YAAJ,CAAiB,CAAjB,CAApB;;WAES+uB,cAAT,CAAwBjvB,MAAxB,EAAuCkvB,aAAvC,EAA+DC,WAA/D,EAAmG;UAC3FC,cAAc,GAAGpvB,MAAM,CAACG,MAAP,IAAiBgvB,WAAW,GAAG,CAAH,GAAO,CAAnC,CAAvB;;QACIL,eAAe,GAAGM,cAAtB,EAAsC;MACpCP,UAAU,GAAG,IAAI3uB,YAAJ,CAAiBkvB,cAAc,GAAG,CAAlC,CAAb;MACAN,eAAe,GAAGM,cAAlB;;;IAEFpvB,MAAM,CAAC6P,OAAP,CAAe,CAAC3G,KAAD,EAAQ9I,CAAR,KAAc;YACrB,CAACX,CAAD,EAAIC,CAAJ,EAAOC,CAAP,IAAYsD,aAAa,CAACiG,KAAD,CAAb,GAAuB1J,WAAW,CAAC0J,KAAD,CAAlC,GAA4CA,KAA9D;YACMmmB,GAAG,GAAG,IAAIjvB,CAAC,GAAG,CAApB;MACAyuB,UAAU,CAACQ,GAAG,GAAG,CAAP,CAAV,GAAsB5vB,CAAtB;MACAovB,UAAU,CAACQ,GAAG,GAAG,CAAP,CAAV,GAAsB3vB,CAAtB;MACAmvB,UAAU,CAACQ,GAAG,GAAG,CAAP,CAAV,GAAsB1vB,CAAtB;KALF,EANiG;;;;UAiB3Ff,CAAC,GAAGwwB,cAAc,GAAG,CAA3B;;QACIF,aAAJ,EAAmB;;;MAGjBL,UAAU,CAACS,UAAX,CAAsB,CAAtB,EAAyB1wB,CAAC,GAAG,CAA7B,EAAgCA,CAAC,GAAG,CAApC;MACAiwB,UAAU,CAACS,UAAX,CAAsB1wB,CAAC,GAAG,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC;KAJF,MAKO,IAAIuwB,WAAJ,EAAiB;;MAEtBN,UAAU,CAACS,UAAX,CAAsB,CAAtB,EAAyB1wB,CAAC,GAAG,CAA7B,EAAgCA,CAAC,GAAG,CAApC;MACAiwB,UAAU,CAACS,UAAX,CAAsB1wB,CAAC,GAAG,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC;KAHK,MAIA;;MAELiwB,UAAU,CAACS,UAAX,CAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B;MACAT,UAAU,CAACS,UAAX,CAAsB1wB,CAAC,GAAG,CAA1B,EAA6BA,CAAC,GAAG,CAAjC,EAAoCA,CAAC,GAAG,CAAxC;;;WAEKiwB,UAAU,CAACU,QAAX,CAAoB,CAApB,EAAuB3wB,CAAvB,CAAP;;;WAGO4wB,cAAT,CACEjL,SADF,EAEEkL,KAFF,EAG8D;QACxDV,aAAa,CAAC5uB,MAAd,GAAuBokB,SAAS,GAAG,CAAvC,EAA0C;MACxCwK,aAAa,GAAG,IAAI7uB,YAAJ,CAAiBqkB,SAAS,GAAG,CAA7B,CAAhB;MACAyK,aAAa,GAAG,IAAI9uB,YAAJ,CAAiBqkB,SAAS,GAAG,CAA7B,CAAhB;;;SAEG,IAAInN,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGqY,KAAK,CAACtvB,MAAlC,EAA0CiX,KAAK,EAA/C,EAAmD;YAC3CsY,cAAc,GAAGtY,KAAK,GAAG,CAA/B;YACMuY,cAAc,GAAGvY,KAAK,GAAG,CAA/B;YACM;QAAExU,QAAF;QAAYG,WAAW,EAAE3D;UAAMqwB,KAAK,CAACrY,KAAD,CAA1C;YACMwY,iBAAiB,GAAGlvB,KAAK,CAACC,OAAN,CAAciC,QAAd,IAA0BA,QAA1B,GAAqCpD,WAAW,CAACoD,QAAD,CAA1E;MACAmsB,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;MACAb,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;MACAb,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;YAEMC,iBAAiB,GAAGnvB,KAAK,CAACC,OAAN,CAAcvB,CAAd,IAAmBA,CAAnB,GAAuB,CAACA,CAAC,CAACK,CAAH,EAAML,CAAC,CAACM,CAAR,EAAWN,CAAC,CAACO,CAAb,EAAgBP,CAAC,CAACH,CAAlB,CAAjD;MACA+vB,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;MACAb,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;MACAb,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;MACAb,aAAa,CAACW,cAAc,GAAG,CAAlB,CAAb,GAAoCE,iBAAiB,CAAC,CAAD,CAArD;;;WAEK;MACLC,YAAY,EAAEf,aAAa,CAACQ,QAAd,CAAuB,CAAvB,EAA0BhL,SAAS,GAAG,CAAtC,CADT;MAELwL,YAAY,EAAEf,aAAa,CAACO,QAAd,CAAuB,CAAvB,EAA0BhL,SAAS,GAAG,CAAtC;KAFhB;;;WAMOyL,aAAT,CAAuBjvB,MAAvB,EAA4C;WACnCkC,aAAa,CAAClC,MAAD,CAAb,GAAwBA,MAAM,CAACmW,GAAP,CAAW7W,MAAX,CAAxB,GAA6CU,MAApD;;;WAGOkvB,cAAT,CACEzvB,KADF,EAEEO,MAFF,EAGEktB,UAHF,EAIEkB,WAJF,EAKgB;QACVlB,UAAJ,EAAgB;UACVW,UAAU,CAACzuB,MAAX,GAAoBqsB,qBAAqB,GAAG,CAAhD,EAAmD;QACjDoC,UAAU,GAAG,IAAI1uB,YAAJ,CAAiBssB,qBAAqB,GAAG,CAAzC,CAAb;;;YAEI0D,eAAe,GAAG1vB,KAAK,IAAI0rB,wBAAjC;YACM,CAACiE,wBAAD,IAA6BH,aAAa,CAAC,CAACE,eAAD,CAAD,CAAhD;YACM,CAAC9wB,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,IAAe4wB,wBAArB;;WACK,IAAI/Y,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGoV,qBAA5B,EAAmDpV,KAAK,EAAxD,EAA4D;cACpDlP,MAAM,GAAGkP,KAAK,GAAG,CAAvB;QACAwX,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB9I,CAAzB;QACAwvB,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB7I,CAAzB;QACAuvB,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB5I,CAAzB;QACAsvB,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB3I,CAAzB;;;aAEKqvB,UAAU,CAACW,QAAX,CAAoB,CAApB,EAAuB/C,qBAAqB,GAAG,CAA/C,CAAP;KAdF,MAeO,IAAIzrB,MAAJ,EAAY;YACXZ,MAAM,GAAGgvB,WAAW,GAAGpuB,MAAM,CAACZ,MAAP,GAAgB,CAAnB,GAAuBY,MAAM,CAACZ,MAAxD;;UACIyuB,UAAU,CAACzuB,MAAX,GAAoBA,MAAM,GAAG,CAAjC,EAAoC;QAClCyuB,UAAU,GAAG,IAAI1uB,YAAJ,CAAiBC,MAAM,GAAG,CAA1B,CAAb;;;YAEIiwB,eAAe,GAAGJ,aAAa,CAACjvB,MAAD,CAArC;;WACK,IAAIqW,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGgZ,eAAe,CAACjwB,MAA5C,EAAoDiX,KAAK,EAAzD,EAA6D;cACrDlP,MAAM,GAAGkP,KAAK,GAAG,CAAvB;cACM,CAAChY,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,IAAe6wB,eAAe,CAAChZ,KAAD,CAApC;QACAwX,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB9I,CAAzB;QACAwvB,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB7I,CAAzB;QACAuvB,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB5I,CAAzB;QACAsvB,UAAU,CAAC1mB,MAAM,GAAG,CAAV,CAAV,GAAyB3I,CAAzB;;;UAGE4vB,WAAJ,EAAiB;cACT,CAAC/vB,CAAD,EAAIC,CAAJ,EAAOC,CAAP,EAAUC,CAAV,IAAe6wB,eAAe,CAAC,CAAD,CAApC;cACMC,SAAS,GAAGlwB,MAAM,GAAG,CAA3B;QACAyuB,UAAU,CAACyB,SAAS,GAAG,CAAZ,GAAgB,CAAjB,CAAV,GAAgCjxB,CAAhC;QACAwvB,UAAU,CAACyB,SAAS,GAAG,CAAZ,GAAgB,CAAjB,CAAV,GAAgChxB,CAAhC;QACAuvB,UAAU,CAACyB,SAAS,GAAG,CAAZ,GAAgB,CAAjB,CAAV,GAAgC/wB,CAAhC;QACAsvB,UAAU,CAACyB,SAAS,GAAG,CAAZ,GAAgB,CAAjB,CAAV,GAAgC9wB,CAAhC;;;aAEKqvB,UAAU,CAACW,QAAX,CAAoB,CAApB,EAAuBpvB,MAAM,GAAG,CAAhC,CAAP;;;UAEI,IAAIoX,KAAJ,CAAU,2CAAV,CAAN;GAtOgC;;;;;QA4O5B0R,cAAc,GAAGC,OAAO,CAC3BlnB,KAAD,IAAuD;UAC/C;MAAEC,KAAK,GAAGL,gBAAV;aAA4BO,QAAK,GAAGjB;QAAqBc,KAA/D;WACOqB,IAAI,CAAC;MAAEpB,KAAF;aAASE;KAAV,CAAX;GAH0B,EAK5B,CAAC,GAAGyW,IAAJ,KAAa6M,IAAI,CAAC0D,SAAL,CAAevQ,IAAf,CALe,CAA9B,CA5OkC;;QAqP5BhI,MAAM,GAAG,CAAC5O,KAAD,EAAqEsuB,QAArE,KAAuF;UAC9F;MAAErU;QAAUja,KAAlB;;QACIia,KAAJ,EAAW;MACTgN,cAAc,CAAC;QAAEhnB,KAAK,EAAE;UAAEd,MAAM,EAAE;;OAApB,CAAd,CAA6CmvB,QAA7C;KADF,MAEO;MACLrH,cAAc,CAACjnB,KAAD,CAAd,CAAsBsuB,QAAtB;;GALJ,CArPkC;;;WA+PzBC,UAAT,CAAoBvuB,KAApB,EAA2B;UACnB;MAAEia,KAAF;MAAS0S,SAAS,GAAG,OAArB;MAA8Bb,cAAc,GAAG,KAA/C;MAAsD7rB,KAAtD;aAA6DE;QAAUH,KAA7E;UACMwuB,cAAc,GAAGxuB,KAAK,CAAChC,MAAN,CAAaG,MAApC;;QAEIqwB,cAAc,GAAG,CAArB,EAAwB;;;;UAIlBtB,aAAa,GAAGsB,cAAc,GAAG,CAAjB,IAAsB7D,WAAW,CAAC3qB,KAAK,CAAChC,MAAN,CAAa,CAAb,CAAD,EAAkBgC,KAAK,CAAChC,MAAN,CAAawwB,cAAc,GAAG,CAA9B,CAAlB,CAAvD,CARyB;;UAUnBrB,WAAW,GAAG,CAACD,aAAD,IAAkBltB,KAAK,CAACyuB,MAA5C;UAEMC,SAAS,GAAGzB,cAAc,CAACjtB,KAAK,CAAChC,MAAP,EAAekvB,aAAf,EAA8BC,WAA9B,CAAhC;IACA3B,eAAe,CAAC;MAAEhqB,IAAI,EAAEktB,SAAR;MAAmBntB,KAAK,EAAE;KAA3B,CAAf;IACAkqB,eAAe,CAAC;MAAEjqB,IAAI,EAAEktB,SAAR;MAAmBntB,KAAK,EAAE;KAA3B,CAAf;UAEM0qB,UAAU,GAAG,EAAEjsB,KAAK,CAACjB,MAAN,IAAgBiB,KAAK,CAACjB,MAAN,CAAaZ,MAA/B,CAAnB;UACMwwB,SAAS,GAAGV,cAAc,CAACjuB,KAAK,CAACxB,KAAP,EAAcwB,KAAK,CAACjB,MAApB,EAA4BktB,UAA5B,EAAwCkB,WAAxC,CAAhC;IACA/rB,cAAW,CAAC;MAAEI,IAAI,EAAEmtB,SAAR;MAAmBptB,KAAK,EAAE;KAA3B,CAAX;UAEMsqB,MAAM,GAAGc,SAAS,KAAK,YAA7B;UACMiC,kBAAkB,GAAGJ,cAAc,IAAIrB,WAAW,GAAG,CAAH,GAAO,CAAtB,CAAzC;UACM5K,SAAS,GAAGsJ,MAAM,GAAG+C,kBAAkB,GAAG,CAAxB,GAA4BnzB,IAAI,CAACkd,KAAL,CAAWiW,kBAAkB,GAAG,CAAhC,CAApD,CAtByB;;UAyBnB;MAAEnB;QAAUztB,KAAlB;UACMysB,iBAAiB,GAAG,CAAC,CAACgB,KAAF,IAAWA,KAAK,CAACtvB,MAAN,GAAe,CAApD;;QACIsuB,iBAAiB,IAAIgB,KAAzB,EAAgC;UAC1BlL,SAAS,KAAKkL,KAAK,CAACtvB,MAAxB,EAAgC;QAC9BoN,OAAO,CAACwG,KAAR,CAAe,YAAWwQ,SAAU,oBAAmBkL,KAAK,CAACtvB,MAAO,qCAApE;;;;YAGI;QAAE2vB,YAAF;QAAgBC;UAAiBP,cAAc,CAACjL,SAAD,EAAYkL,KAAZ,CAArD;MACA/B,kBAAkB,CAAC;QAAElqB,IAAI,EAAEssB,YAAR;QAAsBvsB,KAAK,EAAE;OAA9B,CAAlB;MACAoqB,kBAAkB,CAAC;QAAEnqB,IAAI,EAAEusB,YAAR;QAAsBxsB,KAAK,EAAE;OAA9B,CAAlB;;;IAGFqN,MAAM,CAAC;MAAEqL,KAAF;MAASha,KAAT;aAAgBE;KAAjB,EAA0B,MAAM;;MAEpCE,OAAO,CACLgC,MAAM,CAACmd,MAAP,CAAc,EAAd,EAAkBxf,KAAlB,EAAyB;QACvB6rB,MADuB;QAEvBc,SAAS,EAAE,gBAFY;QAGvBhtB,KAAK,EAAEsa,KAAK,GAAG,GAAH,GAAS,CAHE;QAIvBgS,UAJuB;QAKvB1J,SALuB;QAMvBuJ,cANuB;QAOvBW;OAPF,CADK,CAAP;;UAWIxS,KAAJ,EAAW;QACT5Z,OAAO,CACLgC,MAAM,CAACmd,MAAP,CAAc,EAAd,EAAkBxf,KAAlB,EAAyB;UACvB6rB,MADuB;UAEvBc,SAAS,EAAE,YAFY;UAGvBhtB,KAAK,EAAE,CAHgB;UAIvBssB,UAJuB;UAKvB1J,SALuB;UAMvBuJ,cANuB;UAOvBW;SAPF,CADK,CAAP;;KAdE,CAAN;;;SA6BMoC,OAAD,IAAkB;QACnBnwB,KAAK,CAACC,OAAN,CAAckwB,OAAd,CAAJ,EAA4B;MAC1BA,OAAO,CAAChhB,OAAR,CAAgB0gB,UAAhB;KADF,MAEO;MACLA,UAAU,CAACM,OAAD,CAAV;;GAJJ;CAjUK;AA0UP,AAAe,SAASC,KAAT,CAAe9uB,KAAf,EAAmE;SACzE8O,oBAAC,OAAD;IAAS,oBAAoB,EAAEkX;KAAsChmB,KAArE;IAA4E,WAAW,EAAEkrB;KAAhG;;;ACljBF,MAAM1tB,aAAW,GAAIuxB,CAAD,KAAqB;EACvCtxB,CAAC,EAAEsxB,CAAC,CAAC,CAAD,CADmC;EAEvCrxB,CAAC,EAAEqxB,CAAC,CAAC,CAAD,CAFmC;EAGvCpxB,CAAC,EAAEoxB,CAAC,CAAC,CAAD;CAHc,CAApB;;AAMA,MAAMpe,KAAK,GAAG,GAAd;AACA,MAAMlT,CAAC,GAAG,IAAIkT,KAAd;AACA,MAAMqe,WAAW,GAAG,CAAC,CAAC,CAACvxB,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAD,EAAa,CAACA,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAb,EAAwByX,GAAxB,CAA4B1X,aAA5B,CAApB;AACA,MAAMyxB,WAAW,GAAG,CAAC,CAAC,CAAD,EAAI,CAAC,GAAL,EAAU,CAAV,CAAD,EAAe,CAAC,CAAD,EAAI,GAAJ,EAAS,CAAT,CAAf,EAA4B/Z,GAA5B,CAAgC1X,aAAhC,CAApB;AACA,MAAM0xB,WAAW,GAAG,CAAC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAC,GAAR,CAAD,EAAe,CAAC,CAAD,EAAI,CAAJ,EAAO,GAAP,CAAf,EAA4Bha,GAA5B,CAAgC1X,aAAhC,CAApB;AACA,MAAMqD,IAAI,GAAG;EACXE,WAAW,EAAE;IAAEtD,CAAC,EAAE,CAAL;IAAQC,CAAC,EAAE,CAAX;IAAcC,CAAC,EAAE,CAAjB;IAAoBV,CAAC,EAAE;GADzB;EAEX2D,QAAQ,EAAE;IAAEnD,CAAC,EAAE,CAAL;IAAQC,CAAC,EAAE,CAAX;IAAcC,CAAC,EAAE;;CAF7B;AAIA,MAAMwxB,KAAK,GAAG;EACZtuB,IADY;EAEZ7C,MAAM,EAAEgxB,WAFI;EAGZre,KAAK,EAAE;IAAElT,CAAC,EAAE,GAAL;IAAUC,CAAC,EAAE,GAAb;IAAkBC,CAAC,EAAE;GAHhB;EAIZa,KAAK,EAAE;IAAEpB,CAAC,EAAE,IAAL;IAAWC,CAAC,EAAE,IAAd;IAAoBC,CAAC,EAAE,GAAvB;IAA4BC,CAAC,EAAE;;CAJxC;AAMA,MAAM6xB,KAAK,GAAG;EACZvuB,IADY;EAEZ7C,MAAM,EAAEixB,WAFI;EAGZte,KAAK,EAAE;IAAElT,CAAC,EAAE,GAAL;IAAUC,CAAC,EAAE,GAAb;IAAkBC,CAAC,EAAE;GAHhB;EAIZa,KAAK,EAAE;IAAEpB,CAAC,EAAE,IAAL;IAAWC,CAAC,EAAE,IAAd;IAAoBC,CAAC,EAAE,IAAvB;IAA6BC,CAAC,EAAE;;CAJzC;AAMA,MAAM8xB,KAAK,GAAG;EACZxuB,IADY;EAEZ7C,MAAM,EAAEkxB,WAFI;EAGZve,KAAK,EAAE;IAAElT,CAAC,EAAE,GAAL;IAAUC,CAAC,EAAE,GAAb;IAAkBC,CAAC,EAAE;GAHhB;EAIZa,KAAK,EAAE;IAAEpB,CAAC,EAAE,IAAL;IAAWC,CAAC,EAAE,IAAd;IAAoBC,CAAC,EAAE,IAAvB;IAA6BC,CAAC,EAAE;;CAJzC;;AAcA,AAAe,MAAM+xB,IAAN,SAAmB9mB,cAAK,CAAC+mB,SAAzB,CAA0C;EAKvD3gB,MAAM,GAAG;WACApG,6BAAC,KAAD,QAAQ,KAAKxI,KAAL,CAAW6O,QAAnB,CAAP;;;;;gBANiBygB,sBACU;EAC3BzgB,QAAQ,EAAE,CAACsgB,KAAD,EAAQC,KAAR,EAAeC,KAAf;;;MCxCDG,KAAK,GAAGxI,wBAAwB,CAC3CiB,YAAY,CACV;AAEE,CAAC,CAAC,GAAF,EAAO,CAAC,GAAR,EAAa,CAAC,GAAd,CAFF,EAGE,CAAC,CAAC,GAAF,EAAO,GAAP,EAAY,CAAC,GAAb,CAHF,EAIE,CAAC,GAAD,EAAM,CAAC,GAAP,EAAY,CAAC,GAAb,CAJF,EAKE,CAAC,GAAD,EAAM,GAAN,EAAW,CAAC,GAAZ,CALF;AAOE,CAAC,CAAC,GAAF,EAAO,CAAC,GAAR,EAAa,GAAb,CAPF,EAQE,CAAC,CAAC,GAAF,EAAO,GAAP,EAAY,GAAZ,CARF,EASE,CAAC,GAAD,EAAM,CAAC,GAAP,EAAY,GAAZ,CATF,EAUE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAVF,CADU,EAaV;AAEE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFF,EAGE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHF;AAKE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CALF,EAME,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CANF;AAQE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CARF,EASE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CATF;AAWE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAXF,EAYE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAZF;AAcE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAdF,EAeE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAfF;AAiBE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAjBF,EAkBE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAlBF,CAbU,CAD+B,CAAtC;AAqCP,MAAM5V,sBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;AACA,AAAe,SAAS0I,KAAT,CAAezvB,KAAf,EAAmE;SACzE8O,oBAAC,OAAD;IAAS,oBAAoB,EAAEuD;KAA0BrS,KAAzD;IAAgE,WAAW,EAAEwvB;KAApF;;;ACvCF,MAAME,aAAa,GAAG,EAAtB;AACA,MAAMC,aAAa,GAAG,EAAtB;AACA,MAAMC,MAAM,GAAG,GAAf;AAEA,MAAMpI,SAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAOoI,MAAP,CAAlB;AACA,MAAMnI,SAAS,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAACmI,MAAR,CAAlB;AACA,MAAM5xB,QAAM,GAAG,CAACwpB,SAAD,EAAYC,SAAZ,CAAf;AACA,MAAMoI,KAAK,GAAG,EAAd;;AAEA,KAAK,IAAIzxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsxB,aAApB,EAAmCtxB,CAAC,EAApC,EAAwC;OACjC,IAAIyoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8I,aAApB,EAAmC9I,CAAC,EAApC,EAAwC;UAChC7kB,GAAG,GAAI,CAAC5D,CAAC,GAAG,CAAL,KAAWsxB,aAAa,GAAG,CAA3B,CAAD,GAAkCj0B,IAAI,CAACwJ,EAAnD;UACMtH,CAAC,GAAGiyB,MAAM,GAAGn0B,IAAI,CAAC0G,GAAL,CAASH,GAAT,CAAnB;UACMxG,KAAK,GAAGo0B,MAAM,GAAGn0B,IAAI,CAACyG,GAAL,CAASF,GAAT,CAAvB;UACMD,KAAK,GAAI8kB,CAAC,GAAG,CAAJ,GAAQprB,IAAI,CAACwJ,EAAd,GAAoB0qB,aAAlC;UACMlyB,CAAC,GAAGjC,KAAK,GAAGC,IAAI,CAAC0G,GAAL,CAASJ,KAAT,CAAlB;UACMrE,CAAC,GAAGlC,KAAK,GAAGC,IAAI,CAACyG,GAAL,CAASH,KAAT,CAAlB;IACA/D,QAAM,CAACsP,IAAP,CAAY,CAAC7P,CAAD,EAAIC,CAAJ,EAAOC,CAAP,CAAZ;;QACIkpB,CAAC,GAAG,CAAR,EAAW;;YAEHiJ,cAAc,GAAG1xB,CAAC,KAAK,CAAN,GAAU,CAAV,GAAcJ,QAAM,CAACG,MAAP,GAAgB,CAAhB,GAAoBwxB,aAAzD;MACAE,KAAK,CAACviB,IAAN,CAAW,CAACtP,QAAM,CAACG,MAAP,GAAgB,CAAjB,EAAoBH,QAAM,CAACG,MAAP,GAAgB,CAApC,EAAuC2xB,cAAvC,CAAX;;UACI1xB,CAAC,GAAG,CAAR,EAAW;QACTyxB,KAAK,CAACviB,IAAN,CAAW,CAACtP,QAAM,CAACG,MAAP,GAAgB,CAAjB,EAAoB2xB,cAAc,GAAG,CAArC,EAAwCA,cAAxC,CAAX;;;GAdgC;;;QAmBhCA,cAAc,GAAG1xB,CAAC,KAAK,CAAN,GAAU,CAAV,GAAcJ,QAAM,CAACG,MAAP,GAAgB,IAAIwxB,aAAzD;EACAE,KAAK,CAACviB,IAAN,CAAW,CAACtP,QAAM,CAACG,MAAP,GAAgB,CAAjB,EAAoBH,QAAM,CAACG,MAAP,GAAgBwxB,aAApC,EAAmDG,cAAnD,CAAX;;MACI1xB,CAAC,GAAG,CAAR,EAAW;IACTyxB,KAAK,CAACviB,IAAN,CAAW,CAACtP,QAAM,CAACG,MAAP,GAAgB,CAAjB,EAAoBH,QAAM,CAACG,MAAP,GAAgBwxB,aAAhB,GAAgC,CAApD,EAAuDG,cAAvD,CAAX;;;;;AAIJ,KAAK,IAAIjJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8I,aAApB,EAAmC9I,CAAC,EAApC,EAAwC;QAChCkJ,EAAE,GAAG/xB,QAAM,CAACG,MAAP,GAAgBwxB,aAAhB,GAAgC9I,CAA3C;QACMmJ,MAAM,GAAGnJ,CAAC,KAAK,CAAN,GAAU7oB,QAAM,CAACG,MAAP,GAAgB,CAA1B,GAA8B4xB,EAAE,GAAG,CAAlD;EACAF,KAAK,CAACviB,IAAN,CAAW,CAACyiB,EAAD,EAAKC,MAAL,EAAa,CAAb,CAAX;;;AAGF,MAAaC,OAAO,GAAGjJ,wBAAwB,CAACiB,YAAY,CAACjqB,QAAD,EAAS6xB,KAAT,CAAb,CAAxC;AAEP,MAAMxd,sBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;AACA,AAAe,SAASmJ,OAAT,CAAiBlwB,KAAjB,EAA2E;SACjF8O,oBAAC,OAAD;IAAS,oBAAoB,EAAEuD;KAA0BrS,KAAzD;IAAgE,WAAW,EAAEiwB;KAApF;;;AC9CK,SAASE,aAAT,CAAuBxf,KAAvB,EAAqCyf,MAArC,EAA4D;SAC1D;IAAE3yB,CAAC,EAAEkT,KAAK,CAAClT,CAAN,GAAU2yB,MAAf;IAAuB1yB,CAAC,EAAEiT,KAAK,CAACjT,CAAN,GAAU0yB,MAApC;IAA4CzyB,CAAC,EAAEgT,KAAK,CAAChT,CAAN,GAAUyyB;GAAhE;;AAGF,AAAO,MAAMC,aAAa,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAtB;AACP,AAAO,MAAMC,oBAAoB,GAAG,CAAC,GAAD,EAAM,CAAN,EAAS,GAAT,EAAc,CAAd,CAA7B;AACP,AAAO,MAAMC,kBAAkB,GAAG,CAAC,CAAD,EAAI,GAAJ,EAAS,CAAT,EAAY,CAAZ,CAA3B;AACP,AAAO,MAAMC,UAAU,GAAG,YAAnB;AACP,MAAMC,iBAAiB,GAAG,GAA1B;AACA,AAAO,MAAMC,UAAU,GAAG;EAAEjzB,CAAC,EAAE,GAAL;EAAUC,CAAC,EAAE,GAAb;EAAkBC,CAAC,EAAE;CAAxC;AACP,AAAO,MAAMgzB,gBAAgB,GAAGR,aAAa,CAACO,UAAD,EAAaD,iBAAb,CAAtC;AACP,AAAO,MAAMG,YAAY,GAAG;EAAEnzB,CAAC,EAAE,GAAL;EAAUC,CAAC,EAAE,GAAb;EAAkBC,CAAC,EAAE;CAA1C;AACP,AAAO,MAAMkzB,kBAAkB,GAAGV,aAAa,CAACS,YAAD,EAAeH,iBAAf,CAAxC;AACP,AAAO,MAAMK,IAAI,GAAG;EAClBlwB,QAAQ,EAAE;IAAEnD,CAAC,EAAE,CAAL;IAAQC,CAAC,EAAE,CAAX;IAAcC,CAAC,EAAE;GADT;EAElBoD,WAAW,EAAE;IAAEtD,CAAC,EAAE,CAAL;IAAQC,CAAC,EAAE,CAAX;IAAcC,CAAC,EAAE,CAAjB;IAAoBV,CAAC,EAAE;;CAF/B;AAKP,IAAIgC,KAAK,GAAG,CAAZ;AAEA,AAAO,MAAM8xB,YAAN,CAAmB;EAKxB51B,WAAW,CAAC6C,MAAD,EAAe;;;;;oCAFR,KAEQ;;SACnB2X,EAAL,GAAU1W,KAAK,EAAf;SACKiI,KAAL,GAAalJ,MAAb;;;;AAIJ,AAAO,MAAMgzB,OAAN,CAAc;EAMnB71B,WAAW,CAAC+R,IAAY,GAAG,EAAhB,EAAoB;;;;;oCAHN,EAGM;;oCAFb,KAEa;;SACxBA,IAAL,GAAYA,IAAZ;SACKyI,EAAL,GAAU1W,KAAK,EAAf;;;;;AAUJ,MAAMgyB,gCAAsD,GAAG,CAC7DjxB,KAD6D,EAE7Dsa,gBAF6D,EAG7DxB,eAH6D,KAI1D;;SAEI9Y,KAAK,CACTkV,GADI,CACCwQ,IAAD,IAAU;QACT5M,eAAe,CAACU,IAAhB,CAAqB,CAAC;MAAElE;KAAH,KAAgBA,MAAM,KAAKoQ,IAAhD,CAAJ,EAA2D;aAClD,IAAP;;;UAEII,UAAU,qBAAQJ,IAAR,CAAhB,CAJa;;;UAMP,CAACK,WAAD,IAAgBzL,gBAAgB,CAACoL,IAAI,CAACG,cAAN,EAAsB,CAAtB,CAAtC,CANa;;IAQbC,UAAU,CAACnV,KAAX,GAAmBigB,YAAnB;IAEA9K,UAAU,CAACtnB,KAAX,GAAmBunB,WAAnB;;QACID,UAAU,CAAC/mB,MAAX,IAAqB+mB,UAAU,CAAC9nB,MAAhC,IAA0C8nB,UAAU,CAAC9nB,MAAX,CAAkBG,MAAhE,EAAwE;MACtE2nB,UAAU,CAAC/mB,MAAX,GAAoB,IAAIL,KAAJ,CAAUonB,UAAU,CAAC9nB,MAAX,CAAkBG,MAA5B,EAAoC8W,IAApC,CAAyC8Q,WAAzC,CAApB;;;WAEKD,UAAP;GAfG,EAiBJG,MAjBI,CAiBGC,OAjBH,CAAP;CANF;;;;;;AA6BA,MAAMgL,YAAN,SAA2B1oB,cAAK,CAAC+mB,SAAjC,CAAkD;EAChD3gB,MAAM,GAAG;UACDuiB,QAAQ,GAAG,KAAKnxB,KAAL,CAAW6O,QAA5B;UACMqc,QAAa,GAAG,EAAtB;;SACK,MAAMkG,IAAX,IAAmBD,QAAnB,EAA6B;YACrB3yB,KAAK,GAAG4yB,IAAI,CAACC,MAAL,GAAcf,oBAAd,GAAqCD,aAAnD;YACMryB,MAAwB,GAAGozB,IAAI,CAACpzB,MAAL,CAAYkX,GAAZ,CAAgB,CAAC;QAAEhO;OAAH,KAAerJ,WAAW,CAACqJ,KAAD,CAA1C,CAAjC;MAEAgkB,QAAK,CAAC5d,IAAN,CAAW;QACTqf,SAAS,EAAE6D,UADF;QAET3vB,IAAI,EAAEiwB,IAFG;QAGT9yB,MAHS;QAIT2S,KAAK,EAAE+f,UAJE;QAKTlyB,KAAK,EAAED,UAAU,CAACC,KAAD,CALR;QAMTqnB,cAAc,EAAEuL;OANlB;;;WAUK5oB,6BAAC,KAAD;MAAO,oBAAoB,EAAEyoB;OAAmC/F,QAAhE,CAAP;;;;;AAIJ,MAAMoG,iCAAuD,GAAG,CAC9DtxB,KAD8D,EAE9Dsa,gBAF8D,EAG9DxB,eAH8D,KAI3D;;SAEI9Y,KAAK,CACTkV,GADI,CACCwQ,IAAD,IAAU;QACT5M,eAAe,CAACU,IAAhB,CAAqB,CAAC;MAAElE;KAAH,KAAgBA,MAAM,KAAKoQ,IAAhD,CAAJ,EAA2D;aAClD,IAAP;;;UAEII,UAAU,qBAAQJ,IAAR,CAAhB,CAJa;;;;;IAQbI,UAAU,CAAC/mB,MAAX,GAAoB+mB,UAAU,CAAC/mB,MAAX,CAAkBmW,GAAlB,CAAsB,CAAC1W,KAAD,EAAQ4W,KAAR,KAAkB;aACnDkF,gBAAgB,CAACoL,IAAI,CAAC6L,eAAL,CAAqBnc,KAArB,CAAD,EAA8B,CAA9B,CAAvB;KADkB,CAApB,CARa;;IAYb0Q,UAAU,CAACnV,KAAX,GAAmBkgB,kBAAnB;WACO/K,UAAP;GAdG,EAgBJG,MAhBI,CAgBGC,OAhBH,CAAP;CANF;;;;;;AA4BA,MAAMsL,aAAN,SAA4BhpB,cAAK,CAAC+mB,SAAlC,CAAmD;EACjD3gB,MAAM,GAAG;UACDuiB,QAAQ,GAAG,KAAKnxB,KAAL,CAAW6O,QAA5B;UACM7Q,MAAM,GAAG,EAAf;UACMe,MAAM,GAAG,EAAf;UACMwyB,eAAe,GAAG,EAAxB;;SAEK,MAAMH,IAAX,IAAmBD,QAAnB,EAA6B;YACrB3yB,KAAK,GAAG4yB,IAAI,CAACC,MAAL,GAAcf,oBAAd,GAAqCD,aAAnD;;WACK,MAAMnpB,KAAX,IAAoBkqB,IAAI,CAACpzB,MAAzB,EAAiC;cACzByzB,cAAc,GAAG5zB,WAAW,CAACqJ,KAAK,CAACA,KAAP,CAAlC;QACAlJ,MAAM,CAACsP,IAAP,CAAYmkB,cAAZ;QACA1yB,MAAM,CAACuO,IAAP,CAAYpG,KAAK,CAACmqB,MAAN,GAAed,kBAAf,GAAoC/xB,KAAhD;QACA+yB,eAAe,CAACjkB,IAAhB,CAAqBpG,KAArB;;;;UAIEwqB,UAAsB,GAAG;MAC7B1zB,MAD6B;MAE7Be,MAF6B;MAG7B8B,IAAI,EAAEiwB,IAHuB;MAI7BngB,KAAK,EAAEggB,gBAJsB;MAK7BY;KALF;WAQO/oB,6BAAC,OAAD;MAAS,oBAAoB,EAAE8oB;OAAoC,CAACI,UAAD,CAAnE,CAAP;;;;;AAIJ,AAAe,SAASC,YAAT,CAAsB;EAAE9iB,QAAQ,EAAEsiB,QAAQ,GAAG;CAA7C,EAA0D;MACnEA,QAAQ,CAAChzB,MAAT,KAAoB,CAAxB,EAA2B;WAClB,IAAP;;;SAIAqK,6BAACA,cAAD,CAAO,QAAP,QACEA,6BAAC,YAAD,QAAe2oB,QAAf,CADF,EAEE3oB,6BAAC,aAAD,QAAgB2oB,QAAhB,CAFF,CADF;;;ACzJF,SAASS,QAAT,CAAkBC,MAAlB,EAAwCC,MAAxC,EAA8D;QACtD,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,IAAeJ,MAAM,CAAC3qB,KAA5B;QACM,CAACgrB,EAAD,EAAKC,EAAL,EAASC,EAAT,IAAeN,MAAM,CAAC5qB,KAA5B;SACO6qB,EAAE,KAAKG,EAAP,IAAaF,EAAE,KAAKG,EAApB,IAA0BF,EAAE,KAAKG,EAAxC;;;AAGF,SAASC,QAAT,CAAkBC,OAAlB,EAA6C;QACrC;IAAEt0B;MAAWs0B,OAAnB;;OACK,IAAIl0B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,MAAM,CAACG,MAAP,GAAgB,CAApC,EAAuCC,CAAC,EAAxC,EAA4C;QACtCwzB,QAAQ,CAAC5zB,MAAM,CAACI,CAAD,CAAP,EAAYJ,MAAM,CAACI,CAAC,GAAG,CAAL,CAAlB,CAAZ,EAAwC;aAC/B,IAAP;;;;QAGEm0B,UAAU,GAAGv0B,MAAM,CAAC,CAAD,CAAzB;QACMw0B,SAAS,GAAGx0B,MAAM,CAACA,MAAM,CAACG,MAAP,GAAgB,CAAjB,CAAxB;SACOyzB,QAAQ,CAACW,UAAD,EAAaC,SAAb,CAAf;;;;;;;;AASF,AAAe,MAAMC,cAAN,CAAqB;EAQlCt3B,WAAW,CAACg2B,QAAmB,GAAG,EAAvB,EAA2B;uCAPjB,KAOiB;;;;sCALf,MAAM,EAKS;;;;;;;;yCA8EV,CAACroB,CAAD,EAAI8N,IAAJ,KAAa;;;UAGnC,KAAK8b,aAAT,EAAwB;QACtB5pB,CAAC,CAACE,cAAF;QACAF,CAAC,CAACmD,eAAF;OALqC;;;;UAUnC,CAAC,KAAK0mB,SAAV,EAAqB;;;;UAGjB,CAAC/b,IAAL,EAAW;;OAb4B;;;UAkBnC,CAAC,KAAKgc,WAAN,IAAqB,CAAC,KAAKF,aAA/B,EAA8C;;;;YAIxC;QAAE/f;UAAQiE,IAAhB;YACM1P,KAAK,GAAGyL,GAAG,CAACvC,iBAAJ,CAAsB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAtB,EAAiC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAjC,CAAd,CAvBuC;;UAyBnC,CAAClJ,KAAL,EAAY;;OAzB2B;;;YA8BjC;QAAEwrB;UAAkB,IAA1B;;UAEI,KAAKE,WAAT,EAAsB;aACfC,iBAAL,CAAuB3rB,KAAvB;OADF,MAEO,IAAIwrB,aAAa,IAAI,KAAKI,cAA1B,EAA0C;;cAEzC,CAACC,MAAD,EAASC,MAAT,IAAmB9rB,KAAzB;cACM,CAACgK,MAAD,EAASC,MAAT,IAAmB,KAAK2hB,cAA9B,CAH+C;;cAKzCG,EAAE,GAAGF,MAAM,GAAG7hB,MAApB;cACMgiB,EAAE,GAAGF,MAAM,GAAG7hB,MAApB,CAN+C;;aAS1C2hB,cAAL,GAAsB5rB,KAAtB,CAT+C;;cAYzCisB,YAAY,GAAGT,aAAa,CAAC10B,MAAd,CAAqBohB,MAArB,CAA4B,CAACgU,GAAD,EAAMlsB,KAAN,KAAgB;cAC3D,CAACksB,GAAG,CAACvV,QAAJ,CAAa3W,KAAb,CAAL,EAA0B;YACxBksB,GAAG,CAAC9lB,IAAJ,CAASpG,KAAT;;;iBAEKksB,GAAP;SAJmB,EAKlB,EALkB,CAArB,CAZ+C;;aAoB1C,MAAMC,YAAX,IAA2BF,YAA3B,EAAyC;gBACjC;YAAEjsB;cAAUmsB,YAAlB;UACAnsB,KAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAL,GAAW+rB,EAAtB;UACA/rB,KAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAL,GAAWgsB,EAAtB;;;aAGGI,QAAL;;KA1IkC;;uCA0KzBxqB,CAAD,IAA4B;;YAEhC;QAAE4pB;UAAkB,IAA1B;;UACI,CAACA,aAAL,EAAoB;;;;cAIZ5pB,CAAC,CAAClD,GAAV;aACO,QAAL;aACK,WAAL;cACM,KAAKgtB,WAAT,EAAsB;iBACfW,WAAL,CAAiB,KAAKX,WAAtB;WADF,MAEO;iBACAY,aAAL,CAAmBd,aAAnB;;;eAEGY,QAAL;;;;;;KAzLgC;;uCAgOZ,CAACxqB,CAAD,EAAI8N,IAAJ,KAAa;UACjC,CAAC9N,CAAC,CAAC8C,OAAP,EAAgB;aACT+mB,SAAL,GAAiB,KAAjB;;KAlOkC;;2CAuOR,CAAC7pB,CAAD,EAAI8N,IAAJ,KAAa;;UAErC,CAACA,IAAL,EAAW;;;;UAGP,CAACA,IAAI,CAAClE,OAAL,CAAavU,MAAlB,EAA0B;;;;WAIrBs1B,YAAL,CAAkB7c,IAAI,CAAClE,OAAL,CAAa,CAAb,EAAgB4C,MAAlC,EATyC;;UAYrC,KAAKsd,WAAT,EAAsB;aACfW,WAAL,CAAiB,KAAKX,WAAtB;;OAbuC;;;YAkBnC;QAAEF;UAAkB,IAA1B,CAlByC;;UAqBrC,CAACA,aAAL,EAAoB;;;;UAIhBgB,gBAAgB,GAAG9S,MAAM,CAACC,gBAA9B;UACI8S,aAAa,GAAG,CAAC,CAArB;YACM;QAAEhhB;UAAQiE,IAAhB;YACM1P,KAAK,GAAGyL,GAAG,CAACvC,iBAAJ,CAAsB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAtB,EAAiC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAjC,CAAd;;UACI,CAAClJ,KAAL,EAAY;;;;YAGN,CAAC0sB,EAAD,EAAKC,EAAL,IAAW3sB,KAAjB,CAhCyC;;YAmCnC;QAAElJ;UAAW00B,aAAnB;;WACK,IAAIt0B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,MAAM,CAACG,MAAP,GAAgB,CAApC,EAAuCC,CAAC,EAAxC,EAA4C;cACpCyzB,MAAM,GAAG7zB,MAAM,CAACI,CAAD,CAArB;cACM0zB,MAAM,GAAG9zB,MAAM,CAACI,CAAC,GAAG,CAAL,CAArB;cACM,CAAC2zB,EAAD,EAAKC,EAAL,IAAWH,MAAM,CAAC3qB,KAAxB;cACM,CAACgrB,EAAD,EAAKC,EAAL,IAAWL,MAAM,CAAC5qB,KAAxB,CAJ0C;;;cAQpC4sB,IAAI,GAAG9wB,QAAQ,CAAC+wB,OAAT,CAAiBhC,EAAjB,EAAqBC,EAArB,EAAyBE,EAAzB,EAA6BC,EAA7B,EAAiCyB,EAAjC,EAAqCC,EAArC,CAAb;;YACIC,IAAI,GAAGJ,gBAAX,EAA6B;UAC3BA,gBAAgB,GAAGI,IAAnB;UACAH,aAAa,GAAGv1B,CAAhB;;OA/CqC;;;UAoDrCu1B,aAAa,GAAG,CAAC,CAArB,EAAwB;cAChBK,QAAQ,GAAG,IAAIjD,YAAJ,CAAiB7pB,KAAjB,CAAjB;QACAwrB,aAAa,CAAC10B,MAAd,CAAqBi2B,MAArB,CAA4BN,aAAa,GAAG,CAA5C,EAA+C,CAA/C,EAAkDK,QAAlD;aACKpB,WAAL,GAAmBoB,QAAnB;;;WAEGV,QAAL;KAhSoC;;yCAoSV,CAACxqB,CAAD,EAAI8N,IAAJ,KAAa;UACnC,CAACA,IAAL,EAAW;;;;YAGL;QAAEjE;UAAQiE,IAAhB;YAEM1P,KAAK,GAAGyL,GAAG,CAACvC,iBAAJ,CAAsB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAtB,EAAiC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAjC,CAAd,CANuC;;UASnC,CAAClJ,KAAL,EAAY;;;;YAINgtB,YAAY,GAAG,CAAC,KAAKvB,SAA3B;WACKA,SAAL,GAAiB,IAAjB;WACKG,cAAL,GAAsB5rB,KAAtB;YACMitB,WAAW,GAAGrrB,CAAC,CAAC8C,OAAtB,CAhBuC;;UAmBnCsoB,YAAY,IAAI,CAACC,WAArB,EAAkC;cAC1BC,WAAW,GAAGxd,IAAI,CAAClE,OAAL,CAAa,CAAb,CAApB;aACK+gB,YAAL,CAAkBW,WAAW,IAAIA,WAAW,CAAC9e,MAA7C;eACO,KAAKge,QAAL,EAAP;OAtBqC;;;UA0BnCa,WAAJ,EAAiB;aACVE,SAAL,CAAentB,KAAf;eACO,KAAKosB,QAAL,EAAP;OA5BqC;;;WAgClCgB,kBAAL;aACO,KAAKhB,QAAL,EAAP;KArUoC;;SAC/BnC,QAAL,GAAgBA,QAAhB;;;EAGFoD,qBAAqB,GAAY;WACxB,CAAC,CAAC,KAAK7B,aAAP,IAAwBL,QAAQ,CAAC,KAAKK,aAAN,CAAvC;GAbgC;;;EAiBlC8B,UAAU,CAACld,GAAD,EAA+B;UACjC;MAAEtZ,MAAF;MAAUkP;QAASoK,GAAzB;;QACItZ,MAAM,CAACG,MAAP,GAAgB,CAApB,EAAuB;;KAFgB;;;SAMlCs1B,YAAL;UAEMnB,OAAO,GAAG,IAAItB,OAAJ,CAAY9jB,IAAZ,CAAhB;IACAolB,OAAO,CAACt0B,MAAR,GAAiBA,MAAM,CAACkX,GAAP,CAAY6Z,CAAD,IAAO,IAAIgC,YAAJ,CAAiB,CAAChC,CAAC,CAACtxB,CAAH,EAAMsxB,CAAC,CAACrxB,CAAR,EAAWqxB,CAAC,CAACpxB,CAAF,IAAO,CAAlB,CAAjB,CAAlB,CAAjB;;QACI,CAAC00B,QAAQ,CAACC,OAAD,CAAb,EAAwB;MACtBA,OAAO,CAACt0B,MAAR,CAAesP,IAAf,CAAoBglB,OAAO,CAACt0B,MAAR,CAAe,CAAf,CAApB;;;SAEGmzB,QAAL,CAAc7jB,IAAd,CAAmBglB,OAAnB;GA9BgC;;;;EAmClC+B,SAAS,CAACntB,KAAD,EAAoB;UACrB;MAAEwrB;QAAkB,IAA1B;;QACIA,aAAJ,EAAmB;;UAEb,CAACL,QAAQ,CAACK,aAAD,CAAb,EAA8B;cACtBsB,QAAQ,GAAG,IAAIjD,YAAJ,CAAiB7pB,KAAjB,CAAjB;QACAwrB,aAAa,CAAC10B,MAAd,CAAqBsP,IAArB,CAA0B0mB,QAA1B;aACKP,YAAL,CAAkBO,QAAlB;;;;;UAKE1B,OAAO,GAAG,IAAItB,OAAJ,EAAhB;IACAsB,OAAO,CAACt0B,MAAR,CAAesP,IAAf,CAAoB,IAAIyjB,YAAJ,CAAiB7pB,KAAjB,CAApB;UACMutB,aAAa,GAAG,IAAI1D,YAAJ,CAAiB7pB,KAAjB,CAAtB;IACAorB,OAAO,CAACt0B,MAAR,CAAesP,IAAf,CAAoBmnB,aAApB;SACKtD,QAAL,CAAc7jB,IAAd,CAAmBglB,OAAnB;SACKmB,YAAL,CAAkBgB,aAAlB;SACKnB,QAAL;GArDgC;;;EAyDlCT,iBAAiB,CAAC3rB,KAAD,EAAoB;QAC/B,KAAK0rB,WAAT,EAAsB;WACfA,WAAL,CAAiB1rB,KAAjB,GAAyBA,KAAzB;WACKosB,QAAL;;GA5D8B;;;;;;;;EAsElCgB,kBAAkB,GAAS;UACnBhC,OAAO,GAAG,KAAKI,aAArB;;QACI,CAACJ,OAAL,EAAc;;KAFW;;;QAOrBA,OAAO,CAACt0B,MAAR,CAAeG,MAAf,KAA0B,CAA9B,EAAiC;WAC1Bq1B,aAAL,CAAmBlB,OAAnB;KADF,MAEO;MACLA,OAAO,CAACt0B,MAAR,CAAesP,IAAf,CAAoBglB,OAAO,CAACt0B,MAAR,CAAe,CAAf,CAApB;;;SAEGs1B,QAAL;GAlFgC;;;;EAuJlCE,aAAa,CAAClB,OAAD,EAAyB;SAC/BnB,QAAL,GAAgB,KAAKA,QAAL,CAAclL,MAAd,CAAsBmL,IAAD,IAAUA,IAAI,KAAKkB,OAAxC,CAAhB;SACKI,aAAL,GAAqB,IAArB;GAzJgC;;;;;EA+JlCa,WAAW,CAACrsB,KAAD,EAA4B;UAC/B;MAAEwrB;QAAkB,IAA1B;;QACI,CAACA,aAAL,EAAoB;;;;UAGdgC,SAAS,GAAGhC,aAAa,CAAC10B,MAAd,CAAqBioB,MAArB,CAA6B8I,CAAD,IAAOA,CAAC,CAACpZ,EAAF,KAASzO,KAAK,CAACyO,EAAlD,CAAlB,CALqC;;QAOjC+e,SAAS,CAACv2B,MAAV,KAAqBu0B,aAAa,CAAC10B,MAAd,CAAqBG,MAArB,GAA8B,CAAvD,EAA0D;MACxDu2B,SAAS,CAACpnB,IAAV,CAAeonB,SAAS,CAAC,CAAD,CAAxB;;;IAEFhC,aAAa,CAAC10B,MAAd,GAAuB02B,SAAvB;SACK9B,WAAL,GAAmB,IAAnB;;QACIF,aAAa,CAAC10B,MAAd,CAAqBG,MAArB,GAA8B,CAAlC,EAAqC;WAC9Bq1B,aAAL,CAAmBd,aAAnB;;;SAEGY,QAAL;GA9KgC;;;;EAyMlCG,YAAY,CAACne,MAAD,EAAkC;;SAEvCod,aAAL,GAAqB,IAArB;;QACI,KAAKE,WAAT,EAAsB;WACfA,WAAL,CAAiBvB,MAAjB,GAA0B,KAA1B;;;SAEGuB,WAAL,GAAmB,IAAnB;;SAEK,MAAMN,OAAX,IAAsB,KAAKnB,QAA3B,EAAqC;UAC/BwD,QAAQ,GAAGrC,OAAO,KAAKhd,MAA3B;MACAgd,OAAO,CAACjB,MAAR,GAAiBsD,QAAjB;;UACIA,QAAJ,EAAc;aACPjC,aAAL,GAAqBJ,OAArB;;;WAEG,MAAMprB,KAAX,IAAoBorB,OAAO,CAACt0B,MAA5B,EAAoC;YAC9BkJ,KAAK,KAAKoO,MAAd,EAAsB;;;eAGfsd,WAAL,GAAmB1rB,KAAnB;UACAA,KAAK,CAACmqB,MAAN,GAAe,IAAf;UACAiB,OAAO,CAACjB,MAAR,GAAiB,IAAjB;eACKqB,aAAL,GAAqBJ,OAArB;UACAqC,QAAQ,GAAG,IAAX;;;;;SAKDrB,QAAL;GApOgC;;;;;ACxBpC,MAAMsB,uBAAuB,GAAG;EAAEz1B,MAAM,EAAE,IAAV;EAAgBU,IAAI,EAAE;CAAtD;AACA,MAAMg1B,sBAAsB,GAAG;EAC7B11B,MAAM,EAAE,IADqB;EAE7BU,IAAI,EAAE,IAFuB;EAG7BT,IAAI,EAAE;CAHR;;AAMA,MAAM01B,WAAW,GAAIzzB,IAAD,IAClBjB,QAAQ,CAAC;EACPusB,SAAS,EAAE,WADJ;EAEPrsB,IAAI,EAAG;;;;;;;;;;;;;GAFA;EAgBPgiB,IAAI,EAAG;;;;;;GAhBA;EAuBPzH,UAAU,EAAE;IACV3T,KAAK,EAAE,CAACnH,OAAD,EAAUC,KAAV,KAAoB;UACrBiB,aAAa,CAACjB,KAAK,CAAChC,MAAP,CAAjB,EAAiC;eACxBD,gBAAgB,CAACiC,KAAK,CAAChC,MAAP,CAAvB;;;aAEKgC,KAAK,CAAChC,MAAb;;GA5BG;EA+BPuC,QAAQ,EAAE;IACR/B,KAAK,EAAE,CAACuB,OAAD,EAAUC,KAAV,KAAoB;UACrBiB,aAAa,CAACjB,KAAK,CAACxB,KAAP,CAAjB,EAAgC;eACvBH,MAAM,CAAC2B,KAAK,CAACxB,KAAP,CAAb;;;aAEKwB,KAAK,CAACxB,KAAb;;GApCG;;;EAyCPyB,KAAK,EAAE;IACLd,MAAM,EAAE,CAACY,OAAD,EAAUC,KAAV,KAAoB;aAClBA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACC,KAAN,CAAYd,MAA5B,IAAuCy1B,uBAAuB,CAACz1B,MAAtE;KAFG;IAILU,IAAI,EAAE,CAACE,OAAD,EAAUC,KAAV,KAAoB;aAChBA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACC,KAAN,CAAYJ,IAA5B,IAAqC+0B,uBAAuB,CAAC/0B,IAApE;;GA9CG;EAiDPM,KAAK,EAAED,YAjDA;EAmDPjB,KAAK,EAAE,CAACc,OAAD,EAAUC,KAAV,KAAoBA,KAAK,CAAChC,MAAN,CAAaG;CAnDlC,CADV;;AAuDA,MAAM42B,YAAY,GAAI1zB,IAAD,IACnBjB,QAAQ,CAAC;EACPusB,SAAS,EAAE,WADJ;EAEPrsB,IAAI,EAAG;;;;;;;;;;;;;;;;;GAFA;EAoBPgiB,IAAI,EAAG;;;;;;GApBA;EA2BPzH,UAAU,EAAE;IACV3T,KAAK,EAAE,CAACnH,OAAD,EAAUC,KAAV,KAAoB;UACrBiB,aAAa,CAACjB,KAAK,CAAChC,MAAP,CAAjB,EAAiC;eACxBD,gBAAgB,CAACiC,KAAK,CAAChC,MAAP,CAAvB;;;aAEKgC,KAAK,CAAChC,MAAb;KALQ;IAOVQ,KAAK,EAAE,CAACuB,OAAD,EAAUC,KAAV,KAAoB;UACrB,CAACA,KAAK,CAACjB,MAAP,IAAiB,CAACiB,KAAK,CAACjB,MAAN,CAAaZ,MAAnC,EAA2C;cACnC,IAAIoX,KAAJ,CAAW,kFAAX,CAAN;;;UAEEtU,aAAa,CAACjB,KAAK,CAACjB,MAAP,CAAjB,EAAiC;eACxBiC,eAAe,CAAChB,KAAD,CAAtB;;;aAEKA,KAAK,CAACjB,MAAb;;GAzCG;EA6CPkB,KAAK,EAAE;IACLd,MAAM,EAAE,CAACY,OAAD,EAAUC,KAAV,KAAoB;aAClBA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACC,KAAN,CAAYd,MAA5B,IAAuC01B,sBAAsB,CAAC11B,MAArE;KAFG;IAILU,IAAI,EAAE,CAACE,OAAD,EAAUC,KAAV,KAAoB;aAChBA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACC,KAAN,CAAYJ,IAA5B,IAAqCg1B,sBAAsB,CAACh1B,IAAnE;;GAlDG;EAqDPM,KAAK,EAAED,YArDA;EAuDPjB,KAAK,EAAE,CAACc,OAAD,EAAUC,KAAV,KAAoBA,KAAK,CAAChC,MAAN,CAAaG;CAvDlC,CADV;;;AA4DA,MAAM62B,SAAS,GAAI3zB,IAAD,IAAgB;QAC1B4zB,MAAM,GAAGjO,wBAAwB,CAAC8N,WAAD,CAAxB,CAAsCzzB,IAAtC,CAAf;QACM6zB,MAAM,GAAGlO,wBAAwB,CAAC+N,YAAD,CAAxB,CAAuC1zB,IAAvC,CAAf;SACO,CAACrB,KAAD,EAAa0Z,QAAb,KAAmC;UAClCyb,KAAqB,GAAGz2B,KAAK,CAACC,OAAN,CAAcqB,KAAd,IAAuBA,KAAvB,GAA+B,CAACA,KAAD,CAA7D;UACMo1B,gBAAgB,GAAG,EAAzB;UACMC,gBAAgB,GAAG,EAAzB;IACAF,KAAK,CAACtnB,OAAN,CAAesF,IAAD,IAAU;;UAElBuG,QAAQ,IAAI,CAACvG,IAAI,CAACmiB,kBAAtB,EAA0C;YACpCniB,IAAI,CAACpU,MAAL,IAAeoU,IAAI,CAACpU,MAAL,CAAYZ,MAA/B,EAAuC;UACrCk3B,gBAAgB,CAAC/nB,IAAjB,CAAsB6F,IAAtB;SADF,MAEO;UACLiiB,gBAAgB,CAAC9nB,IAAjB,CAAsB6F,IAAtB;;;KANN;IAWA8hB,MAAM,CAACG,gBAAD,CAAN;IACAF,MAAM,CAACG,gBAAD,CAAN;GAhBF;CAHF;;AAuBA,MAAaE,oBAAoB,GAAG,MAAM;SACjCP,SAAP;CADK;AAIP,MAAM3iB,sBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;AACA,AAAe,SAASyO,SAAT,CAAmBx1B,KAAnB,EAA+E;SACrF8O,oBAAC,OAAD;IAAS,oBAAoB,EAAEuD;KAA0BrS,KAAzD;IAAgE,WAAW,EAAEg1B;KAApF;;;AC/JF,MAAMS,OAAO,GAAG;EACd70B,QAAQ,EAAE;IAAEnD,CAAC,EAAE,CAAL;IAAQC,CAAC,EAAE,CAAX;IAAcC,CAAC,EAAE;GADb;EAEdoD,WAAW,EAAE;IAAEtD,CAAC,EAAE,CAAL;IAAQC,CAAC,EAAE,CAAX;IAAcC,CAAC,EAAE,CAAjB;IAAoBV,CAAC,EAAE;;CAFtC;AAKA,MAAMy4B,aAAa,GAAG;EAAEj4B,CAAC,EAAE,CAAL;EAAQC,CAAC,EAAE,CAAX;EAAcC,CAAC,EAAE;CAAvC;;AAEA,SAASg4B,SAAT,CAAmB33B,MAAnB,EAAiD;QACzCgV,KAAK,GAAG,IAAI9U,YAAJ,CAAiBF,MAAM,CAACG,MAAP,GAAgB,CAAjC,CAAd;;OACK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,MAAM,CAACG,MAA3B,EAAmCC,CAAC,EAApC,EAAwC;UAChC,CAACX,CAAD,EAAIC,CAAJ,EAAOC,CAAP,IAAYK,MAAM,CAACI,CAAD,CAAxB;IACA4U,KAAK,CAAC5U,CAAC,GAAG,CAAL,CAAL,GAAeX,CAAf;IACAuV,KAAK,CAAC5U,CAAC,GAAG,CAAJ,GAAQ,CAAT,CAAL,GAAmBV,CAAnB;IACAsV,KAAK,CAAC5U,CAAC,GAAG,CAAJ,GAAQ,CAAT,CAAL,GAAmBT,CAAnB;;;SAEKqV,KAAP;;;AAGF,SAAS4iB,eAAT,CAAyB53B,MAAzB,EAA2D;QACnD63B,eAAe,GAAGF,SAAS,CAAC33B,MAAD,CAAjC;QACM83B,OAAO,GAAGC,MAAM,CAACF,eAAD,EAAkB,IAAlB,EAAwB,CAAxB,CAAtB;QACMnB,SAAS,GAAG,EAAlB;;OACK,IAAIt2B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG03B,OAAO,CAAC33B,MAA5B,EAAoCC,CAAC,EAArC,EAAyC;UACjC43B,aAAa,GAAGF,OAAO,CAAC13B,CAAD,CAA7B;IACAs2B,SAAS,CAACpnB,IAAV,CAAetP,MAAM,CAACg4B,aAAD,CAArB;;;SAEKtB,SAAP;;;AAOF,MAAMuB,iBAAiB,GAAI9E,QAAD,IAA6B;SAC9CA,QAAQ,CAACjc,GAAT,CAAckc,IAAD,IAAU;;UAEtBpzB,MAAc,GAAGiD,aAAa,CAACmwB,IAAI,CAACpzB,MAAN,CAAb,GAA6BozB,IAAI,CAACpzB,MAAL,CAAYkX,GAAZ,CAAgB1X,WAAhB,CAA7B,GAA4D4zB,IAAI,CAACpzB,MAAxF;UACM6C,IAAI,GAAGuwB,IAAI,CAACvwB,IAAL,GAAYuwB,IAAI,CAACvwB,IAAjB,GAAwB40B,OAArC;UACMS,YAAY,GAAGN,eAAe,CAAC53B,MAAD,CAApC;6BAEKozB,IADL;MAEEpzB,MAAM,EAAEk4B,YAFV;MAGEr1B,IAHF;MAIE8P,KAAK,EAAE+kB,aAJT;MAKE7P,cAAc,EAAEuL;;GAVb,CAAP;CADF;;AAgBA,MAAa+E,yBAAyB,GAAG,MAAO90B,IAAD,IAAe;QACtD+0B,gBAAgB,GAAGb,oBAAoB,GAAGl0B,IAAH,CAA7C;SACQrB,KAAD,IAAgB;IACrBo2B,gBAAgB,CAACH,iBAAiB,CAACj2B,KAAD,CAAlB,EAA2B,KAA3B,CAAhB;GADF;CAFK;;AAQP,SAASq2B,cAAT,OAAqE;MAA7C;IAAExnB,QAAQ,EAAEsiB,QAAQ,GAAG;GAAsB;MAAf9W,IAAe;;QAC7D2a,SAAS,GAAGiB,iBAAiB,CAAC9E,QAAD,CAAnC,CADmE;;;SAMjE3oB,6BAAC,SAAD;IAAW,oBAAoB,EAAE2d;KAA4C9L,IAA7E,GACG2a,SADH,CADF;;;AC/DF,MAAMsB,cAAc,GAAG,SAAvB;AACA,MAAMC,aAAa,GAAG,iBAAtB;AACA,MAAMC,oBAAoB,GAAG,GAA7B;AACA,MAAMr5B,oBAAkB,GAAG;EAAEC,CAAC,EAAE,CAAL;EAAQC,CAAC,EAAE,CAAX;EAAcC,CAAC,EAAE,CAAjB;EAAoBC,CAAC,EAAE;CAAlD;AACA,MAAMk5B,gBAAgB,GAAG;EAAEr5B,CAAC,EAAE,CAAL;EAAQC,CAAC,EAAE,CAAX;EAAcC,CAAC,EAAE,CAAjB;EAAoBC,CAAC,EAAE;CAAhD;AAWA,IAAIm5B,kBAAkB,GAAG,KAAzB;;AACA,SAASC,eAAT,GAA2B;MACrBD,kBAAJ,EAAwB;;;;QAGlB1X,KAAK,GAAGhV,QAAQ,CAAC4sB,aAAT,CAAuB,OAAvB,CAAd;EACA5X,KAAK,CAAC6X,SAAN,GAAmB;;;;;;;;;;;;;;;;GAAnB;;MAiBI7sB,QAAQ,CAAC8sB,IAAb,EAAmB;IACjB9sB,QAAQ,CAAC8sB,IAAT,CAAcC,WAAd,CAA0B/X,KAA1B;;;EAEF0X,kBAAkB,GAAG,IAArB;;;AAGF,AAAO,SAASM,WAAT,CAAqB;EAAE55B,CAAF;EAAKC,CAAL;EAAQC;CAA7B,EAAkD;;;QAGjD25B,IAAI,GAAG,SAAS75B,CAAT,GAAa,UAAUC,CAAvB,GAA2B,SAASC,CAAjD;SACO25B,IAAI,GAAGT,oBAAd;;;AAGF,SAASU,YAAT,CAAsB35B,CAAtB,EAAgCD,CAAhC,EAAmD;SAC1CC,CAAC,CAACH,CAAF,KAAQE,CAAC,CAACF,CAAV,IAAeG,CAAC,CAACF,CAAF,KAAQC,CAAC,CAACD,CAAzB,IAA8BE,CAAC,CAACD,CAAF,KAAQA,CAAC,CAACA,CAAxC,IAA6CC,CAAC,CAACA,CAAF,KAAQD,CAAC,CAACC,CAA9D;;;AAGF,MAAM45B,WAAN,CAAkB;;EAShBh8B,WAAW,GAAG;qCARJ6O,QAAQ,CAAC4sB,aAAT,CAAuB,MAAvB,CAQI;;oCAPL5sB,QAAQ,CAAC4sB,aAAT,CAAuB,MAAvB,CAOK;;mCANN5sB,QAAQ,CAACotB,cAAT,CAAwB,EAAxB,CAMM;;4CAJUj6B,oBAIV;;0CAHSs5B,gBAGT;;sDAFuB,IAEvB;;IACZE,eAAe;SACVU,OAAL,CAAaC,SAAb,GAAyB,6BAAzB;SACKC,MAAL,CAAYD,SAAZ,GAAwB,2BAAxB;SACKD,OAAL,CAAaN,WAAb,CAAyB,KAAKQ,MAA9B;;SACKA,MAAL,CAAYR,WAAZ,CAAwB,KAAKS,KAA7B;;SACKH,OAAL,CAAarY,KAAb,CAAmBxgB,KAAnB,GAA2BI,WAAW,CAACzB,oBAAD,CAAtC;;;EAGF4jB,MAAM,CAACwH,MAAD,EAAqBntB,IAArB,EAAmCC,GAAnC,EAAgDo8B,mBAAhD,EAA+E;SAC9EJ,OAAL,CAAarY,KAAb,CAAmB0Y,SAAnB,GAAgC,aAAYt8B,IAAI,CAACyD,OAAL,EAAe,MAAKxD,GAAG,CAACwD,OAAJ,EAAc,KAA9E;UACM;MAAEL,KAAF;MAASO,MAAM,GAAG;QAAOwpB,MAA/B;UACMoP,UAAU,GAAG54B,MAAM,CAACZ,MAAP,IAAiB,CAApC;UACMy5B,SAAS,GAAGn5B,OAAO,CAACk5B,UAAU,GAAG54B,MAAM,CAAC,CAAD,CAAT,GAAeP,KAAK,IAAI,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAnC,CAAzB;;QAEIo5B,SAAJ,EAAe;YACPzZ,eAAe,GAAG1f,OAAO,CAACM,MAAM,CAAC,CAAD,CAAP,CAA/B;;UACI,CAACm4B,YAAY,CAAC,KAAKW,cAAN,EAAsBD,SAAtB,CAAjB,EAAmD;aAC5CC,cAAL,GAAsBD,SAAtB;aACKP,OAAL,CAAarY,KAAb,CAAmBxgB,KAAnB,GAA2BI,WAAW,CAACg5B,SAAD,CAAtC;;;UAGE,CAACH,mBAAD,IAAwBA,mBAAmB,KAAK,KAAKK,wBAAzD,EAAmF;;aAE5EP,MAAL,CAAYvY,KAAZ,CAAkB+Y,UAAlB,GAA+B,aAA/B;aACKC,YAAL,GAAoB,IAApB;OAHF,MAIO;YAEHP,mBAAmB,KAClB,CAAC,KAAKO,YAAN,IAAuB,KAAKA,YAAL,IAAqB,CAACd,YAAY,CAACU,SAAD,EAAY,KAAKI,YAAjB,CADvC,CADrB,EAGE;;eAEKA,YAAL,GAAoBJ,SAApB;gBACMK,eAAe,GAAGjB,WAAW,CAACY,SAAD,CAAnC;gBACMM,UAAU,GAAGD,eAAe,GAAG3B,cAAH,GAAoBC,aAAtD;eACKgB,MAAL,CAAYvY,KAAZ,CAAkB+Y,UAAlB,GAA+BG,UAA/B;SARF,MASO,IAAIP,UAAU,IAAI,KAAKK,YAAnB,IAAmC,CAACd,YAAY,CAAC/Y,eAAD,EAAkB,KAAK6Z,YAAvB,CAApD,EAA0F;;eAE1FA,YAAL,GAAoB7Z,eAApB;eACKoZ,MAAL,CAAYvY,KAAZ,CAAkB+Y,UAAlB,GAA+Bn5B,WAAW,CAACuf,eAAD,CAA1C;;;;;SAID2Z,wBAAL,GAAgCL,mBAAhC;;QAEI,KAAKD,KAAL,CAAWW,WAAX,KAA2B5P,MAAM,CAAC6P,IAAtC,EAA4C;WACrCZ,KAAL,CAAWW,WAAX,GAAyB5P,MAAM,CAAC6P,IAAP,IAAe,EAAxC;;;;;;;;AAYN,AAAe,MAAMC,IAAN,SAAmB7vB,cAAK,CAAC+mB,SAAzB,CAA0C;;;;;;6CAEE,IAAIrc,GAAJ,EAFF;;+CAGC1K,cAAK,CAAC8vB,SAAN,EAHD;;kDAehC,MAAM;UACvB,KAAKC,QAAT,EAAmB;aACZA,QAAL,CAAcjd,uBAAd,CAAsC,KAAKtD,KAA3C;;KAjBmD;;mCAqB/C,MAAM;YACNjY,OAAO,GAAG,KAAKw4B,QAArB;YACMC,cAAc,GAAG,KAAKC,eAA5B;YACM;QAAE5pB,QAAQ,EAAEyZ,OAAZ;QAAqBmP;UAAwB,KAAKz3B,KAAxD;YACM;QAAEse,OAAO,EAAEoa;UAAkB,KAAKC,iBAAxC;YACM7gB,eAAe,GAAG/X,OAAO,IAAIA,OAAO,CAAC+X,eAA3C;;UAEI,CAAC4gB,aAAD,IAAkB,CAAC34B,OAAnB,IAA8B,CAAC+X,eAAnC,EAAoD;;;;YAG9C;QACJN,SADI;QAEJA,SAAS,EAAE;UAAEhc,KAAF;UAASG;;UAClBoE,OAHJ;YAIM;QAAE8Q;UAAWiH,eAAnB;YAEM8gB,kBAAkB,GAAG,IAAInwB,GAAJ,CAAQ+vB,cAAc,CAAC5Y,IAAf,EAAR,CAA3B;;WAEK,MAAM2I,MAAX,IAAqBD,OAArB,EAA8B;cACtB;UAAEznB,IAAF;UAAQqM;YAASqb,MAAvB;cACM;UAAE3nB;YAAaC,IAArB;cACMg4B,KAAK,GAAG,KAAK1xB,OAAL,CAAavG,QAAb,EAAuBiQ,MAAvB,EAA+B2G,SAA/B,CAAd;;YACI,CAACqhB,KAAL,EAAY;;;;cAIN,CAACz9B,IAAD,EAAOC,GAAP,IAAcw9B,KAApB;;YACIz9B,IAAI,GAAG,CAAC,EAAR,IAAcC,GAAG,GAAG,CAAC,EAArB,IAA2BD,IAAI,GAAGI,KAAK,GAAG,EAA1C,IAAgDH,GAAG,GAAGM,MAAM,GAAG,EAAnE,EAAuE;;;;YAInEqT,EAAE,GAAGwpB,cAAc,CAACnlB,GAAf,CAAmBnG,IAAI,IAAIqb,MAA3B,CAAT;;YACIvZ,EAAJ,EAAQ;UACN4pB,kBAAkB,CAACnuB,MAAnB,CAA0ByC,IAAI,IAAIqb,MAAlC;SADF,MAEO;UACLvZ,EAAE,GAAG,IAAImoB,WAAJ,EAAL;UACAqB,cAAc,CAACz7B,GAAf,CAAmBmQ,IAAI,IAAIqb,MAA3B,EAAmCvZ,EAAnC;UACA0pB,aAAa,CAAC3B,WAAd,CAA0B/nB,EAAE,CAACqoB,OAA7B;;;QAGFroB,EAAE,CAAC+R,MAAH,CAAUwH,MAAV,EAAkBntB,IAAlB,EAAwBC,GAAxB,EAA6Bo8B,mBAA7B;;;WAGG,MAAM7xB,GAAX,IAAkBgzB,kBAAlB,EAAsC;cAC9B5pB,EAAE,GAAGwpB,cAAc,CAACnlB,GAAf,CAAmBzN,GAAnB,CAAX;;YACI,CAACoJ,EAAL,EAAS;;;;QAGTA,EAAE,CAACqoB,OAAH,CAAWyB,MAAX;QACAN,cAAc,CAAC/tB,MAAf,CAAsB7E,GAAtB;;KAtEmD;;qCA0E7C,CAACsB,KAAD,EAAe2J,MAAf,EAAsC2G,SAAtC,KAAgE;YAClEnb,GAAG,GAAG,CAAC6K,KAAK,CAACzJ,CAAP,EAAUyJ,KAAK,CAACxJ,CAAhB,EAAmBwJ,KAAK,CAACvJ,CAAzB,CAAZ;YACM;QAAEvC,IAAF;QAAQC,GAAR;QAAaG,KAAb;QAAoBG;UAAW6b,SAArC;YACMlb,QAAQ,GAAG,CAAClB,IAAD,EAAOC,GAAP,EAAYG,KAAZ,EAAmBG,MAAnB,CAAjB;aACOkV,MAAM,CAAC5J,aAAP,CAAqB3K,QAArB,EAA+BD,GAA/B,CAAP;KA9EqD;;;EASvD2Q,iBAAiB,GAAG;QACd,KAAKurB,QAAT,EAAmB;WACZA,QAAL,CAAc9c,qBAAd,CAAoC,KAAKzD,KAAzC;;;;EAsEJpJ,MAAM,GAAG;WAELpG,6BAACA,cAAD,CAAO,QAAP,QACEA;MAAK,GAAG,EAAE,KAAKmwB;MADjB,EAEEnwB,6BAAC,qBAAD,CAAuB,QAAvB,QACIsK,GAAD,IAAgC;UAC3BA,GAAJ,EAAS;aACFylB,QAAL,GAAgBzlB,GAAhB;;;aAEK,IAAP;KALJ,CAFF,CADF;;;;;gBAlFiBulB,sBAKG;EACpBxpB,QAAQ,EAAE;;;ACjId;;;;;;;;;;;;;;;;;;;;;;AA0DA,MAAMkqB,cAAc,GAAG,EAAvB;AACA,MAAMC,kBAAkB,GAAG,GAA3B;AACA,MAAMC,UAAU,GAAG,CAAnB;AACA,MAAMC,MAAM,GAAG,IAAf;AACA,MAAMC,MAAM,GAAG,EAAf;AAEA,MAAM7C,gBAAc,GAAGj0B,MAAM,CAACC,MAAP,CAAc;EAAElF,CAAC,EAAE,CAAL;EAAQC,CAAC,EAAE,CAAX;EAAcC,CAAC,EAAE,CAAjB;EAAoBC,CAAC,EAAE;CAArC,CAAvB;AACA,MAAMg5B,eAAa,GAAGl0B,MAAM,CAACC,MAAP,CAAc;EAAElF,CAAC,EAAE,CAAL;EAAQC,CAAC,EAAE,CAAX;EAAcC,CAAC,EAAE,CAAjB;EAAoBC,CAAC,EAAE;CAArC,CAAtB;AAEA,MAAM67B,oBAAoB,GAAGC,UAAU,CAAEC,IAAD,IAAU;QAC1C5e,MAAM,GAAG1Q,QAAQ,CAAC4sB,aAAT,CAAuB,QAAvB,CAAf;QACM9jB,GAAG,GAAG4H,MAAM,CAAC6e,UAAP,CAAkB,IAAlB,CAAZ;EACAzmB,GAAG,CAACwmB,IAAJ,GAAWA,IAAX;SACOxmB,GAAP;CAJqC,CAAvC;;AAOA,MAAM0mB,kBAAkB,GAAIjR,MAAD,IAAgC;QACnD;IAAE9qB,CAAF;IAAKC,CAAL;IAAQC;MAAM4qB,MAAM,CAAC1nB,IAAP,CAAYD,QAAhC,CADyD;;SAGjD,IAAGnD,CAAE,IAAGC,CAAE,IAAGC,CAAE,EAAvB;CAHF;;AAMA,MAAM87B,gBAAgB,GAAG,CAACC,OAAD,EAA+BnR,MAA/B,KAAsD;SACtEmR,OAAO,CAACrmB,GAAR,CAAYmmB,kBAAkB,CAACjR,MAAD,CAA9B,KAA2C,CAAlD;CADF;;AAIA,MAAMoR,gBAAgB,GAAG,CAACD,OAAD,EAA+BnR,MAA/B,EAAmDqR,OAAnD,KAAuE;EAC9FF,OAAO,CAAC38B,GAAR,CAAYy8B,kBAAkB,CAACjR,MAAD,CAA9B,EAAwCqR,OAAxC;CADF;;;AAKA,MAAMC,2BAA2B,GAAG,MAClCR,UAAU;AAER,CAACS,OAAD,EAAuBC,QAAvB,EAAiCC,UAAjC,EAAqDC,aAArD,KAA+F;QACvFC,OAAO,GAAG,IAAIC,OAAJ,CAAYH,UAAZ,EAAwBb,MAAxB,EAAgCF,UAAhC,EAA4CC,MAA5C,EAAoD,YAApD,EAAkE,QAAlE,CAAhB;QACMpmB,GAAG,GAAGsmB,oBAAoB,CAAE,GAAEY,UAAW,eAAf,CAAhC;MAEII,YAAY,GAAG,CAAnB;QACMC,SAAS,GAAGL,UAAU,GAAG,IAAIb,MAAnC;QACMmB,QAAQ,GAAG,EAAjB,CAN6F;;MASzF78B,CAAC,GAAG,CAAR;MACIC,CAAC,GAAG,CAAR;;OACK,MAAM68B,IAAX,IAAmBT,OAAnB,EAA4B;UACpBt+B,KAAK,GAAGsX,GAAG,CAAC0nB,WAAJ,CAAgBD,IAAhB,EAAsB/+B,KAApC;UACMi/B,EAAE,GAAGh/B,IAAI,CAACgrB,IAAL,CAAUjrB,KAAV,IAAmB,IAAI29B,MAAlC;;QACI17B,CAAC,GAAGg9B,EAAJ,GAASR,aAAb,EAA4B;MAC1Bx8B,CAAC,GAAG,CAAJ;MACAC,CAAC,IAAI28B,SAAL;;;IAEFC,QAAQ,CAACC,IAAD,CAAR,GAAiB;MAAE98B,CAAF;MAAKC,CAAL;MAAQlC;KAAzB;IACAiC,CAAC,IAAIg9B,EAAL;IACAL,YAAY,GAAG3+B,IAAI,CAAC+J,GAAL,CAAS40B,YAAT,EAAuB38B,CAAvB,CAAf;;;QAGIi9B,aAAa,GAAGh9B,CAAC,GAAG28B,SAA1B;QACMM,WAAW,GAAG,IAAIvhB,UAAJ,CAAeghB,YAAY,GAAGM,aAA9B,CAApB,CAxB6F;;OA2BxF,MAAMH,IAAX,IAAmBT,OAAnB,EAA4B;UACpB;MAAEr8B,CAAF;MAAKC;QAAM48B,QAAQ,CAACC,IAAD,CAAzB;UACM/4B,IAAI,GAAG04B,OAAO,CAACjhB,IAAR,CAAashB,IAAb,CAAb;;SACK,IAAIn8B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG87B,OAAO,CAAC1wB,IAA5B,EAAkCpL,CAAC,EAAnC,EAAuC;WAChC,IAAIyoB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqT,OAAO,CAAC1wB,IAA5B,EAAkCqd,CAAC,EAAnC,EAAuC;;YAEjCppB,CAAC,GAAGopB,CAAJ,GAAQuT,YAAZ,EAA0B;UACxBO,WAAW,CAACP,YAAY,IAAI18B,CAAC,GAAGU,CAAR,CAAZ,GAAyBX,CAAzB,GAA6BopB,CAA9B,CAAX,GAA8CrlB,IAAI,CAACpD,CAAC,GAAG87B,OAAO,CAAC1wB,IAAZ,GAAmBqd,CAApB,CAAlD;;;;;;SAMD;IACLyT,QADK;IAELF,YAFK;IAGLM,aAHK;IAILC;GAJF;CA1CM,CADZ;;AAoDA,MAAMC,8BAA8B,GAAG,MACrCvB,UAAU,CAAC,CAACwB,SAAD,EAA4BC,YAA5B,KAAkD;EAC3DA,YAAY,CAAC;IACXt5B,IAAI,EAAEq5B,SAAS,CAACF,WADL;IAEXn/B,KAAK,EAAEq/B,SAAS,CAACT,YAFN;IAGXz+B,MAAM,EAAEk/B,SAAS,CAACH,aAHP;IAIXK,MAAM,EAAE,OAJG;IAKXC,IAAI,EAAE,OALK;IAMXC,GAAG,EAAE,QANM;IAOXj1B,GAAG,EAAE;GAPK,CAAZ;CADQ,CADZ;;AAaA,MAAM1F,MAAI,GAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAAd;AA4GA,MAAMgiB,MAAI,GAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAAd;;AAuDA,SAAS4Y,eAAT,CAAyBC,QAAzB,EAA8C;;QAEtCrB,OAAO,GAAG,IAAIrxB,GAAJ,CAAQ0yB,QAAQ,IAAI,EAApB,CAAhB;QACMC,qBAAqB,GAAGvB,2BAA2B,EAAzD;QACMwB,wBAAwB,GAAGT,8BAA8B,EAA/D;;QAEMv6B,OAAO,GAAIgB,IAAD,IAAe;UACvBy5B,YAAY,GAAGz5B,IAAI,CAACi6B,OAAL,EAArB;UAEMC,QAAQ,GAAGl6B,IAAI,CAAC;;;;;MAKpBpB,KAAK,EAAE;QACLd,MAAM,EAAE,CAAC2T,GAAD,EAAM9S,KAAN,KAAiBA,KAAK,CAAC8rB,cAAN,GAAuB,KAAvB,GAA+BhsB,YAAY,CAACX,MAAb,CAAoB2T,GAApB,EAAyB9S,KAAzB,CADnD;QAELH,IAAI,EAAE,CAACiT,GAAD,EAAM9S,KAAN,KAAiBA,KAAK,CAAC8rB,cAAN,GAAuB,KAAvB,GAA+BhsB,YAAY,CAACD,IAAb,CAAkBiT,GAAlB,EAAuB9S,KAAvB;OAPpC;MASpBG,KAAK,EAAED,YATa;MAUpBysB,SAAS,EAAE,gBAVS;YAWpBrsB,MAXoB;YAYpBgiB,MAZoB;MAapB/hB,QAAQ,EAAE;QACRi7B,KAAK,EAAEV,YADC;QAERW,SAAS,EAAE,MAAM,CAACX,YAAY,CAACt/B,KAAd,EAAqBs/B,YAAY,CAACn/B,MAAlC,CAFT;QAGRujB,QAAQ,EAAE7d,IAAI,CAACqkB,IAAL,CAAU,YAAV,CAHF;QAIRgW,MAAM,EAAExC,MAJA;QAKRpN,cAAc,EAAEzqB,IAAI,CAACqkB,IAAL,CAAU,gBAAV,CALR;QAMRiW,kBAAkB,EAAEt6B,IAAI,CAACqkB,IAAL,CAAU,oBAAV,CANZ;QAORhM,QAAQ,EAAErY,IAAI,CAACqkB,IAAL,CAAU,UAAV,CAPF;QAQRjf,cAAc,EAAEpF,IAAI,CAACtB,OAAL,CAAa,gBAAb,CARR;QASRyG,aAAa,EAAEnF,IAAI,CAACtB,OAAL,CAAa,eAAb,CATP;QAUR+G,aAAa,EAAEzF,IAAI,CAACtB,OAAL,CAAa,eAAb,CAVP;QAWR67B,UAAU,EAAEv6B,IAAI,CAACtB,OAAL,CAAa,MAAb;OAxBM;MA0BpBwiB,SAAS,EAAElhB,IAAI,CAACqkB,IAAL,CAAU,WAAV,CA1BS;MA2BpBzmB,KAAK,EAAE,CA3Ba;MA4BpB4b,UAAU,EAAE;QACVja,QAAQ,EAAE,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAAS,CAAC,CAAD,EAAI,CAAC,CAAL,CAAT,EAAkB,CAAC,CAAD,EAAI,CAAJ,CAAlB,EAA0B,CAAC,CAAD,EAAI,CAAC,CAAL,CAA1B,CADA;QAEVi7B,QAAQ,EAAE,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAAS,CAAC,CAAD,EAAI,CAAJ,CAAT,EAAiB,CAAC,CAAD,EAAI,CAAJ,CAAjB,EAAyB,CAAC,CAAD,EAAI,CAAJ,CAAzB,CAFA;;QAGVC,SAAS,EAAE,CAAChpB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAAC+7B,UAAhB;UAA4Bt6B,OAAO,EAAE;SAAtD,CAHD;QAIVu6B,UAAU,EAAE,CAAClpB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACi8B,WAAhB;UAA6Bx6B,OAAO,EAAE;SAAvD,CAJF;QAKVy6B,QAAQ,EAAE,CAACppB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACm8B,SAAhB;UAA2B16B,OAAO,EAAE;SAArD,CALA;QAMVkP,KAAK,EAAE,CAACmC,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAAC2Q,KAAhB;UAAuBlP,OAAO,EAAE;SAAjD,CANG;QAOV26B,eAAe,EAAE,CAACtpB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACo8B,eAAhB;UAAiC36B,OAAO,EAAE;SAA3D,CAPP;QAQV46B,SAAS,EAAE,CAACvpB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACq8B,SAAhB;UAA2B56B,OAAO,EAAE;SAArD,CARD;QASV66B,eAAe,EAAE,CAACxpB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACs8B,eAAhB;UAAiC76B,OAAO,EAAE;SAA3D,CATP;QAUV0c,eAAe,EAAE,CAACrL,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACme,eAAhB;UAAiC1c,OAAO,EAAE;SAA3D,CAVP;QAWV86B,cAAc,EAAE,CAACzpB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACu8B,cAAhB;UAAgC96B,OAAO,EAAE;SAA1D,CAXN;QAYV+6B,gBAAgB,EAAE,CAAC1pB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACw8B,gBAAhB;UAAkC/6B,OAAO,EAAE;SAA5D,CAZR;QAaVg7B,eAAe,EAAE,CAAC3pB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACy8B,eAAhB;UAAiCh7B,OAAO,EAAE;SAA3D,CAbP;QAcV+qB,YAAY,EAAE,CAAC1Z,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAACwsB,YAAhB;UAA8B/qB,OAAO,EAAE;SAAxD,CAdJ;QAeVi7B,eAAe,EAAE,CAAC5pB,GAAD,EAAM9S,KAAN,MAAiB;UAAEsB,MAAM,EAAEtB,KAAK,CAAC08B,eAAhB;UAAiCj7B,OAAO,EAAE;SAA3D;;KA3CA,CAArB;WA+CO,CAACzB,KAAD,EAAyC0Z,QAAzC,KAA+D;UAChEijB,kBAAkB,GAAG,CAAzB;;yBACuB38B,KAAvB,EAA8B;cAAnB;UAAEo4B;SAAiB;;YACxB,OAAOA,IAAP,KAAgB,QAApB,EAA8B;gBACtB,IAAI7iB,KAAJ,CAAW,wDAAuD,OAAO6iB,IAAK,YAA9E,CAAN;;;aAGG,MAAMmC,IAAX,IAAmBnC,IAAnB,EAAyB;YACrBuE,kBAAF;UACA7C,OAAO,CAAC1zB,GAAR,CAAYm0B,IAAZ;;;;UAIAqC,cAAc,GAAGv8B,OAAO,CAACw6B,SAA7B;YACMgC,mBAAmB,GAAGD,cAAc,GAAGv6B,MAAM,CAACud,IAAP,CAAYgd,cAAc,CAACtC,QAA3B,CAAH,GAA0C,EAApF;YACMwC,SAAS,GAAGp+B,KAAK,CAACkb,IAAN,CAAWkgB,OAAX,CAAlB;YACMiD,yBAAyB,GAAGC,UAAU,CAACF,SAAD,EAAYD,mBAAZ,CAAV,CAA2C1+B,MAA3C,KAAsD,CAAxF;;UACI,CAACy+B,cAAD,IAAmB,CAACG,yBAAxB,EAAmD;;cAG3C9C,aAAqB,GAAG54B,IAAI,CAAC47B,MAAL,CAAYC,cAAZ,IAA8B,IAA5D;QACAN,cAAc,GAAGxB,qBAAqB,CAACtB,OAAD,EAAUA,OAAO,CAACtwB,IAAlB,EAAwBnJ,OAAO,CAAC25B,UAAhC,EAA4CC,aAA5C,CAAtC;;;MAEFoB,wBAAwB,CAACuB,cAAD,EAAiB9B,YAAjB,CAAxB;YAEMmB,WAAW,GAAG,IAAI/9B,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAApB;YACMR,SAAS,GAAG,IAAIj+B,YAAJ,CAAiBy+B,kBAAjB,CAAlB;YACMZ,UAAU,GAAG,IAAI79B,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAnB,CA3BoE;;YA8B9DP,eAAe,GAAG,IAAIl+B,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAxB;YACMhsB,KAAK,GAAG,IAAIzS,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAd;YACML,eAAe,GAAG,IAAIp+B,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAxB;YACMxe,eAAe,GAAG,IAAIjgB,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAxB;YACMJ,cAAc,GAAG,IAAIr+B,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAvB;YACMH,gBAAgB,GAAG,IAAIt+B,YAAJ,CAAiBy+B,kBAAjB,CAAzB;YACMN,SAAS,GAAG,IAAIn+B,YAAJ,CAAiBy+B,kBAAjB,CAAlB;YACMnQ,YAAY,GAAG,IAAItuB,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAArB;YACMD,eAAe,GAAG,IAAIx+B,YAAJ,CAAiBy+B,kBAAkB,GAAG,CAAtC,CAAxB;YACMF,eAAe,GAAG,IAAIv+B,YAAJ,CAAiBy+B,kBAAjB,CAAxB;UAEIQ,cAAc,GAAG,CAArB,CAzCoE;;;;;;YAgD9DC,QAAQ,GAAG,IAAIlqB,GAAJ,EAAjB;;WAEK,MAAMqV,MAAX,IAAqBvoB,KAArB,EAA4B;;;YACtBq9B,UAAU,GAAG,CAAjB;YACI5/B,CAAC,GAAG,CAAR;YACIC,CAAC,GAAG+7B,gBAAgB,CAAC2D,QAAD,EAAW7U,MAAX,CAAxB;YACI+U,eAAe,GAAG,CAAtB;YACIC,SAAS,GAAG,CAAhB,CAL0B;;;;;cAUpBC,OAAO,GAAG/+B,OAAO,CACrBib,QAAQ,GAAG6O,MAAM,CAAC/pB,KAAP,IAAgB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAnB,GAAkC,mBAAA+pB,MAAM,CAACxpB,MAAP,kEAAgB,CAAhB,MAAsBwpB,MAAM,CAAC/pB,KAA7B,IAAsC83B,gBAD3D,CAAvB;cAGMvnB,OAAO,GAAG,oBAAAwZ,MAAM,CAACxpB,MAAP,oEAAgB,CAAhB,MAAsB,IAAtB,IAA8BsB,OAAO,CAACo3B,mBAAtD;cACMgG,OAAO,GAAGh/B,OAAO,CACrB,oBAAA8pB,MAAM,CAACxpB,MAAP,oEAAgB,CAAhB,OAAuBsB,OAAO,CAACo3B,mBAAR,IAA+BT,WAAW,CAACwG,OAAD,CAA1C,GAAsDlH,gBAAtD,GAAuEC,eAA9F,CADqB,CAAvB;cAGMmH,OAAO,GAAG,CAAAnV,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEgU,cAAR,KAA0B;UAAEn/B,CAAC,EAAE,CAAL;UAAQE,CAAC,EAAE,CAAX;UAAcD,CAAC,EAAE,CAAjB;UAAoBE,CAAC,EAAE;SAAjE;;aAEK,IAAIa,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmqB,MAAM,CAAC6P,IAAP,CAAYj6B,MAAhC,EAAwCC,CAAC,EAAzC,EAA6C;;;gBACrCm8B,IAAI,GAAGhS,MAAM,CAAC6P,IAAP,CAAYh6B,CAAZ,CAAb;;cACIm8B,IAAI,KAAK,IAAb,EAAmB;YACjB98B,CAAC,GAAG,CAAJ,CADiB;;YAGjBC,CAAC,IAAI2C,OAAO,CAAC25B,UAAb;YACAuD,SAAS;;;;gBAGLI,IAAI,GAAGf,cAAc,CAACtC,QAAf,CAAwBC,IAAxB,CAAb;gBACMnlB,KAAK,GAAG+nB,cAAc,GAAGG,eAA/B,CAV2C;;UAa3CrB,WAAW,CAAC,IAAI7mB,KAAJ,GAAY,CAAb,CAAX,GAA6B3X,CAA7B;UACAw+B,WAAW,CAAC,IAAI7mB,KAAJ,GAAY,CAAb,CAAX,GAA6B,CAAC1X,CAA9B;UACAq+B,UAAU,CAAC,IAAI3mB,KAAJ,GAAY,CAAb,CAAV,GAA4BuoB,IAAI,CAAClgC,CAAL,GAAS07B,MAArC,CAf2C;;;;UAmB3C4C,UAAU,CAAC,IAAI3mB,KAAJ,GAAY,CAAb,CAAV,GAA4BuoB,IAAI,CAACjgC,CAAL,GAASy7B,MAAT,GAAkB,OAAO94B,OAAO,CAAC25B,UAA7D;UACAmC,SAAS,CAAC/mB,KAAD,CAAT,GAAmBuoB,IAAI,CAACniC,KAAxB;UAEAiC,CAAC,IAAIkgC,IAAI,CAACniC,KAAV;UACA6hC,UAAU,GAAG5hC,IAAI,CAAC+J,GAAL,CAAS63B,UAAT,EAAqB5/B,CAArB,CAAb,CAvB2C;;;UA4B3C4+B,SAAS,CAACjnB,KAAD,CAAT,GAAmB,sBAAAmT,MAAM,CAAC8T,SAAP,iEAAoB,IAApB,IAA2B,CAA3B,GAA+B,CAAlD;UAEA1rB,KAAK,CAAC,IAAIyE,KAAJ,GAAY,CAAb,CAAL,GAAuBmT,MAAM,CAAC5X,KAAP,CAAalT,CAApC;UACAkT,KAAK,CAAC,IAAIyE,KAAJ,GAAY,CAAb,CAAL,GAAuBmT,MAAM,CAAC5X,KAAP,CAAajT,CAApC;UACAiT,KAAK,CAAC,IAAIyE,KAAJ,GAAY,CAAb,CAAL,GAAuBmT,MAAM,CAAC5X,KAAP,CAAahT,CAApC;UAEA6uB,YAAY,CAAC,IAAIpX,KAAJ,GAAY,CAAb,CAAZ,GAA8BmT,MAAM,CAAC1nB,IAAP,CAAYD,QAAZ,CAAqBnD,CAAnD;UACA+uB,YAAY,CAAC,IAAIpX,KAAJ,GAAY,CAAb,CAAZ,GAA8BmT,MAAM,CAAC1nB,IAAP,CAAYD,QAAZ,CAAqBlD,CAAnD;UACA8uB,YAAY,CAAC,IAAIpX,KAAJ,GAAY,CAAb,CAAZ,GAA8BmT,MAAM,CAAC1nB,IAAP,CAAYD,QAAZ,CAAqBjD,CAAnD;UAEA++B,eAAe,CAAC,IAAItnB,KAAJ,GAAY,CAAb,CAAf,GAAiCmT,MAAM,CAAC1nB,IAAP,CAAYE,WAAZ,CAAwBtD,CAAzD;UACAi/B,eAAe,CAAC,IAAItnB,KAAJ,GAAY,CAAb,CAAf,GAAiCmT,MAAM,CAAC1nB,IAAP,CAAYE,WAAZ,CAAwBrD,CAAzD;UACAg/B,eAAe,CAAC,IAAItnB,KAAJ,GAAY,CAAb,CAAf,GAAiCmT,MAAM,CAAC1nB,IAAP,CAAYE,WAAZ,CAAwBpD,CAAzD;UACA++B,eAAe,CAAC,IAAItnB,KAAJ,GAAY,CAAb,CAAf,GAAiCmT,MAAM,CAAC1nB,IAAP,CAAYE,WAAZ,CAAwB9D,CAAzD;UAEAq/B,eAAe,CAAC,IAAIlnB,KAAJ,GAAY,CAAb,CAAf,GAAiCooB,OAAO,CAACpgC,CAAzC;UACAk/B,eAAe,CAAC,IAAIlnB,KAAJ,GAAY,CAAb,CAAf,GAAiCooB,OAAO,CAACngC,CAAzC;UACAi/B,eAAe,CAAC,IAAIlnB,KAAJ,GAAY,CAAb,CAAf,GAAiCooB,OAAO,CAAClgC,CAAzC;UACAg/B,eAAe,CAAC,IAAIlnB,KAAJ,GAAY,CAAb,CAAf,GAAiCooB,OAAO,CAACjgC,CAAzC;UAEA4gB,eAAe,CAAC,IAAI/I,KAAJ,GAAY,CAAb,CAAf,GAAiCqoB,OAAO,CAACrgC,CAAzC;UACA+gB,eAAe,CAAC,IAAI/I,KAAJ,GAAY,CAAb,CAAf,GAAiCqoB,OAAO,CAACpgC,CAAzC;UACA8gB,eAAe,CAAC,IAAI/I,KAAJ,GAAY,CAAb,CAAf,GAAiCqoB,OAAO,CAACngC,CAAzC;UACA6gB,eAAe,CAAC,IAAI/I,KAAJ,GAAY,CAAb,CAAf,GAAiCqoB,OAAO,CAAClgC,CAAzC;UAEAg/B,cAAc,CAAC,IAAInnB,KAAJ,GAAY,CAAb,CAAd,GAAgCsoB,OAAO,CAACtgC,CAAxC;UACAm/B,cAAc,CAAC,IAAInnB,KAAJ,GAAY,CAAb,CAAd,GAAgCsoB,OAAO,CAACrgC,CAAxC;UACAk/B,cAAc,CAAC,IAAInnB,KAAJ,GAAY,CAAb,CAAd,GAAgCsoB,OAAO,CAACpgC,CAAxC;UACAi/B,cAAc,CAAC,IAAInnB,KAAJ,GAAY,CAAb,CAAd,GAAgCsoB,OAAO,CAACngC,CAAxC;UAEAk/B,eAAe,CAACrnB,KAAD,CAAf,GAAyBmT,MAAM,CAACqV,kBAAP,IAA6BrV,MAAM,CAACqV,kBAAP,CAA0B/f,QAA1B,CAAmCzf,CAAnC,CAA7B,GAAqE,CAArE,GAAyE,CAAlG;UAEAo+B,gBAAgB,CAACpnB,KAAD,CAAhB,GAA0BrG,OAAO,GAAG,CAAH,GAAO,CAAxC;YAEEuuB,eAAF;;;cAGIO,WAAW,GAAGngC,CAAC,GAAG2C,OAAO,CAAC25B,UAAhC;;aACK,IAAI57B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGk/B,eAApB,EAAqCl/B,CAAC,EAAtC,EAA0C;UACxCg+B,eAAe,CAAC,KAAKe,cAAc,GAAG/+B,CAAtB,IAA2B,CAA5B,CAAf,GAAgD,CAACi/B,UAAD,GAAc,CAA9D;UACAjB,eAAe,CAAC,KAAKe,cAAc,GAAG/+B,CAAtB,IAA2B,CAA5B,CAAf,GAAgDy/B,WAAW,GAAG,CAA9D;SAvFwB;;;;;;QA8F1BlE,gBAAgB,CAACyD,QAAD,EAAW7U,MAAX,EAAmBsV,WAAW,GAAGN,SAAS,GAAGl9B,OAAO,CAAC25B,UAArD,CAAhB;QAEAmD,cAAc,IAAIG,eAAlB;;;MAGF/B,QAAQ,CAAC;QACPhZ,SAAS,EAAE4a,cADJ;QAGPzjB,QAAQ,EAAE,CAAC,CAACA,QAHL;QAIPoS,cAAc,EAAEzrB,OAAO,CAACyrB,cAJjB;QAKPkO,UAAU,EAAE35B,OAAO,CAAC25B,UALb;QAMP2B,kBAAkB,EAAEt7B,OAAO,CAACs7B,kBANrB;;QASPI,UATO;QAUPE,WAVO;QAWPE,SAXO;;QAcPC,eAdO;QAePC,SAfO;QAgBPG,gBAhBO;QAiBPC,eAjBO;QAkBPH,eAlBO;QAmBPne,eAnBO;QAoBPoe,cApBO;QAqBPG,eArBO;QAsBPlQ,YAtBO;QAuBP7b;OAvBM,CAAR;KArJF;GAlDF;;EAkOAtQ,OAAO,CAACo3B,mBAAR,GAA8B,KAA9B;SACOp3B,OAAP;;;AAGF,MAAay9B,iBAAiB,GAAI99B,KAAD,IAAwB;;;QACjDK,OAAO,GAAG66B,eAAe,CAACl7B,KAAK,CAACm7B,QAAP,CAA/B,CADuD;;;EAIvD96B,OAAO,CAACo3B,mBAAR,GAA8Bz3B,KAAK,CAACy3B,mBAApC;EACAp3B,OAAO,CAAC25B,UAAR,GAAqBv+B,IAAI,CAAC+J,GAAL,CAASuzB,cAAT,EAAyB/4B,KAAK,CAACg6B,UAAN,IAAoBhB,kBAA7C,CAArB;EACA34B,OAAO,CAACyrB,cAAR,GAAyB9rB,KAAK,CAAC+9B,sBAAN,IAAgC,IAAzD;EACA19B,OAAO,CAACs7B,kBAAR,4BAA6B37B,KAAK,CAAC+9B,sBAAnC,yEAA6D,CAA7D;EACA19B,OAAO,CAACw6B,SAAR,GAAoB76B,KAAK,CAAC66B,SAA1B;SACOx6B,OAAP;CATK;AAYP,AAAe,SAAS29B,MAAT,CAAgBh+B,KAAhB,EAA8B;QACrC,CAACK,OAAD,IAAY6T,cAAQ,CAAC,MAAM4pB,iBAAiB,CAAC99B,KAAD,CAAxB,CAA1B;QACMqS,oBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;SAEOve,6BAAC,OAAD;IAAS,oBAAoB,EAAE6J,oBAA/B;IAAqD,WAAW,EAAEhS;KAAaL,KAA/E,EAAP;;;ACpjBF,SAASi+B,gBAAT,CAA0Bp4B,KAA1B,EAAmD;MAC7CA,KAAK,KAAKuB,SAAd,EAAyB;WAChBA,SAAP;GAF+C;;;UAKzCvB,KAAR;;SAEOue,qBAAqB,CAAC8Z,OAA3B;aAA2C,SAAP;;SAC/B9Z,qBAAqB,CAAC+Z,MAA3B;aAA0C,QAAP;;SAC9B/Z,qBAAqB,CAACga,sBAA3B;aAA0D,wBAAP;;SAC9Cha,qBAAqB,CAACia,qBAA3B;aAAyD,uBAAP;;SAC7Cja,qBAAqB,CAACka,qBAA3B;aAAyD,uBAAP;;SAC7Cla,qBAAqB,CAACma,oBAA3B;aAAwD,sBAAP;;;SAE5Cna,qBAAqB,CAACoa,MAA3B;aAA0C,QAAP;;SAC9Bpa,qBAAqB,CAACqa,aAA3B;aAAiD,OAAP;;SACrCra,qBAAqB,CAACsa,eAA3B;aAAmD,QAAP;;;QAExC,IAAInpB,KAAJ,CAAW,4BAA2BkO,IAAI,CAAC0D,SAAL,CAAethB,KAAf,CAAsB,EAA5D,CAAN;;;;;AAKF,MAAM84B,iBAAiB,GAAG,OAAO;EAC/BC,SAAS,EAAExa,qBAAqB,CAACia,qBADF;EAE/BQ,SAAS,EAAEza,qBAAqB,CAAC+Z,MAFF;EAG/BW,KAAK,EAAE1a,qBAAqB,CAACoa,MAHE;EAI/BO,KAAK,EAAE3a,qBAAqB,CAACoa;CAJL,CAA1B;;AAOA,MAAMQ,cAAc,GAAG,CAAC;EAAExb;CAAH,KAAc;;;MAC/BA,IAAI,CAACyb,KAAL,IAAc,IAAlB,EAAwB;WACfzb,IAAI,CAACyb,KAAZ;GAFiC;;;QAK7Brf,IAAI,GAAGvd,MAAM,CAACud,IAAP,iBAAY4D,IAAI,CAAC0b,MAAjB,uDAA2B,EAA3B,CAAb;;MACItf,IAAI,CAACzhB,MAAL,KAAgB,CAApB,EAAuB;UACf,IAAIoX,KAAJ,CAAU,qBAAV,CAAN;;;SAEKqK,IAAI,CAAC,CAAD,CAAX;CATF;;AAYA,MAAMuf,SAAS,GAAI99B,IAAD,IAAU;QACpBhB,OAAO,GAAGgB,IAAI,CAAC;IACnBsrB,SAAS,EAAE,WADQ;IAEnBxsB,KAAK,EAAED,YAFY;IAGnBK,QAAQ,EAAE;MACR6+B,WAAW,EAAE/9B,IAAI,CAACtB,OAAL,CAAa,aAAb,CADL;MAERs/B,UAAU,EAAEh+B,IAAI,CAACtB,OAAL,CAAa,YAAb,CAFJ;MAIRu/B,gBAAgB,EAAEj+B,IAAI,CAACqkB,IAAL,CAAU,kBAAV,CAJV;MAKR6Z,eAAe,EAAEl+B,IAAI,CAACqkB,IAAL,CAAU,iBAAV,CALT;MAMR8Z,UAAU,EAAEn+B,IAAI,CAACqkB,IAAL,CAAU,YAAV,CANJ;yBAOW,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAC,CAAR,CAPX;gCAQkB,GARlB;gCASkB,GATlB;MAURK,WAAW,EAAE1kB,IAAI,CAACtB,OAAL,CAAa,aAAb,CAVL;MAWR2Z,QAAQ,EAAErY,IAAI,CAACtB,OAAL,CAAa,UAAb;KAdO;IAgBnB8a,UAAU,EAAE;MACVja,QAAQ,EAAES,IAAI,CAACqkB,IAAL,CAAU,WAAV,CADA;MAEV+Z,MAAM,EAAEp+B,IAAI,CAACqkB,IAAL,CAAU,SAAV,CAFE;MAGVmW,QAAQ,EAAEx6B,IAAI,CAACqkB,IAAL,CAAU,WAAV;KAnBO;IAqBnB5D,QAAQ,EAAEzgB,IAAI,CAACqkB,IAAL,CAAU,SAAV,CArBS;IAsBnBplB,IAAI,EAAG;;;;;;;;;;;;;;;;GAtBY;IAuCnBgiB,IAAI,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;GAvCW,CAApB,CAD0B;;QAoEpBod,cAAc,GAAGr+B,IAAI,CAACC,MAAL,CAAY,CAAC,CAAD,EAAI,CAAJ,CAAZ,CAAvB;QACMq+B,YAAY,GAAGt+B,IAAI,CAACi6B,OAAL,CAAa;IAChC95B,IAAI,EAAE,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAD0B;IAEhChG,KAAK,EAAE,CAFyB;IAGhCG,MAAM,EAAE;GAHW,CAArB,CArE0B;;QA4EpBikC,YAAY,GAAGC,WAAW,CAAEC,KAAD,IAAqB;;UAE9C;MAAE9b;QAAc8b,KAAtB;UACMC,QAAQ,GACZD,KAAK,CAACtc,IAAN,CAAWuc,QAAX,IACAD,KAAK,CAACtc,IAAN,CAAWuc,QAAX,CAAoB7qB,GAApB,CAAyB8qB,WAAD,IAAiB;YACjCC,OAAO,GAAGD,WAAW,CAACC,OAAZ,GAAsBH,KAAK,CAACtc,IAAN,CAAW0c,QAAX,CAAoBF,WAAW,CAACC,OAAhC,CAAtB,GAAiEtB,iBAAiB,EAAlG;YACMwB,MAAM,GAAGL,KAAK,CAAC3a,MAAN,IAAgB2a,KAAK,CAAC3a,MAAN,CAAa6a,WAAW,CAACI,MAAzB,CAA/B;YACM9E,OAAO,GAAGj6B,IAAI,CAACi6B,OAAL,CAAa;QAC3B95B,IAAI,EAAE2+B,MADqB;QAE3Bn6B,GAAG,EAAEi4B,gBAAgB,CAACgC,OAAO,CAACrB,SAAT,CAFM;QAG3B3D,GAAG,EAAEgD,gBAAgB,CAACgC,OAAO,CAACpB,SAAT,CAHM;QAI3BC,KAAK,EAAEb,gBAAgB,CAACgC,OAAO,CAACnB,KAAT,CAJI;QAK3BC,KAAK,EAAEd,gBAAgB,CAACgC,OAAO,CAAClB,KAAT;OALT,CAAhB;aAOOzD,OAAP;KAVF,CAFF;;QAcIwE,KAAK,CAAC3a,MAAV,EAAkB;MAChB2a,KAAK,CAAC3a,MAAN,CAAatX,OAAb,CAAsBsyB,MAAD,IAAyBA,MAAM,CAACE,KAAP,EAA9C;;;UAGI1mB,SAAS,GAAG,EAAlB,CArBoD;;aAuB3C2mB,QAAT,CAAkBC,IAAlB,EAAwBf,UAAxB,EAAoC;WAC7B,MAAM7S,SAAX,IAAwB4T,IAAI,CAACC,UAA7B,EAAyC;cACjCC,QAAQ,GAAGX,KAAK,CAACtc,IAAN,CAAWkd,SAAX,CAAqB/T,SAAS,CAAC8T,QAA/B,CAAjB;cACME,OAAO,GAAGF,QAAQ,CAACG,oBAAT,CAA8BtB,gBAA9C;;YACI,CAACtb,SAAL,EAAgB;gBACR,IAAIzO,KAAJ,CAAU,4DAAV,CAAN;;;QAEFoE,SAAS,CAACrM,IAAV,CAAe;UACbwoB,OAAO,EAAE9R,SAAS,CAAC2I,SAAS,CAACmJ,OAAX,CADL;UAEbjU,SAAS,EAAEmC,SAAS,CAAC2I,SAAS,CAAC9R,UAAV,CAAqBgmB,QAAtB,CAFP;UAGbC,OAAO,EAAE9c,SAAS,CAAC2I,SAAS,CAAC9R,UAAV,CAAqBkmB,MAAtB,CAHL;UAIbC,SAAS,EAAEL,OAAO,GACd3c,SAAS,CAAC2I,SAAS,CAAC9R,UAAV,CAAsB,YAAW8lB,OAAO,CAAC9E,QAAR,IAAoB,CAAE,EAAvD,CAAD,CADK,GAEd;YAAEp6B,OAAO,EAAE,CAAX;YAAcH,MAAM,EAAEo+B;WANb;UAObJ,gBAAgB,EAAEqB,OAAO,GAAGZ,QAAQ,CAACY,OAAO,CAACvrB,KAAT,CAAX,GAA6BuqB,YAPzC;UAQbJ,eAAe,EAAEkB,QAAQ,CAACG,oBAAT,CAA8BrB,eAA9B,IAAiD,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CARrD;UASbC;SATF;;KA9BgD;;;aA6C3CyB,QAAT,CAAkBC,IAAlB,EAAwBC,YAAxB,EAAsC;YAC9B3B,UAAU,GAAG0B,IAAI,CAACE,MAAL,GACf98B,aAAI,CAAC+8B,KAAL,CAAWH,IAAI,CAACE,MAAhB,CADe,GAEf98B,aAAI,CAACg9B,4BAAL,CACEh9B,aAAI,CAACO,MAAL,EADF,EAEEq8B,IAAI,CAACK,QAAL,IAAiB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAFnB,EAGEL,IAAI,CAACM,WAAL,IAAoB,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHtB,EAIEN,IAAI,CAACvwB,KAAL,IAAc,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAJhB,CAFJ;MAQArM,aAAI,CAACm9B,GAAL,CAASjC,UAAT,EAAqB2B,YAArB,EAAmC3B,UAAnC;;UACI0B,IAAI,CAACX,IAAL,IAAa,IAAjB,EAAuB;QACrBD,QAAQ,CAACR,KAAK,CAACtc,IAAN,CAAWke,MAAX,CAAkBR,IAAI,CAACX,IAAvB,CAAD,EAA+Bf,UAA/B,CAAR;;;UAEE0B,IAAI,CAACryB,QAAT,EAAmB;aACZ,MAAM8yB,QAAX,IAAuBT,IAAI,CAACryB,QAA5B,EAAsC;UACpCoyB,QAAQ,CAACnB,KAAK,CAACtc,IAAN,CAAWoe,KAAX,CAAiBD,QAAjB,CAAD,EAA6BnC,UAA7B,CAAR;;;KA5D8C;;;;SAmE/C,MAAMqC,OAAX,IAAsB/B,KAAK,CAACtc,IAAN,CAAW0b,MAAX,CAAkBF,cAAc,CAACc,KAAD,CAAhC,EAAyC8B,KAA/D,EAAsE;YAC9DE,aAAa,GAAGx9B,aAAI,CAACO,MAAL,EAAtB;MACAP,aAAI,CAACP,OAAL,CAAa+9B,aAAb,EAA4BA,aAA5B,EAA2CrmC,IAAI,CAACwJ,EAAL,GAAU,CAArD;MACAX,aAAI,CAAC4kB,OAAL,CAAa4Y,aAAb,EAA4BA,aAA5B,EAA2CrmC,IAAI,CAACwJ,EAAL,GAAU,CAArD;MACAg8B,QAAQ,CAACnB,KAAK,CAACtc,IAAN,CAAWoe,KAAX,CAAiBC,OAAjB,CAAD,EAA4BC,aAA5B,CAAR;;;WAEKnoB,SAAP;GAzE8B,CAAhC,CA5E0B;;QAyJpBooB,WAAW,GAAG1gC,IAAI,CAAC;IACvBtB,OAAO,EAAE;MACPs/B,UAAU,EAAE,CAACt/B,OAAD,EAAUC,KAAV,KACVsE,aAAI,CAACg9B,4BAAL,CACEh9B,aAAI,CAACO,MAAL,EADF,EAEEjH,iBAAiB,CAACoC,KAAK,CAACa,IAAN,CAAWE,WAAZ,CAFnB,EAGEvD,WAAW,CAACwC,KAAK,CAACa,IAAN,CAAWD,QAAZ,CAHb,EAIEZ,KAAK,CAAC2Q,KAAN,GAAcnT,WAAW,CAACwC,KAAK,CAAC2Q,KAAP,CAAzB,GAAyC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAJ3C,CAFK;MAQPyuB,WAAW,EAAE,CAACr/B,OAAD,EAAUC,KAAV,KAAqBA,KAAK,CAACL,KAAN,IAAe,IAAf,GAAsB,CAAtB,GAA0BK,KAAK,CAACL,KAR3D;MASPomB,WAAW,EAAE,CAAChmB,OAAD,EAAUC,KAAV,KAAoBA,KAAK,CAACxB,KAAN,IAAe,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CATzC;MAUPkb,QAAQ,EAAE,CAAC3Z,OAAD,EAAUC,KAAV,KAAoB,CAAC,CAACA,KAAK,CAAC0Z;;GAXlB,CAAxB;SAeO,CAAC1Z,KAAD,EAAQ0Z,QAAR,KAAqB;UACpBC,SAAS,GAAGimB,YAAY,CAAC5/B,KAAK,CAAC8/B,KAAP,CAA9B;IACAiC,WAAW,CAACroB,QAAQ,qBAAQ1Z,KAAR;MAAe0Z;SAAa1Z,KAArC,EAA4C,MAAM;MAC3DK,OAAO,CAACsZ,SAAD,CAAP;KADS,CAAX;GAFF;CAxKF;;AA8LA,SAASqoB,aAAT,CAA0B70B,EAA1B,EAAgD80B,IAAhD,EAAoE;QAC5D,CAACp8B,KAAD,EAAQq8B,QAAR,IAAoBhuB,cAAQ,EAAlC;EACAY,eAAS,CACPF,iBAAW,CAAC,MAAM;QACZutB,QAAQ,GAAG,KAAf;IACAh1B,EAAE,GAAGgK,IAAL,CAAWlZ,MAAD,IAAY;UAChB,CAACkkC,QAAL,EAAe;QACbD,QAAQ,CAACjkC,MAAD,CAAR;;KAFJ;WAKO,MAAM;MACXkkC,QAAQ,GAAG,IAAX;MACAD,QAAQ,CAAC96B,SAAD,CAAR;KAFF;GAPS,EAWR66B,IAAI,IAAI,CAAC90B,EAAD,CAXA,CADJ,EAaP80B,IAAI,IAAI,CAAC90B,EAAD,CAbD,CAAT;SAeOtH,KAAP;;;AAGF,SAASu8B,QAAT,CAAkBtC,KAAlB,EAAwE;EACtEuC,mBAAa,CAACvC,KAAD,CAAb;SACOkC,aAAa,CAAC,YAAY;QAC3B,OAAOlC,KAAP,KAAiB,UAArB,EAAiC;aACxBA,KAAK,EAAZ;;;QAEE,OAAOA,KAAP,KAAiB,QAArB,EAA+B;YACvBwC,QAAQ,GAAG,MAAMC,KAAK,CAACzC,KAAD,CAA5B;;UACI,CAACwC,QAAQ,CAACE,EAAd,EAAkB;cACV,IAAIjtB,KAAJ,CAAW,+BAA8B+sB,QAAQ,CAACG,MAAO,EAAzD,CAAN;;;aAEKjgB,QAAQ,EAAC,MAAM8f,QAAQ,CAAC7f,WAAT,EAAP,EAAf;;;;;UAII,IAAIlN,KAAJ,CAAW,2BAA0B,OAAOuqB,KAAM,EAAlD,CAAN;GAbkB,EAcjB,CAACA,KAAD,CAdiB,CAApB;;;AAiBF,AAAe,SAAS4C,SAAT,CAAmB1iC,KAAnB,EAAiC;QACxC;IAAE6O,QAAF;IAAYixB;MAAmB9/B,KAArC;QAA4Bqa,IAA5B,4BAAqCra,KAArC;;QAEMD,OAAO,GAAG4iC,gBAAU,CAACC,qBAAD,CAA1B;QACMC,WAAW,GAAGT,QAAQ,CAACtC,KAAD,CAA5B;EACAhrB,eAAS,CAAC,MAAM;QACV/U,OAAJ,EAAa;MACXA,OAAO,CAAC2e,OAAR;;GAFK,EAIN,CAAC3e,OAAD,EAAU8iC,WAAV,CAJM,CAAT;;MAMI,CAACA,WAAL,EAAkB;WACT,IAAP;;;SAIAr6B,6BAAC,OAAD,eAAa6R,IAAb;IAAmB,WAAW,EAAE8kB,SAAhC;IAA2C,oBAAoB,EAAEhZ;wBACzDtX,QADR;IACkBixB,KAAK,EAAE+C,WADzB;IACsChd,cAAc,EAAEhX;KAFxD;;;ACnSF,MAAMi0B,kBAAkB,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,CAAhB,CAA3B;AAEA,AAAO,SAASC,IAAT,GAAgB;SACd3iC,QAAQ,CAAC;IACdE,IAAI,EAAG;;;;;;;;;;;;;KADO;IAedgiB,IAAI,EAAG;;;;;;KAfO;IAsBdqK,SAAS,EAAE,OAtBG;IAuBd9R,UAAU,EAAE;MACV3T,KAAK,EAAE,CAACnH,OAAD,EAAUC,KAAV,KAAoB;cACnBhC,MAAM,GAAG,EAAf;cACMglC,KAAK,GAAGhjC,KAAK,CAACf,KAApB;;aACK,IAAIb,CAAC,GAAG,CAAC4B,KAAK,CAACf,KAApB,EAA2Bb,CAAC,GAAG4B,KAAK,CAACf,KAArC,EAA4Cb,CAAC,EAA7C,EAAiD;UAC/CJ,MAAM,CAACsP,IAAP,CAAY,CAAC,CAAC01B,KAAF,EAAS5kC,CAAT,EAAY,CAAZ,CAAZ;UACAJ,MAAM,CAACsP,IAAP,CAAY,CAAC01B,KAAD,EAAQ5kC,CAAR,EAAW,CAAX,CAAZ;UACAJ,MAAM,CAACsP,IAAP,CAAY,CAAClP,CAAD,EAAI,CAAC4kC,KAAL,EAAY,CAAZ,CAAZ;UACAhlC,MAAM,CAACsP,IAAP,CAAY,CAAClP,CAAD,EAAI4kC,KAAJ,EAAW,CAAX,CAAZ;;;eAEKhlC,MAAP;OAVQ;MAYVQ,KAAK,EAAE,CAACuB,OAAD,EAAUC,KAAV,KAAoB;cACnBxB,KAAK,GAAGwB,KAAK,CAACxB,KAAN,IAAeskC,kBAA7B;eACO,IAAIpkC,KAAJ,CAAUsB,KAAK,CAACf,KAAN,GAAc,CAAd,GAAkB,CAA5B,EAA+BgW,IAA/B,CAAoCzW,KAApC,CAAP;;KArCU;IAwCdS,KAAK,EAAE,CAACc,OAAD,EAAUC,KAAV,KAAoB;;YAEnBf,KAAK,GAAGe,KAAK,CAACf,KAAN,GAAc,CAAd,GAAkB,CAAhC;aACOA,KAAP;;GA3CW,CAAf;;;AAuDF,AAAe,SAASgkC,IAAT,OAAyC;MAA3B;IAAEhkC;GAAyB;MAAfob,IAAe;;QAChDxL,QAAQ,GAAG;IAAE5P;GAAnB;SAEEuJ,6BAAC,OAAD;IAAS,oBAAoB,EAAEwd;KAAsC3L,IAArE;IAA2E,WAAW,EAAE0oB;MACrFl0B,QADH,CADF;;AAOFo0B,IAAI,CAACC,YAAL,GAAoB;EAAEjkC,KAAK,EAAE;CAA7B;;AClDA;;AAEA,AAAe,MAAMkkC,OAAN,SAAkC36B,eAAlC,CAAmE;;;;;;mCAExE;MAAE2sB,KAAK,EAAE;KAF+D;;kDAUzD,MAAM;UACvB,KAAKoD,QAAT,EAAmB;aACZA,QAAL,CAAcjd,uBAAd,CAAsC,KAAKtD,KAA3C;;KAZ4E;;mCAgBxE,MAAM;YACNjY,OAAO,GAAG,KAAKw4B,QAArB;YACM/gB,SAAS,GAAGzX,OAAO,IAAIA,OAAO,CAACyX,SAArC;YACM;QAAE4rB,UAAF;QAAcv0B;UAAa,KAAK7O,KAAtC;;UACI,CAACD,OAAD,IAAY,CAACyX,SAAjB,EAA4B;;;;YAGtB2d,KAAK,GAAGtmB,QAAQ,CAACqG,GAAT,CAAa,CAAC/B,IAAD,EAAOiC,KAAP,KAAiB;cACpCiuB,WAAW,GAAG,KAAKl8B,OAAL,CAAagM,IAAI,CAACtS,IAAL,CAAUD,QAAvB,EAAiCb,OAAjC,CAApB;eACOqjC,UAAU,CAAC;UAAEjwB,IAAF;UAAQiC,KAAR;UAAeiuB,WAAf;UAA4B7rB;SAA7B,CAAjB;OAFY,CAAd;WAIKgH,QAAL,CAAc;QAAE2W;OAAhB;KA3B8E;;qCA8BtE,CAACjuB,KAAD,EAAenH,OAAf,KAAyD;UAC7D,CAACA,OAAD,IAAY,CAACA,OAAO,CAAC+X,eAAzB,EAA0C;;;;YAGpC;QAAEN;UAAczX,OAAtB;YACM;QAAE8Q;UAAW9Q,OAAO,CAAC+X,eAA3B;YAEMzb,GAAG,GAAG,CAAC6K,KAAK,CAACzJ,CAAP,EAAUyJ,KAAK,CAACxJ,CAAhB,EAAmBwJ,KAAK,CAACvJ,CAAzB,CAAZ;YACM;QAAEvC,IAAF;QAAQC,GAAR;QAAaG,KAAb;QAAoBG;UAAW6b,SAArC;YACMlb,QAAQ,GAAG,CAAClB,IAAD,EAAOC,GAAP,EAAYG,KAAZ,EAAmBG,MAAnB,CAAjB;aACOkV,MAAM,CAAC5J,aAAP,CAAqB3K,QAArB,EAA+BD,GAA/B,CAAP;KAxC8E;;;EAIhF2Q,iBAAiB,GAAG;QACd,KAAKurB,QAAT,EAAmB;WACZA,QAAL,CAAc9c,qBAAd,CAAoC,KAAKzD,KAAzC;;;;EAqCJpJ,MAAM,GAAG;WAELE,oBAACsR,cAAD,QACEtR,oBAAC,qBAAD,CAAuB,QAAvB,QACIgE,GAAD,IAAgC;UAC3BA,GAAJ,EAAS;aACFylB,QAAL,GAAgBzlB,GAAhB;;;aAEK,KAAKnQ,KAAL,CAAWwyB,KAAlB;KALJ,CADF,CADF;;;;;MCnDSmO,iBAAiB,GAAG,CAAC;EAAEC;CAAH,KAAwC;SAC/DliC,IAAD,IAAgB;UACf,CAACmiC,iBAAD,EAAoBC,iBAApB,IAAyCpiC,IAAI,CAAC47B,MAAL,CAAYyG,aAA3D;WACOtjC,QAAQ,CAAC;MACdusB,SAAS,EAAE,QADG;MAEdrsB,IAAI,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAFO;MAiDdgiB,IAAI,EAAG;;;;;;KAjDO;MAwDdzH,UAAU,EAAE;QACV3T,KAAK,EAAE,CAACnH,OAAD,EAAUC,KAAV,KAAoB;iBAClBA,KAAK,CAAChC,MAAN,CAAakX,GAAb,CAAkBhO,KAAD,IAAYxI,KAAK,CAACC,OAAN,CAAcuI,KAAd,IAAuBA,KAAvB,GAA+B1J,WAAW,CAAC0J,KAAD,CAAvE,CAAP;SAFQ;QAIV1I,KAAK,EAAE,CAACuB,OAAD,EAAUC,KAAV,KAAoB;gBACnBjB,MAAM,GAAGiC,eAAe,CAAChB,KAAD,CAA9B;iBACOjB,MAAP;;OA9DU;MAkEdwB,QAAQ,EAAE;QACRojC,SAAS,EAAE,CAAC5jC,OAAD,EAAUC,KAAV,KAAoB;iBACtBA,KAAK,CAAC2Q,KAAN,CAAYlT,CAAZ,IAAiB,CAAxB;SAFM;QAIR8lC,iBAAiB,EAAE,CAAC,CAACA,iBAJb;QAKR/8B,aAAa,EAAEnF,IAAI,CAACtB,OAAL,CAAa,eAAb,CALP;QAMR0G,cAAc,EAAEpF,IAAI,CAACtB,OAAL,CAAa,gBAAb,CANR;QAOR6jC,YAAY,EAAEJ,iBAPN;QAQRK,YAAY,EAAEJ;OA1EF;MA6EdxkC,KAAK,EAAEoC,IAAI,CAACqkB,IAAL,CAAU,eAAV;KA7EM,CAAf;GAFF;CADK;AAqFP,MAAMrT,sBAAoB,GAAG0U,mCAAmC,CAAC,CAAD,CAAhE;AACA,AAAe,SAAS+c,MAAT,CAAgB9jC,KAAhB,EAA8B;QACrC,CAACK,OAAD,IAAY6T,cAAQ,CAAC,MAAMovB,iBAAiB,CAACtjC,KAAD,CAAxB,CAA1B;SACOwI,6BAAC,OAAD;IAAS,oBAAoB,EAAE6J;KAA0BrS,KAAzD;IAAgE,WAAW,EAAEK;KAApF;;;AChHF;;ACAA;;ACAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}